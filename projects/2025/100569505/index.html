<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>


  <!--radix_placeholder_meta_tags-->
<title>Data Visualization | MSc CSS: Calgary</title>

<meta property="description" itemprop="description" content="A visualization of travel times by bike and transit in the city of Calgary."/>

<link rel="canonical" href="https://csslab.uc3m.es/dataviz/projects/2025/100569505/"/>
<link rel="license" href="https://creativecommons.org/licenses/by/4.0/"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2026-01-08"/>
<meta property="article:created" itemprop="dateCreated" content="2026-01-08"/>
<meta name="article:author" content="Miguel Agenjo"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="Data Visualization | MSc CSS: Calgary"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="A visualization of travel times by bike and transit in the city of Calgary."/>
<meta property="og:url" content="https://csslab.uc3m.es/dataviz/projects/2025/100569505/"/>
<meta property="og:image" content="https://csslab.uc3m.es/dataviz/projects/2025/100569505/100569505_files/figure-html5/plot_alternative_final-1.png"/>
<meta property="og:image:width" content="987"/>
<meta property="og:image:height" content="1344"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="Data Visualization | MSc CSS"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary_large_image"/>
<meta property="twitter:title" content="Data Visualization | MSc CSS: Calgary"/>
<meta property="twitter:description" content="A visualization of travel times by bike and transit in the city of Calgary."/>
<meta property="twitter:url" content="https://csslab.uc3m.es/dataviz/projects/2025/100569505/"/>
<meta property="twitter:image" content="https://csslab.uc3m.es/dataviz/projects/2025/100569505/100569505_files/figure-html5/plot_alternative_final-1.png"/>
<meta property="twitter:image:width" content="987"/>
<meta property="twitter:image:height" content="1344"/>

<!--  https://scholar.google.com/intl/en/scholar/inclusion.html#indexing -->
<meta name="citation_title" content="Data Visualization | MSc CSS: Calgary"/>
<meta name="citation_fulltext_html_url" content="https://csslab.uc3m.es/dataviz/projects/2025/100569505/"/>
<meta name="citation_fulltext_world_readable" content=""/>
<meta name="citation_online_date" content="2026/01/08"/>
<meta name="citation_publication_date" content="2026/01/08"/>
<meta name="citation_author" content="Miguel Agenjo"/>
<!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["creative_commons","title","description","categories","author","date","output","citation_url","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["CC BY"]},{"type":"character","attributes":{},"value":["Calgary"]},{"type":"character","attributes":{},"value":["A visualization of travel times by bike and transit in the city of Calgary."]},{"type":"character","attributes":{},"value":["2025"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["Miguel Agenjo"]}]}]},{"type":"character","attributes":{},"value":["2026-01-08"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]}]}]},{"type":"character","attributes":{},"value":["https://csslab.uc3m.es/dataviz/projects/2025/100569505/"]},{"type":"character","attributes":{},"value":["https://csslab.uc3m.es/dataviz/projects/2025/100569505/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["100569505_files/anchor-4.2.2/anchor.min.js","100569505_files/bowser-1.9.3/bowser.min.js","100569505_files/distill-2.2.21/template.v2.js","100569505_files/figure-html5/black_isochr_fastest_street_legend-1.png","100569505_files/figure-html5/find_streets_for_legend-1.png","100569505_files/figure-html5/plot_alternative_final-1.png","100569505_files/figure-html5/plot_color_legend_text-1.png","100569505_files/figure-html5/plot_color_legend-1.png","100569505_files/figure-html5/plot_example_point-1.png","100569505_files/figure-html5/plot_isochrone_island_explanation-1.png","100569505_files/figure-html5/plot_isochrones_legend-1.png","100569505_files/figure-html5/plot_north_arrow_alternative-1.png","100569505_files/figure-html5/plot_north_arrow-1.png","100569505_files/figure-html5/plot_paragraph-1.png","100569505_files/figure-html5/plot_question-1.png","100569505_files/figure-html5/plot_roads_water_isochrones-1.png","100569505_files/figure-html5/plot_roads_water-1.png","100569505_files/figure-html5/plot_scale-1.png","100569505_files/figure-html5/plot_street_arrows-1.png","100569505_files/figure-html5/plot_thin_vertical_squares-1.png","100569505_files/figure-html5/show_hexagon_grid_problem-1.png","100569505_files/figure-html5/st_remove_holes_documentation_example-1.png","100569505_files/header-attrs-2.30/header-attrs.js","100569505_files/jquery-3.6.0/jquery-3.6.0.js","100569505_files/jquery-3.6.0/jquery-3.6.0.min.js","100569505_files/jquery-3.6.0/jquery-3.6.0.min.map","100569505_files/popper-2.6.0/popper.min.js","100569505_files/tippy-6.2.7/tippy-bundle.umd.min.js","100569505_files/tippy-6.2.7/tippy-light-border.css","100569505_files/tippy-6.2.7/tippy.css","100569505_files/tippy-6.2.7/tippy.umd.min.js","100569505_files/webcomponents-2.0.0/webcomponents.js","data/hexagons.csv.gz","data/roads.csv.gz","data/water.csv.gz","original_calgary.png"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../../site_libs/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"/>
<link href="../../../site_libs/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"/>
<script src="../../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<script src="../../../site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
<script src="../../../site_libs/fuse-6.4.1/fuse.min.js"></script>

<script type="application/javascript">

function getMeta(metaName) {
  var metas = document.getElementsByTagName('meta');
  for (let i = 0; i < metas.length; i++) {
    if (metas[i].getAttribute('name') === metaName) {
      return metas[i].getAttribute('content');
    }
  }
  return '';
}

function offsetURL(url) {
  var offset = getMeta('distill:offset');
  return offset ? offset + '/' + url : url;
}

function createFuseIndex() {

  // create fuse index
  var options = {
    keys: [
      { name: 'title', weight: 20 },
      { name: 'categories', weight: 15 },
      { name: 'description', weight: 10 },
      { name: 'contents', weight: 5 },
    ],
    ignoreLocation: true,
    threshold: 0
  };
  var fuse = new window.Fuse([], options);

  // fetch the main search.json
  return fetch(offsetURL('search.json'))
    .then(function(response) {
      if (response.status == 200) {
        return response.json().then(function(json) {
          // index main articles
          json.articles.forEach(function(article) {
            fuse.add(article);
          });
          // download collections and index their articles
          return Promise.all(json.collections.map(function(collection) {
            return fetch(offsetURL(collection)).then(function(response) {
              if (response.status === 200) {
                return response.json().then(function(articles) {
                  articles.forEach(function(article) {
                    fuse.add(article);
                  });
                })
              } else {
                return Promise.reject(
                  new Error('Unexpected status from search index request: ' +
                            response.status)
                );
              }
            });
          })).then(function() {
            return fuse;
          });
        });

      } else {
        return Promise.reject(
          new Error('Unexpected status from search index request: ' +
                      response.status)
        );
      }
    });
}

window.document.addEventListener("DOMContentLoaded", function (event) {

  // get search element (bail if we don't have one)
  var searchEl = window.document.getElementById('distill-search');
  if (!searchEl)
    return;

  createFuseIndex()
    .then(function(fuse) {

      // make search box visible
      searchEl.classList.remove('hidden');

      // initialize autocomplete
      var options = {
        autoselect: true,
        hint: false,
        minLength: 2,
      };
      window.autocomplete(searchEl, options, [{
        source: function(query, callback) {
          const searchOptions = {
            isCaseSensitive: false,
            shouldSort: true,
            minMatchCharLength: 2,
            limit: 10,
          };
          var results = fuse.search(query, searchOptions);
          callback(results
            .map(function(result) { return result.item; })
          );
        },
        templates: {
          suggestion: function(suggestion) {
            var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
              ? `<img src="${offsetURL(suggestion.preview)}"</img>`
              : '';
            var html = `
              <div class="search-item">
                <h3>${suggestion.title}</h3>
                <div class="search-item-description">
                  ${suggestion.description || ''}
                </div>
                <div class="search-item-preview">
                  ${img}
                </div>
              </div>
            `;
            return html;
          }
        }
      }]).on('autocomplete:selected', function(event, suggestion) {
        window.location.href = offsetURL(suggestion.path);
      });
      // remove inline display style on autocompleter (we want to
      // manage responsive display via css)
      $('.algolia-autocomplete').css("display", "");
    })
    .catch(function(error) {
      console.log(error);
    });

});

</script>

<style type="text/css">

.nav-search {
  font-size: x-small;
}

/* Algolioa Autocomplete */

.algolia-autocomplete {
  display: inline-block;
  margin-left: 10px;
  vertical-align: sub;
  background-color: white;
  color: black;
  padding: 6px;
  padding-top: 8px;
  padding-bottom: 0;
  border-radius: 6px;
  border: 1px #0F2E3D solid;
  width: 180px;
}


@media screen and (max-width: 768px) {
  .distill-site-nav .algolia-autocomplete {
    display: none;
    visibility: hidden;
  }
  .distill-site-nav.responsive .algolia-autocomplete {
    display: inline-block;
    visibility: visible;
  }
  .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
    margin-left: 0;
    width: 400px;
    max-height: 400px;
  }
}

.algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
  width: 90%;
  outline: none;
  border: none;
}

.algolia-autocomplete .aa-hint {
  color: #999;
}
.algolia-autocomplete .aa-dropdown-menu {
  width: 550px;
  max-height: 70vh;
  overflow-x: visible;
  overflow-y: scroll;
  padding: 5px;
  margin-top: 3px;
  margin-left: -150px;
  background-color: #fff;
  border-radius: 5px;
  border: 1px solid #999;
  border-top: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
  cursor: pointer;
  padding: 5px 4px;
  border-bottom: 1px solid #eee;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
  border-bottom: none;
  margin-bottom: 2px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
  overflow: hidden;
  font-size: 0.8em;
  line-height: 1.4em;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
  font-size: 1rem;
  margin-block-start: 0;
  margin-block-end: 5px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
  display: inline-block;
  overflow: hidden;
  height: 2.8em;
  width: 80%;
  margin-right: 4%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
  display: inline-block;
  width: 15%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
  height: 3em;
  width: auto;
  display: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
  display: initial;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
  background-color: #eee;
}
.algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
  font-weight: bold;
  font-style: normal;
}

</style>


<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
  font-size: 100%;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

hr.section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  margin: 0px;
}


d-byline {
  border-top: none;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
  border-top: none;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

/* tweak for Pandoc numbered line within distill */
d-article pre.numberSource code > span {
    left: -2em;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // separator
  var separator = '<hr class="section-separator" style="clear: both"/>';
  // prepend separator above appendix
  $('.d-byline').before(separator);
  $('.d-article').before(separator);

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme, except when numbering line
  // in code chunk
  $('pre:not(.numberLines) code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      var author_name = front_matter.authors[i].author
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', author_name ? 'ORCID ID for ' + author_name : 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      const citeChild = $(this).children()[0]
      // Do not process if @xyz has been used without escaping and without bibliography activated
      // https://github.com/rstudio/distill/issues/466
      if (citeChild === undefined) return true

      if (citeChild.nodeName == "D-FOOTNOTE") {
        var fn = citeChild
        $(this).html(fn.shadowRoot.querySelector("sup"))
        $(this).id = fn.id
        fn.remove()
      }
      var refs = $(this).attr('data-cites').split(" ");
      var refHtml = refs.map(function(ref) {
        // Could use CSS.escape too here, we insure backward compatibility in navigator
        return "<p>" + $('div[id="ref-' + ref + '"]').html() + "</p>";
      }).join("\n");
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // fix footnotes in tables (#411)
    // replacing broken distill.pub feature
    $('table d-footnote').each(function() {
      // we replace internal showAtNode methode which is triggered when hovering a footnote
      this.hoverBox.showAtNode = function(node) {
        // ported from https://github.com/distillpub/template/pull/105/files
        calcOffset = function(elem) {
            let x = elem.offsetLeft;
            let y = elem.offsetTop;
            // Traverse upwards until an `absolute` element is found or `elem`
            // becomes null.
            while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                x += elem.offsetLeft;
                y += elem.offsetTop;
            }

            return { left: x, top: y };
        }
        // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
        const bbox = node.getBoundingClientRect();
        const offset = calcOffset(node);
        this.show([offset.left + bbox.width, offset.top + bbox.height]);
      }
    })

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    // ignore leaflet img layers (#106)
    figures = figures.filter(':not(img[class*="leaflet"])')
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */
</style>
<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */

@import url('https://fonts.googleapis.com/css2?family=Questrial');

html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    "Questrial", sans-serif;
  --mono-font:       monospace;
  --body-font:       "Questrial", sans-serif;
  --navbar-font:     "Questrial", sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #000e78;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #000e78;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */

@media screen and (min-width: 768px) {
  d-article aside {
    height: 0;
  }
  aside.slides {
    margin-left: -148px;
    height: auto;
  }
  aside.slides + h2 {
    white-space: nowrap;
  }
}

d-article li {
  margin-bottom: 0.1em;
}

.posts-list .post-preview .thumbnail {
  max-height: 300px;
  overflow: hidden;
}</style>
<style type="text/css">
/* base style */

/* FONT FAMILIES */

:root {
  --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

body,
.posts-list .post-preview p,
.posts-list .description p {
  font-family: var(--body-font), var(--body-default);
}

h1, h2, h3, h4, h5, h6,
.posts-list .post-preview h2,
.posts-list .description h2 {
  font-family: var(--heading-font), var(--heading-default);
}

d-article div.sourceCode code,
d-article pre code {
  font-family: var(--mono-font), var(--mono-default);
}


/*-- TITLE --*/
d-title h1,
.posts-list > h1 {
  color: var(--title-color, black);
}

d-title h1 {
  font-size: var(--title-size, 50px);
}

/*-- HEADERS --*/
d-article h1,
d-article h2,
d-article h3,
d-article h4,
d-article h5,
d-article h6 {
  color: var(--header-color, rgba(0, 0, 0, 0.8));
}

/*-- BODY --*/
d-article > p,  /* only text inside of <p> tags */
d-article > ul, /* lists */
d-article > ol {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
  font-size: var(--body-size, 1.06rem);
}


/*-- CODE --*/
d-article div.sourceCode code,
d-article pre code {
  font-size: var(--code-size, 14px);
}

/*-- ASIDE --*/
d-article aside {
  font-size: var(--aside-size, 12px);
  color: var(--aside-color, rgba(0, 0, 0, 0.6));
}

/*-- FIGURE CAPTIONS --*/
figure .caption,
figure figcaption,
.figure .caption {
  font-size: var(--fig-cap-size, 13px);
  color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
}

/*-- METADATA --*/
d-byline h3 {
  font-size: var(--heading-size, 0.6rem);
  color: var(--heading-color, rgba(0, 0, 0, 0.5));
}

d-byline {
  font-size: var(--body-size, 0.8rem);
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

d-byline a,
d-article d-byline a {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

/*-- TABLE OF CONTENTS --*/
.d-contents nav h3 {
  font-size: var(--heading-size, 18px);
}

.d-contents nav a {
  font-size: var(--contents-size, 13px);
}

/*-- APPENDIX --*/
d-appendix h3 {
  font-size: var(--heading-size, 15px);
  color: var(--heading-color, rgba(0, 0, 0, 0.65));
}

d-appendix {
  font-size: var(--text-size, 0.8em);
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

d-appendix d-footnote-list a.footnote-backlink {
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

/*-- WEBSITE HEADER + FOOTER --*/
.distill-site-header .title {
  font-size: var(--title-size, 18px);
  font-family: var(--navbar-font), var(--heading-default);
}

.distill-site-header a,
.nav-dropdown .nav-dropbtn {
  font-family: var(--navbar-font), var(--heading-default);
}

.nav-dropdown .nav-dropbtn {
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  font-size: var(--text-size, 15px);
}

.distill-site-header a:hover,
.nav-dropdown:hover .nav-dropbtn {
  color: var(--hover-color, white);
}

.distill-site-header {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer a:hover {
  color: var(--hover-color, white);
}</style>
<!--/radix_placeholder_distill-->
  <script src="../../../site_libs/header-attrs-2.30/header-attrs.js"></script>
  <script src="../../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="../../../site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="../../../site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="../../../site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="../../../site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="../../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Calgary","description":"A visualization of travel times by bike and transit in the city of Calgary.","authors":[{"author":"Miguel Agenjo","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2026-01-08T00:00:00.000+01:00","citationText":"Agenjo, 2026"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<span class="logo">
<img src="../../../assets/acronimo_0.png"/>
</span>
<a href="../../../index.html" class="title">Data Visualization | MSc CSS</a>
<input id="distill-search" class="nav-search hidden" type="text" placeholder="Search..."/>
</div>
<div class="nav-right">
<a href="../../../contents.html">Contents</a>
<a href="../../../tutorials.html">Tutorials</a>
<a href="../../../resources.html">Resources</a>
<a href="../../../projects.html">Projects</a>
<a href="https://github.com/IBiDat/dataviz" aria-label="Link to source">
<i class="fab fa-github" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Calgary</h1>

<!--radix_placeholder_categories-->
<div class="dt-tags">
  <a href="../../../projects.html#category:2025" class="dt-tag">2025</a>
</div>
<!--/radix_placeholder_categories-->
<p><p>A visualization of travel times by bike and transit in the city of Calgary.</p></p>
</div>

<div class="d-byline">

  Miguel Agenjo

<br/>2026-01-08
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#introduction" id="toc-introduction">Introduction</a></li>
<li><a href="#set-up-libraries" id="toc-set-up-libraries">Set up libraries</a></li>
<li><a href="#replica" id="toc-replica">Replica</a>
<ul>
<li><a href="#loading-the-data" id="toc-loading-the-data">Loading the data</a></li>
<li><a href="#data-transformation" id="toc-data-transformation">Data transformation</a></li>
<li><a href="#plotting" id="toc-plotting">Plotting</a></li>
</ul></li>
<li><a href="#alternative" id="toc-alternative">Alternative</a>
<ul>
<li><a href="#data-transformation-1" id="toc-data-transformation-1">Data transformation:</a></li>
<li><a href="#plotting-1" id="toc-plotting-1">Plotting</a></li>
</ul></li>
</ul>
</nav>
</div>
<h2 id="introduction">Introduction</h2>
<p>How do we decide how we move around the city? For many commuters using sustainable transport modes the choice between cycling and public transit is influenced by a decisive factor: travel time.</p>
<p>Our project is structured around a data visualization created by Willem Klumpenhouwer, which compares travel times by bike and transit in the city of Calgary, the largest city in Alberta, Canada. The map shows the difference in the time it takes to get to Calgary Tower (one of the main landmarks in the city) by bike and by transit from any point of the city.</p>
<p>Beyond assisting individual commuters, this visualization serves as a diagnostic tool for policy makers. By mapping the relative competitiveness of sustainable transport modes across the entire city, it highlights spatial inequities in transit access and identifies neighborhoods where investments in infrastructure could be more needed or effective.</p>
<figure>
<img src="original_calgary.png" class="external" style="width:100.0%" alt="Original map by Willem Klumpenhouwer" />
<figcaption aria-hidden="true">Original map by Willem Klumpenhouwer</figcaption>
</figure>
<p>The data for the map was obtained from Open Street Maps. For bike travel times, the data is purely based on distance to Calgary Tower, and does not account for elevation. Transit travel time computes the entire duration of the trip (walking to the station or stop, waiting, riding, transferring, and walking to destination). To ensure consistency, the transit travel time for each point of the map was calculated every minute between 8:00 and 9:00 AM, using the median travel time for the map; this helps avoid outliers caused by specific schedule alignments, such as the significant time penalty of just missing a connection.</p>
<p>The goal of this project is, first, to replicate the original map as closely as possible, and second, to propose an alternative visualization of the same data.</p>
<h2 id="set-up-libraries">Set up libraries</h2>
<p>We start by setting up the necessary libraries. Beyond <code>tidyverse</code> and <code>sf</code> for data manipulation and spatial operations, we rely on specific packages like <code>geojsonsf</code> to manipulate the data, <code>funkyheatmap</code>, <code>geosphere</code>, or <code>scales</code> to create the custom geometric elements required for the replication, and other libraries that aided us in building the alternative visualization. The chunk below includes a brief mention of what each library was used for:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/SymbolixAU/geojsonsf'>geojsonsf</a></span><span class='op'>)</span> <span class='co'># Used function geojson_sf to convert geojson into sf</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://r-spatial.github.io/sf/'>sf</a></span><span class='op'>)</span> <span class='co'># Used function st_intersection to manipulate the data</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://funkyheatmap.github.io/funkyheatmap/'>funkyheatmap</a></span><span class='op'>)</span> <span class='co'># Used geom_rounded_rect to replicate rounded rectangles</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>geosphere</span><span class='op'>)</span> <span class='co'># To be able to calculate distances to plot the map scale</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://michaeldorman.github.io/nngeo/'>nngeo</a></span><span class='op'>)</span> <span class='co'># Used st_remove_holes to remove holes in the isochrones </span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://strimas.com/smoothr/'>smoothr</a></span><span class='op'>)</span> <span class='co'># To smooth out the hexagonal borders of the isochrones</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://eliocamp.github.io/ggnewscale/'>ggnewscale</a></span><span class='op'>)</span> <span class='co'># To reset scale colors</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://scales.r-lib.org'>scales</a></span><span class='op'>)</span> <span class='co'># To define alpha in arguments where defaults don't allow it</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://wilkelab.org/ggtext/'>ggtext</a></span><span class='op'>)</span> <span class='co'># To plot some text elements more easily, using less code</span></span></code></pre>
</div>
</div>
<h2 id="replica">Replica</h2>
<h3 id="loading-the-data">Loading the data</h3>
<p>We reached Willem Klumpenhouwer, the author of the original plot, who kindly shared the data with which he built the original plot, helping us ensure an accurate replication. The data he provided consists of three .geojson files:</p>
<ul>
<li><p><strong><code>hexagons</code></strong> includes for variables: <code>geometry</code> (which contains polygons that form a hexagon grid of the map), <code>id</code> (an identification number for each hexagon), <code>b_travel_time</code> (travel time by bike from the centroid of each hexagon to Calgary Tower, in minutes), and <code>travel_time</code> (travel time by transit from the centroid of each hexagon to Calgary Tower, in minutes).</p></li>
<li><p><strong><code>all_roads_dissolved</code></strong>, a multilinestring feature that represents all roads in Calgary.</p></li>
<li><p><strong><code>water</code></strong> contains mulitpolygons with the geometry of some of the most relevant water bodies in the city of Calgary.</p></li>
</ul>
<p>We converted the .geojson files into .csv.gz to upload them following the project guidelines. The original .geojson files contained more columns than the .csv.gz files below (like auxiliary ids used for calculations, or different kind of information about water bodies), but we kept only the necessary variables.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Load the data:</span></span>
<span><span class='va'>hexagons</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://readr.tidyverse.org/reference/read_delim.html'>read_csv</a></span><span class='op'>(</span><span class='st'>"data/hexagons.csv.gz"</span><span class='op'>)</span></span>
<span><span class='va'>roads</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://readr.tidyverse.org/reference/read_delim.html'>read_csv</a></span><span class='op'>(</span><span class='st'>"data/roads.csv.gz"</span><span class='op'>)</span></span>
<span><span class='va'>water</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://readr.tidyverse.org/reference/read_delim.html'>read_csv</a></span><span class='op'>(</span><span class='st'>"data/water.csv.gz"</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># We restore the spatial geometry, specifying coordinate reference system: </span></span>
<span><span class='va'>hexagons</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_as_sf.html'>st_as_sf</a></span><span class='op'>(</span><span class='va'>hexagons</span>, wkt <span class='op'>=</span> <span class='st'>"WKT"</span>, crs <span class='op'>=</span> <span class='fl'>4326</span><span class='op'>)</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename</a></span><span class='op'>(</span>geometry <span class='op'>=</span> <span class='va'>WKT</span><span class='op'>)</span> </span>
<span><span class='va'>all_roads_dissolved</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_as_sf.html'>st_as_sf</a></span><span class='op'>(</span><span class='va'>roads</span>, wkt <span class='op'>=</span> <span class='st'>"WKT"</span>, crs <span class='op'>=</span> <span class='fl'>4326</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename</a></span><span class='op'>(</span>geometry <span class='op'>=</span> <span class='va'>WKT</span><span class='op'>)</span></span>
<span><span class='va'>water</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_as_sf.html'>st_as_sf</a></span><span class='op'>(</span><span class='va'>water</span>, wkt <span class='op'>=</span> <span class='st'>"WKT"</span>, crs <span class='op'>=</span> <span class='fl'>4326</span><span class='op'>)</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename</a></span><span class='op'>(</span>geometry <span class='op'>=</span> <span class='va'>WKT</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<h3 id="data-transformation">Data transformation</h3>
<p>The structure of the data allows for a relatively straightforward transformation process. The core task is to map the travel time data (stored in the hexagons) onto the road network (where it is visualized).</p>
<p>We achieve this by creating a spatial intersection between the hexagonal grid and the road network. This operation splits the road lines at the hexagon boundaries and assigns the corresponding hexagon attributes (ID and travel times) to each road segment.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>hexroads_intersection</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/geos_binary_ops.html'>st_intersection</a></span><span class='op'>(</span><span class='va'>all_roads_dissolved</span>, <span class='va'>hexagons</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>Next, we compute the primary variable for the visualization: the difference in travel time. We bin these differences into five categorical levels to match the original maps legend.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># We are computing time_difference as time by bike minus time by transit. That means that:</span></span>
<span><span class='co'># - negative numbers = faster by bike</span></span>
<span><span class='co'># - positive numbers = faster by transit</span></span>
<span></span>
<span><span class='va'>hexroads_intersection</span> <span class='op'>&lt;-</span> <span class='va'>hexroads_intersection</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    <span class='st'>"time_difference"</span> <span class='op'>=</span> <span class='va'>b_travel_time</span> <span class='op'>-</span> <span class='va'>travel_time</span>,</span>
<span>    <span class='st'>"time_color"</span> <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span></span>
<span>      <span class='va'>time_difference</span> <span class='op'>&lt;=</span> <span class='op'>-</span><span class='fl'>30</span> <span class='op'>~</span> <span class='st'>"-2"</span>, <span class='co'># Bike 30 or more minutes faster</span></span>
<span>      <span class='va'>time_difference</span> <span class='op'>&lt;=</span> <span class='op'>-</span><span class='fl'>10</span> <span class='op'>~</span> <span class='st'>"-1"</span>, <span class='co'># Bike 10 or more minutes faster (&lt;30)</span></span>
<span>      <span class='va'>time_difference</span> <span class='op'>&lt;</span> <span class='fl'>10</span> <span class='op'>~</span> <span class='st'>"0"</span>, <span class='co'># Between -10 and 10 (both not included)</span></span>
<span>      <span class='va'>time_difference</span> <span class='op'>&lt;</span> <span class='fl'>30</span> <span class='op'>~</span> <span class='st'>"1"</span>, <span class='co'># Transit 10 or more minutes faster (&lt;30)</span></span>
<span>      <span class='va'>time_difference</span> <span class='op'>&gt;=</span> <span class='fl'>30</span> <span class='op'>~</span> <span class='st'>"2"</span><span class='op'>)</span>, <span class='co'># Transit 30 or more minutes faster </span></span>
<span>    <span class='st'>"time_color"</span> <span class='op'>=</span> <span class='fu'><a href='https://forcats.tidyverse.org/reference/fct.html'>fct</a></span><span class='op'>(</span> </span>
<span>                   <span class='va'>time_color</span>, levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"-2"</span>, <span class='st'>"-1"</span>, <span class='st'>"0"</span>, <span class='st'>"1"</span>, <span class='st'>"2"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>With our data ready, we can start plotting.</p>
<h3 id="plotting">Plotting</h3>
<h4 id="scaling-ratio">Scaling ratio</h4>
<p>Initially, we developed the replica using the exact pixel dimensions of the original map (25.2565 x 34.375 inches using default 96 dpi) in order to be able to replicate the sharpness in its elements and make it easier to compare overlapping the original and the replica using Gimp. However, after receiving feedback informing about storage constraints, we changed those values to comply with a significantly smaller file size. This meant that we needed to adjust many values (like line width, text size, etc.).</p>
<p>Instead of manually recalculating everything, we introduced a scaling ratio (<code>sr</code>). This object captures the proportion between our new target height (7 inches) and the original height. By multiplying our aesthetic values by <code>sr</code>, we can dynamically scale the entire visualization while preserving the relative proportions of the original design. This method also allows for easier changes if we want to perform any size changes in the future.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Scaling ratio:</span></span>
<span><span class='va'>sr</span> <span class='op'>&lt;-</span> <span class='fl'>7</span><span class='op'>/</span><span class='fl'>34.375</span></span></code></pre>
</div>
</div>
<h4 id="roads-and-water">Roads and water</h4>
<p>We start by plotting the map with the road network adequately colored according to travel time differences. Notice that in the original map the water is plotted on top of the roads (we see there are no bridges over the rivers), we do the same in our replica.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>calgary_replica</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># Roads</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span> </span>
<span>    data <span class='op'>=</span> <span class='va'>hexroads_intersection</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='va'>time_color</span><span class='op'>)</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='fl'>1.1</span> <span class='op'>*</span> <span class='va'>sr</span>, <span class='co'># We multiply by the scaling ratio, as explained above</span></span>
<span>    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_color_manual</a></span><span class='op'>(</span></span>
<span>    values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>      <span class='st'>"-2"</span> <span class='op'>=</span> <span class='st'>"#aa5312"</span>, <span class='co'># bike &gt;30 min faster</span></span>
<span>      <span class='st'>"-1"</span> <span class='op'>=</span> <span class='st'>"#c88c47"</span>, <span class='co'># bike 1030 min faster</span></span>
<span>      <span class='st'>"0"</span>  <span class='op'>=</span> <span class='st'>"#b7a6ac"</span>, <span class='co'># similar travel time</span></span>
<span>      <span class='st'>"1"</span>  <span class='op'>=</span> <span class='st'>"#a36f96"</span>, <span class='co'># transit 1030 min faster</span></span>
<span>      <span class='st'>"2"</span>  <span class='op'>=</span> <span class='st'>"#6a4886"</span>  <span class='co'># transit &gt;30 min faster</span></span>
<span>    <span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># Water:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span> </span>
<span>    data <span class='op'>=</span> <span class='va'>water</span>,</span>
<span>    fill <span class='op'>=</span> <span class='st'>"#a6b0b9"</span>,</span>
<span>    color <span class='op'>=</span> <span class='st'>"#a6b0b9"</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='fl'>1.1</span> <span class='op'>*</span> <span class='va'>sr</span>,</span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_void</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>calgary_replica</span> <span class='co'># To see it</span></span></code></pre>
</div>
<p><img src="100569505_files/figure-html5/plot_roads_water-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<h4 id="paragraph">Paragraph</h4>
<p>We will now add the introductory paragraph. This text block acts effectively as both a title and a descriptive legend, explaining the maps purpose and identifying the central blue point as the Calgary Tower.</p>
<p>To ensure a faithful replication, we used the online tool <a href="https://www.myfonts.com/pages/whatthefont"><em>What the font?</em></a> to identify the exact typography used in the original visualization: Atkinson Hyperlegible Next, which is available in <a href="https://fonts.google.com/specimen/Atkinson+Hyperlegible+Next"><em>Google Fonts</em></a>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># We add the font used in the original plot:</span></span>
<span><span class='fu'>sysfonts</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/sysfonts/man/font_add_google.html'>font_add_google</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"Atkinson Hyperlegible Next"</span>,</span>
<span>  family <span class='op'>=</span> <span class='st'>"atkinson"</span>,</span>
<span>  regular.wt <span class='op'>=</span> <span class='fl'>400</span>, </span>
<span>  db_cache <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='co'># Cache wasn't up to date, didn't include our typography,</span></span>
<span>                    <span class='co'># with FALSE we use the official, slower, but updated API.</span></span>
<span><span class='fu'>showtext</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/showtext/man/showtext_auto.html'>showtext_auto</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span></span>
<span></span>
<span><span class='co'># And then plot the paragraph:</span></span>
<span><span class='va'>calgary_replica</span> <span class='op'>&lt;-</span> <span class='va'>calgary_replica</span> <span class='op'>+</span> </span>
<span>  </span>
<span>  <span class='co'># The text:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>    <span class='st'>"text"</span>,</span>
<span>    x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>114.3100</span>, </span>
<span>    y <span class='op'>=</span> <span class='fl'>50.9790</span>,</span>
<span>    label <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='st'>"This map shows the difference"</span>,</span>
<span>                  <span class='st'>"in the time it takes to reach the"</span>,</span>
<span>                  <span class='st'>"Calgary Tower     by bike and by"</span>,</span>
<span>                  <span class='st'>"transit on a weekday morning."</span>,</span>
<span>                  sep<span class='op'>=</span><span class='st'>"\n"</span><span class='op'>)</span>,</span>
<span>    hjust <span class='op'>=</span> <span class='fl'>0</span>,</span>
<span>    family <span class='op'>=</span> <span class='st'>"atkinson"</span>,</span>
<span>    size <span class='op'>=</span> <span class='fl'>12.9</span> <span class='op'>*</span> <span class='va'>sr</span>,</span>
<span>    lineheight <span class='op'>=</span> <span class='fl'>1.05</span>,</span>
<span>    color <span class='op'>=</span> <span class='st'>"#000000"</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span> </span>
<span>  </span>
<span>  <span class='co'># The blue point in the legend</span></span>
<span>   <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>    <span class='st'>"point"</span>,</span>
<span>    x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>114.2400</span>,</span>
<span>    y <span class='op'>=</span> <span class='fl'>50.97495</span>,  </span>
<span>    shape <span class='op'>=</span> <span class='fl'>21</span>,</span>
<span>    size <span class='op'>=</span> <span class='fl'>8.25</span> <span class='op'>*</span> <span class='va'>sr</span>,</span>
<span>    color <span class='op'>=</span> <span class='st'>"#000000"</span>,</span>
<span>    stroke <span class='op'>=</span> <span class='fl'>4.1</span> <span class='op'>*</span> <span class='va'>sr</span>,</span>
<span>    fill <span class='op'>=</span> <span class='st'>"#69eafe"</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># The blue point in the map (Calgary Tower)</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span>  </span>
<span>    <span class='st'>"point"</span>,</span>
<span>    x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>114.0631</span>,</span>
<span>    y <span class='op'>=</span> <span class='fl'>51.04465</span>,</span>
<span>    shape <span class='op'>=</span> <span class='fl'>21</span>,</span>
<span>    size <span class='op'>=</span> <span class='fl'>8.25</span> <span class='op'>*</span> <span class='va'>sr</span>,</span>
<span>    color <span class='op'>=</span> <span class='st'>"#000000"</span>,</span>
<span>    stroke <span class='op'>=</span> <span class='fl'>4.1</span> <span class='op'>*</span> <span class='va'>sr</span>,</span>
<span>    fill <span class='op'>=</span> <span class='st'>"#69eafe"</span></span>
<span>  <span class='op'>)</span></span>
<span>  </span>
<span><span class='va'>calgary_replica</span> <span class='co'># To see it</span></span></code></pre>
</div>
<p><img src="100569505_files/figure-html5/plot_paragraph-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<h4 id="color-legend">Color legend</h4>
<p>Now that we have the paragraph, we plot the color legend underneath it. It is a non-standard legend which isnt part of ggplots defaults. So we need to create the geometries and text manually.</p>
<p>Since there is a lot of elements here, and we need to manually adjust everything to fit the original plot, decided to write the code in a way that makes it more convenient to use in the process of trial and error, by dividing it in three parts: a) <em>settings</em> where we define the needed values, b) <em>calculations</em> of coordinate values according to the values defined in settings (this allows us to avoid manually defining every single value needed), and c) the <em>plotting</em> according to the previous calculations.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Settings:</span></span>
<span><span class='co'># =========</span></span>
<span></span>
<span><span class='co'># Rectangles:</span></span>
<span><span class='va'>rectangle_left</span> <span class='op'>&lt;-</span> <span class='op'>-</span><span class='fl'>114.3080</span></span>
<span><span class='va'>rectangle_top</span> <span class='op'>&lt;-</span> <span class='fl'>50.9490</span> </span>
<span><span class='va'>rectangle_width</span> <span class='op'>&lt;-</span> <span class='fl'>0.0250</span></span>
<span><span class='va'>rectangle_height</span> <span class='op'>&lt;-</span> <span class='fl'>0.0050</span></span>
<span><span class='va'>rectangle_space</span> <span class='op'>&lt;-</span> <span class='fl'>0.0005</span></span>
<span><span class='va'>rectangle_fill</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"#d26716"</span>, <span class='st'>"#f8ad58"</span>, <span class='st'>"#e3cdd5"</span>, <span class='st'>"#ca8aba"</span>, <span class='st'>"#8359a6"</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Faster by:</span></span>
<span><span class='va'>faster_separation</span> <span class='op'>&lt;-</span> <span class='fl'>1</span> <span class='op'>*</span> <span class='va'>sr</span> <span class='co'># Relative to rectangle_height</span></span>
<span><span class='va'>faster_size</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='fl'>10</span> <span class='op'>*</span> <span class='va'>sr</span><span class='op'>)</span> <span class='co'># For geom_text(size = faster_size)</span></span>
<span><span class='va'>faster_color</span> <span class='op'>&lt;-</span> <span class='st'>"#000000"</span></span>
<span><span class='va'>faster_font</span> <span class='op'>&lt;-</span> <span class='st'>"atkinson"</span></span>
<span></span>
<span><span class='co'># Minutes:</span></span>
<span><span class='va'>minute_separation</span> <span class='op'>&lt;-</span> <span class='fl'>1.5</span> <span class='co'># Relative to rectangle_height</span></span>
<span><span class='va'>minute_size</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='fl'>8</span> <span class='op'>*</span> <span class='va'>sr</span><span class='op'>)</span> <span class='co'># For geom_text(size = minute_size)</span></span>
<span><span class='va'>minute_color</span> <span class='op'>&lt;-</span> <span class='st'>"#000000"</span></span>
<span><span class='va'>minute_font</span> <span class='op'>&lt;-</span> <span class='st'>"atkinson"</span></span>
<span></span>
<span></span>
<span></span>
<span><span class='co'># Calculations:</span></span>
<span><span class='co'>#=============</span></span>
<span></span>
<span><span class='co'># Tibble for legend rectangles:</span></span>
<span><span class='va'>legend_rectangles</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"xmin"</span> <span class='op'>=</span> <span class='va'>rectangle_left</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>0</span><span class='op'>:</span><span class='fl'>4</span><span class='op'>)</span> <span class='op'>*</span> <span class='op'>(</span><span class='va'>rectangle_width</span> <span class='op'>+</span> <span class='va'>rectangle_space</span><span class='op'>)</span>,</span>
<span>  <span class='st'>"xmax"</span> <span class='op'>=</span> <span class='va'>xmin</span> <span class='op'>+</span> <span class='va'>rectangle_width</span>,</span>
<span>  <span class='st'>"ymin"</span> <span class='op'>=</span> <span class='va'>rectangle_top</span> <span class='op'>-</span> <span class='va'>rectangle_height</span>,</span>
<span>  <span class='st'>"ymax"</span> <span class='op'>=</span> <span class='va'>rectangle_top</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Tibble for minutes (relative to rectangles):</span></span>
<span><span class='va'>legend_minutes</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"label"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"30"</span>, <span class='st'>"10"</span>, <span class='st'>"10"</span>, <span class='st'>"30"</span>, <span class='st'>"   minutes"</span><span class='op'>)</span>,</span>
<span>  <span class='st'>"x"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>    <span class='va'>rectangle_left</span> <span class='op'>+</span> <span class='op'>(</span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>4</span><span class='op'>)</span><span class='op'>*</span><span class='va'>rectangle_width</span><span class='op'>)</span> <span class='op'>+</span> <span class='op'>(</span><span class='op'>(</span><span class='fl'>0.5</span><span class='op'>:</span><span class='fl'>3.5</span><span class='op'>)</span> <span class='op'>*</span> <span class='va'>rectangle_space</span><span class='op'>)</span>,</span>
<span>    <span class='va'>rectangle_left</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>4</span><span class='op'>*</span><span class='va'>rectangle_width</span><span class='op'>)</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>3.5</span><span class='op'>*</span><span class='va'>rectangle_space</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>  <span class='st'>"y"</span> <span class='op'>=</span> <span class='va'>rectangle_top</span> <span class='op'>-</span> <span class='va'>rectangle_height</span> <span class='op'>*</span> <span class='va'>minute_separation</span>,</span>
<span>  <span class='st'>"hjust"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.5</span>, <span class='fl'>0.5</span>, <span class='fl'>0.5</span>, <span class='fl'>0.5</span>, <span class='fl'>0</span><span class='op'>)</span> <span class='co'># All justified center, "minutes" left</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Tibble for "faster by" (relative to rectangles):</span></span>
<span><span class='va'>legend_faster</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"label"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"faster by bike"</span>, <span class='st'>"|"</span>, <span class='st'>"faster by transit"</span><span class='op'>)</span>,</span>
<span>  <span class='st'>"x"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>    <span class='va'>rectangle_left</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>2</span><span class='op'>*</span><span class='va'>rectangle_width</span><span class='op'>)</span> <span class='op'>+</span> <span class='va'>rectangle_space</span>,</span>
<span>    <span class='va'>rectangle_left</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>2.5</span><span class='op'>*</span><span class='va'>rectangle_width</span><span class='op'>)</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>2.5</span><span class='op'>*</span><span class='va'>rectangle_space</span><span class='op'>)</span>,</span>
<span>    <span class='va'>rectangle_left</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>3</span><span class='op'>*</span><span class='va'>rectangle_width</span><span class='op'>)</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>3</span><span class='op'>*</span><span class='va'>rectangle_space</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>  <span class='st'>"y"</span> <span class='op'>=</span> <span class='va'>rectangle_top</span> <span class='op'>+</span> <span class='va'>rectangle_height</span> <span class='op'>*</span> <span class='va'>faster_separation</span>,</span>
<span>  <span class='st'>"hjust"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>0.5</span>, <span class='fl'>0</span><span class='op'>)</span> <span class='co'># Justified: right, center, left</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class='co'># Plotting color legend:</span></span>
<span><span class='co'># ======================</span></span>
<span><span class='va'>calgary_replica</span> <span class='op'>&lt;-</span> <span class='va'>calgary_replica</span> <span class='op'>+</span></span>
<span></span>
<span>  <span class='co'># Rounded rectangles:</span></span>
<span>  <span class='fu'><a href='https://funkyheatmap.github.io/funkyheatmap/reference/geom_rounded_rect.html'>geom_rounded_rect</a></span><span class='op'>(</span> <span class='co'># From package: funkyheatmap</span></span>
<span>    data <span class='op'>=</span> <span class='va'>legend_rectangles</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>xmin <span class='op'>=</span> <span class='va'>xmin</span>, xmax <span class='op'>=</span> <span class='va'>xmax</span>,</span>
<span>        ymin <span class='op'>=</span> <span class='va'>ymin</span>, ymax <span class='op'>=</span> <span class='va'>ymax</span>, </span>
<span>        radius <span class='op'>=</span> <span class='fl'>0.3</span><span class='op'>)</span>,</span>
<span>    fill <span class='op'>=</span> <span class='va'>rectangle_fill</span>,</span>
<span>    color <span class='op'>=</span> <span class='cn'>NA</span>,  <span class='co'># No border</span></span>
<span>    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span>  <span class='co'># Minutes:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>legend_minutes</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span>, hjust <span class='op'>=</span> <span class='va'>hjust</span>, label <span class='op'>=</span> <span class='va'>label</span><span class='op'>)</span>,</span>
<span>    size <span class='op'>=</span> <span class='va'>minute_size</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>minute_color</span>, </span>
<span>    family <span class='op'>=</span> <span class='va'>minute_font</span>,</span>
<span>    vjust <span class='op'>=</span> <span class='fl'>1</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># Faster by:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>legend_faster</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span>, hjust <span class='op'>=</span> <span class='va'>hjust</span>, label <span class='op'>=</span> <span class='va'>label</span><span class='op'>)</span>,</span>
<span>    size <span class='op'>=</span> <span class='va'>faster_size</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>faster_color</span>,</span>
<span>    family <span class='op'>=</span> <span class='va'>faster_font</span>,</span>
<span>    vjust <span class='op'>=</span> <span class='fl'>0</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>calgary_replica</span> <span class='co'># To see it</span></span></code></pre>
</div>
<p><img src="100569505_files/figure-html5/plot_color_legend-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<h4 id="north-arrow">North arrow</h4>
<p>Our map is only missing the spatial reference elements. We will start by plotting the arrow pointing North.</p>
<p>Once again, it is a non standard element. This means that default arrows do not work if we want a perfect replica. For example, the function <code>arrow()</code> inside <code>geom_segment(arrow = )</code> does not allow us to create an arrow that is at the same time as big as needed and as sharp (not rounded) as needed. There are packages like <code>ggspatial</code> that include functions to plot cardinal directions, but again, those do not fit our aesthetic needs. Thus, we need to create a custom arrow. An easy solution that will allow us to plot a big arrow with a sharp head and a rounded shaft is plotting a triangular polygon with a rounded rectangle on top.</p>
<p>To understand the code below, we must note that there is a weird behavior in <code>geom_rounded_rectangle()</code>: when line width increases, it plots undesired lines that do not follow the rounded rectangle shape. Which means that we cannot use a single <code>geom_rounded_rectangle()</code> without fill but with a contour line to to plot the box around the arrow. To overcome this, we plotted a black <code>geom_rounded_rectangle()</code> with a smaller white one on top to get the desired effect.</p>
<p>Again, since were creating non-standard elements, we continue with our Settings -&gt; Calculations -&gt; Plotting workflow to facilitate the trial-and-error process. We also rely on relative values (defined in relation to existing shapes) rather than absolute coordinates, which makes the code significantly easier to read and modify compared to using absolute coordinates with many decimals.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Settings:</span></span>
<span><span class='co'># =========</span></span>
<span></span>
<span><span class='va'>arrow_color</span> <span class='op'>&lt;-</span> <span class='st'>"#e3cdd5"</span></span>
<span></span>
<span><span class='co'># Arrow triangle:</span></span>
<span><span class='va'>triangle_mid_x</span> <span class='op'>&lt;-</span> <span class='op'>-</span><span class='fl'>114.2680</span> <span class='co'># This will be the reference for the rest of xs</span></span>
<span><span class='va'>triangle_bottom_y</span> <span class='op'>&lt;-</span> <span class='fl'>50.9067</span> <span class='co'># This will be the reference for the rest of ys</span></span>
<span></span>
<span><span class='va'>triangle_half_width</span> <span class='op'>&lt;-</span> <span class='fl'>0.0076</span></span>
<span><span class='va'>triangle_height</span> <span class='op'>&lt;-</span> <span class='fl'>0.0048</span></span>
<span></span>
<span><span class='co'># Arrow rectangle:</span></span>
<span><span class='va'>arrow_rectangle_width</span> <span class='op'>&lt;-</span> <span class='fl'>0.435</span> <span class='co'># Relative to triangle width</span></span>
<span><span class='va'>arrow_rectangle_height</span> <span class='op'>&lt;-</span> <span class='fl'>1.495</span> <span class='co'># Relative to triangle height</span></span>
<span><span class='va'>arrow_rectangle_radius</span> <span class='op'>&lt;-</span> <span class='fl'>0.24</span></span>
<span></span>
<span><span class='co'># North text:</span></span>
<span><span class='va'>north_space</span> <span class='op'>&lt;-</span> <span class='fl'>0.55</span> <span class='co'># Relative to triangle height, space 0 = arrow tip</span></span>
<span><span class='va'>north_size</span> <span class='op'>&lt;-</span> <span class='fl'>9</span> <span class='op'>*</span> <span class='va'>sr</span></span>
<span><span class='va'>north_color</span> <span class='op'>&lt;-</span> <span class='st'>"black"</span></span>
<span></span>
<span><span class='co'># Outer box:</span></span>
<span><span class='va'>box_width</span> <span class='op'>&lt;-</span> <span class='fl'>2.22</span> <span class='co'># Relative to triangle width</span></span>
<span><span class='va'>box_height</span> <span class='op'>&lt;-</span> <span class='fl'>2.45</span> <span class='co'># Relative to triangle height</span></span>
<span><span class='va'>box_radius</span> <span class='op'>&lt;-</span> <span class='fl'>0.20</span></span>
<span><span class='va'>box_y_position</span> <span class='op'>&lt;-</span> <span class='fl'>0.255</span> <span class='co'># Relative to triangle tip (measured in triangle height)</span></span>
<span><span class='va'>box_color</span> <span class='op'>&lt;-</span> <span class='st'>"#575757"</span></span>
<span></span>
<span><span class='co'># Border thickness (changes the size of the inner box, altering border size):</span></span>
<span><span class='va'>border_thickness</span> <span class='op'>&lt;-</span> <span class='fl'>0.03</span> <span class='co'># Range 0-1 (0 = no border, 1 = full black box)</span></span>
<span><span class='va'>inner_box_color</span> <span class='op'>&lt;-</span> <span class='st'>"white"</span></span>
<span></span>
<span></span>
<span></span>
<span><span class='co'># Calculations:</span></span>
<span><span class='co'># =============</span></span>
<span></span>
<span><span class='co'># Tibble for arrow triangle (head):</span></span>
<span><span class='va'>triangle_polygon</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>    <span class='va'>triangle_mid_x</span>, <span class='co'># Tip x</span></span>
<span>    <span class='va'>triangle_mid_x</span> <span class='op'>-</span> <span class='va'>triangle_half_width</span>, <span class='co'># Left corner x</span></span>
<span>    <span class='va'>triangle_mid_x</span> <span class='op'>+</span> <span class='va'>triangle_half_width</span> <span class='co'># Right corner x</span></span>
<span>  <span class='op'>)</span>,</span>
<span>  y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>    <span class='va'>triangle_bottom_y</span> <span class='op'>+</span> <span class='va'>triangle_height</span>, <span class='co'># Tip y </span></span>
<span>    <span class='va'>triangle_bottom_y</span>, <span class='co'># Left corner y</span></span>
<span>    <span class='va'>triangle_bottom_y</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># Right corner y</span></span>
<span>  </span>
<span><span class='co'># Tibble for arrow rectangle (shaft):</span></span>
<span><span class='va'>arrow_rectangle</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  xmin <span class='op'>=</span> <span class='va'>triangle_mid_x</span> <span class='op'>-</span> <span class='op'>(</span><span class='va'>triangle_half_width</span><span class='op'>*</span><span class='va'>arrow_rectangle_width</span><span class='op'>)</span>, <span class='co'># Left</span></span>
<span>  xmax <span class='op'>=</span> <span class='va'>triangle_mid_x</span> <span class='op'>+</span> <span class='op'>(</span><span class='va'>triangle_half_width</span><span class='op'>*</span><span class='va'>arrow_rectangle_width</span><span class='op'>)</span>, <span class='co'># Right</span></span>
<span>  ymin <span class='op'>=</span> <span class='va'>triangle_bottom_y</span> <span class='op'>-</span> <span class='op'>(</span><span class='va'>triangle_height</span><span class='op'>*</span><span class='va'>arrow_rectangle_height</span><span class='op'>)</span>, <span class='co'># Bottom</span></span>
<span>  ymax <span class='op'>=</span> <span class='va'>triangle_bottom_y</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>0.25</span><span class='op'>*</span><span class='va'>triangle_height</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># Top.   </span></span>
<span>                                                     <span class='co'># We add 0.25 of the</span></span>
<span>                                                     <span class='co'># triangle height to</span></span>
<span>                                                     <span class='co'># hide rounded edge on</span></span>
<span>                                                     <span class='co'># the rectangle top.</span></span>
<span></span>
<span><span class='co'># Tibble for "north":</span></span>
<span><span class='va'>north</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  label <span class='op'>=</span> <span class='st'>"North"</span>,</span>
<span>  x <span class='op'>=</span> <span class='va'>triangle_mid_x</span>,</span>
<span>  y <span class='op'>=</span> <span class='va'>triangle_bottom_y</span> <span class='op'>+</span> <span class='va'>triangle_height</span> <span class='op'>+</span> <span class='va'>north_space</span><span class='op'>*</span><span class='va'>triangle_height</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Tibble for outer box:</span></span>
<span><span class='va'>arrow_box</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"xmin"</span> <span class='op'>=</span> <span class='va'>triangle_mid_x</span> <span class='op'>-</span> <span class='op'>(</span><span class='va'>triangle_half_width</span><span class='op'>*</span><span class='va'>box_width</span><span class='op'>)</span>, <span class='co'># Left</span></span>
<span>  <span class='st'>"xmax"</span> <span class='op'>=</span> <span class='va'>triangle_mid_x</span> <span class='op'>+</span> <span class='op'>(</span><span class='va'>triangle_half_width</span><span class='op'>*</span><span class='va'>box_width</span><span class='op'>)</span>, <span class='co'># Right</span></span>
<span>  <span class='st'>"ymin"</span> <span class='op'>=</span> <span class='va'>triangle_bottom_y</span> <span class='op'>-</span> <span class='op'>(</span><span class='va'>triangle_height</span><span class='op'>*</span><span class='va'>box_height</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='op'>(</span><span class='va'>triangle_height</span><span class='op'>*</span><span class='va'>box_y_position</span><span class='op'>)</span>, <span class='co'># Bottom</span></span>
<span>  <span class='st'>"ymax"</span> <span class='op'>=</span> <span class='va'>triangle_bottom_y</span> <span class='op'>+</span> <span class='op'>(</span><span class='va'>triangle_height</span><span class='op'>*</span><span class='va'>box_height</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='op'>(</span><span class='va'>triangle_height</span><span class='op'>*</span><span class='va'>box_y_position</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># Top</span></span>
<span></span>
<span><span class='co'># Tibble for inner box:</span></span>
<span><span class='co'># We  first create an auxiliary object which we will add/substract to outer box:</span></span>
<span><span class='va'>box_vertical_border</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='op'>(</span><span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>xmax</span> <span class='op'>-</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>xmin</span><span class='op'>)</span><span class='op'>*</span><span class='va'>border_thickness</span><span class='op'>)</span><span class='op'>/</span><span class='fl'>2</span> </span>
<span><span class='va'>box_horizontal_border</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='op'>(</span><span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>ymax</span> <span class='op'>-</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>ymin</span><span class='op'>)</span><span class='op'>*</span><span class='va'>border_thickness</span><span class='op'>)</span><span class='op'>/</span><span class='fl'>2</span></span>
<span><span class='co'># And then the tibble:</span></span>
<span><span class='va'>inner_box</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"xmin"</span> <span class='op'>=</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>xmin</span> <span class='op'>+</span> <span class='va'>box_vertical_border</span>,</span>
<span>  <span class='st'>"xmax"</span> <span class='op'>=</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>xmax</span> <span class='op'>-</span> <span class='va'>box_vertical_border</span>,</span>
<span>  <span class='st'>"ymin"</span> <span class='op'>=</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>ymin</span> <span class='op'>+</span> <span class='va'>box_horizontal_border</span>,</span>
<span>  <span class='st'>"ymax"</span> <span class='op'>=</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>ymax</span> <span class='op'>-</span> <span class='va'>box_horizontal_border</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class='co'># Plotting north arrow:</span></span>
<span><span class='co'># =====================</span></span>
<span></span>
<span><span class='va'>calgary_replica</span> <span class='op'>&lt;-</span> <span class='va'>calgary_replica</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># Outer box:</span></span>
<span>  <span class='fu'><a href='https://funkyheatmap.github.io/funkyheatmap/reference/geom_rounded_rect.html'>geom_rounded_rect</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>arrow_box</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>xmin <span class='op'>=</span> <span class='va'>xmin</span>, xmax <span class='op'>=</span> <span class='va'>xmax</span>,</span>
<span>        ymin <span class='op'>=</span> <span class='va'>ymin</span>, ymax <span class='op'>=</span> <span class='va'>ymax</span><span class='op'>)</span>,</span>
<span>    radius <span class='op'>=</span> <span class='va'>box_radius</span>,</span>
<span>    fill <span class='op'>=</span> <span class='va'>box_color</span>,</span>
<span>    color <span class='op'>=</span> <span class='cn'>NA</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># Inner box:</span></span>
<span>  <span class='fu'><a href='https://funkyheatmap.github.io/funkyheatmap/reference/geom_rounded_rect.html'>geom_rounded_rect</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>inner_box</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>xmin <span class='op'>=</span> <span class='va'>xmin</span>, xmax <span class='op'>=</span> <span class='va'>xmax</span>,</span>
<span>        ymin <span class='op'>=</span> <span class='va'>ymin</span>, ymax <span class='op'>=</span> <span class='va'>ymax</span><span class='op'>)</span>,</span>
<span>    radius <span class='op'>=</span> <span class='va'>box_radius</span>,</span>
<span>    fill <span class='op'>=</span> <span class='va'>inner_box_color</span>,</span>
<span>    color <span class='op'>=</span> <span class='cn'>NA</span></span>
<span>    <span class='op'>)</span><span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># Arrow head (triangle):</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_polygon.html'>geom_polygon</a></span><span class='op'>(</span> </span>
<span>    data <span class='op'>=</span> <span class='va'>triangle_polygon</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span>,</span>
<span>    fill <span class='op'>=</span> <span class='va'>arrow_color</span>,</span>
<span>    color <span class='op'>=</span> <span class='cn'>NA</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span> </span>
<span>  </span>
<span>  <span class='co'># Arrow shaft (rectangle):</span></span>
<span>  <span class='fu'><a href='https://funkyheatmap.github.io/funkyheatmap/reference/geom_rounded_rect.html'>geom_rounded_rect</a></span><span class='op'>(</span> </span>
<span>    data <span class='op'>=</span> <span class='va'>arrow_rectangle</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>xmin <span class='op'>=</span> <span class='va'>xmin</span>, xmax <span class='op'>=</span> <span class='va'>xmax</span>,</span>
<span>        ymin <span class='op'>=</span> <span class='va'>ymin</span>, ymax <span class='op'>=</span> <span class='va'>ymax</span><span class='op'>)</span>,</span>
<span>    radius <span class='op'>=</span> <span class='va'>arrow_rectangle_radius</span>,</span>
<span>    fill <span class='op'>=</span> <span class='va'>arrow_color</span>,</span>
<span>    color<span class='op'>=</span> <span class='cn'>NA</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span> </span>
<span>  </span>
<span>  <span class='co'># "North" text:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>north</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span>, label <span class='op'>=</span> <span class='va'>label</span><span class='op'>)</span>,</span>
<span>    size <span class='op'>=</span> <span class='va'>north_size</span>,</span>
<span>    fontface <span class='op'>=</span> <span class='st'>"bold"</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>north_color</span>, </span>
<span>    family <span class='op'>=</span> <span class='st'>"atkinson"</span></span>
<span>    <span class='op'>)</span></span>
<span></span>
<span><span class='va'>calgary_replica</span> <span class='co'># To see it</span></span></code></pre>
</div>
<p><img src="100569505_files/figure-html5/plot_north_arrow-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<h4 id="scale">Scale</h4>
<p>As was the case with the North arrow, the scale bar is a non-standard element. Even specialized packages like <code>ggspatial</code> do not offer the specific design required for a faithful replica. Consequently, we build it manually using the same approach described above.</p>
<p>However, unlike the arbitrary positioning of the legend elements, the scale bar represents a physical reality: 3 kilometers. To make sure we get the proper length, we use <code>destPoint()</code> from package <code>geosphere</code>, which, as it documentation states: given a start point, initial bearing (direction), and distance, this function computes the destination point travelling along a the shortest path on an ellipsoid (the geodesic).</p>
<p>A distinct visual detail of the original map is that the vertical ticks are plotted over the horizontal line. We maintain this layering in our replica.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Settings:</span></span>
<span><span class='co'># =========</span></span>
<span></span>
<span><span class='co'># Horizontal line:</span></span>
<span><span class='va'>scale_length</span> <span class='op'>&lt;-</span> <span class='fl'>3100</span> <span class='co'># In meters (we set it a bit longer so that the ends</span></span>
<span>                     <span class='co'># extend over the ticks as in the original)</span></span>
<span><span class='va'>scale_space</span> <span class='op'>&lt;-</span> <span class='fl'>0.13</span> <span class='co'># Space between scale and box, proportion of box height</span></span>
<span><span class='va'>scale_thickness</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='fl'>2</span><span class='op'>*</span><span class='va'>sr</span><span class='op'>)</span> <span class='co'># For geom_segment(linewidth = )</span></span>
<span><span class='va'>scale_color</span> <span class='op'>&lt;-</span> <span class='st'>"#676767"</span></span>
<span>  </span>
<span><span class='co'># Ticks:</span></span>
<span><span class='va'>tick_distance</span> <span class='op'>&lt;-</span> <span class='fl'>3000</span> <span class='co'># In meters, distance between the ticks at each end </span></span>
<span><span class='va'>tick_length</span> <span class='op'>&lt;-</span> <span class='fl'>0.08</span> <span class='co'># Proportion of the box height</span></span>
<span><span class='va'>tick_thickness</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='fl'>1.1</span><span class='op'>*</span><span class='va'>sr</span><span class='op'>)</span> <span class='co'># For geom_segment(linewidth = )</span></span>
<span><span class='va'>tick_color</span> <span class='op'>&lt;-</span> <span class='st'>"#000000"</span></span>
<span></span>
<span><span class='co'># Kilometers:</span></span>
<span><span class='va'>km_space</span> <span class='op'>&lt;-</span> <span class='fl'>0.275</span> <span class='co'># Space between km and scale, proportion of box height</span></span>
<span><span class='va'>km_size</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='fl'>8</span> <span class='op'>*</span> <span class='va'>sr</span><span class='op'>)</span> <span class='co'># For geom_text(size = )</span></span>
<span><span class='va'>km_font</span> <span class='op'>&lt;-</span> <span class='st'>"atkinson"</span></span>
<span><span class='va'>km_color</span> <span class='op'>&lt;-</span> <span class='st'>"#000000"</span></span>
<span></span>
<span></span>
<span></span>
<span><span class='co'># Calculations:</span></span>
<span><span class='co'># =============</span></span>
<span></span>
<span><span class='co'># Auxiliary objects:</span></span>
<span><span class='va'>box_actual_width</span> <span class='op'>&lt;-</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>xmax</span> <span class='op'>-</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>xmin</span></span>
<span><span class='va'>box_actual_height</span> <span class='op'>&lt;-</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>ymax</span> <span class='op'>-</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>ymin</span></span>
<span><span class='va'>box_mid_x</span> <span class='op'>&lt;-</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>xmin</span> <span class='op'>+</span> <span class='op'>(</span><span class='va'>box_actual_width</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Calculate right end of the horizontal line:</span></span>
<span><span class='va'>scale_left</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/as_tibble.html'>as_tibble</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/geosphere/man/destPoint.html'>destPoint</a></span><span class='op'>(</span></span>
<span>  p <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span> </span>
<span>    <span class='va'>box_mid_x</span>, <span class='co'># Starting x</span></span>
<span>    <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>ymin</span> <span class='op'>-</span> <span class='va'>box_actual_height</span><span class='op'>*</span><span class='va'>scale_space</span><span class='op'>)</span>, <span class='co'># Starting y</span></span>
<span>  b <span class='op'>=</span> <span class='fl'>90</span>, <span class='co'># b = bearing in degrees</span></span>
<span>  d <span class='op'>=</span> <span class='op'>-</span><span class='va'>scale_length</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># d = distance in meters </span></span>
<span></span>
<span><span class='co'># Calculate left end of the horizontal line:</span></span>
<span><span class='va'>scale_right</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/as_tibble.html'>as_tibble</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/geosphere/man/destPoint.html'>destPoint</a></span><span class='op'>(</span></span>
<span>  p <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>box_mid_x</span>, <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>ymin</span> <span class='op'>-</span> <span class='va'>box_actual_height</span><span class='op'>*</span><span class='va'>scale_space</span><span class='op'>)</span>, </span>
<span>  b <span class='op'>=</span> <span class='fl'>90</span>,</span>
<span>  d <span class='op'>=</span> <span class='va'>scale_length</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Tibble for horizontal line:</span></span>
<span><span class='va'>scale_horizontal</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"x"</span> <span class='op'>=</span> <span class='va'>scale_left</span><span class='op'>$</span><span class='va'>lon</span>, <span class='st'>"xend"</span> <span class='op'>=</span> <span class='va'>scale_right</span><span class='op'>$</span><span class='va'>lon</span>,</span>
<span>  <span class='st'>"y"</span> <span class='op'>=</span> <span class='va'>scale_left</span><span class='op'>$</span><span class='va'>lat</span>, <span class='st'>"yend"</span> <span class='op'>=</span> <span class='va'>scale_left</span><span class='op'>$</span><span class='va'>lat</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Calculate left tick:</span></span>
<span><span class='va'>tick_left</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/as_tibble.html'>as_tibble</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/geosphere/man/destPoint.html'>destPoint</a></span><span class='op'>(</span></span>
<span>  p <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>box_mid_x</span>, <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>ymin</span> <span class='op'>-</span> <span class='va'>box_actual_height</span><span class='op'>*</span><span class='va'>scale_space</span><span class='op'>)</span>, </span>
<span>  b <span class='op'>=</span> <span class='fl'>90</span>,</span>
<span>  d <span class='op'>=</span> <span class='op'>-</span><span class='va'>tick_distance</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Calculate right tick:</span></span>
<span><span class='va'>tick_right</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/as_tibble.html'>as_tibble</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/geosphere/man/destPoint.html'>destPoint</a></span><span class='op'>(</span></span>
<span>  p <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>box_mid_x</span>, <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>ymin</span> <span class='op'>-</span> <span class='va'>box_actual_height</span><span class='op'>*</span><span class='va'>scale_space</span><span class='op'>)</span>, </span>
<span>  b <span class='op'>=</span> <span class='fl'>90</span>,</span>
<span>  d <span class='op'>=</span> <span class='va'>tick_distance</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Tibble for ticks:</span></span>
<span><span class='va'>tick</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"x"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>tick_left</span><span class='op'>$</span><span class='va'>lon</span>, <span class='va'>box_mid_x</span>, <span class='va'>tick_right</span><span class='op'>$</span><span class='va'>lon</span><span class='op'>)</span>,</span>
<span>  <span class='st'>"xend"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>tick_left</span><span class='op'>$</span><span class='va'>lon</span>, <span class='va'>box_mid_x</span>, <span class='va'>tick_right</span><span class='op'>$</span><span class='va'>lon</span><span class='op'>)</span>,</span>
<span>  <span class='st'>"y"</span> <span class='op'>=</span> <span class='va'>tick_left</span><span class='op'>$</span><span class='va'>lat</span> <span class='op'>-</span> <span class='op'>(</span><span class='op'>(</span><span class='va'>box_actual_height</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>*</span><span class='va'>tick_length</span><span class='op'>)</span>, </span>
<span>  <span class='st'>"yend"</span> <span class='op'>=</span> <span class='va'>tick_left</span><span class='op'>$</span><span class='va'>lat</span> <span class='op'>+</span> <span class='op'>(</span><span class='op'>(</span><span class='va'>box_actual_height</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>*</span><span class='va'>tick_length</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Tibble for kilometers:</span></span>
<span><span class='va'>km</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"label"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"0"</span>, <span class='st'>"1.5"</span>, <span class='st'>"3"</span>, <span class='st'>"  km"</span><span class='op'>)</span>,</span>
<span>  <span class='st'>"x"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>scale_left</span><span class='op'>$</span><span class='va'>lon</span>, <span class='va'>box_mid_x</span>, <span class='va'>scale_right</span><span class='op'>$</span><span class='va'>lon</span>, <span class='va'>scale_right</span><span class='op'>$</span><span class='va'>lon</span><span class='op'>)</span>,</span>
<span>  <span class='st'>"y"</span> <span class='op'>=</span> <span class='va'>scale_left</span><span class='op'>$</span><span class='va'>lat</span> <span class='op'>-</span> <span class='op'>(</span><span class='op'>(</span><span class='va'>box_actual_height</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>*</span><span class='va'>km_space</span><span class='op'>)</span>,</span>
<span>  <span class='st'>"hjust"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.5</span>, <span class='fl'>0.5</span>, <span class='fl'>0.5</span>, <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># All justified center, "kilometers" left</span></span>
<span></span>
<span></span>
<span></span>
<span><span class='co'># Plotting scale:</span></span>
<span><span class='co'># ===============</span></span>
<span></span>
<span><span class='va'>calgary_replica</span> <span class='op'>&lt;-</span> <span class='va'>calgary_replica</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># Ticks:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_segment.html'>geom_segment</a></span><span class='op'>(</span> </span>
<span>    data <span class='op'>=</span> <span class='va'>tick</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, xend <span class='op'>=</span> <span class='va'>xend</span>, </span>
<span>        y <span class='op'>=</span> <span class='va'>y</span>, yend <span class='op'>=</span> <span class='va'>yend</span><span class='op'>)</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='va'>tick_thickness</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>tick_color</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># Horizontal line:  </span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_segment.html'>geom_segment</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>scale_horizontal</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, xend <span class='op'>=</span> <span class='va'>xend</span>, </span>
<span>        y <span class='op'>=</span> <span class='va'>y</span>, yend <span class='op'>=</span> <span class='va'>yend</span><span class='op'>)</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='va'>scale_thickness</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>scale_color</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># Kilometers:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>km</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span>, hjust <span class='op'>=</span> <span class='va'>hjust</span>, label <span class='op'>=</span> <span class='va'>label</span><span class='op'>)</span>,</span>
<span>    size <span class='op'>=</span> <span class='va'>km_size</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>km_color</span>, </span>
<span>    family <span class='op'>=</span> <span class='va'>km_font</span></span>
<span>    <span class='op'>)</span></span>
<span></span>
<span><span class='va'>calgary_replica</span> <span class='co'># To see it</span></span></code></pre>
</div>
<p><img src="100569505_files/figure-html5/plot_scale-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<p>With the replica finished, we can move on to the alternative visualization.</p>
<h2 id="alternative">Alternative</h2>
<p>While the original visualization effectively highlights the relative competitiveness of each mode, we identified two key opportunities for improvement:</p>
<ul>
<li><p>First, the original map does not include information on absolute travel times. This is a critical piece of context for any potential user: for example, it is unlikely that someone chooses to travel by bike just because it is ten minutes faster; they probably want to know how long they will have to cycle to reach the destination. We will address this by adding isochrones that show the time it takes to get to Calgary Tower if the fastest travel mode is chosen.</p></li>
<li><p>Second, some of the people to whom we showed the original map struggled to read it quickly. This mainly has to do with the legend: although understandable, it is not very intuitive (requiring the user to read a long paragraph first). We will address this by simplifying the text and changing the legends disposition. We believe that representing the colors vertically helps the user understand the data faster, since it mirrors the actual flow of the map (where the full scale of colors from orange to purple appears vertically from North to South). On top of that, we will add a small extra legend showing how to read an annotated example point.</p></li>
</ul>
<p>In addition, we will carry out several specific refinements:</p>
<ul>
<li><p>We will plot the roads on top of the water, to show where bridges are.</p></li>
<li><p>We will create a high-contrast dark version of the map.</p></li>
<li><p>To address data inconsistencies, we will plot only one color for roads where the bike is faster. The original map includes a dark orange category representing points where cycling is supposedly &gt;30 minutes faster. However, many of these data points do not make sensefor example, when they appear immediately next to points from which transit is faster. This shouldnt be possible, especially over large areas; there should be a middle area where the bike is faster by 1030 minutes, showing a progressive transition. We believe these inconsistencies are likely the result of flaws in r5py (which the author used to generate the data). Since we cannot discriminate between legitimate points and artifacts with the available data, we decided to merge all bike is faster areas under a single label. While not a perfect solution, it seems like a reasonable approach after visual inspection of the map.</p></li>
</ul>
<h3 id="data-transformation-1">Data transformation:</h3>
<p>The first step is to carry out some data transformation in order to compute the isochrones. For that, we add a new variable to hexagons containing binned data (in 20-minute intervals) representing the travel time if the fastest mode is chosen.</p>
<p>Why did we choose 20-minute bins? Why not 15 or 30? We found that this interval achieves a nice equilibrium between making the map informative and not overloading it with too many isochrone lines. We will create four areas: under 20, under 40, under 60, and 60 or more.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>hexagons2</span> <span class='op'>&lt;-</span> <span class='va'>hexagons</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    <span class='st'>"fastest_travel_time"</span> <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span></span>
<span>      <span class='va'>b_travel_time</span> <span class='op'>&gt;</span> <span class='va'>travel_time</span> <span class='op'>~</span> <span class='va'>travel_time</span>,</span>
<span>      <span class='va'>travel_time</span> <span class='op'>&gt;</span> <span class='va'>b_travel_time</span> <span class='op'>~</span> <span class='va'>b_travel_time</span><span class='op'>)</span>,</span>
<span>    <span class='st'>"isochrones"</span> <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span></span>
<span>      <span class='va'>fastest_travel_time</span> <span class='op'>&lt;</span> <span class='fl'>20</span> <span class='op'>~</span> <span class='fl'>4</span>,</span>
<span>      <span class='va'>fastest_travel_time</span> <span class='op'>&lt;</span> <span class='fl'>40</span> <span class='op'>~</span> <span class='fl'>3</span>,</span>
<span>      <span class='va'>fastest_travel_time</span> <span class='op'>&lt;</span> <span class='fl'>60</span> <span class='op'>~</span> <span class='fl'>2</span>,</span>
<span>      <span class='va'>fastest_travel_time</span> <span class='op'>&gt;=</span> <span class='fl'>60</span> <span class='op'>~</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>isochrones</span> <span class='op'>!=</span> <span class='fl'>1</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>We used the last filter in order not to get an area for the last isochrone. Since it has an infinite maximum value, it would just represent the border of the map, which adds no information and would only create visual noise.</p>
<p>The reason we gave the isochrones a decreasing order is because the lowest values are plotted first (at the bottom) and, given the transformations we perform in the next chunk, the larger areas include the areas inside them they are not doughnuts. Since we want to color in a gradient from cyan to gray, we need the smaller areas to have the biggest number to be plotted last (on top), and appear more more vivid (which would not be the case if we plot a gray layer on top).</p>
<p>Having clarified this, we can can continue with the data transformation. We have the areas for the isochrones, but there are a few problems we need to solve. Firstly, because our areas are simply sets of individual hexagons, plotting them directly results in a hexagon grid effect:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>hexagons2</span>, </span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>isochrones</span><span class='op'>)</span>,</span>
<span>    alpha <span class='op'>=</span> <span class='fl'>0.5</span></span>
<span>    <span class='op'>)</span></span></code></pre>
</div>
<p><img src="100569505_files/figure-html5/show_hexagon_grid_problem-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<p>To resolve this, we need to dissolve the internal boundaries between adjacent hexagons of the same class. Using <code>group_by</code> followed by <code>summarise</code> is a simple solution to merge these features into single geometries.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>hexagons2</span> <span class='op'>&lt;-</span> <span class='va'>hexagons2</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>isochrones</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>We now have isochrones that we can plot without the hexagon grid effect. However, there are two other problems: first, there are lots of holes in our isochrones. Second, the border of our isochrones follows straight lines with the shape of the hexagons, which would create visual noise if plotted on top of the roads. Lets remove the wholes and smooth out the isochrones:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>hexagons2</span> <span class='op'>&lt;-</span> <span class='va'>hexagons2</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_cast.html'>st_cast</a></span><span class='op'>(</span><span class='st'>"POLYGON"</span><span class='op'>)</span> <span class='op'>|&gt;</span> <span class='co'># More on why we use st_cast() below </span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span><span class='st'>"area"</span> <span class='op'>=</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/geos_measures.html'>st_area</a></span><span class='op'>(</span><span class='va'>geometry</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span>  <span class='co'># We calculate area of each polygon</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span><span class='st'>"area"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>area</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span> <span class='co'># Make numeric to be able to filter</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>area</span> <span class='op'>&gt;</span> <span class='fl'>500000</span><span class='op'>)</span> <span class='op'>|&gt;</span>  <span class='co'># We keep only the polygons with a big area (m2)</span></span>
<span>  <span class='fu'><a href='https://michaeldorman.github.io/nngeo/reference/st_remove_holes.html'>st_remove_holes</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>|&gt;</span>  <span class='co'># Remove the holes</span></span>
<span>  <span class='fu'><a href='https://strimas.com/smoothr/reference/smooth.html'>smooth</a></span><span class='op'>(</span> <span class='co'># From package smoothr, to smooth the border of the isochrones</span></span>
<span>    method <span class='op'>=</span> <span class='st'>"ksmooth"</span>,</span>
<span>    smoothness <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>Why did we use <code>st_cast</code>? Initially, we attempted <code>st_remove_holes()</code> from package <code>nngeo</code> directly. But it didnt work (the code did run, but we did not get the desired effect). The reason was that the geometry in our object <code>isochrones</code> is multipolygon, and <code>st_remove_holes()</code> removes the holes inside each of the polygons that form a multipolygon.</p>
<p>Looking at an example from the functions documentation might help us convey what <code>st_remove_holes()</code> does:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>opar</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span><span class='op'>(</span>mfrow <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Example with 'sfg' - POLYGON</span></span>
<span><span class='va'>p1</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>rbind</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>0</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>0</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3</span>,<span class='fl'>2</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>,<span class='fl'>4</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>4</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>p2</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>rbind</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>1</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>2</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>,<span class='fl'>2</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>p3</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>rbind</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3</span>,<span class='fl'>0</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>4</span>,<span class='fl'>0</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>4</span>,<span class='fl'>1</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3</span>,<span class='fl'>1</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3</span>,<span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>p4</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>rbind</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3.3</span>,<span class='fl'>0.3</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3.8</span>,<span class='fl'>0.3</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3.8</span>,<span class='fl'>0.8</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3.3</span>,<span class='fl'>0.8</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3.3</span>,<span class='fl'>0.3</span><span class='op'>)</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>5</span><span class='op'>:</span><span class='fl'>1</span>,<span class='op'>]</span></span>
<span><span class='va'>p5</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>rbind</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3</span>,<span class='fl'>3</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>4</span>,<span class='fl'>2</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>4</span>,<span class='fl'>3</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3</span>,<span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>mpol</span> <span class='op'>=</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st.html'>st_multipolygon</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>p1</span>,<span class='va'>p2</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>p3</span>,<span class='va'>p4</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>p5</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>result</span> <span class='op'>=</span> <span class='fu'><a href='https://michaeldorman.github.io/nngeo/reference/st_remove_holes.html'>st_remove_holes</a></span><span class='op'>(</span><span class='va'>mpol</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>mpol</span>, col <span class='op'>=</span> <span class='st'>"#FF000033"</span>, main <span class='op'>=</span> <span class='st'>"Before"</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>result</span>, col <span class='op'>=</span> <span class='st'>"#FF000033"</span>, main <span class='op'>=</span> <span class='st'>"After"</span><span class='op'>)</span></span></code></pre>
</div>
<p><img src="100569505_files/figure-html5/st_remove_holes_documentation_example-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<p>The issue is that <code>st_remove_holes()</code> alone does not solve our problem because many of the visual gaps in our isochrones are not technically holesthey are small, detached islands (separate polygons within a multipolygon). For example, small pockets of 60-minute travel time appearing inside a 40-minute zone look like holes, but strictly speaking, they are separate geometries.</p>
<p>Thats why we use <code>st_cast()</code>: it divides the multipolygons into the polygons that form them. Once we have done that, we can filter by size removing the small polygons that look like holes. This way we fix both the holes and the small island that look like holes. We are now ready to plot.</p>
<h3 id="plotting-1">Plotting</h3>
<h4 id="roads-water-and-isochrones">Roads, water, and isochrones</h4>
<p>We begin plotting the roads, water, and isochrones. We will first plot the isochrones areas, since they would alter the color of the roads if we plotted them on top of them. After that, the water, then the roads to make sure bridges are visible (unlike in the original map, where water was on top of roads), and finally the isochrones border.</p>
<p>We have decided to plot water bodies using a light, contrasting color. We believe that rivers and lakes serve as critical visual landmarks, helping inhabitants of the city intuitively orient themselves and locate key places (like home or work) relative to these geographic features.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>alternative</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span><span class='co'># Isochrones' areas (no border yet)</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>hexagons2</span>, </span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>isochrones</span><span class='op'>)</span>,</span>
<span>    color <span class='op'>=</span> <span class='cn'>NA</span>,</span>
<span>    alpha <span class='op'>=</span> <span class='fl'>0.2</span>,</span>
<span>    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span> </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_gradient.html'>scale_fill_gradient</a></span><span class='op'>(</span>low <span class='op'>=</span> <span class='st'>"gray"</span>, <span class='co'># Outer isochrone</span></span>
<span>                      high <span class='op'>=</span> <span class='st'>"cyan"</span> <span class='co'># Inner isochrone</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span><span class='co'># Water:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span> <span class='co'>#</span></span>
<span>    data <span class='op'>=</span> <span class='va'>water</span>,</span>
<span>    fill <span class='op'>=</span> <span class='st'>"#b6b6b6"</span>,</span>
<span>    color <span class='op'>=</span> <span class='st'>"#b6b6b6"</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='fl'>1.1</span> <span class='op'>*</span> <span class='va'>sr</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span><span class='co'># Roads:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>hexroads_intersection</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='va'>time_color</span><span class='op'>)</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='fl'>0.6</span> <span class='op'>*</span> <span class='va'>sr</span>, <span class='co'># Thinner looks better with the isochrones</span></span>
<span>    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_color_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>    <span class='st'>"-2"</span> <span class='op'>=</span> <span class='st'>"#c88c47"</span>, <span class='co'># Color choice explained above</span></span>
<span>    <span class='st'>"-1"</span> <span class='op'>=</span> <span class='st'>"#c88c47"</span>, <span class='co'># bike 1030 min faster</span></span>
<span>    <span class='st'>"0"</span>  <span class='op'>=</span> <span class='st'>"#b7a6ac"</span>, <span class='co'># similar travel time</span></span>
<span>    <span class='st'>"1"</span>  <span class='op'>=</span> <span class='st'>"#a36f96"</span>, <span class='co'># transit 1030 min faster</span></span>
<span>    <span class='st'>"2"</span>  <span class='op'>=</span> <span class='st'>"#6a4886"</span><span class='op'>)</span> <span class='co'># transit &gt;30 min faster</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span><span class='co'># Isochrones's borders:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>hexagons2</span>, </span>
<span>    color <span class='op'>=</span> <span class='fu'><a href='https://scales.r-lib.org/reference/alpha.html'>alpha</a></span><span class='op'>(</span><span class='st'>"#e5fcff"</span>, <span class='fl'>0.7</span><span class='op'>)</span>,</span>
<span>    fill <span class='op'>=</span> <span class='cn'>NA</span>,</span>
<span>    alpha <span class='op'>=</span> <span class='fl'>0</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='fl'>1</span> <span class='op'>*</span> <span class='va'>sr</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># Theming:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_void</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span> <span class='co'># To make the plot area and the whole image have black background</span></span>
<span>    plot.background <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='st'>"black"</span>, color <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span>,</span>
<span>    panel.background <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='st'>"black"</span>, color <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>alternative</span> <span class='co'># To see it</span></span></code></pre>
</div>
<p><img src="100569505_files/figure-html5/plot_roads_water_isochrones-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<h4 id="a-dissmissed-legend-option-lollipops">A dissmissed legend option: lollipops</h4>
<p>We spent quite some time trying various kind of legend for road colors. We will discuss only one of the dismissed alternatives: for a while, we considered using a lollipop style legend. We ultimately discarded it because the lollipop lines added unnecessary visual noise across the map, and the information they provided was redundant with the color of the dots themselves, as can be seen below:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Settings:</span></span>
<span><span class='co'># =========</span></span>
<span></span>
<span><span class='co'># Lines settings:</span></span>
<span><span class='va'>lines_width</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='fl'>1</span> <span class='op'>*</span> <span class='va'>sr</span><span class='op'>)</span> <span class='co'># Lollipop lines width</span></span>
<span><span class='va'>lines_x_end</span> <span class='op'>&lt;-</span> <span class='op'>-</span><span class='fl'>114.18</span>  <span class='co'># Same outside x for all lines</span></span>
<span></span>
<span><span class='va'>yellow_line_y_end</span> <span class='op'>&lt;-</span> <span class='fl'>50.980</span> <span class='co'># Yellow line line y end + text y + point y</span></span>
<span><span class='va'>gray_line_y_end</span> <span class='op'>&lt;-</span> <span class='fl'>50.965</span></span>
<span><span class='va'>light_purple_line_y_end</span> <span class='op'>&lt;-</span> <span class='fl'>50.950</span> <span class='co'># Light purple line y end + text y + point y</span></span>
<span><span class='va'>purple_line_y_end</span> <span class='op'>&lt;-</span> <span class='fl'>50.935</span> <span class='co'># Purple line y end + text y + point y</span></span>
<span></span>
<span><span class='va'>dot_size</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='fl'>25</span> <span class='op'>*</span> <span class='va'>sr</span><span class='op'>)</span> <span class='co'># Lollipop dot size</span></span>
<span><span class='va'>dot_stroke</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='fl'>2</span> <span class='op'>*</span> <span class='va'>sr</span><span class='op'>)</span></span>
<span><span class='va'>dot_stroke_color</span> <span class='op'>&lt;-</span> <span class='st'>"white"</span></span>
<span></span>
<span><span class='va'>text_color</span> <span class='op'>&lt;-</span> <span class='st'>"white"</span> <span class='co'># Text color</span></span>
<span><span class='va'>text_family</span> <span class='op'>&lt;-</span> <span class='st'>"atkinson"</span> <span class='co'># Typography</span></span>
<span><span class='va'>text_size</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='fl'>10</span> <span class='op'>*</span> <span class='va'>sr</span><span class='op'>)</span></span>
<span><span class='va'>text_h_just</span> <span class='op'>&lt;-</span> <span class='fl'>1</span> <span class='co'># 0 left, 0.5 center, 1 right</span></span>
<span><span class='va'>text_dot_space</span> <span class='op'>&lt;-</span> <span class='fl'>0.0125</span> <span class='co'># Space between the text and the dots</span></span>
<span></span>
<span></span>
<span></span>
<span><span class='co'># Plotting the legend:</span></span>
<span><span class='co'>#=====================</span></span>
<span></span>
<span><span class='va'>alternative</span> <span class='op'>+</span> </span>
<span>    </span>
<span><span class='co'># Yellow streets</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span> <span class='co'># Yellow line</span></span>
<span>    <span class='st'>"segment"</span>,</span>
<span>    x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>114.105</span>,</span>
<span>    xend <span class='op'>=</span> <span class='va'>lines_x_end</span>,</span>
<span>    y <span class='op'>=</span> <span class='fl'>51.03</span>,</span>
<span>    yend <span class='op'>=</span> <span class='va'>yellow_line_y_end</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='va'>lines_width</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>dot_stroke_color</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span> <span class='co'># Yellow lollipop dot</span></span>
<span>    <span class='st'>"point"</span>,</span>
<span>    x <span class='op'>=</span> <span class='va'>lines_x_end</span>,</span>
<span>    y <span class='op'>=</span> <span class='va'>yellow_line_y_end</span>,</span>
<span>    size <span class='op'>=</span> <span class='va'>dot_size</span>,</span>
<span>    shape <span class='op'>=</span> <span class='fl'>21</span>,</span>
<span>    fill <span class='op'>=</span> <span class='st'>"#f8ad58"</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>dot_stroke_color</span>, <span class='co'># Border</span></span>
<span>    stroke <span class='op'>=</span> <span class='va'>dot_stroke</span> <span class='co'># Border stroke width</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span> <span class='co'># Yellow text</span></span>
<span>    <span class='st'>"text"</span>,</span>
<span>    label <span class='op'>=</span> <span class='st'>"10-30' faster by bike"</span>,</span>
<span>    x <span class='op'>=</span> <span class='va'>lines_x_end</span> <span class='op'>-</span> <span class='va'>text_dot_space</span>,</span>
<span>    y <span class='op'>=</span> <span class='va'>yellow_line_y_end</span>,</span>
<span>    hjust <span class='op'>=</span> <span class='va'>text_h_just</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>text_color</span>,</span>
<span>    family <span class='op'>=</span> <span class='va'>text_family</span>,</span>
<span>    size <span class='op'>=</span> <span class='va'>text_size</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span><span class='co'># Gray streets</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span> <span class='co'># Gray line</span></span>
<span>    <span class='st'>"segment"</span>,</span>
<span>    x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>114.125</span>,</span>
<span>    xend <span class='op'>=</span> <span class='va'>lines_x_end</span>,</span>
<span>    y <span class='op'>=</span> <span class='fl'>50.995</span>,</span>
<span>    yend <span class='op'>=</span> <span class='va'>gray_line_y_end</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='va'>lines_width</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>dot_stroke_color</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span> <span class='co'># Gray lollipop dot</span></span>
<span>    <span class='st'>"point"</span>,</span>
<span>    x <span class='op'>=</span> <span class='va'>lines_x_end</span>,</span>
<span>    y <span class='op'>=</span> <span class='va'>gray_line_y_end</span>,</span>
<span>    size <span class='op'>=</span> <span class='va'>dot_size</span>,</span>
<span>    shape <span class='op'>=</span> <span class='fl'>21</span>,</span>
<span>    fill <span class='op'>=</span> <span class='st'>"#e3cdd5"</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>dot_stroke_color</span>, </span>
<span>    stroke <span class='op'>=</span> <span class='va'>dot_stroke</span> </span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span> <span class='co'># Gray area text</span></span>
<span>    <span class='st'>"text"</span>,</span>
<span>    label <span class='op'>=</span> <span class='st'>"similar travel time"</span>, <span class='co'># Standard label for gray</span></span>
<span>    x <span class='op'>=</span> <span class='va'>lines_x_end</span> <span class='op'>-</span> <span class='va'>text_dot_space</span>,</span>
<span>    y <span class='op'>=</span> <span class='va'>gray_line_y_end</span>,</span>
<span>    hjust <span class='op'>=</span> <span class='va'>text_h_just</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>text_color</span>,</span>
<span>    family <span class='op'>=</span> <span class='va'>text_family</span>,</span>
<span>    size <span class='op'>=</span> <span class='va'>text_size</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span><span class='co'># Light purple streets</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span> <span class='co'># Light purple  line</span></span>
<span>    <span class='st'>"segment"</span>,</span>
<span>    x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>114.130</span>,</span>
<span>    xend <span class='op'>=</span> <span class='va'>lines_x_end</span>,</span>
<span>    y <span class='op'>=</span> <span class='fl'>50.94</span>,</span>
<span>    yend <span class='op'>=</span> <span class='va'>light_purple_line_y_end</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='va'>lines_width</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>dot_stroke_color</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span> <span class='co'># Light purple lollipop dot</span></span>
<span>    <span class='st'>"point"</span>,</span>
<span>    x <span class='op'>=</span> <span class='va'>lines_x_end</span>,</span>
<span>    y <span class='op'>=</span> <span class='va'>light_purple_line_y_end</span>,</span>
<span>    size <span class='op'>=</span> <span class='va'>dot_size</span>,</span>
<span>    shape <span class='op'>=</span> <span class='fl'>21</span>,</span>
<span>    fill <span class='op'>=</span> <span class='st'>"#ca8aba"</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>dot_stroke_color</span>, </span>
<span>    stroke <span class='op'>=</span> <span class='va'>dot_stroke</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span> <span class='co'># Light purple text</span></span>
<span>    <span class='st'>"text"</span>,</span>
<span>    label <span class='op'>=</span> <span class='st'>"10-30' faster by transit"</span>,</span>
<span>    x <span class='op'>=</span> <span class='va'>lines_x_end</span> <span class='op'>-</span> <span class='va'>text_dot_space</span>,</span>
<span>    y <span class='op'>=</span> <span class='va'>light_purple_line_y_end</span>,</span>
<span>    hjust <span class='op'>=</span> <span class='va'>text_h_just</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>text_color</span>,</span>
<span>    family <span class='op'>=</span> <span class='va'>text_family</span>,</span>
<span>    size <span class='op'>=</span> <span class='va'>text_size</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span><span class='co'># Purple streets</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span> <span class='co'># Purple line</span></span>
<span>    <span class='st'>"segment"</span>,</span>
<span>    x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>114.110</span>,</span>
<span>    xend <span class='op'>=</span> <span class='va'>lines_x_end</span>,</span>
<span>    y <span class='op'>=</span> <span class='fl'>50.910</span>,</span>
<span>    yend <span class='op'>=</span> <span class='va'>purple_line_y_end</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='va'>lines_width</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>dot_stroke_color</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span> <span class='co'># Purple lollipop dot</span></span>
<span>    <span class='st'>"point"</span>,</span>
<span>    x <span class='op'>=</span> <span class='va'>lines_x_end</span>,</span>
<span>    y <span class='op'>=</span> <span class='va'>purple_line_y_end</span>,</span>
<span>    size <span class='op'>=</span> <span class='va'>dot_size</span>,</span>
<span>    shape <span class='op'>=</span> <span class='fl'>21</span>,</span>
<span>    fill <span class='op'>=</span> <span class='st'>"#8359a6"</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>dot_stroke_color</span>, <span class='co'># Border</span></span>
<span>    stroke <span class='op'>=</span> <span class='va'>dot_stroke</span> <span class='co'># Border stroke width</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span> <span class='co'># Purple text</span></span>
<span>    <span class='st'>"text"</span>,</span>
<span>    label <span class='op'>=</span> <span class='st'>"+30' faster by transit"</span>,</span>
<span>    x <span class='op'>=</span> <span class='va'>lines_x_end</span> <span class='op'>-</span> <span class='va'>text_dot_space</span>,</span>
<span>    y <span class='op'>=</span> <span class='va'>purple_line_y_end</span>,</span>
<span>    hjust <span class='op'>=</span> <span class='va'>text_h_just</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>text_color</span>,</span>
<span>    family <span class='op'>=</span> <span class='va'>text_family</span>,</span>
<span>    size <span class='op'>=</span> <span class='va'>text_size</span></span>
<span>  <span class='op'>)</span></span></code></pre>
</div>
<p><img src="100569505_files/figure-html5/black_isochr_fastest_street_legend-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<h4 id="color-legend-1">Color legend</h4>
<p>Instead of the lollipops, we decided to go with a legend that looks like the streets it represents.</p>
<p>As we discussed, one of the main issues with the original plot was that it was hard to understand the legend quickly.</p>
<p>For our alternative proposal, we chose to plot thin vertical rectangles. The idea is that they visually resemble the roads they represent. Furthermore, the colors in the legend appear in the same direction and order as they do on the map itself (scanning from North to South reveals a gradient from Yellow to Purple). We believe this alignment allows for much faster cognitive processing of the map.</p>
<p>Since, once again, theres lots of manual work to do until we find pleasing values, we will use the same Settings -&gt; Calculations -&gt; Plotting approach we used above.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Settings:</span></span>
<span><span class='co'># =========</span></span>
<span><span class='va'>v_rectangle_top_y</span> <span class='op'>&lt;-</span> <span class='fl'>50.984</span></span>
<span><span class='va'>v_rectangle_mid_x</span> <span class='op'>&lt;-</span> <span class='op'>-</span><span class='fl'>114.17</span></span>
<span><span class='va'>v_rectangle_width</span> <span class='op'>&lt;-</span> <span class='fl'>0.002</span></span>
<span><span class='va'>v_rectangle_height</span> <span class='op'>&lt;-</span> <span class='fl'>0.0145</span></span>
<span><span class='va'>v_rectangle_space</span> <span class='op'>&lt;-</span> <span class='fl'>0.0005</span></span>
<span><span class='va'>v_rectangle_radius</span> <span class='op'>&lt;-</span> <span class='fl'>0.3</span></span>
<span><span class='va'>v_rectangle_fill</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"#c88c47"</span>, <span class='st'>"#b7a6ac"</span>, <span class='st'>"#a36f96"</span>, <span class='st'>"#6a4886"</span><span class='op'>)</span></span>
<span></span>
<span></span>
<span>  </span>
<span><span class='co'># Calculations:</span></span>
<span><span class='co'># =============</span></span>
<span><span class='va'>v_rectangles</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"xmin"</span> <span class='op'>=</span> <span class='va'>v_rectangle_mid_x</span> <span class='op'>-</span> <span class='op'>(</span><span class='va'>v_rectangle_width</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span>,</span>
<span>  <span class='st'>"xmax"</span> <span class='op'>=</span> <span class='va'>v_rectangle_mid_x</span> <span class='op'>+</span> <span class='op'>(</span><span class='va'>v_rectangle_width</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span>,</span>
<span>  <span class='st'>"ymin"</span> <span class='op'>=</span></span>
<span>    <span class='va'>v_rectangle_top_y</span> <span class='op'>-</span> <span class='op'>(</span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>4</span><span class='op'>)</span><span class='op'>*</span><span class='va'>v_rectangle_height</span><span class='op'>)</span> <span class='op'>-</span> <span class='op'>(</span><span class='op'>(</span><span class='fl'>0</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>)</span><span class='op'>*</span><span class='va'>v_rectangle_space</span><span class='op'>)</span>,</span>
<span>  <span class='st'>"ymax"</span> <span class='op'>=</span> <span class='va'>v_rectangle_top_y</span> <span class='op'>-</span> <span class='op'>(</span><span class='op'>(</span><span class='fl'>0</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>)</span><span class='op'>*</span><span class='op'>(</span><span class='va'>v_rectangle_height</span> <span class='op'>+</span> <span class='va'>v_rectangle_space</span><span class='op'>)</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class='co'># Plotting the rectangles:</span></span>
<span><span class='co'>#=========================</span></span>
<span><span class='va'>alternative</span> <span class='op'>&lt;-</span> <span class='va'>alternative</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://eliocamp.github.io/ggnewscale/reference/new_scale.html'>new_scale_fill</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span> <span class='co'># So that it doesn't affect the color of the isochrones</span></span>
<span>  <span class='fu'><a href='https://funkyheatmap.github.io/funkyheatmap/reference/geom_rounded_rect.html'>geom_rounded_rect</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>v_rectangles</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>xmin <span class='op'>=</span> <span class='va'>xmin</span>, xmax <span class='op'>=</span> <span class='va'>xmax</span>,</span>
<span>        ymin <span class='op'>=</span> <span class='va'>ymin</span>, ymax <span class='op'>=</span> <span class='va'>ymax</span><span class='op'>)</span>,</span>
<span>    fill <span class='op'>=</span> <span class='va'>v_rectangle_fill</span>,</span>
<span>    radius <span class='op'>=</span> <span class='va'>v_rectangle_radius</span>,</span>
<span>    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>alternative</span> <span class='co'># To see it</span></span></code></pre>
</div>
<p><img src="100569505_files/figure-html5/plot_thin_vertical_squares-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<p>Next, we add a distinctive detail: street arrows. These are pointers constructed from actual road geometries extracted from our map data. These arrows emerge from the thin rectangles (which act as main streets) and point towards the descriptive text. This makes the legend more visible, reinforces the connection between the color and the road network, and adds a coherent aesthetic touch.</p>
<p>We used this code to find an adequate area of streets to use as arrow:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>alternative</span> <span class='op'>+</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>    <span class='st'>"polygon"</span>,</span>
<span>    x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>114.078</span>, <span class='op'>-</span><span class='fl'>114.078</span>, <span class='op'>-</span><span class='fl'>114.0631</span>, <span class='op'>-</span><span class='fl'>114.0631</span><span class='op'>)</span> <span class='co'># The sums allowed us to</span></span>
<span>          <span class='op'>+</span> <span class='op'>(</span><span class='op'>-</span><span class='fl'>0.054</span><span class='op'>)</span><span class='op'>)</span>,                                <span class='co'># quickly move around</span></span>
<span>    y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>51.0445</span>, <span class='fl'>51.0455</span>, <span class='fl'>51.051</span>, <span class='fl'>51.039</span><span class='op'>)</span>         <span class='co'># the map looking for an</span></span>
<span>          <span class='op'>+</span> <span class='op'>(</span><span class='op'>-</span><span class='fl'>0.08385</span><span class='op'>)</span><span class='op'>)</span>,                              <span class='co'># area that we liked.</span></span>
<span>    color <span class='op'>=</span> <span class='st'>"green"</span>,</span>
<span>    fill <span class='op'>=</span> <span class='cn'>NA</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='fl'>0.4</span><span class='op'>)</span></span></code></pre>
</div>
<p><img src="100569505_files/figure-html5/find_streets_for_legend-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<p>Once we found the coordinates, we save them as a matrix, because that is the object later required by <code>st_polygon</code></p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>selected_coordinates</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span><span class='op'>(</span></span>
<span>  <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>   <span class='st'>"x"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>114.078</span>, <span class='op'>-</span><span class='fl'>114.078</span>, <span class='op'>-</span><span class='fl'>114.0631</span>, <span class='op'>-</span><span class='fl'>114.0631</span><span class='op'>)</span> <span class='op'>+</span> <span class='op'>(</span><span class='op'>-</span><span class='fl'>0.054</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>   <span class='st'>"y"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>51.0445</span>, <span class='fl'>51.0455</span>, <span class='fl'>51.051</span>, <span class='fl'>51.039</span><span class='op'>)</span> <span class='op'>+</span> <span class='op'>(</span><span class='op'>-</span><span class='fl'>0.08385</span><span class='op'>)</span><span class='op'>)</span></span>
<span>   <span class='op'>)</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>4</span>, <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># We need to repeat the first row in fifth</span></span>
<span>                 <span class='co'># place to close the polygon</span></span></code></pre>
</div>
</div>
<p>We can now create a polygon with those coordinates:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>selected_polygon</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st.html'>st_polygon</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>selected_coordinates</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>Then select the corresponding area from hexagons by intersection:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># We need to specify that our object uses the same coordinate </span></span>
<span><span class='co'># reference system (crs), otherwise st_intersection doesn't work.</span></span>
<span><span class='va'>selected_polygon</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/sfc.html'>st_sfc</a></span><span class='op'>(</span></span>
<span>  <span class='va'>selected_polygon</span>,</span>
<span>  crs <span class='op'>=</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_crs.html'>st_crs</a></span><span class='op'>(</span><span class='va'>all_roads_dissolved</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># We can now get the intersection:</span></span>
<span><span class='va'>selected_street</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/geos_binary_ops.html'>st_intersection</a></span><span class='op'>(</span><span class='va'>all_roads_dissolved</span>, <span class='va'>selected_polygon</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>Finally, we create a new object with this sf object substracting from its coordinates the coordinates of its centroid. This way, it will be easier to move (plot) repeatedly (we can put it wherever we want just by summing the coordinates that we want to make the centroid).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>centroid</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/geos_unary.html'>st_centroid</a></span><span class='op'>(</span><span class='fu'><a href='https://r-spatial.github.io/sf/reference/geos_combine.html'>st_union</a></span><span class='op'>(</span><span class='va'>selected_street</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>street_arrow</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_geometry.html'>st_geometry</a></span><span class='op'>(</span><span class='va'>selected_street</span><span class='op'>)</span> <span class='op'>-</span> <span class='va'>centroid</span></span></code></pre>
</div>
</div>
<p>We now have our street arrow template, we are ready to plot it next to the vertical squares that act as main roads:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Settings:</span></span>
<span><span class='co'># =========</span></span>
<span><span class='va'>street_arrow_mid_x</span> <span class='op'>&lt;-</span> <span class='op'>-</span><span class='fl'>0.0055</span> <span class='co'># From v_rectangle_mid_x</span></span>
<span><span class='va'>street_arrow_yellow_y</span> <span class='op'>&lt;-</span> <span class='fl'>0</span> <span class='co'># From 1/2 height of the vertical rectangles</span></span>
<span><span class='va'>street_arrow_width</span> <span class='op'>&lt;-</span> <span class='fl'>0.6</span> <span class='op'>*</span> <span class='va'>sr</span></span>
<span></span>
<span></span>
<span></span>
<span><span class='co'># Calculations:</span></span>
<span><span class='co'># =============</span></span>
<span></span>
<span><span class='co'># Yellow street arrow:</span></span>
<span><span class='va'>street_arrow_yellow</span> <span class='op'>&lt;-</span> <span class='va'>street_arrow</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>  <span class='va'>v_rectangle_mid_x</span> <span class='op'>+</span> <span class='va'>street_arrow_mid_x</span>,</span>
<span>  <span class='va'>v_rectangle_top_y</span> <span class='op'>-</span> <span class='op'>(</span><span class='fl'>0.5</span><span class='op'>*</span><span class='va'>v_rectangle_height</span><span class='op'>)</span> <span class='op'>+</span> <span class='va'>street_arrow_yellow_y</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Gray street arrow:</span></span>
<span><span class='va'>street_arrow_gray</span> <span class='op'>&lt;-</span> <span class='va'>street_arrow</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>  <span class='va'>v_rectangle_mid_x</span> <span class='op'>+</span> <span class='va'>street_arrow_mid_x</span>,</span>
<span>  <span class='va'>v_rectangle_top_y</span> <span class='op'>-</span> <span class='op'>(</span><span class='op'>(</span><span class='fl'>1.5</span><span class='op'>*</span><span class='va'>v_rectangle_height</span><span class='op'>)</span> <span class='op'>+</span> <span class='va'>v_rectangle_space</span><span class='op'>)</span> <span class='op'>+</span> <span class='va'>street_arrow_yellow_y</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Light purple street arrow:</span></span>
<span><span class='va'>street_arrow_light_purple</span> <span class='op'>&lt;-</span> <span class='va'>street_arrow</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>  <span class='va'>v_rectangle_mid_x</span> <span class='op'>+</span> <span class='va'>street_arrow_mid_x</span>,</span>
<span>  <span class='va'>v_rectangle_top_y</span> <span class='op'>-</span> <span class='op'>(</span><span class='op'>(</span><span class='fl'>2.5</span><span class='op'>*</span><span class='va'>v_rectangle_height</span><span class='op'>)</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>2</span><span class='op'>*</span><span class='va'>v_rectangle_space</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> <span class='va'>street_arrow_yellow_y</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Purple street arrow:</span></span>
<span><span class='va'>street_arrow_purple</span> <span class='op'>&lt;-</span> <span class='va'>street_arrow</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>  <span class='va'>v_rectangle_mid_x</span> <span class='op'>+</span> <span class='va'>street_arrow_mid_x</span>,</span>
<span>  <span class='va'>v_rectangle_top_y</span> <span class='op'>-</span> <span class='op'>(</span><span class='op'>(</span><span class='fl'>3.5</span><span class='op'>*</span><span class='va'>v_rectangle_height</span><span class='op'>)</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>3</span><span class='op'>*</span><span class='va'>v_rectangle_space</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> <span class='va'>street_arrow_yellow_y</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Assign crs to every arrow again:</span></span>
<span><span class='va'>street_arrow_yellow</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/sfc.html'>st_sfc</a></span><span class='op'>(</span><span class='va'>street_arrow_yellow</span>,</span>
<span>                              crs <span class='op'>=</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_crs.html'>st_crs</a></span><span class='op'>(</span><span class='va'>all_roads_dissolved</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>street_arrow_gray</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/sfc.html'>st_sfc</a></span><span class='op'>(</span><span class='va'>street_arrow_gray</span>,</span>
<span>                            crs <span class='op'>=</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_crs.html'>st_crs</a></span><span class='op'>(</span><span class='va'>all_roads_dissolved</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>street_arrow_light_purple</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/sfc.html'>st_sfc</a></span><span class='op'>(</span><span class='va'>street_arrow_light_purple</span>,</span>
<span>                                    crs <span class='op'>=</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_crs.html'>st_crs</a></span><span class='op'>(</span><span class='va'>all_roads_dissolved</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>street_arrow_purple</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/sfc.html'>st_sfc</a></span><span class='op'>(</span><span class='va'>street_arrow_purple</span>,</span>
<span>                              crs <span class='op'>=</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_crs.html'>st_crs</a></span><span class='op'>(</span><span class='va'>all_roads_dissolved</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class='co'># Ploting street arrows:</span></span>
<span><span class='co'>#=======================</span></span>
<span></span>
<span><span class='va'>alternative</span> <span class='op'>&lt;-</span> <span class='va'>alternative</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span> </span>
<span>    data <span class='op'>=</span> <span class='va'>street_arrow_yellow</span>,</span>
<span>    color <span class='op'>=</span> <span class='st'>"#c88c47"</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='va'>street_arrow_width</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>street_arrow_gray</span>,</span>
<span>    color <span class='op'>=</span> <span class='st'>"#b7a6ac"</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='va'>street_arrow_width</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>street_arrow_light_purple</span>,</span>
<span>    color <span class='op'>=</span> <span class='st'>"#a36f96"</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='va'>street_arrow_width</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='co'># 4. Purple Arrow</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>street_arrow_purple</span>,</span>
<span>    color <span class='op'>=</span> <span class='st'>"#6a4886"</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='va'>street_arrow_width</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>alternative</span> <span class='co'># To see it</span></span></code></pre>
</div>
<p><img src="100569505_files/figure-html5/plot_street_arrows-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<p>We just need to add the text to finish the color legend. Even though we use more words than the original legend, we believe this format is faster to read (and allows us to simplify the main introductory paragraph into a concise question, which works better as a title for the plot).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Settings:</span></span>
<span><span class='co'># =========</span></span>
<span><span class='va'>v_rect_text_color</span> <span class='op'>&lt;-</span> <span class='st'>"white"</span></span>
<span><span class='va'>v_rect_text_size</span> <span class='op'>&lt;-</span> <span class='fl'>7.5</span> <span class='op'>*</span> <span class='va'>sr</span></span>
<span><span class='va'>v_rect_text_family</span> <span class='op'>&lt;-</span> <span class='st'>"atkinson"</span></span>
<span></span>
<span><span class='va'>v_rect_h_just</span> <span class='op'>&lt;-</span> <span class='fl'>1</span> <span class='co'># Right</span></span>
<span><span class='va'>v_rect_text_h_space</span> <span class='op'>&lt;-</span> <span class='fl'>0.020</span></span>
<span><span class='va'>v_rect_text_text</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"10-30' faster by bike"</span>,</span>
<span>                      <span class='st'>"similar travel time"</span>,</span>
<span>                      <span class='st'>"10-30' faster by transit"</span>,</span>
<span>                      <span class='st'>"+30' faster by transit"</span><span class='op'>)</span></span>
<span>  </span>
<span></span>
<span></span>
<span><span class='co'># Calculations:</span></span>
<span><span class='co'>#==============</span></span>
<span><span class='va'>v_rect_text</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"x"</span> <span class='op'>=</span> <span class='va'>v_rectangle_mid_x</span> <span class='op'>-</span> <span class='va'>v_rect_text_h_space</span>,</span>
<span>  <span class='st'>"y"</span> <span class='op'>=</span> <span class='va'>v_rectangles</span><span class='op'>$</span><span class='va'>ymax</span> <span class='op'>-</span> <span class='op'>(</span><span class='va'>v_rectangle_height</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span>,</span>
<span>  <span class='st'>"label"</span> <span class='op'>=</span> <span class='va'>v_rect_text_text</span>,</span>
<span>  <span class='st'>"hjust"</span> <span class='op'>=</span> <span class='va'>v_rect_h_just</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span></span>
<span><span class='co'># Plot the text:</span></span>
<span><span class='co'>#===============</span></span>
<span><span class='va'>alternative</span> <span class='op'>&lt;-</span> <span class='va'>alternative</span> <span class='op'>+</span> </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>v_rect_text</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span>, hjust <span class='op'>=</span> <span class='va'>hjust</span>, label <span class='op'>=</span> <span class='va'>label</span><span class='op'>)</span>,</span>
<span>    size <span class='op'>=</span> <span class='va'>v_rect_text_size</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>v_rect_text_color</span>,</span>
<span>    family <span class='op'>=</span> <span class='va'>v_rect_text_family</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>alternative</span> <span class='co'># To see it</span></span></code></pre>
</div>
<p><img src="100569505_files/figure-html5/plot_color_legend_text-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<p>Finally, we plot the short question that acts as a title explaining what the map represents, while also identifying central point as Calgary Tower.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Settings:</span></span>
<span><span class='co'># =========</span></span>
<span></span>
<span><span class='co'># Text:</span></span>
<span><span class='va'>question_text_x</span> <span class='op'>&lt;-</span> <span class='va'>v_rectangle_mid_x</span> <span class='op'>+</span> <span class='op'>(</span><span class='va'>v_rectangle_width</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span></span>
<span><span class='va'>question_text_y</span> <span class='op'>&lt;-</span> <span class='fl'>50.9960</span></span>
<span><span class='va'>question_text_h_space</span> <span class='op'>&lt;-</span> <span class='fl'>0</span> <span class='co'># Relative to vertical rectangles mid x</span></span>
<span></span>
<span><span class='va'>question_text_size</span> <span class='op'>&lt;-</span> <span class='fl'>10</span> <span class='op'>*</span> <span class='va'>sr</span></span>
<span><span class='va'>question_text_line_height</span> <span class='op'>&lt;-</span> <span class='fl'>1.1</span></span>
<span><span class='va'>question_text_color</span> <span class='op'>&lt;-</span> <span class='st'>"white"</span> </span>
<span><span class='va'>question_text_family</span> <span class='op'>&lt;-</span> <span class='st'>"atkinson"</span></span>
<span><span class='va'>question_text_h_just</span> <span class='op'>&lt;-</span> <span class='fl'>1</span> <span class='co'># Right alignment</span></span>
<span></span>
<span></span>
<span><span class='co'># Blue point:</span></span>
<span><span class='va'>legend_blue_point_x</span> <span class='op'>&lt;-</span> <span class='op'>-</span><span class='fl'>114.1875</span></span>
<span><span class='va'>legend_blue_point_y</span> <span class='op'>&lt;-</span> <span class='fl'>50.9957</span></span>
<span></span>
<span><span class='va'>blue_point_size</span> <span class='op'>&lt;-</span> <span class='fl'>4</span> <span class='op'>*</span> <span class='va'>sr</span></span>
<span><span class='va'>blue_point_stroke</span> <span class='op'>&lt;-</span> <span class='fl'>4.5</span> <span class='op'>*</span> <span class='va'>sr</span></span>
<span><span class='va'>blue_point_fill</span> <span class='op'>&lt;-</span> <span class='st'>"#61d7ea"</span></span>
<span><span class='va'>blue_point_color</span> <span class='op'>&lt;-</span> <span class='st'>"white"</span></span>
<span></span>
<span></span>
<span></span>
<span><span class='co'># Plotting the legend:</span></span>
<span><span class='co'>#=====================</span></span>
<span></span>
<span><span class='va'>alternative</span> <span class='op'>&lt;-</span> <span class='va'>alternative</span> <span class='op'>+</span> </span>
<span>    </span>
<span><span class='co'># The question text:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>    <span class='st'>"text"</span>,</span>
<span>    x <span class='op'>=</span> <span class='va'>question_text_x</span>,</span>
<span>    y <span class='op'>=</span> <span class='va'>question_text_y</span>,</span>
<span>    label <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='st'>"What's the fastest way to get"</span>,</span>
<span>                  <span class='st'>"to Calgary Tower     on a"</span>,</span>
<span>                  <span class='st'>"weekday morning?"</span>,</span>
<span>                  sep <span class='op'>=</span> <span class='st'>"\n"</span><span class='op'>)</span>,</span>
<span>    hjust <span class='op'>=</span> <span class='va'>question_text_h_just</span>,</span>
<span>    family <span class='op'>=</span> <span class='va'>question_text_family</span>,</span>
<span>    size <span class='op'>=</span> <span class='va'>question_text_size</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>question_text_color</span>,</span>
<span>    lineheight <span class='op'>=</span> <span class='va'>question_text_line_height</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span><span class='co'># The blue point inside the question:</span></span>
<span>   <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span>  </span>
<span>    <span class='st'>"point"</span>,</span>
<span>    x <span class='op'>=</span> <span class='va'>legend_blue_point_x</span>, </span>
<span>    y <span class='op'>=</span> <span class='va'>legend_blue_point_y</span>,  </span>
<span>    shape <span class='op'>=</span> <span class='fl'>21</span>, </span>
<span>    size <span class='op'>=</span> <span class='va'>blue_point_size</span>,</span>
<span>    fill <span class='op'>=</span> <span class='va'>blue_point_fill</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>blue_point_color</span>,</span>
<span>    stroke <span class='op'>=</span> <span class='va'>blue_point_stroke</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span><span class='co'># The blue point in the map (Calgary Tower):  </span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>    <span class='st'>"point"</span>,</span>
<span>    x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>114.0631</span>, </span>
<span>    y <span class='op'>=</span> <span class='fl'>51.04465</span>,</span>
<span>    shape <span class='op'>=</span> <span class='fl'>21</span>, </span>
<span>    size <span class='op'>=</span> <span class='va'>blue_point_size</span>,</span>
<span>    fill <span class='op'>=</span> <span class='va'>blue_point_fill</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>blue_point_color</span>,</span>
<span>    stroke <span class='op'>=</span> <span class='va'>blue_point_stroke</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>alternative</span> <span class='co'># To see it</span></span></code></pre>
</div>
<p><img src="100569505_files/figure-html5/plot_question-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<h4 id="isochrones-legend">Isochrones legend</h4>
<p>We still need a legend explaining what the transparent cyan areas are. Since isochrones are widely used, and most people already understand them without much explanation, we can be very concise, and use very few words. Our legend will include the minutes within the isochrone border. We achieve this effect by plotting a number inside a black point with a border of the same color as the isochrone border. We also include a small annotation explaining that these numbers represent minutes. While our informal testing suggested people guess the meaning of the numbers correctly without the text, we included it to remove any potential ambiguity.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Settings</span></span>
<span><span class='co'># ========</span></span>
<span></span>
<span><span class='co'># Point</span></span>
<span><span class='va'>iso_point_size</span> <span class='op'>&lt;-</span> <span class='fl'>13.75</span> <span class='op'>*</span> <span class='va'>sr</span></span>
<span><span class='va'>iso_point_fill</span> <span class='op'>&lt;-</span> <span class='st'>"black"</span></span>
<span><span class='va'>iso_point_stroke_width</span> <span class='op'>&lt;-</span> <span class='fl'>1.5</span> <span class='op'>*</span> <span class='va'>sr</span></span>
<span><span class='va'>iso_point_stroke_color</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://scales.r-lib.org/reference/alpha.html'>alpha</a></span><span class='op'>(</span><span class='st'>"#e5fcff"</span>, <span class='fl'>0.7</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Text</span></span>
<span><span class='va'>iso_text_size</span> <span class='op'>&lt;-</span> <span class='fl'>6.7</span> <span class='op'>*</span> <span class='va'>sr</span></span>
<span><span class='va'>iso_text_color</span> <span class='op'>&lt;-</span> <span class='st'>"white"</span></span>
<span></span>
<span><span class='co'># Point and text position</span></span>
<span><span class='va'>x_20</span> <span class='op'>&lt;-</span> <span class='op'>-</span><span class='fl'>114.045</span></span>
<span><span class='va'>y_20</span> <span class='op'>&lt;-</span> <span class='fl'>51.0632</span></span>
<span></span>
<span><span class='va'>x_40</span> <span class='op'>&lt;-</span> <span class='op'>-</span><span class='fl'>114.0263</span></span>
<span><span class='va'>y_40</span> <span class='op'>&lt;-</span> <span class='fl'>51.082</span></span>
<span></span>
<span><span class='va'>x_60</span> <span class='op'>&lt;-</span> <span class='op'>-</span><span class='fl'>114.0096</span></span>
<span><span class='va'>y_60</span> <span class='op'>&lt;-</span> <span class='fl'>51.099</span></span>
<span></span>
<span></span>
<span></span>
<span><span class='co'># Plot isochrones legend:</span></span>
<span><span class='co'># =======================</span></span>
<span></span>
<span><span class='va'>alternative</span> <span class='op'>&lt;-</span> <span class='va'>alternative</span> <span class='op'>+</span> </span>
<span>  </span>
<span>  <span class='co'># Small annotation:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span> <span class='co'># The curve</span></span>
<span>    <span class='st'>"curve"</span>,</span>
<span>    x <span class='op'>=</span> <span class='va'>x_60</span> <span class='op'>-</span> <span class='fl'>0.001</span>, </span>
<span>    y <span class='op'>=</span> <span class='va'>y_60</span> <span class='op'>+</span> <span class='fl'>0.001</span>,</span>
<span>    xend <span class='op'>=</span> <span class='va'>x_60</span> <span class='op'>+</span> <span class='fl'>0.0020</span>,</span>
<span>    yend <span class='op'>=</span> <span class='va'>y_60</span> <span class='op'>+</span> <span class='fl'>0.0065</span>,</span>
<span>    curvature <span class='op'>=</span> <span class='fl'>0.9</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='fl'>0.85</span> <span class='op'>*</span> <span class='va'>sr</span>,</span>
<span>    color <span class='op'>=</span> <span class='st'>"white"</span>,</span>
<span>    arrow <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/arrow.html'>arrow</a></span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>30</span>,</span>
<span>                  length <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='op'>(</span><span class='fl'>0.1</span> <span class='op'>*</span> <span class='va'>sr</span><span class='op'>)</span>, <span class='st'>"in"</span><span class='op'>)</span>,</span>
<span>                  ends <span class='op'>=</span> <span class='st'>"last"</span>,</span>
<span>                  type <span class='op'>=</span> <span class='st'>"closed"</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># Minutes by fastest mode text:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>    <span class='st'>"text"</span>,</span>
<span>    x <span class='op'>=</span> <span class='va'>x_60</span> <span class='op'>-</span> <span class='fl'>0.006</span>,</span>
<span>    y <span class='op'>=</span> <span class='va'>y_60</span> <span class='op'>+</span> <span class='fl'>0.0092</span>,</span>
<span>    label <span class='op'>=</span> <span class='st'>"minutes\nby fastest\nmode"</span>,</span>
<span>    size <span class='op'>=</span> <span class='va'>iso_text_size</span>,</span>
<span>    lineheight <span class='op'>=</span> <span class='fl'>0.85</span>,</span>
<span>    vjust <span class='op'>=</span> <span class='fl'>0.5</span>,</span>
<span>    hjust <span class='op'>=</span> <span class='fl'>0.5</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>iso_text_color</span>,</span>
<span>    family <span class='op'>=</span> <span class='st'>"atkinson"</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># 20' point and text</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>   <span class='st'>"point"</span>,</span>
<span>   x <span class='op'>=</span> <span class='va'>x_20</span>,</span>
<span>   y <span class='op'>=</span> <span class='va'>y_20</span>,</span>
<span>   size <span class='op'>=</span> <span class='va'>iso_point_size</span>,</span>
<span>   shape <span class='op'>=</span> <span class='fl'>21</span>,</span>
<span>   fill <span class='op'>=</span> <span class='va'>iso_point_fill</span>,</span>
<span>   <span class='co'>#alpha = iso_point_alpha,</span></span>
<span>   stroke <span class='op'>=</span> <span class='va'>iso_point_stroke_width</span>,</span>
<span>   color <span class='op'>=</span> <span class='va'>iso_point_stroke_color</span></span>
<span> <span class='op'>)</span> <span class='op'>+</span></span>
<span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>   <span class='st'>"text"</span>,</span>
<span>   label <span class='op'>=</span> <span class='st'>"20"</span>,</span>
<span>   x <span class='op'>=</span> <span class='va'>x_20</span>,</span>
<span>   y <span class='op'>=</span> <span class='va'>y_20</span>,</span>
<span>   size <span class='op'>=</span> <span class='va'>iso_text_size</span>,</span>
<span>   family <span class='op'>=</span> <span class='st'>"atkinson"</span>,</span>
<span>   color <span class='op'>=</span> <span class='va'>iso_text_color</span></span>
<span> <span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span>  <span class='co'># 40' point and text    </span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>   <span class='st'>"point"</span>,</span>
<span>   x <span class='op'>=</span> <span class='va'>x_40</span>,</span>
<span>   y <span class='op'>=</span> <span class='va'>y_40</span>,</span>
<span>   size <span class='op'>=</span> <span class='va'>iso_point_size</span>,</span>
<span>   shape <span class='op'>=</span> <span class='fl'>21</span>,</span>
<span>   fill <span class='op'>=</span> <span class='va'>iso_point_fill</span>,</span>
<span>   stroke <span class='op'>=</span> <span class='va'>iso_point_stroke_width</span>,</span>
<span>   color <span class='op'>=</span> <span class='va'>iso_point_stroke_color</span></span>
<span> <span class='op'>)</span> <span class='op'>+</span></span>
<span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>   <span class='st'>"text"</span>,</span>
<span>   label <span class='op'>=</span> <span class='st'>"40"</span>,</span>
<span>   x <span class='op'>=</span> <span class='va'>x_40</span>,</span>
<span>   y <span class='op'>=</span> <span class='va'>y_40</span>,</span>
<span>   size <span class='op'>=</span> <span class='va'>iso_text_size</span>,</span>
<span>   family <span class='op'>=</span> <span class='st'>"atkinson"</span>,</span>
<span>   color <span class='op'>=</span> <span class='va'>iso_text_color</span></span>
<span> <span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span> <span class='co'># 60' point and text</span></span>
<span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>   <span class='st'>"point"</span>,</span>
<span>   x <span class='op'>=</span> <span class='va'>x_60</span>,</span>
<span>   y <span class='op'>=</span> <span class='va'>y_60</span>,</span>
<span>   size <span class='op'>=</span> <span class='va'>iso_point_size</span>,</span>
<span>   shape <span class='op'>=</span> <span class='fl'>21</span>,</span>
<span>   fill <span class='op'>=</span> <span class='va'>iso_point_fill</span>,</span>
<span>   <span class='co'>#alpha = iso_point_alpha,</span></span>
<span>   stroke <span class='op'>=</span> <span class='va'>iso_point_stroke_width</span>,</span>
<span>   color <span class='op'>=</span> <span class='va'>iso_point_stroke_color</span></span>
<span> <span class='op'>)</span> <span class='op'>+</span></span>
<span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>   <span class='st'>"text"</span>,</span>
<span>   label <span class='op'>=</span> <span class='st'>"60"</span>,</span>
<span>   x <span class='op'>=</span> <span class='va'>x_60</span>,</span>
<span>   y <span class='op'>=</span> <span class='va'>y_60</span>,</span>
<span>   size <span class='op'>=</span> <span class='va'>iso_text_size</span>,</span>
<span>   family <span class='op'>=</span> <span class='st'>"atkinson"</span>,</span>
<span>   color <span class='op'>=</span> <span class='va'>iso_text_color</span></span>
<span> <span class='op'>)</span></span>
<span>  </span>
<span><span class='va'>alternative</span> <span class='co'># To see it</span></span></code></pre>
</div>
<p><img src="100569505_files/figure-html5/plot_isochrones_legend-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<h4 id="example-point">Example point</h4>
<p>As mentioned earlier, we will include a point with an example of how to read the map (street color and isochrone). We made use of the large empty space between the streets northwest of Calgary Tower to integrate this annotation organically.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>alternative</span> <span class='op'>&lt;-</span> <span class='va'>alternative</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># Text:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>    <span class='st'>"richtext"</span>,</span>
<span>    label <span class='op'>=</span> <span class='st'>"Bike is faster and&lt;br&gt;travel takes under 40'"</span>,</span>
<span>    x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>114.109</span>,</span>
<span>    y <span class='op'>=</span> <span class='fl'>51.104</span>,</span>
<span>    size <span class='op'>=</span> <span class='va'>iso_text_size</span>,</span>
<span>    vjust <span class='op'>=</span> <span class='fl'>0</span>,</span>
<span>    color <span class='op'>=</span> <span class='st'>"white"</span>,</span>
<span>    family <span class='op'>=</span> <span class='st'>"atkinson"</span>,</span>
<span>    fill <span class='op'>=</span> <span class='cn'>NA</span>,</span>
<span>    label.color <span class='op'>=</span> <span class='cn'>NA</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># Arrow:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>    <span class='st'>"curve"</span>,</span>
<span>    x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>114.107</span>,</span>
<span>    y <span class='op'>=</span> <span class='fl'>51.106</span>,</span>
<span>    xend <span class='op'>=</span> <span class='op'>-</span><span class='fl'>114.085</span>,</span>
<span>    yend <span class='op'>=</span> <span class='fl'>51.0935</span>,</span>
<span>    curvature <span class='op'>=</span> <span class='fl'>0.5</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='fl'>0.7</span> <span class='op'>*</span> <span class='va'>sr</span>,</span>
<span>    color <span class='op'>=</span> <span class='st'>"white"</span>,</span>
<span>    arrow <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/arrow.html'>arrow</a></span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>30</span>,</span>
<span>                  length <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='op'>(</span><span class='fl'>0.1</span> <span class='op'>*</span> <span class='va'>sr</span><span class='op'>)</span>, <span class='st'>"in"</span><span class='op'>)</span>,</span>
<span>                  ends <span class='op'>=</span> <span class='st'>"first"</span>,</span>
<span>                  type <span class='op'>=</span> <span class='st'>"closed"</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># Map dot:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span> </span>
<span>    <span class='st'>"point"</span>,</span>
<span>    x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>114.085</span>,</span>
<span>    y <span class='op'>=</span> <span class='fl'>51.0935</span>,</span>
<span>    shape <span class='op'>=</span> <span class='fl'>21</span>,</span>
<span>    size <span class='op'>=</span> <span class='fl'>5</span> <span class='op'>*</span> <span class='va'>sr</span>,</span>
<span>    stroke <span class='op'>=</span> <span class='fl'>2</span> <span class='op'>*</span> <span class='va'>sr</span>,</span>
<span>    fill <span class='op'>=</span> <span class='st'>"#f8ad58"</span>,  </span>
<span>    color <span class='op'>=</span> <span class='st'>"white"</span> </span>
<span>  <span class='op'>)</span> </span>
<span></span>
<span><span class='va'>alternative</span></span></code></pre>
</div>
<p><img src="100569505_files/figure-html5/plot_example_point-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<h4 id="isochrone-islands-explanation">Isochrone islands explanation</h4>
<p>We also added an annotation to explain a phenomenon visible in the map, which may confuse some users: islands of faster travel time disconnected from the main isochrones. These are caused by the presence of transit stations.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>alternative</span> <span class='op'>&lt;-</span> <span class='va'>alternative</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># Text:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>    <span class='st'>"richtext"</span>,</span>
<span>    label <span class='op'>=</span> <span class='st'>"The presence of transit stations can&lt;br&gt;</span></span>
<span><span class='st'>            create islands of faster travel time"</span>,</span>
<span>    x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>114.085</span>,</span>
<span>    y <span class='op'>=</span> <span class='fl'>50.868</span>,</span>
<span>    size <span class='op'>=</span> <span class='fl'>7</span> <span class='op'>*</span> <span class='va'>sr</span>,</span>
<span>    vjust <span class='op'>=</span> <span class='fl'>0.5</span>,</span>
<span>    hjust <span class='op'>=</span> <span class='fl'>1</span>,</span>
<span>    color <span class='op'>=</span> <span class='st'>"white"</span>,</span>
<span>    family <span class='op'>=</span> <span class='st'>"atkinson"</span>,</span>
<span>    fill <span class='op'>=</span> <span class='cn'>NA</span>,</span>
<span>    label.color <span class='op'>=</span> <span class='cn'>NA</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># Arrow:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>    <span class='st'>"curve"</span>,</span>
<span>    x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>114.085</span>,</span>
<span>    y <span class='op'>=</span> <span class='fl'>50.8688</span>,</span>
<span>    xend <span class='op'>=</span> <span class='op'>-</span><span class='fl'>114.074</span>,</span>
<span>    yend <span class='op'>=</span> <span class='fl'>50.877</span>,</span>
<span>    curvature <span class='op'>=</span> <span class='fl'>0.3</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='fl'>0.7</span> <span class='op'>*</span> <span class='va'>sr</span>,</span>
<span>    color <span class='op'>=</span> <span class='st'>"white"</span>,</span>
<span>    arrow <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/arrow.html'>arrow</a></span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>30</span>,</span>
<span>                  length <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='op'>(</span><span class='fl'>0.1</span> <span class='op'>*</span> <span class='va'>sr</span><span class='op'>)</span>, <span class='st'>"in"</span><span class='op'>)</span>,</span>
<span>                  ends <span class='op'>=</span> <span class='st'>"first"</span>,</span>
<span>                  type <span class='op'>=</span> <span class='st'>"closed"</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> </span>
<span></span>
<span><span class='va'>alternative</span> <span class='co'># To see it</span></span></code></pre>
</div>
<p><img src="100569505_files/figure-html5/plot_isochrone_island_explanation-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<h4 id="north-arrow-1">North arrow</h4>
<p>We felt the North arrow had a too prominent role in the original map. Most local users can orient themselves via the river or major roads, and cardinal directions are rarely the primary mental model for navigating a city by bike or transit.</p>
<p>To give it a more appropriate secondary role, we reduced its size, moved it to the bottom right (following the natural top-left to bottom-right reading flow), and changed the color scheme to a subtle white-on-black to match the dark theme.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Settings:</span></span>
<span><span class='co'># =========</span></span>
<span><span class='co'># Arrow:</span></span>
<span><span class='va'>arrow_color</span> <span class='op'>&lt;-</span> <span class='st'>"white"</span></span>
<span><span class='co'># Arrow triangle </span></span>
<span><span class='va'>triangle_mid_x</span> <span class='op'>&lt;-</span> <span class='op'>-</span><span class='fl'>113.8825</span> </span>
<span><span class='va'>triangle_half_width</span> <span class='op'>&lt;-</span> <span class='fl'>0.003325</span></span>
<span><span class='va'>triangle_bottom_y</span> <span class='op'>&lt;-</span> <span class='fl'>50.8600</span> <span class='co'>#Master</span></span>
<span><span class='va'>triangle_height</span> <span class='op'>&lt;-</span> <span class='fl'>0.0021</span></span>
<span><span class='co'># Arrow rectangle:</span></span>
<span><span class='va'>arrow_rectangle_width</span> <span class='op'>&lt;-</span> <span class='fl'>0.455</span> <span class='co'># Relative to triangle width</span></span>
<span><span class='va'>arrow_rectangle_height</span> <span class='op'>&lt;-</span> <span class='fl'>1.495</span> <span class='co'># Relative to triangle height</span></span>
<span><span class='va'>arrow_rectangle_radius</span> <span class='op'>&lt;-</span> <span class='fl'>0.24</span> </span>
<span></span>
<span><span class='co'># North text:</span></span>
<span><span class='va'>north_space</span> <span class='op'>&lt;-</span> <span class='fl'>0.75</span> <span class='co'># Relative to triangle height</span></span>
<span><span class='va'>north_size</span> <span class='op'>&lt;-</span> <span class='fl'>6</span> <span class='op'>*</span> <span class='va'>sr</span></span>
<span><span class='va'>north_color</span> <span class='op'>&lt;-</span> <span class='st'>"white"</span></span>
<span></span>
<span><span class='co'># Outer box:</span></span>
<span><span class='va'>box_width</span> <span class='op'>&lt;-</span> <span class='fl'>2.40</span> <span class='co'># Relative to triangle width</span></span>
<span><span class='va'>box_height</span> <span class='op'>&lt;-</span> <span class='fl'>2.75</span> <span class='co'># Relative to triangle height</span></span>
<span><span class='va'>box_radius</span> <span class='op'>&lt;-</span> <span class='fl'>0.20</span></span>
<span><span class='va'>box_y_position</span> <span class='op'>&lt;-</span> <span class='fl'>0.255</span> <span class='co'># Relative to triangle tip (measured in triangle height)</span></span>
<span><span class='va'>box_color</span> <span class='op'>&lt;-</span> <span class='st'>"white"</span></span>
<span></span>
<span><span class='co'># Border thickness (i will use this to change size of inner box):</span></span>
<span><span class='va'>border_thickness</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='fl'>0.3</span> <span class='op'>*</span> <span class='va'>sr</span><span class='op'>)</span> <span class='co'># Range 0-1 (no border, full black box).</span></span>
<span><span class='va'>inner_box_color</span> <span class='op'>&lt;-</span> <span class='st'>"black"</span></span>
<span></span>
<span></span>
<span></span>
<span><span class='co'># Calculations:</span></span>
<span><span class='co'># =============</span></span>
<span></span>
<span><span class='co'># Tibble for arrow triangle (head):</span></span>
<span><span class='va'>triangle_polygon</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>    <span class='va'>triangle_mid_x</span>, <span class='co'># Tip x</span></span>
<span>    <span class='va'>triangle_mid_x</span> <span class='op'>-</span> <span class='va'>triangle_half_width</span>, <span class='co'># Left corner x</span></span>
<span>    <span class='va'>triangle_mid_x</span> <span class='op'>+</span> <span class='va'>triangle_half_width</span> <span class='co'># Right corner x</span></span>
<span>  <span class='op'>)</span>,</span>
<span>  y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>    <span class='va'>triangle_bottom_y</span> <span class='op'>+</span> <span class='va'>triangle_height</span>, <span class='co'># Tip y </span></span>
<span>    <span class='va'>triangle_bottom_y</span>, <span class='co'># Left corner y</span></span>
<span>    <span class='va'>triangle_bottom_y</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># Right corner y</span></span>
<span>  </span>
<span><span class='co'># Tibble for arrow rectangle (shaft):</span></span>
<span><span class='va'>arrow_rectangle</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  xmin <span class='op'>=</span> <span class='va'>triangle_mid_x</span> <span class='op'>-</span> <span class='op'>(</span><span class='va'>triangle_half_width</span><span class='op'>*</span><span class='va'>arrow_rectangle_width</span><span class='op'>)</span>, <span class='co'># Left</span></span>
<span>  xmax <span class='op'>=</span> <span class='va'>triangle_mid_x</span> <span class='op'>+</span> <span class='op'>(</span><span class='va'>triangle_half_width</span><span class='op'>*</span><span class='va'>arrow_rectangle_width</span><span class='op'>)</span>, <span class='co'># Right</span></span>
<span>  ymin <span class='op'>=</span> <span class='va'>triangle_bottom_y</span> <span class='op'>-</span> <span class='op'>(</span><span class='va'>triangle_height</span><span class='op'>*</span><span class='va'>arrow_rectangle_height</span><span class='op'>)</span>, <span class='co'># Bottom</span></span>
<span>  ymax <span class='op'>=</span> <span class='va'>triangle_bottom_y</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>0.25</span><span class='op'>*</span><span class='va'>triangle_height</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># Top.   </span></span>
<span>                                                     <span class='co'># We add 0.25 of the</span></span>
<span>                                                     <span class='co'># triangle height to</span></span>
<span>                                                     <span class='co'># hide rounded edge on</span></span>
<span>                                                     <span class='co'># the rectangle top.</span></span>
<span>  </span>
<span><span class='co'># Tibble for "north":</span></span>
<span><span class='va'>north</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  label <span class='op'>=</span> <span class='st'>"North"</span>,</span>
<span>  x <span class='op'>=</span> <span class='va'>triangle_mid_x</span>,</span>
<span>  y <span class='op'>=</span> <span class='va'>triangle_bottom_y</span> <span class='op'>+</span> <span class='va'>triangle_height</span> <span class='op'>+</span> <span class='va'>north_space</span><span class='op'>*</span><span class='va'>triangle_height</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Tibble for outer box:</span></span>
<span><span class='va'>arrow_box</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"xmin"</span> <span class='op'>=</span> <span class='va'>triangle_mid_x</span> <span class='op'>-</span> <span class='op'>(</span><span class='va'>triangle_half_width</span><span class='op'>*</span><span class='va'>box_width</span><span class='op'>)</span>, <span class='co'># Left</span></span>
<span>  <span class='st'>"xmax"</span> <span class='op'>=</span> <span class='va'>triangle_mid_x</span> <span class='op'>+</span> <span class='op'>(</span><span class='va'>triangle_half_width</span><span class='op'>*</span><span class='va'>box_width</span><span class='op'>)</span>, <span class='co'># Right</span></span>
<span>  <span class='st'>"ymin"</span> <span class='op'>=</span> <span class='va'>triangle_bottom_y</span> <span class='op'>-</span> <span class='op'>(</span><span class='va'>triangle_height</span><span class='op'>*</span><span class='va'>box_height</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='op'>(</span><span class='va'>triangle_height</span><span class='op'>*</span><span class='va'>box_y_position</span><span class='op'>)</span>, <span class='co'># Bottom</span></span>
<span>  <span class='st'>"ymax"</span> <span class='op'>=</span> <span class='va'>triangle_bottom_y</span> <span class='op'>+</span> <span class='op'>(</span><span class='va'>triangle_height</span><span class='op'>*</span><span class='va'>box_height</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='op'>(</span><span class='va'>triangle_height</span><span class='op'>*</span><span class='va'>box_y_position</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># Top</span></span>
<span></span>
<span><span class='co'># Tibble for inner box:</span></span>
<span><span class='co'># We  first create an auxiliary object which we will add/substract to outer box:</span></span>
<span><span class='va'>box_vertical_border</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='op'>(</span><span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>xmax</span> <span class='op'>-</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>xmin</span><span class='op'>)</span><span class='op'>*</span><span class='va'>border_thickness</span><span class='op'>)</span><span class='op'>/</span><span class='fl'>2</span> </span>
<span><span class='va'>box_horizontal_border</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='op'>(</span><span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>ymax</span> <span class='op'>-</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>ymin</span><span class='op'>)</span><span class='op'>*</span><span class='va'>border_thickness</span><span class='op'>)</span><span class='op'>/</span><span class='fl'>2</span></span>
<span><span class='co'># And then the tibble:</span></span>
<span><span class='va'>inner_box</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"xmin"</span> <span class='op'>=</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>xmin</span> <span class='op'>+</span> <span class='va'>box_vertical_border</span>,</span>
<span>  <span class='st'>"xmax"</span> <span class='op'>=</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>xmax</span> <span class='op'>-</span> <span class='va'>box_vertical_border</span>,</span>
<span>  <span class='st'>"ymin"</span> <span class='op'>=</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>ymin</span> <span class='op'>+</span> <span class='va'>box_horizontal_border</span>,</span>
<span>  <span class='st'>"ymax"</span> <span class='op'>=</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>ymax</span> <span class='op'>-</span> <span class='va'>box_horizontal_border</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class='co'># Plotting north arrow:</span></span>
<span><span class='co'># =====================</span></span>
<span><span class='va'>alternative</span> <span class='op'>&lt;-</span> <span class='va'>alternative</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># Outer box (for border effect):</span></span>
<span>  <span class='fu'><a href='https://funkyheatmap.github.io/funkyheatmap/reference/geom_rounded_rect.html'>geom_rounded_rect</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>arrow_box</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>xmin <span class='op'>=</span> <span class='va'>xmin</span>, xmax <span class='op'>=</span> <span class='va'>xmax</span>,</span>
<span>        ymin <span class='op'>=</span> <span class='va'>ymin</span>, ymax <span class='op'>=</span> <span class='va'>ymax</span><span class='op'>)</span>,</span>
<span>    radius <span class='op'>=</span> <span class='va'>box_radius</span>,</span>
<span>    fill <span class='op'>=</span> <span class='va'>box_color</span>,</span>
<span>    color <span class='op'>=</span> <span class='cn'>NA</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># Inner box (for border effect):</span></span>
<span>  <span class='fu'><a href='https://funkyheatmap.github.io/funkyheatmap/reference/geom_rounded_rect.html'>geom_rounded_rect</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>inner_box</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>xmin <span class='op'>=</span> <span class='va'>xmin</span>, xmax <span class='op'>=</span> <span class='va'>xmax</span>,</span>
<span>        ymin <span class='op'>=</span> <span class='va'>ymin</span>, ymax <span class='op'>=</span> <span class='va'>ymax</span><span class='op'>)</span>,</span>
<span>    radius <span class='op'>=</span> <span class='va'>box_radius</span>,</span>
<span>    fill <span class='op'>=</span> <span class='va'>inner_box_color</span>,</span>
<span>    color <span class='op'>=</span> <span class='cn'>NA</span></span>
<span>    <span class='op'>)</span><span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># Arrow triangle:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_polygon.html'>geom_polygon</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>triangle_polygon</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span>,</span>
<span>    fill <span class='op'>=</span> <span class='va'>arrow_color</span>,</span>
<span>    color <span class='op'>=</span> <span class='cn'>NA</span> </span>
<span>    <span class='op'>)</span> <span class='op'>+</span> </span>
<span>  </span>
<span>  <span class='co'># Arrow body:</span></span>
<span>  <span class='fu'><a href='https://funkyheatmap.github.io/funkyheatmap/reference/geom_rounded_rect.html'>geom_rounded_rect</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>arrow_rectangle</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>xmin <span class='op'>=</span> <span class='va'>xmin</span>, xmax <span class='op'>=</span> <span class='va'>xmax</span>,</span>
<span>        ymin <span class='op'>=</span> <span class='va'>ymin</span>, ymax <span class='op'>=</span> <span class='va'>ymax</span><span class='op'>)</span>,</span>
<span>    radius <span class='op'>=</span> <span class='va'>arrow_rectangle_radius</span>,</span>
<span>    fill <span class='op'>=</span> <span class='va'>arrow_color</span>,</span>
<span>    color<span class='op'>=</span> <span class='cn'>NA</span> <span class='co'># No border</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span> </span>
<span>  </span>
<span>  <span class='co'># "North" text:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>north</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span>, label <span class='op'>=</span> <span class='va'>label</span><span class='op'>)</span>,</span>
<span>    size <span class='op'>=</span> <span class='va'>north_size</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>north_color</span>, </span>
<span>    family <span class='op'>=</span> <span class='st'>"atkinson"</span>,</span>
<span>    fontface <span class='op'>=</span> <span class='st'>"bold"</span></span>
<span>    <span class='op'>)</span></span>
<span></span>
<span><span class='va'>alternative</span> <span class='co'># To see it</span></span></code></pre>
</div>
<p><img src="100569505_files/figure-html5/plot_north_arrow_alternative-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<h4 id="scale-1">Scale</h4>
<p>Finally, we add the scale. Since the North arrow is now smaller, the scale must also be reduced to maintain visual balance. We adjusted the represented distance to 2km (from 3km) to fit these new dimensions.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Settings:</span></span>
<span><span class='co'># =========</span></span>
<span><span class='co'># Horizontal line:</span></span>
<span><span class='va'>scale_length</span> <span class='op'>&lt;-</span> <span class='fl'>2000</span> <span class='co'># In meters</span></span>
<span><span class='va'>scale_space</span> <span class='op'>&lt;-</span> <span class='fl'>0.25</span> <span class='co'># Space between line and box, proportion of box width</span></span>
<span><span class='va'>scale_color</span> <span class='op'>&lt;-</span> <span class='st'>"white"</span></span>
<span><span class='va'>scale_thickness</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='fl'>1.3</span> <span class='op'>*</span> <span class='va'>sr</span><span class='op'>)</span> <span class='co'># For geom_segment(linedwidth = )</span></span>
<span>  </span>
<span><span class='co'># Ticks:</span></span>
<span><span class='va'>tick_length</span> <span class='op'>&lt;-</span> <span class='fl'>0.15</span> <span class='co'># Proportion of the box height</span></span>
<span><span class='va'>tick_color</span> <span class='op'>&lt;-</span> <span class='st'>"white"</span></span>
<span><span class='va'>tick_thickness</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='fl'>1.3</span> <span class='op'>*</span> <span class='va'>sr</span><span class='op'>)</span> <span class='co'># For geom_segment(linewidth = )</span></span>
<span></span>
<span><span class='co'># Kilometers:</span></span>
<span><span class='va'>km_space</span> <span class='op'>&lt;-</span> <span class='fl'>0.6</span> <span class='co'># Space between km and scale, proportion of box height</span></span>
<span><span class='va'>km_size</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='fl'>7</span> <span class='op'>*</span> <span class='va'>sr</span><span class='op'>)</span> <span class='co'># For geom_text(size =)</span></span>
<span><span class='va'>km_color</span> <span class='op'>&lt;-</span> <span class='st'>"white"</span></span>
<span><span class='va'>km_font</span> <span class='op'>&lt;-</span> <span class='st'>"atkinson"</span></span>
<span></span>
<span></span>
<span></span>
<span><span class='co'># Calculations:</span></span>
<span><span class='co'># =============</span></span>
<span></span>
<span><span class='co'># Auxiliary objects:</span></span>
<span><span class='va'>box_actual_width</span> <span class='op'>&lt;-</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>xmax</span> <span class='op'>-</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>xmin</span> <span class='co'>#</span></span>
<span><span class='va'>box_actual_height</span> <span class='op'>&lt;-</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>ymax</span> <span class='op'>-</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>ymin</span></span>
<span><span class='va'>box_mid_x</span> <span class='op'>&lt;-</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>xmin</span> <span class='op'>+</span> <span class='op'>(</span><span class='va'>box_actual_width</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Scale left end:</span></span>
<span><span class='va'>scale_left</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/as_tibble.html'>as_tibble</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/geosphere/man/destPoint.html'>destPoint</a></span><span class='op'>(</span></span>
<span>  p <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>box_mid_x</span>,  <span class='co'># Starting x </span></span>
<span>        <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>ymin</span> <span class='op'>-</span> <span class='va'>box_actual_height</span><span class='op'>*</span><span class='va'>scale_space</span><span class='op'>)</span>, <span class='co'># Starting y </span></span>
<span>  b <span class='op'>=</span> <span class='fl'>90</span>, <span class='co'># b = bearing in degrees</span></span>
<span>  d <span class='op'>=</span> <span class='op'>-</span><span class='va'>scale_length</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># d = distance in meters </span></span>
<span></span>
<span><span class='co'># Scale right end:</span></span>
<span><span class='va'>scale_right</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/as_tibble.html'>as_tibble</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/geosphere/man/destPoint.html'>destPoint</a></span><span class='op'>(</span></span>
<span>  p <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>box_mid_x</span>,  <span class='co'># Starting x </span></span>
<span>        <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>ymin</span> <span class='op'>-</span> <span class='va'>box_actual_height</span><span class='op'>*</span><span class='va'>scale_space</span><span class='op'>)</span>, <span class='co'># Starting y </span></span>
<span>  b <span class='op'>=</span> <span class='fl'>90</span>, <span class='co'># b = bearing in degrees</span></span>
<span>  d <span class='op'>=</span> <span class='va'>scale_length</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># d = distance in meters </span></span>
<span></span>
<span><span class='co'># Scale horizontal line:</span></span>
<span><span class='va'>scale_horizontal</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"x"</span> <span class='op'>=</span> <span class='va'>scale_left</span><span class='op'>$</span><span class='va'>lon</span>, <span class='st'>"xend"</span> <span class='op'>=</span> <span class='va'>scale_right</span><span class='op'>$</span><span class='va'>lon</span>,</span>
<span>  <span class='st'>"y"</span> <span class='op'>=</span> <span class='va'>scale_left</span><span class='op'>$</span><span class='va'>lat</span>, <span class='st'>"yend"</span> <span class='op'>=</span> <span class='va'>scale_left</span><span class='op'>$</span><span class='va'>lat</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Tibble for ticks:</span></span>
<span><span class='va'>tick</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"x"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>scale_left</span><span class='op'>$</span><span class='va'>lon</span>, <span class='va'>box_mid_x</span>, <span class='va'>scale_right</span><span class='op'>$</span><span class='va'>lon</span><span class='op'>)</span>,</span>
<span>  <span class='st'>"xend"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>scale_left</span><span class='op'>$</span><span class='va'>lon</span>, <span class='va'>box_mid_x</span>, <span class='va'>scale_right</span><span class='op'>$</span><span class='va'>lon</span><span class='op'>)</span>,</span>
<span>  <span class='st'>"y"</span> <span class='op'>=</span> <span class='va'>scale_left</span><span class='op'>$</span><span class='va'>lat</span> <span class='op'>-</span> <span class='op'>(</span><span class='op'>(</span><span class='va'>box_actual_height</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>*</span><span class='va'>tick_length</span><span class='op'>)</span>, </span>
<span>  <span class='st'>"yend"</span> <span class='op'>=</span> <span class='va'>scale_left</span><span class='op'>$</span><span class='va'>lat</span> <span class='op'>+</span> <span class='op'>(</span><span class='op'>(</span><span class='va'>box_actual_height</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>*</span><span class='va'>tick_length</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Tibble for kms:</span></span>
<span><span class='va'>km</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"label"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"0"</span>, <span class='st'>"1"</span>, <span class='st'>"2"</span>, <span class='st'>"  km"</span><span class='op'>)</span>,</span>
<span>  <span class='st'>"x"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>scale_left</span><span class='op'>$</span><span class='va'>lon</span>, <span class='va'>box_mid_x</span>, <span class='va'>scale_right</span><span class='op'>$</span><span class='va'>lon</span>, <span class='va'>scale_right</span><span class='op'>$</span><span class='va'>lon</span><span class='op'>)</span>,</span>
<span>  <span class='st'>"y"</span> <span class='op'>=</span> <span class='va'>scale_left</span><span class='op'>$</span><span class='va'>lat</span> <span class='op'>-</span> <span class='op'>(</span><span class='op'>(</span><span class='va'>box_actual_height</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>*</span><span class='va'>km_space</span><span class='op'>)</span>,</span>
<span>  <span class='st'>"hjust"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.5</span>, <span class='fl'>0.5</span>, <span class='fl'>0.5</span>, <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># All justified center, "kilometers" left</span></span>
<span></span>
<span></span>
<span></span>
<span><span class='co'># Plotting scale:</span></span>
<span><span class='co'># ===============</span></span>
<span></span>
<span><span class='va'>alternative</span> <span class='op'>&lt;-</span> <span class='va'>alternative</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># Horizontal line</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_segment.html'>geom_segment</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>scale_horizontal</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, xend <span class='op'>=</span> <span class='va'>xend</span>, </span>
<span>        y <span class='op'>=</span> <span class='va'>y</span>, yend <span class='op'>=</span> <span class='va'>yend</span><span class='op'>)</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='va'>scale_thickness</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>scale_color</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># Ticks:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_segment.html'>geom_segment</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>tick</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, xend <span class='op'>=</span> <span class='va'>xend</span>, </span>
<span>        y <span class='op'>=</span> <span class='va'>y</span>, yend <span class='op'>=</span> <span class='va'>yend</span><span class='op'>)</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='va'>tick_thickness</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>tick_color</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># Kilometers:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>km</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span>, hjust <span class='op'>=</span> <span class='va'>hjust</span>, label <span class='op'>=</span> <span class='va'>label</span><span class='op'>)</span>,</span>
<span>    size <span class='op'>=</span> <span class='va'>km_size</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>km_color</span>, </span>
<span>    family <span class='op'>=</span> <span class='va'>km_font</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>alternative</span> <span class='co'># To see it</span></span></code></pre>
</div>
<p><img src="100569505_files/figure-html5/plot_alternative_final-1.png" width="100%" data-distill-preview=1 style="display: block; margin: auto;" /></p>
</div>
<p>This is our final alternative visualization. It combines the best parts of the original map the use of the road network to represent time differences, a strong color scheme, and water bodies as visual hints with absolute travel times via isochrones, giving users a complete picture of their commute. We also redesigned the legend to be more intuitive and faster to read, cleaned up the noise in the bike data, and added helpful annotations. Now, any user can quickly answer the question: Whats the fastest way to get to Calgary Tower?</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="reuse">Reuse</h3>
  <p>Text and figures are licensed under Creative Commons Attribution <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>. The figures that have been reused from other sources don't fall under this license and can be recognized by a note in their caption: "Figure from ...".</p>
  <h3 id="citation">Citation</h3>
  <p>For attribution, please cite this work as</p>
  <pre class="citation-appendix short">Agenjo (2026, Jan. 8). Data Visualization | MSc CSS: Calgary. Retrieved from https://csslab.uc3m.es/dataviz/projects/2025/100569505/</pre>
  <p>BibTeX citation</p>
  <pre class="citation-appendix long">@misc{agenjo2026calgary,
  author = {Agenjo, Miguel},
  title = {Data Visualization | MSc CSS: Calgary},
  url = {https://csslab.uc3m.es/dataviz/projects/2025/100569505/},
  year = {2026}
}</pre>
</div>
<!--/radix_placeholder_appendices-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<!--radix_placeholder_navigation_after_body--><html><body>
<div class="distill-site-nav distill-site-footer">
<p><img src="../../../assets/acronimo_nombre1l_0.png" width="400"></p>
</div>
<!--/radix_placeholder_navigation_after_body-->
</body></html>


</body>

</html>
