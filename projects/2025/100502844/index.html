<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>


  <!--radix_placeholder_meta_tags-->
<title>Data Visualization | MSc CSS: Small Stats Can Be Big Players in Development and Good Governance</title>

<meta property="description" itemprop="description" content="This report reconstructs the “Small States Can Be Big Players in Development and Good Governance” figure using R, combining World Bank, UNDP, and V-Dem data in a fully reproducible workflow."/>

<link rel="canonical" href="https://csslab.uc3m.es/dataviz/projects/2025/100502844/"/>
<link rel="license" href="https://creativecommons.org/licenses/by/4.0/"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2026-01-06"/>
<meta property="article:created" itemprop="dateCreated" content="2026-01-06"/>
<meta name="article:author" content="Abdullah Tadmuri"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="Data Visualization | MSc CSS: Small Stats Can Be Big Players in Development and Good Governance"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="This report reconstructs the “Small States Can Be Big Players in Development and Good Governance” figure using R, combining World Bank, UNDP, and V-Dem data in a fully reproducible workflow."/>
<meta property="og:url" content="https://csslab.uc3m.es/dataviz/projects/2025/100502844/"/>
<meta property="og:image" content="https://csslab.uc3m.es/dataviz/projects/2025/100502844/100502844_files/figure-html5/panel-a-scatter-1.png"/>
<meta property="og:image:width" content="7680"/>
<meta property="og:image:height" content="4416"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="Data Visualization | MSc CSS"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary_large_image"/>
<meta property="twitter:title" content="Data Visualization | MSc CSS: Small Stats Can Be Big Players in Development and Good Governance"/>
<meta property="twitter:description" content="This report reconstructs the “Small States Can Be Big Players in Development and Good Governance” figure using R, combining World Bank, UNDP, and V-Dem data in a fully reproducible workflow."/>
<meta property="twitter:url" content="https://csslab.uc3m.es/dataviz/projects/2025/100502844/"/>
<meta property="twitter:image" content="https://csslab.uc3m.es/dataviz/projects/2025/100502844/100502844_files/figure-html5/panel-a-scatter-1.png"/>
<meta property="twitter:image:width" content="7680"/>
<meta property="twitter:image:height" content="4416"/>

<!--  https://scholar.google.com/intl/en/scholar/inclusion.html#indexing -->
<meta name="citation_title" content="Data Visualization | MSc CSS: Small Stats Can Be Big Players in Development and Good Governance"/>
<meta name="citation_fulltext_html_url" content="https://csslab.uc3m.es/dataviz/projects/2025/100502844/"/>
<meta name="citation_fulltext_world_readable" content=""/>
<meta name="citation_online_date" content="2026/01/06"/>
<meta name="citation_publication_date" content="2026/01/06"/>
<meta name="citation_author" content="Abdullah Tadmuri"/>
<!--/radix_placeholder_meta_tags-->
  
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["creative_commons","title","description","author","date","categories","bibliography","output","citation_url","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["CC BY"]},{"type":"character","attributes":{},"value":["Small Stats Can Be Big Players in Development and Good Governance"]},{"type":"character","attributes":{},"value":["This report reconstructs the “Small States Can Be Big Players in Development and Good Governance” figure using R, combining World Bank, UNDP, and V-Dem data in a fully reproducible workflow."]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["Abdullah Tadmuri"]}]}]},{"type":"character","attributes":{},"value":["2026-01-06"]},{"type":"character","attributes":{},"value":["2025"]},{"type":"character","attributes":{},"value":["references.bib"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]}]}]},{"type":"character","attributes":{},"value":["https://csslab.uc3m.es/dataviz/projects/2025/100502844/"]},{"type":"character","attributes":{},"value":["https://csslab.uc3m.es/dataviz/projects/2025/100502844/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["100502844_files/anchor-4.2.2/anchor.min.js","100502844_files/bowser-1.9.3/bowser.min.js","100502844_files/distill-2.2.21/template.v2.js","100502844_files/figure-html5/assamble-figure-1.png","100502844_files/figure-html5/assemble-layout-1.png","100502844_files/figure-html5/bottem-text-panel-1.png","100502844_files/figure-html5/bottom-text-panel-1.png","100502844_files/figure-html5/main-scatter-plot-1.png","100502844_files/figure-html5/panel-a-scatter-1.png","100502844_files/figure-html5/panel-b-democracy-1.png","100502844_files/figure-html5/panel-c-co2-1.png","100502844_files/figure-html5/panel-d-hdi-1.png","100502844_files/figure-html5/panel-e-co2-absolute-1.png","100502844_files/figure-html5/panel-e-hdi-per-co2-1.png","100502844_files/figure-html5/ridge-plot-1.png","100502844_files/figure-html5/ridge-plot-2.png","100502844_files/figure-html5/ridge-plot-3.png","100502844_files/figure-html5/ridge-plot-4.png","100502844_files/figure-html5/ridge-plot-5.png","100502844_files/figure-html5/world-map-1.png","100502844_files/figure-html5/world-map-panel-1.png","100502844_files/header-attrs-2.30/header-attrs.js","100502844_files/jquery-3.6.0/jquery-3.6.0.js","100502844_files/jquery-3.6.0/jquery-3.6.0.min.js","100502844_files/jquery-3.6.0/jquery-3.6.0.min.map","100502844_files/popper-2.6.0/popper.min.js","100502844_files/tippy-6.2.7/tippy-bundle.umd.min.js","100502844_files/tippy-6.2.7/tippy-light-border.css","100502844_files/tippy-6.2.7/tippy.css","100502844_files/tippy-6.2.7/tippy.umd.min.js","100502844_files/webcomponents-2.0.0/webcomponents.js","data/cache/all_panels.rds","data/cache/hdr_countries.rds","data/cache/model_results.rds","data/cache/owid_co2.rds","data/cache/wdi_governance.rds","data/cache/wdi_population.rds","images/clipboard-2056465238.png","references.bib"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../../site_libs/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"/>
<link href="../../../site_libs/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"/>
<script src="../../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<script src="../../../site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
<script src="../../../site_libs/fuse-6.4.1/fuse.min.js"></script>

<script type="application/javascript">

function getMeta(metaName) {
  var metas = document.getElementsByTagName('meta');
  for (let i = 0; i < metas.length; i++) {
    if (metas[i].getAttribute('name') === metaName) {
      return metas[i].getAttribute('content');
    }
  }
  return '';
}

function offsetURL(url) {
  var offset = getMeta('distill:offset');
  return offset ? offset + '/' + url : url;
}

function createFuseIndex() {

  // create fuse index
  var options = {
    keys: [
      { name: 'title', weight: 20 },
      { name: 'categories', weight: 15 },
      { name: 'description', weight: 10 },
      { name: 'contents', weight: 5 },
    ],
    ignoreLocation: true,
    threshold: 0
  };
  var fuse = new window.Fuse([], options);

  // fetch the main search.json
  return fetch(offsetURL('search.json'))
    .then(function(response) {
      if (response.status == 200) {
        return response.json().then(function(json) {
          // index main articles
          json.articles.forEach(function(article) {
            fuse.add(article);
          });
          // download collections and index their articles
          return Promise.all(json.collections.map(function(collection) {
            return fetch(offsetURL(collection)).then(function(response) {
              if (response.status === 200) {
                return response.json().then(function(articles) {
                  articles.forEach(function(article) {
                    fuse.add(article);
                  });
                })
              } else {
                return Promise.reject(
                  new Error('Unexpected status from search index request: ' +
                            response.status)
                );
              }
            });
          })).then(function() {
            return fuse;
          });
        });

      } else {
        return Promise.reject(
          new Error('Unexpected status from search index request: ' +
                      response.status)
        );
      }
    });
}

window.document.addEventListener("DOMContentLoaded", function (event) {

  // get search element (bail if we don't have one)
  var searchEl = window.document.getElementById('distill-search');
  if (!searchEl)
    return;

  createFuseIndex()
    .then(function(fuse) {

      // make search box visible
      searchEl.classList.remove('hidden');

      // initialize autocomplete
      var options = {
        autoselect: true,
        hint: false,
        minLength: 2,
      };
      window.autocomplete(searchEl, options, [{
        source: function(query, callback) {
          const searchOptions = {
            isCaseSensitive: false,
            shouldSort: true,
            minMatchCharLength: 2,
            limit: 10,
          };
          var results = fuse.search(query, searchOptions);
          callback(results
            .map(function(result) { return result.item; })
          );
        },
        templates: {
          suggestion: function(suggestion) {
            var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
              ? `<img src="${offsetURL(suggestion.preview)}"</img>`
              : '';
            var html = `
              <div class="search-item">
                <h3>${suggestion.title}</h3>
                <div class="search-item-description">
                  ${suggestion.description || ''}
                </div>
                <div class="search-item-preview">
                  ${img}
                </div>
              </div>
            `;
            return html;
          }
        }
      }]).on('autocomplete:selected', function(event, suggestion) {
        window.location.href = offsetURL(suggestion.path);
      });
      // remove inline display style on autocompleter (we want to
      // manage responsive display via css)
      $('.algolia-autocomplete').css("display", "");
    })
    .catch(function(error) {
      console.log(error);
    });

});

</script>

<style type="text/css">

.nav-search {
  font-size: x-small;
}

/* Algolioa Autocomplete */

.algolia-autocomplete {
  display: inline-block;
  margin-left: 10px;
  vertical-align: sub;
  background-color: white;
  color: black;
  padding: 6px;
  padding-top: 8px;
  padding-bottom: 0;
  border-radius: 6px;
  border: 1px #0F2E3D solid;
  width: 180px;
}


@media screen and (max-width: 768px) {
  .distill-site-nav .algolia-autocomplete {
    display: none;
    visibility: hidden;
  }
  .distill-site-nav.responsive .algolia-autocomplete {
    display: inline-block;
    visibility: visible;
  }
  .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
    margin-left: 0;
    width: 400px;
    max-height: 400px;
  }
}

.algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
  width: 90%;
  outline: none;
  border: none;
}

.algolia-autocomplete .aa-hint {
  color: #999;
}
.algolia-autocomplete .aa-dropdown-menu {
  width: 550px;
  max-height: 70vh;
  overflow-x: visible;
  overflow-y: scroll;
  padding: 5px;
  margin-top: 3px;
  margin-left: -150px;
  background-color: #fff;
  border-radius: 5px;
  border: 1px solid #999;
  border-top: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
  cursor: pointer;
  padding: 5px 4px;
  border-bottom: 1px solid #eee;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
  border-bottom: none;
  margin-bottom: 2px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
  overflow: hidden;
  font-size: 0.8em;
  line-height: 1.4em;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
  font-size: 1rem;
  margin-block-start: 0;
  margin-block-end: 5px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
  display: inline-block;
  overflow: hidden;
  height: 2.8em;
  width: 80%;
  margin-right: 4%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
  display: inline-block;
  width: 15%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
  height: 3em;
  width: auto;
  display: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
  display: initial;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
  background-color: #eee;
}
.algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
  font-weight: bold;
  font-style: normal;
}

</style>


<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
  font-size: 100%;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

hr.section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  margin: 0px;
}


d-byline {
  border-top: none;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
  border-top: none;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

/* tweak for Pandoc numbered line within distill */
d-article pre.numberSource code > span {
    left: -2em;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // separator
  var separator = '<hr class="section-separator" style="clear: both"/>';
  // prepend separator above appendix
  $('.d-byline').before(separator);
  $('.d-article').before(separator);

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme, except when numbering line
  // in code chunk
  $('pre:not(.numberLines) code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      var author_name = front_matter.authors[i].author
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', author_name ? 'ORCID ID for ' + author_name : 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      const citeChild = $(this).children()[0]
      // Do not process if @xyz has been used without escaping and without bibliography activated
      // https://github.com/rstudio/distill/issues/466
      if (citeChild === undefined) return true

      if (citeChild.nodeName == "D-FOOTNOTE") {
        var fn = citeChild
        $(this).html(fn.shadowRoot.querySelector("sup"))
        $(this).id = fn.id
        fn.remove()
      }
      var refs = $(this).attr('data-cites').split(" ");
      var refHtml = refs.map(function(ref) {
        // Could use CSS.escape too here, we insure backward compatibility in navigator
        return "<p>" + $('div[id="ref-' + ref + '"]').html() + "</p>";
      }).join("\n");
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // fix footnotes in tables (#411)
    // replacing broken distill.pub feature
    $('table d-footnote').each(function() {
      // we replace internal showAtNode methode which is triggered when hovering a footnote
      this.hoverBox.showAtNode = function(node) {
        // ported from https://github.com/distillpub/template/pull/105/files
        calcOffset = function(elem) {
            let x = elem.offsetLeft;
            let y = elem.offsetTop;
            // Traverse upwards until an `absolute` element is found or `elem`
            // becomes null.
            while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                x += elem.offsetLeft;
                y += elem.offsetTop;
            }

            return { left: x, top: y };
        }
        // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
        const bbox = node.getBoundingClientRect();
        const offset = calcOffset(node);
        this.show([offset.left + bbox.width, offset.top + bbox.height]);
      }
    })

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    // ignore leaflet img layers (#106)
    figures = figures.filter(':not(img[class*="leaflet"])')
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */
</style>
<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */

@import url('https://fonts.googleapis.com/css2?family=Questrial');

html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    "Questrial", sans-serif;
  --mono-font:       monospace;
  --body-font:       "Questrial", sans-serif;
  --navbar-font:     "Questrial", sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #000e78;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #000e78;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */

@media screen and (min-width: 768px) {
  d-article aside {
    height: 0;
  }
  aside.slides {
    margin-left: -148px;
    height: auto;
  }
  aside.slides + h2 {
    white-space: nowrap;
  }
}

d-article li {
  margin-bottom: 0.1em;
}

.posts-list .post-preview .thumbnail {
  max-height: 300px;
  overflow: hidden;
}</style>
<style type="text/css">
/* base style */

/* FONT FAMILIES */

:root {
  --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

body,
.posts-list .post-preview p,
.posts-list .description p {
  font-family: var(--body-font), var(--body-default);
}

h1, h2, h3, h4, h5, h6,
.posts-list .post-preview h2,
.posts-list .description h2 {
  font-family: var(--heading-font), var(--heading-default);
}

d-article div.sourceCode code,
d-article pre code {
  font-family: var(--mono-font), var(--mono-default);
}


/*-- TITLE --*/
d-title h1,
.posts-list > h1 {
  color: var(--title-color, black);
}

d-title h1 {
  font-size: var(--title-size, 50px);
}

/*-- HEADERS --*/
d-article h1,
d-article h2,
d-article h3,
d-article h4,
d-article h5,
d-article h6 {
  color: var(--header-color, rgba(0, 0, 0, 0.8));
}

/*-- BODY --*/
d-article > p,  /* only text inside of <p> tags */
d-article > ul, /* lists */
d-article > ol {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
  font-size: var(--body-size, 1.06rem);
}


/*-- CODE --*/
d-article div.sourceCode code,
d-article pre code {
  font-size: var(--code-size, 14px);
}

/*-- ASIDE --*/
d-article aside {
  font-size: var(--aside-size, 12px);
  color: var(--aside-color, rgba(0, 0, 0, 0.6));
}

/*-- FIGURE CAPTIONS --*/
figure .caption,
figure figcaption,
.figure .caption {
  font-size: var(--fig-cap-size, 13px);
  color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
}

/*-- METADATA --*/
d-byline h3 {
  font-size: var(--heading-size, 0.6rem);
  color: var(--heading-color, rgba(0, 0, 0, 0.5));
}

d-byline {
  font-size: var(--body-size, 0.8rem);
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

d-byline a,
d-article d-byline a {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

/*-- TABLE OF CONTENTS --*/
.d-contents nav h3 {
  font-size: var(--heading-size, 18px);
}

.d-contents nav a {
  font-size: var(--contents-size, 13px);
}

/*-- APPENDIX --*/
d-appendix h3 {
  font-size: var(--heading-size, 15px);
  color: var(--heading-color, rgba(0, 0, 0, 0.65));
}

d-appendix {
  font-size: var(--text-size, 0.8em);
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

d-appendix d-footnote-list a.footnote-backlink {
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

/*-- WEBSITE HEADER + FOOTER --*/
.distill-site-header .title {
  font-size: var(--title-size, 18px);
  font-family: var(--navbar-font), var(--heading-default);
}

.distill-site-header a,
.nav-dropdown .nav-dropbtn {
  font-family: var(--navbar-font), var(--heading-default);
}

.nav-dropdown .nav-dropbtn {
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  font-size: var(--text-size, 15px);
}

.distill-site-header a:hover,
.nav-dropdown:hover .nav-dropbtn {
  color: var(--hover-color, white);
}

.distill-site-header {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer a:hover {
  color: var(--hover-color, white);
}</style>
<!--/radix_placeholder_distill-->
  <script src="../../../site_libs/header-attrs-2.30/header-attrs.js"></script>
  <script src="../../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="../../../site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="../../../site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="../../../site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="../../../site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="../../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Small Stats Can Be Big Players in Development and Good Governance","description":"This report reconstructs the “Small States Can Be Big Players in Development and Good Governance” figure using R, combining World Bank, UNDP, and V-Dem data in a fully reproducible workflow.","authors":[{"author":"Abdullah Tadmuri","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2026-01-06T00:00:00.000-05:00","citationText":"Tadmuri, 2026"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<span class="logo">
<img src="../../../assets/acronimo_0.png"/>
</span>
<a href="../../../index.html" class="title">Data Visualization | MSc CSS</a>
<input id="distill-search" class="nav-search hidden" type="text" placeholder="Search..."/>
</div>
<div class="nav-right">
<a href="../../../contents.html">Contents</a>
<a href="../../../tutorials.html">Tutorials</a>
<a href="../../../resources.html">Resources</a>
<a href="../../../projects.html">Projects</a>
<a href="https://github.com/IBiDat/dataviz" aria-label="Link to source">
<i class="fab fa-github" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Small Stats Can Be Big Players in Development and Good Governance</h1>

<!--radix_placeholder_categories-->
<div class="dt-tags">
  <a href="../../../projects.html#category:2025" class="dt-tag">2025</a>
</div>
<!--/radix_placeholder_categories-->
<p><p>This report reconstructs the “Small States Can Be Big Players in Development and Good Governance” figure using R, combining World Bank, UNDP, and V-Dem data in a fully reproducible workflow.</p></p>
</div>

<div class="d-byline">
  
  Abdullah Tadmuri
  
<br/>2026-01-06
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#introduction" id="toc-introduction">Introduction</a></li>
<li><a href="#original-visualization" id="toc-original-visualization">Original Visualization</a></li>
<li><a href="#motivation" id="toc-motivation">Motivation</a></li>
<li><a href="#data-sources-and-data-collection" id="toc-data-sources-and-data-collection">Data sources and data collection</a></li>
<li><a href="#data-preparation-and-cleaning" id="toc-data-preparation-and-cleaning">Data Preparation and Cleaning</a></li>
<li><a href="#visual-design-and-aesthetic-choices" id="toc-visual-design-and-aesthetic-choices">Visual Design and Aesthetic Choices</a></li>
<li><a href="#the-main-scatter-plot-governance-and-human-development" id="toc-the-main-scatter-plot-governance-and-human-development">The Main Scatter Plot: Governance and Human Development</a></li>
<li><a href="#the-ridge-plots-distributions-across-state-size-groups" id="toc-the-ridge-plots-distributions-across-state-size-groups">The Ridge Plots: Distributions Across State-Size Groups</a></li>
<li><a href="#the-world-map-geographic-patterns-of-state-size" id="toc-the-world-map-geographic-patterns-of-state-size">The World Map: Geographic Patterns of State Size</a></li>
<li><a href="#assembling-the-composite-figure" id="toc-assembling-the-composite-figure">Assembling the Composite Figure</a>
<ul>
<li><a href="#conclusion-and-reflections" id="toc-conclusion-and-reflections">Conclusion and Reflections</a></li>
</ul></li>
<li><a href="#extended-analysis-democratic-governance-human-development-and-low-carbon-development-19902022" id="toc-extended-analysis-democratic-governance-human-development-and-low-carbon-development-19902022">Extended Analysis: Democratic Governance, Human Development and Low-Carbon Development (1990–2022)</a></li>
</ul>
</nav>
</div>
<h2 id="introduction">Introduction</h2>
<p>This project replicates the multi-panel visualization “Small States Can Be Big Players in Development and Good Governance”, originally produced for the World Data Visualization Prize. The original figure combines several international datasets to show how countries differ in human development, governance quality, political stability, corruption, and democratic freedoms, depending on their population size.</p>
<p>The aim here is twofold. First, to recreate the graphic as faithfully as possible using only R and openly available data. Second, to build a fully transparent and reproducible workflow that covers the entire pipeline: data retrieval, cleaning, transformation, visualization, and final layout. The final figure is generated entirely from scratch using tidyverse tools, ggplot2, sf, and related packages. Every element—scatterplot, ridge-density panels, world map, annotation blocks, and the overall layout—is constructed through a structured sequence of steps designed to balance precision, clarity, and readability.</p>
<h2 id="original-visualization">Original Visualization</h2>
<figure>
<img src="images/clipboard-2056465238.png" class="external" alt="Original chart. Source: World Data Visualization Prize" />
<figcaption aria-hidden="true">Original chart. Source: World Data Visualization Prize</figcaption>
</figure>
<h2 id="motivation">Motivation</h2>
<p>Small states hold a distinctive place in global development debates. Although they account for only a small share of the world’s population, many of them achieve high levels of human development and maintain effective, stable institutions. Island nations and microstates often score strongly on governance and democratic indicators, challenging the intuition that size naturally confers an advantage in state capacity or development outcomes.</p>
<p>The original visualization captures this idea by placing several indicators side by side and grouping countries by population size. It shows that small states frequently appear among the best performers on governance and democracy, while also revealing differences in how far various groups have progressed over time. Replicating this figure offers a concrete exercise in computational social science. It requires handling heterogeneous data sources, making careful choices about visual encoding, and thinking critically about how design decisions shape interpretation. The analysis is descriptive rather than causal, but it illustrates how empirical patterns become more visible when multiple dimensions of development are presented in a coherent visual narrative.</p>
<h2 id="data-sources-and-data-collection">Data sources and data collection</h2>
<p>All data used in this replication come from public, well-documented sources and are retrieved programmatically within R. This approach ensures that anyone with access to the script can obtain the same inputs and follow the same steps to arrive at the final graphic.</p>
<p>The main economic and governance indicators are taken from the World Bank’s World Development Indicators and Worldwide Governance Indicators. Using the wbstats package, the script downloads government effectiveness, political stability, control of corruption, GDP in purchasing-power-parity terms, GDP per capita, unemployment, and total population. The key years are 2007, 2012, and 2017, chosen to match the timing structure implied in the original figure. Human development scores come from the United Nations Development Programme’s Human Development Index time series. The project extracts HDI values for 2000 and 2017, which are then used to compute the change in HDI over that period. This change is later displayed in one of the ridge-density plots and helps capture long-term development trajectories.</p>
<p>Democratic freedoms are measured with the Liberal Democracy Index from the Varieties of Democracy (V-Dem) project. The dataset is accessed via the vdemdata package, which provides a harmonised version of the annual V-Dem release. The replication focuses on values for 2017 to keep the time frame consistent across the governance and democracy indicators. Once retrieved, these datasets are merged using standard ISO-3 country codes. Each country is assigned to one of three population-based categories based on its 2017 population: small states have fewer than five million inhabitants, midsized states have between five and thirty-five million, and big states exceed thirty-five million. This classification mirrors the original visualization and provides a consistent backbone for colouring, labelling, and grouping across all panels. Because all data collection and merging are handled inside the R script, the final figure is fully reproducible and grounded in verifiable, up-to-date sources.<br />
</p>
<h5 id="libraries-options">Libraries &amp; Options</h5>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/sfirke/janitor'>janitor</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/pachadotdev/wbstats'>wbstats</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://vincentarelbundock.github.io/countrycode/'>countrycode</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://scales.r-lib.org'>scales</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://wilkelab.org/ggridges/'>ggridges</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/yixuan/showtext'>showtext</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/yixuan/sysfonts'>sysfonts</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>vdemdata</span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://r-spatial.github.io/sf/'>sf</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://docs.ropensci.org/rnaturalearth/'>rnaturalearth</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://wilkelab.org/cowplot/'>cowplot</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://wilkelab.org/ggtext/'>ggtext</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://ggrepel.slowkow.com/'>ggrepel</a></span><span class='op'>)</span>   </span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://docs.ropensci.org/magick/'>magick</a></span><span class='op'>)</span></span>
<span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/options.html'>options</a></span><span class='op'>(</span>timeout <span class='op'>=</span> <span class='fl'>300</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<h5 id="fonts-colors">Fonts &amp; Colors</h5>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/pkg/sysfonts/man/font_add_google.html'>font_add_google</a></span><span class='op'>(</span><span class='st'>"Montserrat"</span>, <span class='st'>"Montserrat"</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/pkg/showtext/man/showtext_auto.html'>showtext_auto</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/pkg/showtext/man/showtext_opts.html'>showtext_opts</a></span><span class='op'>(</span>dpi <span class='op'>=</span> <span class='fl'>96</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>base_font</span> <span class='op'>&lt;-</span> <span class='st'>"sans"</span>   </span>
<span></span>
<span><span class='co'># Exact colours  as in the original Figure </span></span>
<span></span>
<span><span class='va'>col1</span>  <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/rgb.html'>rgb</a></span><span class='op'>(</span><span class='fl'>225</span>, <span class='fl'>25</span>, <span class='fl'>27</span>,  alpha <span class='op'>=</span> <span class='fl'>255</span>, maxColorValue <span class='op'>=</span> <span class='fl'>255</span><span class='op'>)</span>  <span class='co'># red</span></span>
<span><span class='va'>col2</span>  <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/rgb.html'>rgb</a></span><span class='op'>(</span><span class='fl'>30</span>,  <span class='fl'>93</span>, <span class='fl'>160</span>, alpha <span class='op'>=</span> <span class='fl'>255</span>, maxColorValue <span class='op'>=</span> <span class='fl'>255</span><span class='op'>)</span>  <span class='co'># blue</span></span>
<span><span class='va'>col3</span>  <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/rgb.html'>rgb</a></span><span class='op'>(</span><span class='fl'>255</span>, <span class='fl'>220</span>, <span class='fl'>69</span>, alpha <span class='op'>=</span> <span class='fl'>255</span>, maxColorValue <span class='op'>=</span> <span class='fl'>255</span><span class='op'>)</span>  <span class='co'># yellow</span></span>
<span><span class='va'>col1a</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/rgb.html'>rgb</a></span><span class='op'>(</span><span class='fl'>225</span>, <span class='fl'>25</span>, <span class='fl'>27</span>,  alpha <span class='op'>=</span> <span class='fl'>195</span>, maxColorValue <span class='op'>=</span> <span class='fl'>255</span><span class='op'>)</span></span>
<span><span class='va'>col2a</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/rgb.html'>rgb</a></span><span class='op'>(</span><span class='fl'>30</span>,  <span class='fl'>93</span>, <span class='fl'>160</span>, alpha <span class='op'>=</span> <span class='fl'>195</span>, maxColorValue <span class='op'>=</span> <span class='fl'>255</span><span class='op'>)</span></span>
<span><span class='va'>col3a</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/rgb.html'>rgb</a></span><span class='op'>(</span><span class='fl'>255</span>, <span class='fl'>220</span>, <span class='fl'>69</span>, alpha <span class='op'>=</span> <span class='fl'>195</span>, maxColorValue <span class='op'>=</span> <span class='fl'>255</span><span class='op'>)</span></span>
<span><span class='va'>col3b</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/rgb.html'>rgb</a></span><span class='op'>(</span><span class='fl'>248</span>, <span class='fl'>202</span>, <span class='fl'>8</span>,  alpha <span class='op'>=</span> <span class='fl'>255</span>, maxColorValue <span class='op'>=</span> <span class='fl'>255</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>bg.col</span>     <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/rgb.html'>rgb</a></span><span class='op'>(</span><span class='fl'>255</span>, <span class='fl'>251</span>, <span class='fl'>245</span>, maxColorValue <span class='op'>=</span> <span class='fl'>255</span><span class='op'>)</span></span>
<span><span class='va'>dark.color</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/rgb.html'>rgb</a></span><span class='op'>(</span><span class='fl'>35</span>, <span class='fl'>35</span>, <span class='fl'>58</span>, maxColorValue <span class='op'>=</span> <span class='fl'>255</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>size_colors</span>       <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"small"</span> <span class='op'>=</span> <span class='va'>col1</span>, <span class='st'>"medium"</span> <span class='op'>=</span> <span class='va'>col3</span>, <span class='st'>"big"</span> <span class='op'>=</span> <span class='va'>col2</span><span class='op'>)</span></span>
<span><span class='va'>size_colors_alpha</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"small"</span> <span class='op'>=</span> <span class='va'>col1a</span>, <span class='st'>"medium"</span> <span class='op'>=</span> <span class='va'>col3a</span>, <span class='st'>"big"</span> <span class='op'>=</span> <span class='va'>col2a</span><span class='op'>)</span></span>
<span><span class='va'>order_size</span>        <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"small"</span>, <span class='st'>"medium"</span>, <span class='st'>"big"</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<h5 id="helper">Helper</h5>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>fetch_wb</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>indicators</span>, <span class='va'>years</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2007</span>, <span class='fl'>2012</span>, <span class='fl'>2017</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>  <span class='fu'><a href='https://purrr.tidyverse.org/reference/map_dfr.html'>map_dfr</a></span><span class='op'>(</span><span class='va'>indicators</span>, <span class='op'>~</span><span class='op'>{</span></span>
<span>    <span class='fu'><a href='https://rdrr.io/pkg/wbstats/man/wb_data.html'>wb_data</a></span><span class='op'>(</span></span>
<span>      indicator   <span class='op'>=</span> <span class='va'>.x</span>,</span>
<span>      country     <span class='op'>=</span> <span class='st'>"all"</span>,</span>
<span>      start_date  <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>years</span><span class='op'>)</span>,</span>
<span>      end_date    <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>years</span><span class='op'>)</span>,</span>
<span>      return_wide <span class='op'>=</span> <span class='cn'>TRUE</span></span>
<span>    <span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>      <span class='fu'><a href='https://sfirke.github.io/janitor/reference/clean_names.html'>clean_names</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span>  <span class='op'>}</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>iso2c</span>, <span class='va'>iso3c</span>, <span class='va'>country</span>, <span class='va'>date</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span></span>
<span>      <span class='fu'><a href='https://dplyr.tidyverse.org/reference/across.html'>across</a></span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/where.html'>where</a></span><span class='op'>(</span><span class='va'>is.numeric</span><span class='op'>)</span>, <span class='op'>~</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/nth.html'>first</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/na.fail.html'>na.omit</a></span><span class='op'>(</span><span class='va'>.x</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>      .groups <span class='op'>=</span> <span class='st'>"drop"</span></span>
<span>    <span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>date <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/integer.html'>as.integer</a></span><span class='op'>(</span><span class='va'>date</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>date</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='va'>years</span><span class='op'>)</span></span>
<span><span class='op'>}</span></span></code></pre>
</div>
</div>
<h5 id="economic-data">Economic Data</h5>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/base/options.html'>options</a></span><span class='op'>(</span>timeout <span class='op'>=</span> <span class='fl'>300</span><span class='op'>)</span></span>
<span><span class='va'>econ_all</span> <span class='op'>&lt;-</span> <span class='fu'>fetch_wb</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"NY.GDP.MKTP.PP.KD"</span>, <span class='st'>"SP.POP.TOTL"</span>,<span class='st'>"NY.GDP.PCAP.PP.KD"</span>, <span class='st'>"SL.UEM.TOTL.ZS"</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>d.econ17</span> <span class='op'>&lt;-</span> <span class='va'>econ_all</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span></span>
<span>    <span class='va'>iso2c</span>, <span class='va'>iso3c</span>, <span class='va'>country</span>, <span class='va'>date</span>,</span>
<span>    <span class='va'>ny_gdp_mktp_pp_kd</span>, <span class='va'>sp_pop_totl</span>, <span class='va'>ny_gdp_pcap_pp_kd</span>, <span class='va'>sl_uem_totl_zs</span></span>
<span>  <span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_wider.html'>pivot_wider</a></span><span class='op'>(</span></span>
<span>    names_from  <span class='op'>=</span> <span class='va'>date</span>,</span>
<span>    values_from <span class='op'>=</span> <span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>iso2c</span>, <span class='va'>iso3c</span>, <span class='va'>country</span>, <span class='va'>date</span><span class='op'>)</span>,</span>
<span>    names_sep   <span class='op'>=</span> <span class='st'>"_"</span></span>
<span>  <span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    gdp    <span class='op'>=</span> <span class='va'>ny_gdp_mktp_pp_kd_2017</span>,</span>
<span>    popul  <span class='op'>=</span> <span class='va'>sp_pop_totl_2017</span>,</span>
<span>    gdp.pc <span class='op'>=</span> <span class='va'>ny_gdp_pcap_pp_kd_2017</span></span>
<span>  <span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>iso2c</span>, <span class='va'>iso3c</span>, <span class='va'>country</span>, <span class='va'>gdp</span>, <span class='va'>popul</span>, <span class='va'>gdp.pc</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<h5 id="governance-data">Governance Data</h5>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>gov_all</span> <span class='op'>&lt;-</span> <span class='fu'>fetch_wb</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CC.EST"</span>, <span class='st'>"GE.EST"</span>, <span class='st'>"PV.EST"</span>, <span class='st'>"RL.EST"</span>, <span class='st'>"RQ.EST"</span>, <span class='st'>"VA.EST"</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>d.gov17</span> <span class='op'>&lt;-</span> <span class='va'>gov_all</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>iso2c</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>iso2c</span>, <span class='va'>iso3c</span>, <span class='va'>country</span>, <span class='va'>date</span>,</span>
<span>         <span class='va'>cc_est</span>, <span class='va'>ge_est</span>, <span class='va'>pv_est</span>, <span class='va'>rl_est</span>, <span class='va'>rq_est</span>, <span class='va'>va_est</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_wider.html'>pivot_wider</a></span><span class='op'>(</span></span>
<span>    names_from  <span class='op'>=</span> <span class='va'>date</span>,</span>
<span>    values_from <span class='op'>=</span> <span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>iso2c</span>, <span class='va'>iso3c</span>, <span class='va'>country</span>, <span class='va'>date</span><span class='op'>)</span>,</span>
<span>    names_sep   <span class='op'>=</span> <span class='st'>"_"</span></span>
<span>  <span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    corupt     <span class='op'>=</span> <span class='va'>cc_est_2017</span>,</span>
<span>    govef      <span class='op'>=</span> <span class='va'>ge_est_2017</span>,</span>
<span>    polviol    <span class='op'>=</span> <span class='va'>pv_est_2017</span>,</span>
<span>    govef.c.12 <span class='op'>=</span> <span class='va'>ge_est_2017</span> <span class='op'>-</span> <span class='va'>ge_est_2012</span></span>
<span>  <span class='op'>)</span></span></code></pre>
</div>
</div>
<h5 id="hdi-data">HDI Data</h5>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>d.hdi</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://readr.tidyverse.org/reference/read_delim.html'>read_csv</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"https://hdr.undp.org/sites/default/files/2021-22_HDR/HDR21-22_Composite_indices_complete_time_series.csv"</span>,</span>
<span>  show_col_types <span class='op'>=</span> <span class='cn'>FALSE</span></span>
<span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span></span>
<span>    iso3c    <span class='op'>=</span> <span class='va'>iso3</span>,</span>
<span>    hdi.00   <span class='op'>=</span> <span class='va'>hdi_2000</span>,</span>
<span>    hdi.2017 <span class='op'>=</span> <span class='va'>hdi_2017</span></span>
<span>  <span class='op'>)</span></span></code></pre>
</div>
</div>
<h5 id="v-dem-data">V-Dem Data</h5>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>freedom_data</span> <span class='op'>&lt;-</span> <span class='va'>vdem</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>year</span> <span class='op'>==</span> <span class='fl'>2017</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/transmute.html'>transmute</a></span><span class='op'>(</span></span>
<span>    iso3c   <span class='op'>=</span> <span class='va'>country_text_id</span>,</span>
<span>    freedom <span class='op'>=</span> <span class='va'>v2x_libdem</span></span>
<span>  <span class='op'>)</span></span></code></pre>
</div>
</div>
<h2 id="data-preparation-and-cleaning">Data Preparation and Cleaning</h2>
<p>Once the raw indicators are downloaded, the next step is to turn them into a single, well-structured dataset that can support all parts of the visualization. Although the underlying sources are high-quality, they differ in naming conventions, formats, and coverage, so a careful cleaning process is essential.</p>
<p>The preparation begins by standardising country identifiers. All datasets are converted to ISO-3 country codes, which serve as the common key across the World Bank, UNDP, and V-Dem records. This step avoids common problems caused by alternative country names or older naming conventions. Some labels are also adjusted manually to reflect the style used in the original figure, for example renaming “Gambia, The” to “The Gambia” and replacing “Congo, Rep.” with “Congo (Rep.)”. These edits ensure consistency between the final labels in the scatterplot and the original visualization.</p>
<p>After harmonising identifiers, the datasets are merged into one frame. Economic variables provide 2017 population and GDP measures, as well as the governance indicators for that year. The HDI table contributes values for 2000 and 2017, allowing the calculation of long-term change in human development. Similarly, the governance series offer values for 2012 and 2017, which are used to compute recent change in government effectiveness.</p>
<p>At this stage, the population-based groups defined earlier are encoded in the data as both numeric factors and descriptive labels such as “small states”, “midsized states”, and “big states”. These labels later appear on the ridge plots and help structure the legend and text.</p>
<p>Finally, the dataset is filtered to remove incomplete or problematic cases. Countries with missing HDI values, non-standard codes, or incomplete governance data are excluded to keep the final visualizations interpretable and comparable. The cleaned, merged dataset—referred to in the code as w1—contains all the variables required for the scatterplot, ridge panels, and world map. With this unified structure in place, the rest of the visualization can be built straightforwardly on top of it.</p>
<h5 id="size-groups">Size Groups</h5>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>w</span> <span class='op'>&lt;-</span> <span class='va'>d.econ17</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/transmute.html'>transmute</a></span><span class='op'>(</span></span>
<span>    <span class='va'>iso3c</span>, <span class='va'>country</span>, pop <span class='op'>=</span> <span class='va'>popul</span>,</span>
<span>    size <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/cut.html'>cut</a></span><span class='op'>(</span></span>
<span>      <span class='va'>pop</span> <span class='op'>/</span> <span class='fl'>1e6</span>,</span>
<span>      breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>5</span>, <span class='fl'>35</span>, <span class='cn'>Inf</span><span class='op'>)</span>,</span>
<span>      labels <span class='op'>=</span> <span class='va'>order_size</span>   <span class='co'># "small", "medium", "big"</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    size <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>size</span>, levels <span class='op'>=</span> <span class='va'>order_size</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>w</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/count.html'>count</a></span><span class='op'>(</span><span class='va'>size</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>pct <span class='op'>=</span> <span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org/reference/percent_format.html'>percent</a></span><span class='op'>(</span><span class='va'>n</span> <span class='op'>/</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code># A tibble: 4 × 3
  size       n pct  
  &lt;fct&gt;  &lt;int&gt; &lt;chr&gt;
1 small    101 38.0%
2 medium    80 30.1%
3 big       84 31.6%
4 &lt;NA&gt;       1 0.4% </code></pre>
</div>
<h5 id="merge-everything---w1">Merge Everything -&gt; w1</h5>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>w1</span> <span class='op'>&lt;-</span> <span class='va'>w</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>d.gov17</span>, <span class='op'>-</span><span class='va'>country</span><span class='op'>)</span>, by <span class='op'>=</span> <span class='st'>"iso3c"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>d.hdi</span>, <span class='va'>iso3c</span>, <span class='va'>hdi.00</span>, <span class='va'>hdi.2017</span><span class='op'>)</span>, by <span class='op'>=</span> <span class='st'>"iso3c"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>freedom_data</span>, by <span class='op'>=</span> <span class='st'>"iso3c"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/nchar.html'>nchar</a></span><span class='op'>(</span><span class='va'>iso2c</span><span class='op'>)</span> <span class='op'>==</span> <span class='fl'>2</span>, <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>hdi.2017</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    size3 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span></span>
<span>      <span class='va'>size</span>,</span>
<span>      levels <span class='op'>=</span> <span class='va'>order_size</span>,</span>
<span>      labels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"small states"</span>, <span class='st'>"midsized states"</span>, <span class='st'>"big states"</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    hdi.c.0017 <span class='op'>=</span> <span class='va'>hdi.2017</span> <span class='op'>-</span> <span class='va'>hdi.00</span>,</span>
<span>    country <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/recode.html'>recode</a></span><span class='op'>(</span></span>
<span>      <span class='va'>country</span>,</span>
<span>      <span class='st'>"Gambia, The"</span>              <span class='op'>=</span> <span class='st'>"The Gambia"</span>,</span>
<span>      <span class='st'>"United Arab Emirates"</span>     <span class='op'>=</span> <span class='st'>"UAE"</span>,</span>
<span>      <span class='st'>"Central African Republic"</span> <span class='op'>=</span> <span class='st'>"CAR"</span>,</span>
<span>      <span class='st'>"Czech Republic"</span>           <span class='op'>=</span> <span class='st'>"Czechia"</span>,</span>
<span>      <span class='st'>"United States"</span>            <span class='op'>=</span> <span class='st'>"USA"</span>,</span>
<span>      <span class='st'>"Micronesia, Fed. Sts."</span>    <span class='op'>=</span> <span class='st'>"Micronesia"</span>,</span>
<span>      <span class='st'>"Congo, Rep."</span>              <span class='op'>=</span> <span class='st'>"Congo (Rep.)"</span></span>
<span>    <span class='op'>)</span></span>
<span>  <span class='op'>)</span></span></code></pre>
</div>
</div>
<h2 id="visual-design-and-aesthetic-choices">Visual Design and Aesthetic Choices</h2>
<p>A key objective of the project is to reproduce the distinctive visual character of the original figure, not just its statistical content. Achieving this requires a deliberate design system, covering fonts, colours, background, spacing, and annotation style.</p>
<p>The colour palette is central to that system. Small, midsized, and big states are distinguished using a red–yellow–blue scheme, with both solid and semi-transparent versions of each colour. These shades are not chosen arbitrarily; they are matched to the original design using explicit RGB values. Semi-transparent colours are especially important for the ridge-density plots and the scatterplot, where overlapping elements need to remain visible without overwhelming the viewer. By defining the palette manually and applying it consistently, the figure ensures that colour always carries the same meaning across panels.</p>
<p>Typography reinforces the design. Using showtext and sysfonts, the script imports the Montserrat font family, which closely resembles the modern, geometric typeface used in the original graphic. The background is set to a light cream tone rather than the default grey, giving the figure a warm, print-like appearance. Text is drawn in a dark blue-grey, which provides strong contrast and good legibility against the light background.</p>
<p>A custom ggplot theme governs overall layout. Minor gridlines are removed to reduce visual noise, while major gridlines remain to help orient the reader. Axis titles are enlarged and bolded so they remain readable even when the final figure is scaled to fit a page. Styled annotation blocks above and beside the scatterplot use ggtext to allow inline formatting, including coloured words that highlight key terms such as “small states”.</p>
<p>Every colour, font, and spacing decision is encoded directly in the script. This not only helps match the look and feel of the original figure, but also ensures that the design is stable across machines and renders. The result is a visual style that is coherent, recognisable, and tightly linked to the narrative of the figure</p>
<h5 id="custom-theme">Custom Theme</h5>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>theme_small_states</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_minimal</a></span><span class='op'>(</span>base_family <span class='op'>=</span> <span class='va'>base_font</span>, base_size <span class='op'>=</span> <span class='fl'>11</span><span class='op'>)</span> <span class='op'><a href='https://ggplot2.tidyverse.org/reference/get_theme.html'>%+replace%</a></span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>      plot.background  <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>bg.col</span>, colour <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span>,</span>
<span>      panel.background <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>bg.col</span>, colour <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span>,</span>
<span>      panel.grid.minor <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>      text             <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>colour <span class='op'>=</span> <span class='va'>dark.color</span><span class='op'>)</span>,</span>
<span></span>
<span>      plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>        size   <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>rel</a></span><span class='op'>(</span><span class='fl'>5</span><span class='op'>)</span>,</span>
<span>        face   <span class='op'>=</span> <span class='st'>"bold"</span>,</span>
<span>        hjust  <span class='op'>=</span> <span class='fl'>0.5</span>,</span>
<span>        margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>b <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span>,</span>
<span>      plot.subtitle <span class='op'>=</span> <span class='fu'>ggtext</span><span class='fu'>::</span><span class='fu'><a href='https://wilkelab.org/ggtext/reference/element_markdown.html'>element_markdown</a></span><span class='op'>(</span></span>
<span>        size       <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>rel</a></span><span class='op'>(</span><span class='fl'>4</span><span class='op'>)</span>,</span>
<span>        lineheight <span class='op'>=</span> <span class='fl'>1.3</span>,</span>
<span>        hjust      <span class='op'>=</span> <span class='fl'>0</span>,</span>
<span>        margin     <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>b <span class='op'>=</span> <span class='fl'>8</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span>,</span>
<span>      plot.caption <span class='op'>=</span> <span class='fu'>ggtext</span><span class='fu'>::</span><span class='fu'><a href='https://wilkelab.org/ggtext/reference/element_markdown.html'>element_markdown</a></span><span class='op'>(</span></span>
<span>        size       <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>rel</a></span><span class='op'>(</span><span class='fl'>2</span><span class='op'>)</span>,</span>
<span>        hjust      <span class='op'>=</span> <span class='fl'>0</span>,</span>
<span>        lineheight <span class='op'>=</span> <span class='fl'>1.1</span>,</span>
<span>        margin     <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>12</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span>,</span>
<span></span>
<span>      <span class='co'># updated axis titles</span></span>
<span>      axis.title.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>        size   <span class='op'>=</span> <span class='fl'>60</span>,</span>
<span>        family <span class='op'>=</span> <span class='va'>base_font</span>,</span>
<span>        face   <span class='op'>=</span> <span class='st'>"bold"</span>,</span>
<span>        hjust  <span class='op'>=</span> <span class='fl'>0.5</span>,</span>
<span>        margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>16</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span>,</span>
<span>      axis.title.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>        size   <span class='op'>=</span> <span class='fl'>60</span>,</span>
<span>        family <span class='op'>=</span> <span class='va'>base_font</span>,</span>
<span>        face   <span class='op'>=</span> <span class='st'>"bold"</span>,</span>
<span>        angle  <span class='op'>=</span> <span class='fl'>90</span>,</span>
<span>        vjust  <span class='op'>=</span> <span class='fl'>0.5</span>,</span>
<span>        margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>r <span class='op'>=</span> <span class='fl'>16</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span>,</span>
<span></span>
<span>      axis.text       <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>rel</a></span><span class='op'>(</span><span class='fl'>3.0</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>      legend.position <span class='op'>=</span> <span class='st'>"none"</span></span>
<span>    <span class='op'>)</span></span>
<span><span class='op'>}</span></span></code></pre>
</div>
</div>
<h5 id="text-blocks-scatte-bottom-strip">Text Blocks (Scatte+ Bottom Strip)</h5>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>bottom_left_html</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"These charts show the distribution densities &lt;br&gt;of different"</span>,</span>
<span>  <span class='st'>"variables by three groups &lt;br&gt; based on state size:"</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>data_caption_html</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"&lt;span style='color:"</span>, <span class='va'>col1</span>, <span class='st'>";'&gt;Data:&lt;/span&gt; "</span>,</span>
<span>  <span class='st'>"Human Development Index from Human Development Reports. "</span>,</span>
<span>  <span class='st'>"Government Effectiveness, Control of Corruption, and Political Stability "</span>,</span>
<span>  <span class='st'>"from Worldwide Governance Indicators. "</span>,</span>
<span>  <span class='st'>"Freedom Rating from Freedom House."</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>legend_html</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"In all these charts, states are grouped &lt;br&gt; and colored by population size:"</span>,</span>
<span>  <span class='st'>"&lt;span style='color:"</span>, <span class='va'>col2</span>,  <span class='st'>";'&gt;&lt;br&gt;big states&lt;/span&gt; (more than 35 million)"</span>,</span>
<span>  <span class='st'>"&lt;span style='color:"</span>, <span class='va'>col3b</span>, <span class='st'>";'&gt;&lt;br&gt;midsized&lt;/span&gt; (between 5 and 35 million)"</span>,</span>
<span>  <span class='st'>"&lt;span style='color:"</span>, <span class='va'>col1</span>,  <span class='st'>";'&gt;&lt;br&gt;small states&lt;/span&gt; (less than 5 million)"</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>subtitle_panel_html</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"There are more than &lt;span style='color:"</span>, <span class='va'>col1</span>, <span class='st'>";'&gt;77 small states&lt;/span&gt; "</span>,</span>
<span>  <span class='st'>"(with population below 5 million) that account for&lt;br&gt;"</span>,</span>
<span>  <span class='st'>"more than &lt;span style='color:"</span>, <span class='va'>col1</span>, <span class='st'>";'&gt;1.5%&lt;/span&gt; of the world population "</span>,</span>
<span>  <span class='st'>"and for close to &lt;span style='color:"</span>, <span class='va'>col1</span>, <span class='st'>";'&gt;3%&lt;/span&gt; of the global wealth.&lt;br&gt;"</span>,</span>
<span>  <span class='st'>"Some &lt;span style='color:"</span>, <span class='va'>col1</span>, <span class='st'>";'&gt;small states&lt;/span&gt; are amongst the most developed nations "</span>,</span>
<span>  <span class='st'>"&lt;br&gt;with highest levels of government effectiveness."</span></span>
<span><span class='op'>)</span></span></code></pre>
</div>
</div>
<h2 id="the-main-scatter-plot-governance-and-human-development">The Main Scatter Plot: Governance and Human Development</h2>
<p>The scatter plot comparing government effectiveness and the Human Development Index in 2017 is the focal point of the figure. It distills the core message into a simple visual: small states, despite their modest populations, often achieve high levels of both institutional quality and human development.</p>
<p>To recreate this plot, the analysis keeps the axis ranges and scaling consistent with the original. This preserves the shape of the cloud of points and ensures that the visual boundaries match what viewers would see in the reference graphic. Country bubbles are drawn intentionally large, reflecting the bold style of the original and making it easy to distinguish the three population groups by colour.</p>
<p>Because many countries cluster in similar regions of the plot, a small amount of jitter is applied to both axes. The jitter is carefully controlled: it separates overlapping points just enough to make them visible, but not so much that it misrepresents the underlying data or alters the apparent relationships. This helps to manage overplotting while maintaining the integrity of the visual patterns.</p>
<p>An important characteristic of the original figure is the extensive use of country labels, especially among small states. The replication follows this approach by labelling all small states and a selection of other countries that are either highlighted in the original or analytically interesting. The ggrepel package is used to automatically adjust label positions, reducing collisions and preserving legibility. Crucially, labels and points share the same jitter, so each name remains aligned with its corresponding bubble even in dense regions.</p>
<p>The panel also includes two text elements that allow it to stand alone: a short explanatory paragraph at the top, and a compact legend-like block on the right that explains the population thresholds and colour scheme. Together with the bubble cloud and labels, these elements clearly communicate the central insight: small states can, and often do, perform as well as or better than larger countries in terms of governance and human development.</p>
<h5 id="main-scatter-panel">Main Scatter Panel</h5>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>w1_plot</span> <span class='op'>&lt;-</span> <span class='va'>w1</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span></span>
<span>    <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>govef</span><span class='op'>)</span>,</span>
<span>    <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>hdi.2017</span><span class='op'>)</span>,</span>
<span>    <span class='va'>govef</span>    <span class='op'>&gt;=</span> <span class='op'>-</span><span class='fl'>2.2</span>, <span class='va'>govef</span>    <span class='op'>&lt;=</span> <span class='fl'>2.2</span>,</span>
<span>    <span class='va'>hdi.2017</span> <span class='op'>&gt;=</span> <span class='fl'>0.34</span>, <span class='va'>hdi.2017</span> <span class='op'>&lt;=</span> <span class='fl'>1.02</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='co'># one shared jitter object for points *and* labels</span></span>
<span><span class='va'>jitter_pos</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/position_jitter.html'>position_jitter</a></span><span class='op'>(</span></span>
<span>  width  <span class='op'>=</span> <span class='fl'>0.03</span>,  <span class='co'># gentle x jitter</span></span>
<span>  height <span class='op'>=</span> <span class='fl'>0.003</span>, <span class='co'># very small y jitter (keeps HDI truthful)</span></span>
<span>  seed   <span class='op'>=</span> <span class='fl'>42</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># original hand-picked labels</span></span>
<span><span class='va'>label_47</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"CAR"</span>, <span class='st'>"Comoros"</span>, <span class='st'>"Guinea-Bissau"</span>, <span class='st'>"Djibouti"</span>, <span class='st'>"Liberia"</span>, <span class='st'>"Lesotho"</span>, <span class='st'>"The Gambia"</span>,</span>
<span>  <span class='st'>"Equatorial Guinea"</span>, <span class='st'>"Congo (Rep.)"</span>, <span class='st'>"Solomon Islands"</span>, <span class='st'>"Timor-Leste"</span>, <span class='st'>"Vanuatu"</span>,</span>
<span>  <span class='st'>"Marshall Islands"</span>, <span class='st'>"Gabon"</span>, <span class='st'>"Eswatini"</span>, <span class='st'>"Micronesia"</span>, <span class='st'>"Cabo Verde"</span>, <span class='st'>"Namibia"</span>,</span>
<span>  <span class='st'>"Botswana"</span>, <span class='st'>"Guyana"</span>, <span class='st'>"Kiribati"</span>, <span class='st'>"Bhutan"</span>, <span class='st'>"Samoa"</span>, <span class='st'>"Jamaica"</span>, <span class='st'>"Suriname"</span>,</span>
<span>  <span class='st'>"Belize"</span>, <span class='st'>"Moldova"</span>, <span class='st'>"Dominica"</span>, <span class='st'>"Lebanon"</span>, <span class='st'>"Bosnia and Herzegovina"</span>,</span>
<span>  <span class='st'>"Palau"</span>, <span class='st'>"Oman"</span>, <span class='st'>"Uruguay"</span>, <span class='st'>"Croatia"</span>, <span class='st'>"Cyprus"</span>, <span class='st'>"Latvia"</span>, <span class='st'>"Barbados"</span>,</span>
<span>  <span class='st'>"Malta"</span>, <span class='st'>"Mauritius"</span>, <span class='st'>"Brunei"</span>, <span class='st'>"Georgia"</span>, <span class='st'>"Estonia"</span>, <span class='st'>"Ireland"</span>, <span class='st'>"Iceland"</span>,</span>
<span>  <span class='st'>"Luxembourg"</span>, <span class='st'>"New Zealand"</span>, <span class='st'>"Andorra"</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># extra labels: all small states + top midsized by HDI</span></span>
<span><span class='va'>small_names</span> <span class='op'>&lt;-</span> <span class='va'>w1_plot</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>size</span> <span class='op'>==</span> <span class='st'>"small"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/pull.html'>pull</a></span><span class='op'>(</span><span class='va'>country</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>top_mid_names</span> <span class='op'>&lt;-</span> <span class='va'>w1_plot</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>size</span> <span class='op'>==</span> <span class='st'>"medium"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice_max</a></span><span class='op'>(</span><span class='va'>hdi.2017</span>, n <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>|&gt;</span>   <span class='co'># change n if you want more / fewer midsized</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/pull.html'>pull</a></span><span class='op'>(</span><span class='va'>country</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>labels_all</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>union</a></span><span class='op'>(</span><span class='va'>label_47</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>small_names</span>, <span class='va'>top_mid_names</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>label_data</span> <span class='op'>&lt;-</span> <span class='va'>w1_plot</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>country</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='va'>labels_all</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>p_scatter</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>w1_plot</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>govef</span>, y <span class='op'>=</span> <span class='va'>hdi.2017</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='co'># grid lines</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span>xintercept <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>2</span>, <span class='fl'>2</span>, <span class='fl'>1</span><span class='op'>)</span>, colour <span class='op'>=</span> <span class='st'>"grey80"</span>, linewidth <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_hline</a></span><span class='op'>(</span>yintercept <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fl'>0.4</span>, <span class='fl'>1</span>, <span class='fl'>0.2</span><span class='op'>)</span>, colour <span class='op'>=</span> <span class='st'>"grey80"</span>, linewidth <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span>  <span class='co'># points: big, coloured by size (small/medium/big)</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>size</span>, colour <span class='op'>=</span> <span class='va'>size</span><span class='op'>)</span>,</span>
<span>    shape    <span class='op'>=</span> <span class='fl'>21</span>,</span>
<span>    size     <span class='op'>=</span> <span class='fl'>22</span>,   </span>
<span>    stroke   <span class='op'>=</span> <span class='fl'>1.1</span>,</span>
<span>    alpha    <span class='op'>=</span> <span class='fl'>0.85</span>,</span>
<span>    position <span class='op'>=</span> <span class='va'>jitter_pos</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_fill_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>size_colors_alpha</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_color_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>size_colors</span><span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span>  <span class='co'># labels: same jitter so they stay attached to bubbles</span></span>
<span>  <span class='fu'>ggrepel</span><span class='fu'>::</span><span class='fu'><a href='https://ggrepel.slowkow.com/reference/geom_text_repel.html'>geom_text_repel</a></span><span class='op'>(</span></span>
<span>    data          <span class='op'>=</span> <span class='va'>label_data</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>label <span class='op'>=</span> <span class='va'>country</span><span class='op'>)</span>,</span>
<span>    size          <span class='op'>=</span> <span class='fl'>6.7</span>,</span>
<span>    fontface      <span class='op'>=</span> <span class='st'>"italic"</span>,</span>
<span>    max.overlaps  <span class='op'>=</span> <span class='cn'>Inf</span>,</span>
<span>    box.padding   <span class='op'>=</span> <span class='fl'>0.45</span>,</span>
<span>    point.padding <span class='op'>=</span> <span class='fl'>0.3</span>,</span>
<span>    force         <span class='op'>=</span> <span class='fl'>1.2</span>,</span>
<span>    seed          <span class='op'>=</span> <span class='fl'>23</span>,</span>
<span>    segment.color <span class='op'>=</span> <span class='cn'>NA</span>,</span>
<span>    position      <span class='op'>=</span> <span class='va'>jitter_pos</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span>  <span class='co'># axes</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span></span>
<span>    name   <span class='op'>=</span> <span class='st'>"Government Effectiveness (2017)"</span>,</span>
<span>    breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>2</span>, <span class='fl'>2</span>, <span class='fl'>1</span><span class='op'>)</span>,</span>
<span>    labels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"-2"</span>, <span class='st'>"-1"</span>, <span class='st'>""</span>, <span class='st'>"1"</span>, <span class='st'>"2"</span><span class='op'>)</span>,</span>
<span>    limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>2.2</span>, <span class='fl'>2.2</span><span class='op'>)</span>,</span>
<span>    expand <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span></span>
<span>    name   <span class='op'>=</span> <span class='st'>"Human Development Index (2017)"</span>,</span>
<span>    breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fl'>0.4</span>, <span class='fl'>1</span>, <span class='fl'>0.2</span><span class='op'>)</span>,</span>
<span>    labels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"0.4"</span>, <span class='st'>""</span>, <span class='st'>""</span>, <span class='st'>"1.0"</span><span class='op'>)</span>,</span>
<span>    limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.34</span>, <span class='fl'>1.02</span><span class='op'>)</span>,</span>
<span>    expand <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span>  <span class='co'># in-panel paragraph</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>    <span class='st'>"richtext"</span>,</span>
<span>    x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>2.2</span>,</span>
<span>    y <span class='op'>=</span> <span class='fl'>0.975</span>,</span>
<span>    label  <span class='op'>=</span> <span class='va'>subtitle_panel_html</span>,</span>
<span>    hjust  <span class='op'>=</span> <span class='fl'>0</span>, vjust <span class='op'>=</span> <span class='fl'>1</span>,</span>
<span>    family <span class='op'>=</span> <span class='va'>base_font</span>,</span>
<span>    size   <span class='op'>=</span> <span class='fl'>11.2</span>,</span>
<span>    color  <span class='op'>=</span> <span class='va'>dark.color</span>,</span>
<span>    fill   <span class='op'>=</span> <span class='va'>bg.col</span>,</span>
<span>    label.color   <span class='op'>=</span> <span class='cn'>NA</span>,</span>
<span>    label.r       <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='st'>"pt"</span><span class='op'>)</span>,</span>
<span>    label.padding <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='st'>"pt"</span><span class='op'>)</span>,</span>
<span>    lineheight    <span class='op'>=</span> <span class='fl'>1.1</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span>  <span class='co'># legend block</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>    <span class='st'>"richtext"</span>,</span>
<span>    x <span class='op'>=</span> <span class='fl'>1.70</span>,</span>
<span>    y <span class='op'>=</span> <span class='fl'>0.45</span>,</span>
<span>    label  <span class='op'>=</span> <span class='va'>legend_html</span>,</span>
<span>    hjust  <span class='op'>=</span> <span class='fl'>0.5</span>, vjust <span class='op'>=</span> <span class='fl'>0.5</span>,</span>
<span>    family <span class='op'>=</span> <span class='va'>base_font</span>,</span>
<span>    size   <span class='op'>=</span> <span class='fl'>11</span>,</span>
<span>    fill   <span class='op'>=</span> <span class='va'>bg.col</span>,</span>
<span>    label.color   <span class='op'>=</span> <span class='cn'>NA</span>,</span>
<span>    label.r       <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>3</span>, <span class='st'>"pt"</span><span class='op'>)</span>,</span>
<span>    label.padding <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>4</span>, <span class='st'>"pt"</span><span class='op'>)</span>,</span>
<span>    color         <span class='op'>=</span> <span class='va'>dark.color</span>,</span>
<span>    lineheight    <span class='op'>=</span> <span class='fl'>1.1</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>    title <span class='op'>=</span> <span class='st'>"Small States Can Be Big Players in Development and Good Governance"</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_cartesian.html'>coord_cartesian</a></span><span class='op'>(</span>clip <span class='op'>=</span> <span class='st'>"off"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>theme_small_states</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    plot.margin  <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span><span class='fl'>18</span>, <span class='fl'>24</span>, <span class='fl'>42</span>, <span class='fl'>16</span><span class='op'>)</span>,</span>
<span>    plot.subtitle <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>p_scatter</span></span></code></pre>
</div>
<p><img src="100502844_files/figure-html5/main-scatter-plot-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<h2 id="the-ridge-plots-distributions-across-state-size-groups">The Ridge Plots: Distributions Across State-Size Groups</h2>
<p>To complement the country-level perspective of the scatter plot, the figure includes five ridge-density panels. These plots shift the focus from individual countries to the distributions of key indicators within each population group.</p>
<p>Three ridge plots show 2017 distributions of political stability, control of corruption, and democratic freedoms. The remaining two display changes over time: one captures the change in HDI between 2000 and 2017, and the other shows the change in government effectiveness between 2012 and 2017. Presenting these variables as overlapping density ridges allows the viewer to compare not just average levels, but also how values are spread within each group.</p>
<p>The y-axis categories—small, midsized, and big states—appear in the same order on every ridge plot. This consistent ordering, combined with re-used colours and labels, makes it easy to scan across panels and see how the distributions differ. Semi-transparent fills and sharp outlines help distinguish the groups without making the plots look crowded. Titles are centred and bold, and the axis labels beneath each ridge clarify exactly which indicator is being shown.</p>
<p>The patterns that emerge from these panels reinforce and nuance the story told by the scatterplot. Small states tend to concentrate at more favourable values for political stability and corruption, and they often have higher scores on the Liberal Democracy Index. At the same time, the change plots reveal that recent improvements in HDI and government effectiveness have not been uniformly stronger for small states. Many already-high performers have seen more modest gains, suggesting that their advantages reflect earlier progress as much as recent trends. The ridge plots therefore add depth to the analysis by showing that performance and change do not always align in simple ways.</p>
<h5 id="ridge-plots-no-legends">Ridge Plots (No Legends)</h5>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>make_ridge</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>data</span>, <span class='va'>var</span>, <span class='va'>title</span>, <span class='va'>xlab</span>, <span class='va'>show_y</span> <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>data</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='op'>{</span><span class='op'>{</span> <span class='va'>var</span> <span class='op'>}</span><span class='op'>}</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>         <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='op'>{</span><span class='op'>{</span> <span class='va'>var</span> <span class='op'>}</span><span class='op'>}</span>, y <span class='op'>=</span> <span class='va'>size3</span>, fill <span class='op'>=</span> <span class='va'>size3</span>, colour <span class='op'>=</span> <span class='va'>size3</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://wilkelab.org/ggridges/reference/geom_density_ridges.html'>geom_density_ridges</a></span><span class='op'>(</span>scale <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_fill_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"small states"</span>    <span class='op'>=</span> <span class='va'>col1a</span>,</span>
<span>                                 <span class='st'>"midsized states"</span> <span class='op'>=</span> <span class='va'>col3a</span>,</span>
<span>                                 <span class='st'>"big states"</span>      <span class='op'>=</span> <span class='va'>col2a</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_color_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"small states"</span>    <span class='op'>=</span> <span class='va'>col1</span>,</span>
<span>                                  <span class='st'>"midsized states"</span> <span class='op'>=</span> <span class='va'>col3</span>,</span>
<span>                                  <span class='st'>"big states"</span>      <span class='op'>=</span> <span class='va'>col2</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span>expand <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.01</span>, <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_discrete.html'>scale_y_discrete</a></span><span class='op'>(</span>expand <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.01</span>, <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title <span class='op'>=</span> <span class='va'>title</span>, x <span class='op'>=</span> <span class='va'>xlab</span>, y <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://wilkelab.org/ggridges/reference/theme_ridges.html'>theme_ridges</a></span><span class='op'>(</span>font_size <span class='op'>=</span> <span class='fl'>24</span>, grid <span class='op'>=</span> <span class='cn'>TRUE</span>, font_family <span class='op'>=</span> <span class='va'>base_font</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>      legend.position <span class='op'>=</span> <span class='st'>"none"</span>,</span>
<span>      plot.margin <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.1</span>, <span class='fl'>0.4</span>, <span class='fl'>0.1</span>, <span class='fl'>0.4</span><span class='op'>)</span>, <span class='st'>"lines"</span><span class='op'>)</span>,</span>
<span>      </span>
<span>      <span class='co'># ridge titles </span></span>
<span>      plot.title  <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>        colour <span class='op'>=</span> <span class='va'>dark.color</span>,</span>
<span>        size   <span class='op'>=</span> <span class='fl'>19</span>,</span>
<span>        face   <span class='op'>=</span> <span class='st'>"bold"</span>,</span>
<span>        hjust  <span class='op'>=</span> <span class='fl'>0.5</span></span>
<span>      <span class='op'>)</span>,</span>
<span>      </span>
<span>      plot.background <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>bg.col</span>, colour <span class='op'>=</span> <span class='va'>dark.color</span><span class='op'>)</span>,</span>
<span>      </span>
<span>      <span class='co'># y labels: big / midsized / small states</span></span>
<span>      axis.text.y <span class='op'>=</span> <span class='kw'>if</span> <span class='op'>(</span><span class='va'>show_y</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>        <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>          size  <span class='op'>=</span> <span class='fl'>19</span>,             </span>
<span>          face  <span class='op'>=</span> <span class='st'>"italic"</span>,</span>
<span>          family<span class='op'>=</span> <span class='va'>base_font</span>,</span>
<span>          hjust <span class='op'>=</span> <span class='fl'>0.5</span>    <span class='co'># a bit more centered against ridges</span></span>
<span>        <span class='op'>)</span></span>
<span>      <span class='op'>}</span> <span class='kw'>else</span> <span class='op'>{</span></span>
<span>        <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span>      <span class='op'>}</span>,</span>
<span>      </span>
<span>      axis.ticks.y  <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>      axis.title.y  <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>      </span>
<span>      <span class='co'># x-axis titles under each ridge</span></span>
<span>      axis.title.x  <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>        colour <span class='op'>=</span> <span class='va'>dark.color</span>,</span>
<span>        size   <span class='op'>=</span> <span class='fl'>26</span>,              </span>
<span>        hjust  <span class='op'>=</span> <span class='fl'>0.5</span>,</span>
<span>        vjust  <span class='op'>=</span> <span class='fl'>.60</span>,                <span class='co'># nudge away from axis a bit</span></span>
<span>        family <span class='op'>=</span> <span class='va'>base_font</span></span>
<span>      <span class='op'>)</span>,</span>
<span>      axis.text.x   <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>16</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_cartesian.html'>coord_cartesian</a></span><span class='op'>(</span>ylim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>7</span><span class='op'>)</span>, clip <span class='op'>=</span> <span class='st'>"off"</span><span class='op'>)</span></span>
<span><span class='op'>}</span></span>
<span></span>
<span><span class='va'>p_pol</span> <span class='op'>&lt;-</span> <span class='fu'>make_ridge</span><span class='op'>(</span></span>
<span>  <span class='va'>w1</span>, <span class='va'>polviol</span>,</span>
<span>  <span class='st'>"Small states tend to be more politically stable"</span>,</span>
<span>  <span class='st'>"Political stability (2017)"</span>,</span>
<span>  show_y <span class='op'>=</span> <span class='cn'>TRUE</span></span>
<span><span class='op'>)</span></span>
<span><span class='va'>p_pol</span></span></code></pre>
</div>
<img src="100502844_files/figure-html5/ridge-plot-1.png" width="100%" style="display: block; margin: auto;" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>p_cor</span> <span class='op'>&lt;-</span> <span class='fu'>make_ridge</span><span class='op'>(</span></span>
<span>  <span class='va'>w1</span>, <span class='va'>corupt</span>,</span>
<span>  <span class='st'>"and have lower levels of corruption"</span>,</span>
<span>  <span class='st'>"Control of Corruption (2017)"</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>p_cor</span></span></code></pre>
</div>
<img src="100502844_files/figure-html5/ridge-plot-2.png" width="100%" style="display: block; margin: auto;" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>p_free</span> <span class='op'>&lt;-</span> <span class='fu'>make_ridge</span><span class='op'>(</span></span>
<span>  <span class='va'>w1</span>, <span class='va'>freedom</span>,</span>
<span>  <span class='st'>"and enjoy more democratic freedoms"</span>,</span>
<span>  <span class='st'>"Liberal Democracy Index (2017)"</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>p_free</span></span></code></pre>
</div>
<img src="100502844_files/figure-html5/ridge-plot-3.png" width="100%" style="display: block; margin: auto;" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>p_hdi</span> <span class='op'>&lt;-</span> <span class='fu'>make_ridge</span><span class='op'>(</span></span>
<span>  <span class='va'>w1</span>, <span class='va'>hdi.c.0017</span>,</span>
<span>  <span class='st'>"But small states have improved less"</span>,</span>
<span>  <span class='st'>"Change in HDI, 2017–2000"</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>p_hdi</span></span></code></pre>
</div>
<img src="100502844_files/figure-html5/ridge-plot-4.png" width="100%" style="display: block; margin: auto;" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>p_gov</span> <span class='op'>&lt;-</span> <span class='fu'>make_ridge</span><span class='op'>(</span></span>
<span>  <span class='va'>w1</span>, <span class='va'>govef.c.12</span>,</span>
<span>  <span class='st'>"and have even lost some ground"</span>,</span>
<span>  <span class='st'>"Change in Government Effectiveness, 2017–2012"</span></span>
<span><span class='op'>)</span></span>
<span><span class='va'>p_gov</span></span></code></pre>
</div>
<p><img src="100502844_files/figure-html5/ridge-plot-5.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<h2 id="the-world-map-geographic-patterns-of-state-size">The World Map: Geographic Patterns of State Size</h2>
<p>The world map on the right-hand side of the top section introduces a spatial dimension to the figure. It shows where small, midsized, and big states are located, allowing the viewer to place the abstract relationships from the scatter and ridge plots into a geographic context.</p>
<p>The map uses a Robinson projection, which offers a visually balanced representation of the globe and avoids extreme distortions near the poles. This choice is particularly helpful for highlighting regions with many small states, such as the Caribbean, the Pacific, and the Indian Ocean. Using data from the rnaturalearth package, each country polygon is joined with its population-based size classification and shaded accordingly. States for which classification is not available appear in white, rather than being forced into an arbitrary group.</p>
<p>The design of the map is intentionally minimalist. There are no axes, legends, or additional overlays. Instead, it relies on the same colour scheme used elsewhere in the figure, so viewers can immediately recognise which areas are populated by small, midsized, or big states. The map’s role is not to provide new numerical information, but to show that these categories are widely spread across regions and not confined to one part of the world.</p>
<p>Several broad patterns become clear at a glance. Small states tend to cluster in island regions and along coastal areas. Midsized states are more evenly distributed across continents, while big states are heavily concentrated in parts of Africa, Asia, and the Americas. These spatial patterns underscore that population size is not neatly aligned with geography or level of development, reinforcing the argument that small states form a diverse and globally dispersed group.</p>
<h5 id="world-map-panel">World Map Panel</h5>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>world_sf</span> <span class='op'>&lt;-</span> <span class='fu'>rnaturalearth</span><span class='fu'>::</span><span class='fu'><a href='https://docs.ropensci.org/rnaturalearth/reference/ne_countries.html'>ne_countries</a></span><span class='op'>(</span></span>
<span>  scale       <span class='op'>=</span> <span class='st'>"medium"</span>,</span>
<span>  returnclass <span class='op'>=</span> <span class='st'>"sf"</span></span>
<span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>iso3c <span class='op'>=</span> <span class='va'>iso_a3</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>w</span>, <span class='va'>iso3c</span>, <span class='va'>size</span><span class='op'>)</span>, by <span class='op'>=</span> <span class='st'>"iso3c"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_transform.html'>st_transform</a></span><span class='op'>(</span>crs <span class='op'>=</span> <span class='st'>"+proj=robin +ellps=WGS84"</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>p_map</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>world_sf</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>size</span><span class='op'>)</span>, colour <span class='op'>=</span> <span class='st'>"grey82"</span>, linewidth <span class='op'>=</span> <span class='fl'>0.1</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_fill_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>size_colors</span>, na.value <span class='op'>=</span> <span class='st'>"white"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_void</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    plot.background  <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>bg.col</span>, colour <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span>,</span>
<span>    panel.background <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>bg.col</span>, colour <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span>,</span>
<span>    legend.position  <span class='op'>=</span> <span class='st'>"none"</span>,</span>
<span>    plot.margin      <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span><span class='fl'>0.1</span>, <span class='fl'>0.1</span>, <span class='op'>-</span><span class='fl'>2</span>, <span class='fl'>0.1</span><span class='op'>)</span>  <span class='co'># tiny negative bottom margin</span></span>
<span>  <span class='op'>)</span></span>
<span><span class='va'>p_map</span></span></code></pre>
</div>
<p><img src="100502844_files/figure-html5/world-map-panel-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<h5 id="text-panels-for-bottom-section">Text Panels for Bottom Section</h5>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>p_bottom_left_text</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/lims.html'>xlim</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/lims.html'>ylim</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_void</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>    <span class='st'>"richtext"</span>,</span>
<span>    x <span class='op'>=</span> <span class='fl'>0</span>, y <span class='op'>=</span> <span class='fl'>0.4</span>,</span>
<span>    label  <span class='op'>=</span> <span class='va'>bottom_left_html</span>,</span>
<span>    hjust  <span class='op'>=</span> <span class='fl'>0</span>, vjust <span class='op'>=</span> <span class='fl'>0.5</span>,</span>
<span>    family <span class='op'>=</span> <span class='va'>base_font</span>,</span>
<span>    size   <span class='op'>=</span> <span class='fl'>10</span>,</span>
<span>    color  <span class='op'>=</span> <span class='va'>dark.color</span>,</span>
<span>    fill   <span class='op'>=</span> <span class='va'>bg.col</span>,</span>
<span>    label.color   <span class='op'>=</span> <span class='cn'>NA</span>,</span>
<span>    label.r       <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='st'>"pt"</span><span class='op'>)</span>,</span>
<span>    label.padding <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='st'>"pt"</span><span class='op'>)</span>,</span>
<span>    lineheight    <span class='op'>=</span> <span class='fl'>1.0</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>p_bottom_data_caption</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/lims.html'>xlim</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/lims.html'>ylim</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_void</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>    <span class='st'>"richtext"</span>,</span>
<span>    x <span class='op'>=</span> <span class='fl'>0</span>, y <span class='op'>=</span> <span class='fl'>0.5</span>,</span>
<span>    label  <span class='op'>=</span> <span class='va'>data_caption_html</span>,</span>
<span>    hjust  <span class='op'>=</span> <span class='fl'>0</span>, vjust <span class='op'>=</span> <span class='fl'>0.5</span>,</span>
<span>    family <span class='op'>=</span> <span class='va'>base_font</span>,</span>
<span>    size   <span class='op'>=</span> <span class='fl'>7.6</span>,</span>
<span>    color  <span class='op'>=</span> <span class='va'>dark.color</span>,</span>
<span>    fill   <span class='op'>=</span> <span class='va'>bg.col</span>,</span>
<span>    label.color   <span class='op'>=</span> <span class='cn'>NA</span>,</span>
<span>    label.r       <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='st'>"pt"</span><span class='op'>)</span>,</span>
<span>    label.padding <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='st'>"pt"</span><span class='op'>)</span>,</span>
<span>    lineheight    <span class='op'>=</span> <span class='fl'>1.05</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class='fu'><a href='https://wilkelab.org/cowplot/reference/plot_grid.html'>plot_grid</a></span><span class='op'>(</span><span class='va'>p_bottom_left_text</span>, <span class='va'>p_bottom_data_caption</span>, ncol <span class='op'>=</span> <span class='fl'>1</span>, rel_heights <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
<p><img src="100502844_files/figure-html5/bottom-text-panel-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<h2 id="assembling-the-composite-figure">Assembling the Composite Figure</h2>
<p>The final figure is not a single plot but a composite of multiple visual components. Assembling these into a coherent layout is itself an important part of the replication.</p>
<p>Using functions from cowplot, the scatter plot, world map, ridge-density panels, and annotation blocks are combined into a structured grid. The top row contains the scatter plot on the left and a vertical column on the right that houses the world map and two ridge plots. This arrangement mirrors the original design and keeps the main relationship between governance and human development at the centre of attention, with supporting context to the side.</p>
<p>The lower section of the figure hosts the remaining ridge plots, together with an explanatory text block and a concise data caption. The relative widths and heights of each row and column are tuned so that no panel dominates the others and the viewer’s eye naturally flows from the main scatter plot to the distributions and then to the map and explanatory notes.</p>
<p>Consistent background colours and text styling are applied across all panels. At the very end, the saved image is passed through magick to add a clean border, giving the figure a polished appearance suitable for presentation or print. Because the layout is generated entirely within R, the composition can be modified or extended simply by changing the code, without any manual editing of images.</p>
<h5 id="combine-panels-with-cowplot">Combine Panels with CowPlot</h5>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>bottom_row_main</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://wilkelab.org/cowplot/reference/plot_grid.html'>plot_grid</a></span><span class='op'>(</span></span>
<span>  <span class='va'>p_bottom_left_text</span>,</span>
<span>  <span class='va'>p_pol</span>, <span class='va'>p_cor</span>, <span class='va'>p_free</span>,</span>
<span>  ncol <span class='op'>=</span> <span class='fl'>5</span>,</span>
<span>  rel_widths <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1.45</span>, <span class='fl'>1.4</span>, <span class='fl'>1.4</span>, <span class='fl'>1.4</span><span class='op'>)</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>bottom_row</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://wilkelab.org/cowplot/reference/plot_grid.html'>plot_grid</a></span><span class='op'>(</span></span>
<span>  <span class='va'>bottom_row_main</span>,</span>
<span>  <span class='va'>p_bottom_data_caption</span>,</span>
<span>  ncol <span class='op'>=</span> <span class='fl'>1</span>,</span>
<span>  rel_heights <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3</span>, <span class='fl'>1</span><span class='op'>)</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>right_col</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://wilkelab.org/cowplot/reference/plot_grid.html'>plot_grid</a></span><span class='op'>(</span></span>
<span>  <span class='va'>p_map</span>, <span class='va'>p_hdi</span>, <span class='va'>p_gov</span>,</span>
<span>  ncol        <span class='op'>=</span> <span class='fl'>1</span>,</span>
<span>  rel_heights <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>1</span><span class='op'>)</span>  </span>
<span><span class='op'>)</span></span>
<span><span class='va'>top_section</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://wilkelab.org/cowplot/reference/plot_grid.html'>plot_grid</a></span><span class='op'>(</span></span>
<span>  <span class='va'>p_scatter</span>, <span class='va'>right_col</span>,</span>
<span>  ncol <span class='op'>=</span> <span class='fl'>2</span>,</span>
<span>  rel_widths <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3</span>, <span class='fl'>1</span><span class='op'>)</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>final_plot</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://wilkelab.org/cowplot/reference/plot_grid.html'>plot_grid</a></span><span class='op'>(</span></span>
<span>  <span class='va'>top_section</span>, <span class='va'>bottom_row</span>,</span>
<span>  ncol <span class='op'>=</span> <span class='fl'>1</span>,</span>
<span>  rel_heights <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>4</span>, <span class='fl'>1.2</span><span class='op'>)</span></span>
<span><span class='op'>)</span></span>
<span><span class='va'>final_plot</span></span></code></pre>
</div>
<p><img src="100502844_files/figure-html5/assamble-figure-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<h3 id="conclusion-and-reflections">Conclusion and Reflections</h3>
<p>This project brings together several strands of computational social science: systematic data collection, reproducible workflows, careful data preparation, and thoughtful visual design. Rebuilding the “Small States Can Be Big Players in Development and Good Governance” figure required more than copying its appearance. It meant reconstructing its logic, from data sources and indicator definitions to grouping rules and layout choices.</p>
<p>Substantively, the replicated visualization reinforces the idea that small states often occupy a surprisingly strong position in global development. Many of them combine high human development with effective, stable, and democratic institutions. At the same time, the distribution and change plots show that progress has been uneven and that some of these advantages reflect earlier gains rather than rapid recent improvements. The multi-panel design encourages readers to think about state performance in a more nuanced way, linking levels and trajectories, outcomes and geography.</p>
<p>Methodologically, the project illustrates the value of open data and scripted analysis. Every transformation—from the first API call to the final composite plot—is recorded in the code, making the results easy to reproduce, critique, or adapt. The experience also highlights how much design matters: clear colour schemes, consistent typography, and sensible layout decisions are essential for turning complex data into an accessible story.</p>
<p>Taken together, the replication demonstrates how data, code, and visualization can work together to produce insights about the global distribution of development and governance. It shows that careful replication is not simply an exercise in copying, but a way to deepen understanding of both the underlying phenomena and the tools used to study them.</p>
<h2 id="extended-analysis-democratic-governance-human-development-and-low-carbon-development-19902022">Extended Analysis: Democratic Governance, Human Development and Low-Carbon Development (1990–2022)</h2>
<p>The second part of this report presents an expanded and substantially updated version of the original replication. While the first section reproduced the visual design and data choices of the World Data Visualization Prize entry, this new version builds a broader empirical foundation, strengthens the statistical modelling, and incorporates a much wider temporal range. The goal is to evaluate how democratic governance, carbon emissions and human development interact over time, and to examine whether small states remain distinctive once richer data and more flexible methods are introduced.</p>
<p>The extended version replaces the static HDI and governance datasets with continuously updated sources. Human development is now obtained directly from the UNDP Human Development Data API, which provides consistent country-year series from 1990 to 2022. Carbon emissions come from the official Our World in Data repository, which includes both total emissions and per-capita measures. Democracy is measured using the V-Dem v14 Liberal Democracy Index, a large improvement over the single governance measures used previously, and governance quality is drawn from the World Governance Indicators series. Population data continue to come from the World Bank, but are now used to classify states more transparently into small, midsized and big groups based on their most recent population. Countries below five million residents are treated as “small states”, those between five and thirty-five million as “midsized”, and those above thirty-five million as “big”. These classifications remain stable over time and are used consistently across modelling and visualisation.</p>
<p>Instead of analysing a single cross-section, the new version uses the full 1990–2022 period to construct two snapshots for every country: a baseline early-2000s value and the latest available value. From these, it is possible to derive meaningful changes in human development, emissions and democracy. Pairing these changes produces absolute and relative measures of “decoupling”—that is, whether development has risen while emissions have fallen, and whether the growth in HDI has outpaced the growth in CO₂ per capita. These measures reveal which states have managed to achieve genuine sustainability improvements over the past three decades, and how small states compare to larger ones.</p>
<p>The central methodological improvement is the use of a generalised additive model (GAM) rather than a linear specification. A single straight line between HDI and the logarithm of CO₂ per capita hides important non-linearities: wealthy countries often become more efficient at higher levels of development, while low-income countries vary widely in emissions pathways. By estimating separate smooth functions for small, midsized and big states, the GAM allows the relationship between development and emissions to differ across groups. Model comparison shows that the GAM fits the data markedly better than a linear model, with lower AIC and higher explained variance. This approach offers a more faithful representation of cross-national heterogeneity and strengthens the substantive interpretation of the results.</p>
<p>The new visual design reflects these methodological choices. The main scatterplot now overlays GAM curves and 95% confidence ribbons for each size category, adds labelled trajectory arrows showing how specific countries moved between 1990 and 2022, and uses both colour and transparency to communicate multiple dimensions simultaneously: colour represents population size, transparency reflects democracy levels, and point size represents population magnitude. The map panel has been rewritten to include microstates that cannot be represented using polygons; instead, these states appear as proportional points, ensuring they are not visually erased. Three distribution panels present the cross-sectional densities of democracy, CO₂ emissions and HDI across size groups, making it easier to compare overall differences rather than relying solely on scatterplot impressions. An efficiency panel shows both absolute emissions and a robust measure of “HDI per unit CO₂”, which highlights how states convert emissions into development outcomes.</p>
<p>Each of these additions is intended not only to update the data, but also to provide a more complete account of what distinguishes small states within the global landscape of development and sustainability. When longer time-series, richer democracy measures and more flexible modelling are incorporated, the basic narrative from the original replication still holds: small states tend to be more democratic and less carbon-intensive than large states, even after three decades of global change. What the extended analysis adds is a higher-resolution understanding of why this occurs. Many small states maintain stable or improving democracy while simultaneously improving their development–emissions balance. Midsized states often emerge as the most “efficient” developers in terms of HDI per unit CO₂, whereas big states show much greater dispersion and include both high-emission energy exporters and major developing economies.</p>
<p>The extended version therefore stands as a comprehensive update to the original replication. It incorporates new data sources, a more robust modelling strategy, an explicit treatment of temporal change, and a refined visual grammar that supports a deeper and more accurate interpretation of global sustainability trajectories. The accompanying master script, presented in full below, executes the entire workflow from raw data retrieval to final multi-panel layout.<br />
</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/base/message.html'>suppressPackageStartupMessages</a></span><span class='op'>(</span><span class='op'>{</span></span>
<span>  <span class='co'># Core</span></span>
<span>  <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span></span>
<span>  <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/sfirke/janitor'>janitor</a></span><span class='op'>)</span></span>
<span>  </span>
<span>  <span class='co'># Data access</span></span>
<span>  <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://httr2.r-lib.org'>httr2</a></span><span class='op'>)</span></span>
<span>  <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://jeroen.r-universe.dev/jsonlite'>jsonlite</a></span><span class='op'>)</span></span>
<span>  <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://vincentarelbundock.github.io/WDI/'>WDI</a></span><span class='op'>)</span></span>
<span>  <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>vdemdata</span><span class='op'>)</span></span>
<span>  </span>
<span>  <span class='co'># Spatial</span></span>
<span>  <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://r-spatial.github.io/sf/'>sf</a></span><span class='op'>)</span></span>
<span>  <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://docs.ropensci.org/rnaturalearth/'>rnaturalearth</a></span><span class='op'>)</span></span>
<span>  <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://docs.ropensci.org/rnaturalearthdata/'>rnaturalearthdata</a></span><span class='op'>)</span></span>
<span>  </span>
<span>  <span class='co'># Visualisation</span></span>
<span>  <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://scales.r-lib.org'>scales</a></span><span class='op'>)</span></span>
<span>  <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://ggrepel.slowkow.com/'>ggrepel</a></span><span class='op'>)</span></span>
<span>  <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://wilkelab.org/ggtext/'>ggtext</a></span><span class='op'>)</span></span>
<span>  <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://wilkelab.org/ggridges/'>ggridges</a></span><span class='op'>)</span></span>
<span>  <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://patchwork.data-imaginist.com'>patchwork</a></span><span class='op'>)</span></span>
<span>  <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://wilkelab.org/cowplot/'>cowplot</a></span><span class='op'>)</span></span>
<span>  </span>
<span>  <span class='co'># Modelling</span></span>
<span>  <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>mgcv</span><span class='op'>)</span></span>
<span>  <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://broom.tidymodels.org/'>broom</a></span><span class='op'>)</span></span>
<span>  </span>
<span>  <span class='co'># Parallel</span></span>
<span>  <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/DavisVaughan/furrr'>furrr</a></span><span class='op'>)</span></span>
<span>  </span>
<span>  <span class='co'># Utilities</span></span>
<span>  <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://vincentarelbundock.github.io/countrycode/'>countrycode</a></span><span class='op'>)</span></span>
<span>  <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://glue.tidyverse.org/'>glue</a></span><span class='op'>)</span></span>
<span>  <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://docs.ropensci.org/magick/'>magick</a></span><span class='op'>)</span></span>
<span><span class='op'>}</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/base/files2.html'>dir.create</a></span><span class='op'>(</span><span class='st'>"data"</span>, showWarnings <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/files2.html'>dir.create</a></span><span class='op'>(</span><span class='st'>"data/cache"</span>, recursive <span class='op'>=</span> <span class='cn'>TRUE</span>, showWarnings <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<h5 id="visual-configuration">Visual Configuration</h5>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>col_small</span> <span class='op'>&lt;-</span> <span class='st'>"#EE7733"</span>  <span class='co'># Paul Tol – orange</span></span>
<span><span class='va'>col_mid</span>   <span class='op'>&lt;-</span> <span class='st'>"#009988"</span>  <span class='co'># teal</span></span>
<span><span class='va'>col_big</span>   <span class='op'>&lt;-</span> <span class='st'>"#0077BB"</span>  <span class='co'># blue</span></span>
<span><span class='va'>bg_col</span>    <span class='op'>&lt;-</span> <span class='st'>"#FFFBF5"</span>  <span class='co'># warm off-white</span></span>
<span><span class='va'>dark_col</span>  <span class='op'>&lt;-</span> <span class='st'>"#23233A"</span>  <span class='co'># dark text</span></span>
<span><span class='va'>ocean_col</span> <span class='op'>&lt;-</span> <span class='st'>"#F7FAFC"</span>  <span class='co'># light blue for ocean</span></span>
<span></span>
<span><span class='va'>size_colors</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>small <span class='op'>=</span> <span class='va'>col_small</span>, midsized <span class='op'>=</span> <span class='va'>col_mid</span>, big <span class='op'>=</span> <span class='va'>col_big</span><span class='op'>)</span></span>
<span><span class='va'>order_size</span>  <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"small"</span>, <span class='st'>"midsized"</span>, <span class='st'>"big"</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>base_font</span>  <span class='op'>&lt;-</span> <span class='st'>"sans"</span></span>
<span><span class='va'>title_size</span> <span class='op'>&lt;-</span> <span class='fl'>40</span></span>
<span></span>
<span><span class='va'>YEAR_START</span> <span class='op'>&lt;-</span> <span class='fl'>1990</span></span>
<span><span class='va'>YEAR_END</span>   <span class='op'>&lt;-</span> <span class='fl'>2022</span></span>
<span><span class='va'>BASE_YEAR</span>  <span class='op'>&lt;-</span> <span class='fl'>2000</span></span>
<span></span>
<span><span class='va'>SMALL_POP</span> <span class='op'>&lt;-</span> <span class='fl'>5e6</span>   <span class='co'># under 5M = small</span></span>
<span><span class='va'>MID_POP</span>   <span class='op'>&lt;-</span> <span class='fl'>35e6</span>  <span class='co'># 5–35M = midsized</span></span>
<span></span>
<span><span class='va'>DENSITY_ADJ</span> <span class='op'>&lt;-</span> <span class='fl'>1.2</span></span>
<span><span class='va'>DENS_ALPHA</span>  <span class='op'>&lt;-</span> <span class='fl'>0.65</span></span>
<span></span>
<span><span class='co'># HDR API </span></span>
<span><span class='va'>HDR_API_KEY</span> <span class='op'>&lt;-</span> <span class='st'>"HDR-fZ9iELU5pGPCjNEqQ4leuNbBAKHiDheO"</span></span>
<span><span class='va'>BATCH_SIZE</span>  <span class='op'>&lt;-</span> <span class='fl'>40</span></span>
<span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>123</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<h5 id="helper-functions">Helper Functions</h5>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>safe_request</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>url</span>,</span>
<span>                         <span class='va'>params</span>      <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>                         <span class='va'>max_retries</span> <span class='op'>=</span> <span class='fl'>3</span>,</span>
<span>                         <span class='va'>cache_file</span>  <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>  <span class='co'># Optional: use cached result if available</span></span>
<span>  <span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NULL.html'>is.null</a></span><span class='op'>(</span><span class='va'>cache_file</span><span class='op'>)</span> <span class='op'>&amp;&amp;</span> <span class='fu'><a href='https://rdrr.io/r/base/files.html'>file.exists</a></span><span class='op'>(</span><span class='va'>cache_file</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>    <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>readRDS</a></span><span class='op'>(</span><span class='va'>cache_file</span><span class='op'>)</span><span class='op'>)</span></span>
<span>  <span class='op'>}</span></span>
<span>  </span>
<span>  <span class='va'>result</span> <span class='op'>&lt;-</span> <span class='cn'>NULL</span></span>
<span>  </span>
<span>  <span class='kw'>for</span> <span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq_len</a></span><span class='op'>(</span><span class='va'>max_retries</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>    <span class='va'>result</span> <span class='op'>&lt;-</span> <span class='kw'><a href='https://rdrr.io/r/base/conditions.html'>tryCatch</a></span><span class='op'>(</span></span>
<span>      <span class='op'>{</span></span>
<span>        <span class='va'>req</span> <span class='op'>&lt;-</span> <span class='fu'>httr2</span><span class='fu'>::</span><span class='fu'><a href='https://httr2.r-lib.org/reference/request.html'>request</a></span><span class='op'>(</span><span class='va'>url</span><span class='op'>)</span></span>
<span>        </span>
<span>        <span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>params</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>          <span class='co'># expand named list of query params into ... for req_url_query()</span></span>
<span>          <span class='va'>req</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/do.call.html'>do.call</a></span><span class='op'>(</span><span class='fu'>httr2</span><span class='fu'>::</span><span class='va'><a href='https://httr2.r-lib.org/reference/req_url.html'>req_url_query</a></span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>req</span><span class='op'>)</span>, <span class='va'>params</span><span class='op'>)</span><span class='op'>)</span></span>
<span>        <span class='op'>}</span></span>
<span>        </span>
<span>        <span class='va'>resp</span> <span class='op'>&lt;-</span> <span class='va'>req</span> <span class='op'>|&gt;</span></span>
<span>          <span class='fu'>httr2</span><span class='fu'>::</span><span class='fu'><a href='https://httr2.r-lib.org/reference/req_retry.html'>req_retry</a></span><span class='op'>(</span>max_tries <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>          <span class='fu'>httr2</span><span class='fu'>::</span><span class='fu'><a href='https://httr2.r-lib.org/reference/req_timeout.html'>req_timeout</a></span><span class='op'>(</span><span class='fl'>30</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>          <span class='fu'>httr2</span><span class='fu'>::</span><span class='fu'><a href='https://httr2.r-lib.org/reference/req_perform.html'>req_perform</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span>        </span>
<span>        <span class='fu'>httr2</span><span class='fu'>::</span><span class='fu'><a href='https://httr2.r-lib.org/reference/resp_body_raw.html'>resp_body_json</a></span><span class='op'>(</span><span class='va'>resp</span>, simplifyVector <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span></span>
<span>      <span class='op'>}</span>,</span>
<span>      error <span class='op'>=</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>e</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>        <span class='kw'>if</span> <span class='op'>(</span><span class='va'>i</span> <span class='op'>==</span> <span class='va'>max_retries</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>          <span class='kw'><a href='https://rdrr.io/r/base/stop.html'>stop</a></span><span class='op'>(</span><span class='fu'>glue</span><span class='fu'>::</span><span class='fu'><a href='https://glue.tidyverse.org/reference/glue.html'>glue</a></span><span class='op'>(</span></span>
<span>           <span class='st'>"safe_request() failed after {max_retries} attempts: {e$message}"</span></span>
<span>          <span class='op'>)</span><span class='op'>)</span></span>
<span>        <span class='op'>}</span></span>
<span>        <span class='fu'><a href='https://rdrr.io/r/base/Sys.sleep.html'>Sys.sleep</a></span><span class='op'>(</span><span class='fl'>2</span><span class='op'>^</span><span class='va'>i</span><span class='op'>)</span></span>
<span>        <span class='cn'>NULL</span></span>
<span>      <span class='op'>}</span></span>
<span>    <span class='op'>)</span></span>
<span>    </span>
<span>    <span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NULL.html'>is.null</a></span><span class='op'>(</span><span class='va'>result</span><span class='op'>)</span><span class='op'>)</span> <span class='kw'>break</span></span>
<span>  <span class='op'>}</span></span>
<span>  </span>
<span>  <span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NULL.html'>is.null</a></span><span class='op'>(</span><span class='va'>cache_file</span><span class='op'>)</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NULL.html'>is.null</a></span><span class='op'>(</span><span class='va'>result</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>    <span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></span><span class='op'>(</span><span class='va'>result</span>, <span class='va'>cache_file</span><span class='op'>)</span></span>
<span>  <span class='op'>}</span></span>
<span>  </span>
<span>  <span class='va'>result</span></span>
<span><span class='op'>}</span></span>
<span></span>
<span><span class='va'>chunk_vector</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>size</span> <span class='op'>=</span> <span class='fl'>40L</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/split.html'>split</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>ceiling</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq_along</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>/</span> <span class='va'>size</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='op'>}</span></span>
<span></span>
<span><span class='va'>audit_join</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>left_df</span>, <span class='va'>right_df</span>, <span class='va'>by</span>, <span class='va'>join_name</span> <span class='op'>=</span> <span class='st'>"join"</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>left_df</span>, <span class='va'>right_df</span>, by <span class='op'>=</span> <span class='va'>by</span><span class='op'>)</span></span>
<span><span class='op'>}</span></span>
<span></span>
<span></span>
<span><span class='va'>theme_uc3m</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>grid</span> <span class='op'>=</span> <span class='cn'>TRUE</span>, <span class='va'>base_size</span> <span class='op'>=</span> <span class='fl'>42</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_minimal</a></span><span class='op'>(</span>base_family <span class='op'>=</span> <span class='va'>base_font</span>, base_size <span class='op'>=</span> <span class='va'>base_size</span><span class='op'>)</span> <span class='op'><a href='https://ggplot2.tidyverse.org/reference/get_theme.html'>%+replace%</a></span></span>
<span>    <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>      plot.background  <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>bg_col</span>, color <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span>,</span>
<span>      panel.background <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>bg_col</span>, color <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span>,</span>
<span>      text             <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='va'>dark_col</span><span class='op'>)</span>,</span>
<span>      </span>
<span>      plot.title <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>        size       <span class='op'>=</span> <span class='va'>title_size</span>,</span>
<span>        face       <span class='op'>=</span> <span class='st'>"bold"</span>,</span>
<span>        margin     <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>b <span class='op'>=</span> <span class='fl'>6</span><span class='op'>)</span>,</span>
<span>        lineheight <span class='op'>=</span> <span class='fl'>1.3</span></span>
<span>      <span class='op'>)</span>,</span>
<span>      plot.subtitle <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>        size       <span class='op'>=</span> <span class='va'>base_size</span> <span class='op'>+</span> <span class='fl'>1</span>,</span>
<span>        margin     <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>b <span class='op'>=</span> <span class='fl'>8</span><span class='op'>)</span>,</span>
<span>        lineheight <span class='op'>=</span> <span class='fl'>1.3</span></span>
<span>      <span class='op'>)</span>,</span>
<span>      plot.caption <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>        size       <span class='op'>=</span> <span class='va'>base_size</span> <span class='op'>-</span> <span class='fl'>1</span>,</span>
<span>        hjust      <span class='op'>=</span> <span class='fl'>0</span>,</span>
<span>        margin     <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>8</span><span class='op'>)</span>,</span>
<span>        lineheight <span class='op'>=</span> <span class='fl'>1.3</span>,</span>
<span>        color      <span class='op'>=</span> <span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org/reference/alpha.html'>alpha</a></span><span class='op'>(</span><span class='va'>dark_col</span>, <span class='fl'>0.7</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span>,</span>
<span>      </span>
<span>      <span class='co'># background grid lines thicker</span></span>
<span>      panel.grid.major <span class='op'>=</span> <span class='kw'>if</span> <span class='op'>(</span><span class='va'>grid</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>        <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_line</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"grey86"</span>, linewidth <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span></span>
<span>      <span class='op'>}</span> <span class='kw'>else</span> <span class='op'>{</span></span>
<span>        <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span>      <span class='op'>}</span>,</span>
<span>      panel.grid.minor <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>      </span>
<span>      <span class='co'>#axis titles + tick labels</span></span>
<span>      axis.title <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='va'>base_size</span> <span class='op'>+</span> <span class='fl'>8</span><span class='op'>)</span>,</span>
<span>      axis.text  <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='va'>base_size</span> <span class='op'>+</span> <span class='fl'>6</span><span class='op'>)</span>,</span>
<span>      </span>
<span>      axis.ticks <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_line</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"grey70"</span>, linewidth <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>,</span>
<span>      axis.ticks.length <span class='op'>=</span> <span class='fu'>grid</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>6</span>, <span class='st'>"pt"</span><span class='op'>)</span>,</span>
<span>      </span>
<span>      legend.position <span class='op'>=</span> <span class='st'>"none"</span>,</span>
<span>      plot.margin     <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span><span class='fl'>12</span>, <span class='fl'>12</span>, <span class='fl'>12</span>, <span class='fl'>12</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span></span>
<span><span class='op'>}</span></span></code></pre>
</div>
</div>
<h5 id="metadata">Metadata</h5>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>metadata</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span></span>
<span>  fetch_timestamp <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Sys.time.html'>Sys.time</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>  r_version       <span class='op'>=</span> <span class='va'>R.version.string</span>,</span>
<span>  year_range      <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>YEAR_START</span>, <span class='va'>YEAR_END</span><span class='op'>)</span>,</span>
<span>  errors          <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span><span class='op'>)</span></span></code></pre>
</div>
</div>
<h4 id="data-loding">Data Loding</h4>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'>#  HDI from HDRO API</span></span>
<span></span>
<span><span class='va'>hdr_base_url</span>    <span class='op'>&lt;-</span> <span class='st'>"https://hdrdata.org/api"</span></span>
<span><span class='va'>cache_countries</span> <span class='op'>&lt;-</span> <span class='st'>"data/cache/hdr_countries.rds"</span></span>
<span></span>
<span><span class='va'>countries_raw</span> <span class='op'>&lt;-</span> <span class='fu'>safe_request</span><span class='op'>(</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>hdr_base_url</span>, <span class='st'>"/Metadata/Countries"</span><span class='op'>)</span>,</span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>apikey <span class='op'>=</span> <span class='va'>HDR_API_KEY</span><span class='op'>)</span>,</span>
<span>  cache_file <span class='op'>=</span> <span class='va'>cache_countries</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>countries</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/as_tibble.html'>as_tibble</a></span><span class='op'>(</span><span class='va'>countries_raw</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/transmute.html'>transmute</a></span><span class='op'>(</span>iso3 <span class='op'>=</span> <span class='va'>code</span>, country_name_hdr <span class='op'>=</span> <span class='va'>name</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='fu'><a href='https://stringr.tidyverse.org/reference/str_detect.html'>str_detect</a></span><span class='op'>(</span><span class='va'>iso3</span>, <span class='st'>"^[A-Z]{3}$"</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span></span>
<span><span class='va'>years_string</span>    <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='va'>YEAR_START</span><span class='op'>:</span><span class='va'>YEAR_END</span>, collapse <span class='op'>=</span> <span class='st'>","</span><span class='op'>)</span></span>
<span><span class='va'>country_batches</span> <span class='op'>&lt;-</span> <span class='fu'>chunk_vector</span><span class='op'>(</span><span class='va'>countries</span><span class='op'>$</span><span class='va'>iso3</span>, <span class='va'>BATCH_SIZE</span><span class='op'>)</span></span>
<span></span>
<span></span>
<span><span class='fu'><a href='https://future.futureverse.org/reference/plan.html'>plan</a></span><span class='op'>(</span><span class='va'>multisession</span>, workers <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span></span>
<span><span class='va'>hdi_data_list</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://furrr.futureverse.org/reference/future_map.html'>future_map</a></span><span class='op'>(</span></span>
<span>  <span class='va'>country_batches</span>,</span>
<span>  <span class='kw'>function</span><span class='op'>(</span><span class='va'>batch</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>    <span class='fu'>safe_request</span><span class='op'>(</span></span>
<span>      <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>hdr_base_url</span>, <span class='st'>"/CompositeIndices/query"</span><span class='op'>)</span>,</span>
<span>      <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span></span>
<span>        apikey              <span class='op'>=</span> <span class='va'>HDR_API_KEY</span>,</span>
<span>        countryOrAggregation <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='va'>batch</span>, collapse <span class='op'>=</span> <span class='st'>","</span><span class='op'>)</span>,</span>
<span>        year                <span class='op'>=</span> <span class='va'>years_string</span>,</span>
<span>        indicator           <span class='op'>=</span> <span class='st'>"hdi"</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span></span>
<span>  <span class='op'>}</span>,</span>
<span>  .progress <span class='op'>=</span> <span class='cn'>TRUE</span>,</span>
<span>  .options  <span class='op'>=</span> <span class='fu'><a href='https://furrr.futureverse.org/reference/furrr_options.html'>furrr_options</a></span><span class='op'>(</span>seed <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span></span>
<span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://future.futureverse.org/reference/plan.html'>plan</a></span><span class='op'>(</span><span class='va'>sequential</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>hdi_data</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/bind_rows.html'>bind_rows</a></span><span class='op'>(</span><span class='fu'><a href='https://purrr.tidyverse.org/reference/map.html'>map</a></span><span class='op'>(</span><span class='va'>hdi_data_list</span>, <span class='va'>as_tibble</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://sfirke.github.io/janitor/reference/clean_names.html'>clean_names</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>hdi_clean</span> <span class='op'>&lt;-</span> <span class='va'>hdi_data</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/separate.html'>separate</a></span><span class='op'>(</span></span>
<span>    <span class='va'>country</span>,</span>
<span>    into   <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"iso3"</span>, <span class='st'>"country_from_series"</span><span class='op'>)</span>,</span>
<span>    sep    <span class='op'>=</span> <span class='st'>"\\s-\\s"</span>,</span>
<span>    remove <span class='op'>=</span> <span class='cn'>FALSE</span>,</span>
<span>    fill   <span class='op'>=</span> <span class='st'>"right"</span>,</span>
<span>    extra  <span class='op'>=</span> <span class='st'>"merge"</span></span>
<span>  <span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    iso3       <span class='op'>=</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_trim.html'>str_trim</a></span><span class='op'>(</span><span class='va'>iso3</span><span class='op'>)</span>,</span>
<span>    year       <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/integer.html'>as.integer</a></span><span class='op'>(</span><span class='va'>year</span><span class='op'>)</span>,</span>
<span>    hdi        <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/warning.html'>suppressWarnings</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>value</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>    hdi_source <span class='op'>=</span> <span class='st'>"HDRO_API"</span></span>
<span>  <span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_detect.html'>str_detect</a></span><span class='op'>(</span><span class='va'>iso3</span>, <span class='st'>"^[A-Z]{3}$"</span><span class='op'>)</span>,</span>
<span>    <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>year</span><span class='op'>)</span>,</span>
<span>    <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>hdi</span><span class='op'>)</span>,</span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/between.html'>between</a></span><span class='op'>(</span><span class='va'>hdi</span>, <span class='fl'>0</span>, <span class='fl'>1</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>iso3</span>, <span class='va'>year</span>, <span class='va'>hdi</span>, <span class='va'>hdi_source</span><span class='op'>)</span></span>
<span></span>
<span></span>
<span><span class='va'>metadata</span><span class='op'>$</span><span class='va'>hdi_fetch</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span></span>
<span>  n_countries    <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/n_distinct.html'>n_distinct</a></span><span class='op'>(</span><span class='va'>hdi_clean</span><span class='op'>$</span><span class='va'>iso3</span><span class='op'>)</span>,</span>
<span>  n_observations <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>hdi_clean</span><span class='op'>)</span>,</span>
<span>  year_range     <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/range.html'>range</a></span><span class='op'>(</span><span class='va'>hdi_clean</span><span class='op'>$</span><span class='va'>year</span><span class='op'>)</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># CO2 from Our World in Data </span></span>
<span></span>
<span><span class='va'>co2_url</span>   <span class='op'>&lt;-</span> <span class='st'>"https://raw.githubusercontent.com/owid/co2-data/master/owid-co2-data.csv"</span></span>
<span><span class='va'>cache_co2</span> <span class='op'>&lt;-</span> <span class='st'>"data/cache/owid_co2.rds"</span></span>
<span></span>
<span><span class='va'>co2_data</span> <span class='op'>&lt;-</span> <span class='kw'><a href='https://rdrr.io/r/base/conditions.html'>tryCatch</a></span><span class='op'>(</span></span>
<span>  <span class='op'>{</span></span>
<span>    <span class='va'>use_cache</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/files.html'>file.exists</a></span><span class='op'>(</span><span class='va'>cache_co2</span><span class='op'>)</span> <span class='op'>&amp;&amp;</span></span>
<span>      <span class='fu'><a href='https://rdrr.io/r/base/difftime.html'>difftime</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Sys.time.html'>Sys.time</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/file.info.html'>file.info</a></span><span class='op'>(</span><span class='va'>cache_co2</span><span class='op'>)</span><span class='op'>$</span><span class='va'>mtime</span>, units <span class='op'>=</span> <span class='st'>"hours"</span><span class='op'>)</span> <span class='op'>&lt;</span> <span class='fl'>24</span></span>
<span>    </span>
<span>    <span class='kw'>if</span> <span class='op'>(</span><span class='va'>use_cache</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>      <span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>readRDS</a></span><span class='op'>(</span><span class='va'>cache_co2</span><span class='op'>)</span></span>
<span>    <span class='op'>}</span> <span class='kw'>else</span> <span class='op'>{</span></span>
<span>      <span class='va'>data</span> <span class='op'>&lt;-</span> <span class='fu'>readr</span><span class='fu'>::</span><span class='fu'><a href='https://readr.tidyverse.org/reference/read_delim.html'>read_csv</a></span><span class='op'>(</span><span class='va'>co2_url</span>, show_col_types <span class='op'>=</span> <span class='cn'>FALSE</span>, progress <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span></span>
<span>      <span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></span><span class='op'>(</span><span class='va'>data</span>, <span class='va'>cache_co2</span><span class='op'>)</span></span>
<span>      <span class='va'>data</span></span>
<span>    <span class='op'>}</span></span>
<span>  <span class='op'>}</span>,</span>
<span>  error <span class='op'>=</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>e</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>    <span class='va'>metadata</span><span class='op'>$</span><span class='va'>errors</span><span class='op'>$</span><span class='va'>co2_fetch</span> <span class='op'>&lt;-</span> <span class='va'>e</span><span class='op'>$</span><span class='va'>message</span></span>
<span>    </span>
<span>    <span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/files.html'>file.exists</a></span><span class='op'>(</span><span class='va'>cache_co2</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>      <span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>readRDS</a></span><span class='op'>(</span><span class='va'>cache_co2</span><span class='op'>)</span></span>
<span>    <span class='op'>}</span> <span class='kw'>else</span> <span class='op'>{</span></span>
<span>      <span class='kw'><a href='https://rdrr.io/r/base/stop.html'>stop</a></span><span class='op'>(</span><span class='st'>"CO₂ data unavailable and no cache exists"</span><span class='op'>)</span></span>
<span>    <span class='op'>}</span></span>
<span>  <span class='op'>}</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>co2_clean</span> <span class='op'>&lt;-</span> <span class='va'>co2_data</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/transmute.html'>transmute</a></span><span class='op'>(</span></span>
<span>    iso3           <span class='op'>=</span> <span class='va'>iso_code</span>,</span>
<span>    year           <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/integer.html'>as.integer</a></span><span class='op'>(</span><span class='va'>year</span><span class='op'>)</span>,</span>
<span>    co2_per_capita <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/warning.html'>suppressWarnings</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>co2_per_capita</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>    co2_total      <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/warning.html'>suppressWarnings</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>co2</span><span class='op'>)</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_detect.html'>str_detect</a></span><span class='op'>(</span><span class='va'>iso3</span>, <span class='st'>"^[A-Z]{3}$"</span><span class='op'>)</span>,</span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/between.html'>between</a></span><span class='op'>(</span><span class='va'>year</span>, <span class='va'>YEAR_START</span>, <span class='va'>YEAR_END</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>metadata</span><span class='op'>$</span><span class='va'>co2_fetch</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span></span>
<span>  source_url      <span class='op'>=</span> <span class='va'>co2_url</span>,</span>
<span>  n_observations  <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>co2_clean</span><span class='op'>)</span>,</span>
<span>  cache_age_hours <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/difftime.html'>difftime</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Sys.time.html'>Sys.time</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/file.info.html'>file.info</a></span><span class='op'>(</span><span class='va'>cache_co2</span><span class='op'>)</span><span class='op'>$</span><span class='va'>mtime</span>, units <span class='op'>=</span> <span class='st'>"hours"</span><span class='op'>)</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span></span>
<span><span class='co'># Population from World Bank WDI </span></span>
<span></span>
<span><span class='va'>cache_pop</span> <span class='op'>&lt;-</span> <span class='st'>"data/cache/wdi_population.rds"</span></span>
<span></span>
<span><span class='va'>pop_data</span> <span class='op'>&lt;-</span> <span class='kw'><a href='https://rdrr.io/r/base/conditions.html'>tryCatch</a></span><span class='op'>(</span></span>
<span>  <span class='op'>{</span></span>
<span>    <span class='va'>use_cache</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/files.html'>file.exists</a></span><span class='op'>(</span><span class='va'>cache_pop</span><span class='op'>)</span> <span class='op'>&amp;&amp;</span></span>
<span>      <span class='fu'><a href='https://rdrr.io/r/base/difftime.html'>difftime</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Sys.time.html'>Sys.time</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/file.info.html'>file.info</a></span><span class='op'>(</span><span class='va'>cache_pop</span><span class='op'>)</span><span class='op'>$</span><span class='va'>mtime</span>, units <span class='op'>=</span> <span class='st'>"days"</span><span class='op'>)</span> <span class='op'>&lt;</span> <span class='fl'>7</span></span>
<span>    </span>
<span>    <span class='kw'>if</span> <span class='op'>(</span><span class='va'>use_cache</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>      <span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>readRDS</a></span><span class='op'>(</span><span class='va'>cache_pop</span><span class='op'>)</span></span>
<span>    <span class='op'>}</span> <span class='kw'>else</span> <span class='op'>{</span></span>
<span>      <span class='va'>data</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/WDI/man/WDI.html'>WDI</a></span><span class='op'>(</span></span>
<span>        country   <span class='op'>=</span> <span class='st'>"all"</span>,</span>
<span>        indicator <span class='op'>=</span> <span class='st'>"SP.POP.TOTL"</span>,</span>
<span>        start     <span class='op'>=</span> <span class='va'>YEAR_START</span>,</span>
<span>        end       <span class='op'>=</span> <span class='va'>YEAR_END</span>,</span>
<span>        extra     <span class='op'>=</span> <span class='cn'>FALSE</span></span>
<span>      <span class='op'>)</span></span>
<span>      <span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></span><span class='op'>(</span><span class='va'>data</span>, <span class='va'>cache_pop</span><span class='op'>)</span></span>
<span>      <span class='va'>data</span></span>
<span>    <span class='op'>}</span></span>
<span>  <span class='op'>}</span>,</span>
<span>  error <span class='op'>=</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>e</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>    <span class='va'>metadata</span><span class='op'>$</span><span class='va'>errors</span><span class='op'>$</span><span class='va'>wdi_fetch</span> <span class='op'>&lt;-</span> <span class='va'>e</span><span class='op'>$</span><span class='va'>message</span></span>
<span>    </span>
<span>    <span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/files.html'>file.exists</a></span><span class='op'>(</span><span class='va'>cache_pop</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>      <span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>readRDS</a></span><span class='op'>(</span><span class='va'>cache_pop</span><span class='op'>)</span></span>
<span>    <span class='op'>}</span> <span class='kw'>else</span> <span class='op'>{</span></span>
<span>      <span class='kw'><a href='https://rdrr.io/r/base/stop.html'>stop</a></span><span class='op'>(</span><span class='st'>"Population data unavailable and no cache exists"</span><span class='op'>)</span></span>
<span>    <span class='op'>}</span></span>
<span>  <span class='op'>}</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>pop_clean</span> <span class='op'>&lt;-</span> <span class='va'>pop_data</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://sfirke.github.io/janitor/reference/clean_names.html'>clean_names</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/transmute.html'>transmute</a></span><span class='op'>(</span></span>
<span>    iso2       <span class='op'>=</span> <span class='va'>iso2c</span>,</span>
<span>    iso3       <span class='op'>=</span> <span class='fu'><a href='https://vincentarelbundock.github.io/countrycode/reference/countrycode.html'>countrycode</a></span><span class='op'>(</span><span class='va'>iso2</span>, <span class='st'>"iso2c"</span>, <span class='st'>"iso3c"</span>, warn <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>,</span>
<span>    year       <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/integer.html'>as.integer</a></span><span class='op'>(</span><span class='va'>year</span><span class='op'>)</span>,</span>
<span>    population <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/warning.html'>suppressWarnings</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>sp_pop_totl</span><span class='op'>)</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>iso3</span><span class='op'>)</span>, <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>population</span><span class='op'>)</span>, <span class='va'>population</span> <span class='op'>&gt;</span> <span class='fl'>0</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>metadata</span><span class='op'>$</span><span class='va'>population_fetch</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span></span>
<span>  n_observations <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>pop_clean</span><span class='op'>)</span>,</span>
<span>  indicator      <span class='op'>=</span> <span class='st'>"SP.POP.TOTL"</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='co'>#V-Dem democracy </span></span>
<span></span>
<span><span class='va'>vdem_data</span> <span class='op'>&lt;-</span> <span class='va'>vdem</span></span>
<span></span>
<span><span class='va'>vdem_clean</span> <span class='op'>&lt;-</span> <span class='va'>vdem_data</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>year</span> <span class='op'>&gt;=</span> <span class='va'>YEAR_START</span>, <span class='va'>year</span> <span class='op'>&lt;=</span> <span class='va'>YEAR_END</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/transmute.html'>transmute</a></span><span class='op'>(</span></span>
<span>    iso3           <span class='op'>=</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/case.html'>str_to_upper</a></span><span class='op'>(</span><span class='va'>country_text_id</span><span class='op'>)</span>,</span>
<span>    country_vdem   <span class='op'>=</span> <span class='va'>country_name</span>,</span>
<span>    year           <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/integer.html'>as.integer</a></span><span class='op'>(</span><span class='va'>year</span><span class='op'>)</span>,</span>
<span>    freedom        <span class='op'>=</span> <span class='va'>v2x_libdem</span>,</span>
<span>    electoral_dem  <span class='op'>=</span> <span class='va'>v2x_polyarchy</span>,</span>
<span>    civil_liberties <span class='op'>=</span> <span class='va'>v2x_civlib</span></span>
<span>  <span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span></span>
<span>    <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>iso3</span><span class='op'>)</span>,</span>
<span>    <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_detect.html'>str_detect</a></span><span class='op'>(</span><span class='va'>iso3</span>, <span class='st'>"^[A-Z]{3}$"</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>metadata</span><span class='op'>$</span><span class='va'>vdem_fetch</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span></span>
<span>  n_observations <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>vdem_clean</span><span class='op'>)</span>,</span>
<span>  n_countries    <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/n_distinct.html'>n_distinct</a></span><span class='op'>(</span><span class='va'>vdem_clean</span><span class='op'>$</span><span class='va'>iso3</span><span class='op'>)</span>,</span>
<span>  year_range     <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/range.html'>range</a></span><span class='op'>(</span><span class='va'>vdem_clean</span><span class='op'>$</span><span class='va'>year</span><span class='op'>)</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># World Governance Indicators </span></span>
<span></span>
<span><span class='va'>cache_gov</span> <span class='op'>&lt;-</span> <span class='st'>"data/cache/wdi_governance.rds"</span></span>
<span><span class='va'>gov_indicators</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CC.EST"</span>, <span class='st'>"GE.EST"</span>, <span class='st'>"PV.EST"</span>, <span class='st'>"RL.EST"</span>, <span class='st'>"RQ.EST"</span>, <span class='st'>"VA.EST"</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>gov_data</span> <span class='op'>&lt;-</span> <span class='kw'><a href='https://rdrr.io/r/base/conditions.html'>tryCatch</a></span><span class='op'>(</span></span>
<span>  <span class='op'>{</span></span>
<span>    <span class='va'>use_cache</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/files.html'>file.exists</a></span><span class='op'>(</span><span class='va'>cache_gov</span><span class='op'>)</span> <span class='op'>&amp;&amp;</span></span>
<span>      <span class='fu'><a href='https://rdrr.io/r/base/difftime.html'>difftime</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Sys.time.html'>Sys.time</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/file.info.html'>file.info</a></span><span class='op'>(</span><span class='va'>cache_gov</span><span class='op'>)</span><span class='op'>$</span><span class='va'>mtime</span>, units <span class='op'>=</span> <span class='st'>"days"</span><span class='op'>)</span> <span class='op'>&lt;</span> <span class='fl'>7</span></span>
<span>    </span>
<span>    <span class='kw'>if</span> <span class='op'>(</span><span class='va'>use_cache</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>      <span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>readRDS</a></span><span class='op'>(</span><span class='va'>cache_gov</span><span class='op'>)</span></span>
<span>    <span class='op'>}</span> <span class='kw'>else</span> <span class='op'>{</span></span>
<span>      <span class='va'>data</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/WDI/man/WDI.html'>WDI</a></span><span class='op'>(</span></span>
<span>        country   <span class='op'>=</span> <span class='st'>"all"</span>,</span>
<span>        indicator <span class='op'>=</span> <span class='va'>gov_indicators</span>,</span>
<span>        start     <span class='op'>=</span> <span class='va'>YEAR_START</span>,</span>
<span>        end       <span class='op'>=</span> <span class='va'>YEAR_END</span>,</span>
<span>        extra     <span class='op'>=</span> <span class='cn'>FALSE</span></span>
<span>      <span class='op'>)</span></span>
<span>      <span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></span><span class='op'>(</span><span class='va'>data</span>, <span class='va'>cache_gov</span><span class='op'>)</span></span>
<span>      <span class='va'>data</span></span>
<span>    <span class='op'>}</span></span>
<span>  <span class='op'>}</span>,</span>
<span>  error <span class='op'>=</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>e</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>    <span class='va'>metadata</span><span class='op'>$</span><span class='va'>errors</span><span class='op'>$</span><span class='va'>governance_fetch</span> <span class='op'>&lt;-</span> <span class='va'>e</span><span class='op'>$</span><span class='va'>message</span></span>
<span>    </span>
<span>    <span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/files.html'>file.exists</a></span><span class='op'>(</span><span class='va'>cache_gov</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>      <span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>readRDS</a></span><span class='op'>(</span><span class='va'>cache_gov</span><span class='op'>)</span></span>
<span>    <span class='op'>}</span> <span class='kw'>else</span> <span class='op'>{</span></span>
<span>      <span class='kw'><a href='https://rdrr.io/r/base/stop.html'>stop</a></span><span class='op'>(</span><span class='st'>"Governance data unavailable and no cache exists"</span><span class='op'>)</span></span>
<span>    <span class='op'>}</span></span>
<span>  <span class='op'>}</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>gov_clean</span> <span class='op'>&lt;-</span> <span class='va'>gov_data</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://sfirke.github.io/janitor/reference/clean_names.html'>clean_names</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/transmute.html'>transmute</a></span><span class='op'>(</span></span>
<span>    iso2  <span class='op'>=</span> <span class='va'>iso2c</span>,</span>
<span>    iso3  <span class='op'>=</span> <span class='fu'><a href='https://vincentarelbundock.github.io/countrycode/reference/countrycode.html'>countrycode</a></span><span class='op'>(</span><span class='va'>iso2</span>, <span class='st'>"iso2c"</span>, <span class='st'>"iso3c"</span>, warn <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>,</span>
<span>    year  <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/integer.html'>as.integer</a></span><span class='op'>(</span><span class='va'>year</span><span class='op'>)</span>,</span>
<span>    control_corruption   <span class='op'>=</span> <span class='va'>cc_est</span>,</span>
<span>    govt_effectiveness   <span class='op'>=</span> <span class='va'>ge_est</span>,</span>
<span>    political_stability  <span class='op'>=</span> <span class='va'>pv_est</span>,</span>
<span>    rule_of_law          <span class='op'>=</span> <span class='va'>rl_est</span>,</span>
<span>    regulatory_quality   <span class='op'>=</span> <span class='va'>rq_est</span>,</span>
<span>    voice_accountability <span class='op'>=</span> <span class='va'>va_est</span></span>
<span>  <span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>iso3</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>metadata</span><span class='op'>$</span><span class='va'>governance_fetch</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span></span>
<span>  n_observations <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>gov_clean</span><span class='op'>)</span>,</span>
<span>  n_countries    <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/n_distinct.html'>n_distinct</a></span><span class='op'>(</span><span class='va'>gov_clean</span><span class='op'>$</span><span class='va'>iso3</span><span class='op'>)</span>,</span>
<span>  indicators     <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>gov_indicators</span><span class='op'>)</span></span>
<span><span class='op'>)</span></span></code></pre>
</div>
</div>
<h5 id="data-integration-deriver-variables">Data Integration &amp; Deriver Variables</h5>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>df</span> <span class='op'>&lt;-</span> <span class='fu'>audit_join</span><span class='op'>(</span></span>
<span>  <span class='va'>hdi_clean</span>,</span>
<span>  <span class='va'>co2_clean</span>,</span>
<span>  by        <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"iso3"</span>, <span class='st'>"year"</span><span class='op'>)</span>,</span>
<span>  join_name <span class='op'>=</span> <span class='st'>"HDI + CO₂"</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>df</span> <span class='op'>&lt;-</span> <span class='fu'>audit_join</span><span class='op'>(</span></span>
<span>  <span class='va'>df</span>,</span>
<span>  <span class='va'>pop_clean</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>iso3</span>, <span class='va'>year</span>, <span class='va'>population</span><span class='op'>)</span>,</span>
<span>  by        <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"iso3"</span>, <span class='st'>"year"</span><span class='op'>)</span>,</span>
<span>  join_name <span class='op'>=</span> <span class='st'>"Add population"</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>df</span> <span class='op'>&lt;-</span> <span class='fu'>audit_join</span><span class='op'>(</span></span>
<span>  <span class='va'>df</span>,</span>
<span>  <span class='va'>vdem_clean</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>iso3</span>, <span class='va'>year</span>, <span class='va'>freedom</span>, <span class='va'>electoral_dem</span>, <span class='va'>civil_liberties</span><span class='op'>)</span>,</span>
<span>  by        <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"iso3"</span>, <span class='st'>"year"</span><span class='op'>)</span>,</span>
<span>  join_name <span class='op'>=</span> <span class='st'>"Add V-Dem"</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>df</span> <span class='op'>&lt;-</span> <span class='fu'>audit_join</span><span class='op'>(</span></span>
<span>  <span class='va'>df</span>,</span>
<span>  <span class='va'>gov_clean</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span></span>
<span>    <span class='va'>iso3</span>, <span class='va'>year</span>,</span>
<span>    <span class='va'>control_corruption</span>, <span class='va'>govt_effectiveness</span>,</span>
<span>    <span class='va'>political_stability</span>, <span class='va'>rule_of_law</span></span>
<span>  <span class='op'>)</span>,</span>
<span>  by        <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"iso3"</span>, <span class='st'>"year"</span><span class='op'>)</span>,</span>
<span>  join_name <span class='op'>=</span> <span class='st'>"Add governance"</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>df</span> <span class='op'>&lt;-</span> <span class='fu'>audit_join</span><span class='op'>(</span></span>
<span>  <span class='va'>df</span>,</span>
<span>  <span class='va'>countries</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename</a></span><span class='op'>(</span>country <span class='op'>=</span> <span class='va'>country_name_hdr</span><span class='op'>)</span>,</span>
<span>  by        <span class='op'>=</span> <span class='st'>"iso3"</span>,</span>
<span>  join_name <span class='op'>=</span> <span class='st'>"Add country names"</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>df</span> <span class='op'>&lt;-</span> <span class='va'>df</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    co2_per_capita <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/coalesce.html'>coalesce</a></span><span class='op'>(</span><span class='va'>co2_per_capita</span>, <span class='va'>co2_total</span> <span class='op'>/</span> <span class='va'>population</span><span class='op'>)</span>,</span>
<span>    co2_per_capita <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>pmax</a></span><span class='op'>(</span><span class='va'>co2_per_capita</span>, <span class='fl'>0</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,</span>
<span>    co2pc_log1p    <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log1p</a></span><span class='op'>(</span><span class='va'>co2_per_capita</span><span class='op'>)</span>,</span>
<span>    hdi_per_co2    <span class='op'>=</span> <span class='va'>hdi</span> <span class='op'>/</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>pmax</a></span><span class='op'>(</span><span class='va'>co2_per_capita</span>, <span class='va'>.Machine</span><span class='op'>$</span><span class='va'>double.eps</span><span class='op'>)</span>,</span>
<span>    democracy_level <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span></span>
<span>      <span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>freedom</span><span class='op'>)</span>      <span class='op'>~</span> <span class='cn'>NA_character_</span>,</span>
<span>      <span class='va'>freedom</span> <span class='op'>&gt;=</span> <span class='fl'>0.75</span>     <span class='op'>~</span> <span class='st'>"Highly Democratic"</span>,</span>
<span>      <span class='va'>freedom</span> <span class='op'>&gt;=</span> <span class='fl'>0.50</span>     <span class='op'>~</span> <span class='st'>"Partly Democratic"</span>,</span>
<span>      <span class='va'>freedom</span> <span class='op'>&gt;=</span> <span class='fl'>0.25</span>     <span class='op'>~</span> <span class='st'>"Hybrid Regime"</span>,</span>
<span>      <span class='cn'>TRUE</span>                <span class='op'>~</span> <span class='st'>"Autocratic"</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    democracy_level <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span></span>
<span>      <span class='va'>democracy_level</span>,</span>
<span>      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Highly Democratic"</span>, <span class='st'>"Partly Democratic"</span>, <span class='st'>"Hybrid Regime"</span>, <span class='st'>"Autocratic"</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    is_democratic <span class='op'>=</span> <span class='va'>freedom</span> <span class='op'>&gt;=</span> <span class='fl'>0.5</span></span>
<span>  <span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/distinct.html'>distinct</a></span><span class='op'>(</span><span class='va'>iso3</span>, <span class='va'>year</span>, .keep_all <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<h5 id="size-groups-snapshots-decoupling">Size Groups, Snapshots &amp; Decoupling</h5>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'>#  Size groups </span></span>
<span></span>
<span><span class='va'>pop_latest</span> <span class='op'>&lt;-</span> <span class='va'>df</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>population</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>iso3</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>year</span> <span class='op'>==</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>year</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>ungroup</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/transmute.html'>transmute</a></span><span class='op'>(</span></span>
<span>    <span class='va'>iso3</span>,</span>
<span>    pop_latest <span class='op'>=</span> <span class='va'>population</span>,</span>
<span>    size_group <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span></span>
<span>      <span class='va'>pop_latest</span> <span class='op'>&lt;</span>  <span class='va'>SMALL_POP</span> <span class='op'>~</span> <span class='st'>"small"</span>,</span>
<span>      <span class='va'>pop_latest</span> <span class='op'>&lt;=</span> <span class='va'>MID_POP</span>   <span class='op'>~</span> <span class='st'>"midsized"</span>,</span>
<span>      <span class='cn'>TRUE</span>                    <span class='op'>~</span> <span class='st'>"big"</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    size_group <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>size_group</span>, levels <span class='op'>=</span> <span class='va'>order_size</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/distinct.html'>distinct</a></span><span class='op'>(</span><span class='va'>iso3</span>, .keep_all <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>df</span> <span class='op'>&lt;-</span> <span class='va'>df</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>pop_latest</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>iso3</span>, <span class='va'>size_group</span>, <span class='va'>pop_latest</span><span class='op'>)</span>, by <span class='op'>=</span> <span class='st'>"iso3"</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>pop_latest</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/count.html'>count</a></span><span class='op'>(</span><span class='va'>size_group</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>pct <span class='op'>=</span> <span class='fu'><a href='https://scales.r-lib.org/reference/percent_format.html'>percent</a></span><span class='op'>(</span><span class='va'>n</span> <span class='op'>/</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span>, <span class='fl'>0.1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code># A tibble: 3 × 3
  size_group     n pct  
  &lt;fct&gt;      &lt;int&gt; &lt;chr&gt;
1 small         70 36.3%
2 midsized      81 42.0%
3 big           42 21.8%</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Latest snapshot</span></span>
<span></span>
<span><span class='va'>df_latest</span> <span class='op'>&lt;-</span> <span class='va'>df</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>hdi</span><span class='op'>)</span>, <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>co2_per_capita</span><span class='op'>)</span>, <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>population</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>iso3</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>year</span> <span class='op'>==</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>year</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>ungroup</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/transmute.html'>transmute</a></span><span class='op'>(</span></span>
<span>    <span class='va'>iso3</span>,</span>
<span>    <span class='va'>country</span>,</span>
<span>    <span class='va'>size_group</span>,</span>
<span>    <span class='va'>hdi_source</span>,</span>
<span>    year_latest        <span class='op'>=</span> <span class='va'>year</span>,</span>
<span>    hdi_latest         <span class='op'>=</span> <span class='va'>hdi</span>,</span>
<span>    co2pc_latest       <span class='op'>=</span> <span class='va'>co2_per_capita</span>,</span>
<span>    co2log_latest      <span class='op'>=</span> <span class='va'>co2pc_log1p</span>,</span>
<span>    pop_latest         <span class='op'>=</span> <span class='va'>population</span>,</span>
<span>    hdi_per_co2_latest <span class='op'>=</span> <span class='va'>hdi_per_co2</span>,</span>
<span>    freedom_latest     <span class='op'>=</span> <span class='va'>freedom</span>,</span>
<span>    democracy_level_latest <span class='op'>=</span> <span class='va'>democracy_level</span>,</span>
<span>    is_democratic_latest   <span class='op'>=</span> <span class='va'>is_democratic</span>,</span>
<span>    govt_effectiveness_latest  <span class='op'>=</span> <span class='va'>govt_effectiveness</span>,</span>
<span>    control_corruption_latest  <span class='op'>=</span> <span class='va'>control_corruption</span>,</span>
<span>    political_stability_latest <span class='op'>=</span> <span class='va'>political_stability</span></span>
<span>  <span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/distinct.html'>distinct</a></span><span class='op'>(</span><span class='va'>iso3</span>, .keep_all <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Baseline snapshot </span></span>
<span></span>
<span><span class='va'>df_base</span> <span class='op'>&lt;-</span> <span class='va'>df</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>year</span> <span class='op'>&gt;=</span> <span class='va'>BASE_YEAR</span>, <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>hdi</span><span class='op'>)</span>, <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>co2_per_capita</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>iso3</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>year</span> <span class='op'>==</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>year</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>ungroup</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/transmute.html'>transmute</a></span><span class='op'>(</span></span>
<span>    <span class='va'>iso3</span>,</span>
<span>    year_base   <span class='op'>=</span> <span class='va'>year</span>,</span>
<span>    hdi_base    <span class='op'>=</span> <span class='va'>hdi</span>,</span>
<span>    co2pc_base  <span class='op'>=</span> <span class='va'>co2_per_capita</span>,</span>
<span>    freedom_base <span class='op'>=</span> <span class='va'>freedom</span></span>
<span>  <span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/distinct.html'>distinct</a></span><span class='op'>(</span><span class='va'>iso3</span>, .keep_all <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Deltas &amp; decoupling </span></span>
<span></span>
<span><span class='va'>df_delta</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>inner_join</a></span><span class='op'>(</span><span class='va'>df_latest</span>, <span class='va'>df_base</span>, by <span class='op'>=</span> <span class='st'>"iso3"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    d_hdi        <span class='op'>=</span> <span class='va'>hdi_latest</span> <span class='op'>-</span> <span class='va'>hdi_base</span>,</span>
<span>    d_co2pc      <span class='op'>=</span> <span class='va'>co2pc_latest</span> <span class='op'>-</span> <span class='va'>co2pc_base</span>,</span>
<span>    d_freedom    <span class='op'>=</span> <span class='va'>freedom_latest</span> <span class='op'>-</span> <span class='va'>freedom_base</span>,</span>
<span>    years_elapsed <span class='op'>=</span> <span class='va'>year_latest</span> <span class='op'>-</span> <span class='va'>year_base</span>,</span>
<span>    abs_decouple  <span class='op'>=</span> <span class='va'>d_hdi</span> <span class='op'>&gt;</span> <span class='fl'>0</span> <span class='op'>&amp;</span> <span class='va'>d_co2pc</span> <span class='op'>&lt;</span> <span class='fl'>0</span>,</span>
<span>    rel_decouple  <span class='op'>=</span> <span class='op'>(</span><span class='va'>hdi_latest</span> <span class='op'>/</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>pmax</a></span><span class='op'>(</span><span class='va'>hdi_base</span>, <span class='va'>.Machine</span><span class='op'>$</span><span class='va'>double.eps</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>&gt;</span></span>
<span>      <span class='op'>(</span><span class='va'>co2pc_latest</span> <span class='op'>/</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>pmax</a></span><span class='op'>(</span><span class='va'>co2pc_base</span>, <span class='va'>.Machine</span><span class='op'>$</span><span class='va'>double.eps</span><span class='op'>)</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>decouple_summary</span> <span class='op'>&lt;-</span> <span class='va'>df_delta</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>size_group</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>size_group</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span></span>
<span>    n            <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>n</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    n_decouple   <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>abs_decouple</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,</span>
<span>    pct_decouple <span class='op'>=</span> <span class='fu'><a href='https://scales.r-lib.org/reference/percent_format.html'>percent</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>abs_decouple</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>, <span class='fl'>0.1</span><span class='op'>)</span>,</span>
<span>    rel_decouple <span class='op'>=</span> <span class='fu'><a href='https://scales.r-lib.org/reference/percent_format.html'>percent</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>rel_decouple</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>, <span class='fl'>0.1</span><span class='op'>)</span>,</span>
<span>    .groups      <span class='op'>=</span> <span class='st'>"drop"</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>decouple_summary</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code># A tibble: 3 × 5
  size_group     n n_decouple pct_decouple rel_decouple
  &lt;fct&gt;      &lt;int&gt;      &lt;int&gt; &lt;chr&gt;        &lt;chr&gt;       
1 small         70         22 31.4%        35.7%       
2 midsized      81         29 35.8%        46.9%       
3 big           42         16 38.1%        45.2%       </code></pre>
</div>
<h5 id="modeling-lm-gam-group-tests-narrative-stats">Modeling (LM, GAM, GROUP TESTS, NARRATIVE STATS)</h5>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'>#  Modelling dataset </span></span>
<span></span>
<span><span class='va'>df_model</span> <span class='op'>&lt;-</span> <span class='va'>df_latest</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span></span>
<span>    <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>hdi_latest</span><span class='op'>)</span>,</span>
<span>    <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>co2log_latest</span><span class='op'>)</span>,</span>
<span>    <span class='fu'><a href='https://rdrr.io/r/base/is.finite.html'>is.finite</a></span><span class='op'>(</span><span class='va'>co2log_latest</span><span class='op'>)</span>,</span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/between.html'>between</a></span><span class='op'>(</span><span class='va'>hdi_latest</span>, <span class='fl'>0.30</span>, <span class='fl'>1.00</span><span class='op'>)</span>,</span>
<span>    <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>size_group</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='co'># Descriptive stats for narrative</span></span>
<span></span>
<span><span class='va'>freedom_by_size</span> <span class='op'>&lt;-</span> <span class='va'>df_model</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>freedom_latest</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>size_group</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span></span>
<span>    n              <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>n</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    median_freedom <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/median.html'>median</a></span><span class='op'>(</span><span class='va'>freedom_latest</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,</span>
<span>    mean_freedom   <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>freedom_latest</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,</span>
<span>    sd_freedom     <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/sd.html'>sd</a></span><span class='op'>(</span><span class='va'>freedom_latest</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,</span>
<span>    .groups        <span class='op'>=</span> <span class='st'>"drop"</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>co2_by_size</span> <span class='op'>&lt;-</span> <span class='va'>df_model</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>size_group</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span></span>
<span>    n          <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>n</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    median_co2 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/median.html'>median</a></span><span class='op'>(</span><span class='va'>co2pc_latest</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,</span>
<span>    mean_co2   <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>co2pc_latest</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,</span>
<span>    sd_co2     <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/sd.html'>sd</a></span><span class='op'>(</span><span class='va'>co2pc_latest</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,</span>
<span>    .groups    <span class='op'>=</span> <span class='st'>"drop"</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='co'># small vs big, assuming order_size c("small","midsized","big")</span></span>
<span></span>
<span><span class='va'>freedom_diff_pct</span> <span class='op'>&lt;-</span> <span class='op'>(</span></span>
<span>  <span class='op'>(</span><span class='va'>freedom_by_size</span><span class='op'>$</span><span class='va'>median_freedom</span><span class='op'>[</span><span class='va'>freedom_by_size</span><span class='op'>$</span><span class='va'>size_group</span> <span class='op'>==</span> <span class='st'>"small"</span><span class='op'>]</span> <span class='op'>-</span></span>
<span>     <span class='va'>freedom_by_size</span><span class='op'>$</span><span class='va'>median_freedom</span><span class='op'>[</span><span class='va'>freedom_by_size</span><span class='op'>$</span><span class='va'>size_group</span> <span class='op'>==</span> <span class='st'>"big"</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>/</span></span>
<span>    <span class='va'>freedom_by_size</span><span class='op'>$</span><span class='va'>median_freedom</span><span class='op'>[</span><span class='va'>freedom_by_size</span><span class='op'>$</span><span class='va'>size_group</span> <span class='op'>==</span> <span class='st'>"big"</span><span class='op'>]</span></span>
<span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>100</span></span>
<span></span>
<span><span class='va'>co2_diff_pct</span> <span class='op'>&lt;-</span> <span class='op'>(</span></span>
<span>  <span class='op'>(</span><span class='va'>co2_by_size</span><span class='op'>$</span><span class='va'>median_co2</span><span class='op'>[</span><span class='va'>co2_by_size</span><span class='op'>$</span><span class='va'>size_group</span> <span class='op'>==</span> <span class='st'>"big"</span><span class='op'>]</span> <span class='op'>-</span></span>
<span>     <span class='va'>co2_by_size</span><span class='op'>$</span><span class='va'>median_co2</span><span class='op'>[</span><span class='va'>co2_by_size</span><span class='op'>$</span><span class='va'>size_group</span> <span class='op'>==</span> <span class='st'>"small"</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>/</span></span>
<span>    <span class='va'>co2_by_size</span><span class='op'>$</span><span class='va'>median_co2</span><span class='op'>[</span><span class='va'>co2_by_size</span><span class='op'>$</span><span class='va'>size_group</span> <span class='op'>==</span> <span class='st'>"big"</span><span class='op'>]</span></span>
<span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>100</span></span>
<span></span>
<span><span class='co'># Correlation democracy–CO2</span></span>
<span></span>
<span><span class='va'>cor_overall</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/cor.test.html'>cor.test</a></span><span class='op'>(</span></span>
<span>  <span class='va'>df_model</span><span class='op'>$</span><span class='va'>freedom_latest</span>,</span>
<span>  <span class='va'>df_model</span><span class='op'>$</span><span class='va'>co2pc_latest</span>,</span>
<span>  method <span class='op'>=</span> <span class='st'>"pearson"</span>,</span>
<span>  use    <span class='op'>=</span> <span class='st'>"complete.obs"</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>cor_by_size</span> <span class='op'>&lt;-</span> <span class='va'>df_model</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>freedom_latest</span><span class='op'>)</span>, <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>co2pc_latest</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>size_group</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span></span>
<span>    n           <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>n</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    correlation <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/cor.html'>cor</a></span><span class='op'>(</span><span class='va'>freedom_latest</span>, <span class='va'>co2pc_latest</span>, use <span class='op'>=</span> <span class='st'>"complete.obs"</span><span class='op'>)</span>,</span>
<span>    .groups     <span class='op'>=</span> <span class='st'>"drop"</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='co'># LM &amp; GAM</span></span>
<span></span>
<span><span class='va'>model_lm</span>  <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>hdi_latest</span> <span class='op'>~</span> <span class='va'>co2log_latest</span>, data <span class='op'>=</span> <span class='va'>df_model</span><span class='op'>)</span></span>
<span><span class='va'>lm_glance</span> <span class='op'>&lt;-</span> <span class='fu'>broom</span><span class='fu'>::</span><span class='fu'><a href='https://generics.r-lib.org/reference/glance.html'>glance</a></span><span class='op'>(</span><span class='va'>model_lm</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>model_gam</span> <span class='op'>&lt;-</span> <span class='fu'>mgcv</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/mgcv/man/gam.html'>gam</a></span><span class='op'>(</span></span>
<span>  <span class='va'>hdi_latest</span> <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/pkg/mgcv/man/s.html'>s</a></span><span class='op'>(</span><span class='va'>co2log_latest</span>, by <span class='op'>=</span> <span class='va'>size_group</span>, k <span class='op'>=</span> <span class='fl'>6</span><span class='op'>)</span> <span class='op'>+</span> <span class='va'>size_group</span>,</span>
<span>  data   <span class='op'>=</span> <span class='va'>df_model</span>,</span>
<span>  method <span class='op'>=</span> <span class='st'>"REML"</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>gam_summary</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>model_gam</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>gam_rsq</span> <span class='op'>&lt;-</span> <span class='va'>gam_summary</span><span class='op'>$</span><span class='va'>r.sq</span></span>
<span><span class='va'>gam_dev</span> <span class='op'>&lt;-</span> <span class='va'>gam_summary</span><span class='op'>$</span><span class='va'>dev.expl</span></span>
<span></span>
<span><span class='va'>aic_lm</span>  <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/AIC.html'>AIC</a></span><span class='op'>(</span><span class='va'>model_lm</span><span class='op'>)</span></span>
<span><span class='va'>aic_gam</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/AIC.html'>AIC</a></span><span class='op'>(</span><span class='va'>model_gam</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Prediction grid (for GAM curves)</span></span>
<span></span>
<span><span class='va'>pred_grid</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tidyr.tidyverse.org/reference/expand_grid.html'>expand_grid</a></span><span class='op'>(</span></span>
<span>  co2log_latest <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>df_model</span><span class='op'>$</span><span class='va'>co2log_latest</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,</span>
<span>    <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>df_model</span><span class='op'>$</span><span class='va'>co2log_latest</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,</span>
<span>    length.out <span class='op'>=</span> <span class='fl'>200</span></span>
<span>  <span class='op'>)</span>,</span>
<span>  size_group <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"small"</span>, <span class='st'>"midsized"</span>, <span class='st'>"big"</span><span class='op'>)</span>, levels <span class='op'>=</span> <span class='va'>order_size</span><span class='op'>)</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>gam_pred</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span></span>
<span>  <span class='va'>model_gam</span>,</span>
<span>  newdata <span class='op'>=</span> <span class='va'>pred_grid</span>,</span>
<span>  se.fit  <span class='op'>=</span> <span class='cn'>TRUE</span>,</span>
<span>  type    <span class='op'>=</span> <span class='st'>"response"</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>pred_grid</span> <span class='op'>&lt;-</span> <span class='va'>pred_grid</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    hdi_pred <span class='op'>=</span> <span class='va'>gam_pred</span><span class='op'>$</span><span class='va'>fit</span>,</span>
<span>    hdi_se   <span class='op'>=</span> <span class='va'>gam_pred</span><span class='op'>$</span><span class='va'>se.fit</span>,</span>
<span>    hdi_lwr  <span class='op'>=</span> <span class='va'>hdi_pred</span> <span class='op'>-</span> <span class='fl'>1.96</span> <span class='op'>*</span> <span class='va'>hdi_se</span>,</span>
<span>    hdi_upr  <span class='op'>=</span> <span class='va'>hdi_pred</span> <span class='op'>+</span> <span class='fl'>1.96</span> <span class='op'>*</span> <span class='va'>hdi_se</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>pred_grid_clean</span> <span class='op'>&lt;-</span> <span class='va'>pred_grid</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>hdi_pred</span><span class='op'>)</span>, <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>hdi_lwr</span><span class='op'>)</span>, <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>hdi_upr</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Group differences (freedom, CO₂, efficiency)</span></span>
<span></span>
<span><span class='va'>kw_freedom</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/kruskal.test.html'>kruskal.test</a></span><span class='op'>(</span><span class='va'>freedom_latest</span> <span class='op'>~</span> <span class='va'>size_group</span>, data <span class='op'>=</span> <span class='va'>df_model</span><span class='op'>)</span></span>
<span><span class='va'>kw_co2</span>     <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/kruskal.test.html'>kruskal.test</a></span><span class='op'>(</span><span class='va'>co2pc_latest</span>   <span class='op'>~</span> <span class='va'>size_group</span>, data <span class='op'>=</span> <span class='va'>df_model</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># unified efficiency data for tests + plots</span></span>
<span><span class='va'>eff_data</span> <span class='op'>&lt;-</span> <span class='va'>df_model</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span></span>
<span>    <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>hdi_per_co2_latest</span><span class='op'>)</span>,</span>
<span>    <span class='fu'><a href='https://rdrr.io/r/base/is.finite.html'>is.finite</a></span><span class='op'>(</span><span class='va'>hdi_per_co2_latest</span><span class='op'>)</span>,</span>
<span>    <span class='va'>co2pc_latest</span> <span class='op'>&gt;</span> <span class='fl'>0.1</span>,</span>
<span>    <span class='va'>hdi_per_co2_latest</span> <span class='op'>&gt;</span> <span class='fl'>0</span>,</span>
<span>    <span class='va'>hdi_per_co2_latest</span> <span class='op'>&lt;</span> <span class='fl'>10</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>eff_q</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/quantile.html'>quantile</a></span><span class='op'>(</span><span class='va'>eff_data</span><span class='op'>$</span><span class='va'>hdi_per_co2_latest</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.02</span>, <span class='fl'>0.98</span><span class='op'>)</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>eff_data</span> <span class='op'>&lt;-</span> <span class='va'>eff_data</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    hdi_eff_robust <span class='op'>=</span> <span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org/reference/oob.html'>squish</a></span><span class='op'>(</span><span class='va'>hdi_per_co2_latest</span>, range <span class='op'>=</span> <span class='va'>eff_q</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>kw_eff</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/kruskal.test.html'>kruskal.test</a></span><span class='op'>(</span><span class='va'>hdi_eff_robust</span> <span class='op'>~</span> <span class='va'>size_group</span>, data <span class='op'>=</span> <span class='va'>eff_data</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Medians for visuals </span></span>
<span></span>
<span><span class='va'>medians_latest</span> <span class='op'>&lt;-</span> <span class='va'>df_model</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>size_group</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span></span>
<span>    median_freedom  <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/median.html'>median</a></span><span class='op'>(</span><span class='va'>freedom_latest</span>,  na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,</span>
<span>    median_co2      <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/median.html'>median</a></span><span class='op'>(</span><span class='va'>co2log_latest</span>,   na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,</span>
<span>    median_co2_raw  <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/median.html'>median</a></span><span class='op'>(</span><span class='va'>co2pc_latest</span>,    na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,</span>
<span>    median_hdi      <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/median.html'>median</a></span><span class='op'>(</span><span class='va'>hdi_latest</span>,      na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,</span>
<span>    .groups         <span class='op'>=</span> <span class='st'>"drop"</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>medians_eff</span> <span class='op'>&lt;-</span> <span class='va'>eff_data</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>size_group</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span></span>
<span>    median_eff <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/median.html'>median</a></span><span class='op'>(</span><span class='va'>hdi_eff_robust</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,</span>
<span>    .groups    <span class='op'>=</span> <span class='st'>"drop"</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>medians_delta</span> <span class='op'>&lt;-</span> <span class='va'>df_delta</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>size_group</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>size_group</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span></span>
<span>    median_d_hdi     <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/median.html'>median</a></span><span class='op'>(</span><span class='va'>d_hdi</span>,      na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,</span>
<span>    median_d_co2     <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/median.html'>median</a></span><span class='op'>(</span><span class='va'>d_co2pc</span>,    na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,</span>
<span>    median_d_freedom <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/median.html'>median</a></span><span class='op'>(</span><span class='va'>d_freedom</span>,  na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,</span>
<span>    .groups          <span class='op'>=</span> <span class='st'>"drop"</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='co'># Trajectories (1990 -&gt; 2022) </span></span>
<span></span>
<span><span class='va'>trajectory_countries</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>  <span class='co'># Major emitters / big economies</span></span>
<span>  <span class='st'>"USA"</span>, <span class='st'>"CHN"</span>, <span class='st'>"IND"</span>,</span>
<span>  </span>
<span>  <span class='co'># High-income fossil exporters</span></span>
<span>  <span class='st'>"QAT"</span>, <span class='st'>"ARE"</span>, <span class='st'>"KWT"</span>, <span class='st'>"SAU"</span>,</span>
<span>  </span>
<span>  <span class='co'># High-HDI small / midsized in Europe &amp; Asia</span></span>
<span>  <span class='st'>"NOR"</span>, <span class='st'>"ISL"</span>, <span class='st'>"SWE"</span>, <span class='st'>"DNK"</span>,</span>
<span>  <span class='st'>"LUX"</span>, <span class='st'>"SGP"</span>, <span class='st'>"HKG"</span>, <span class='st'>"MLT"</span>,</span>
<span>  </span>
<span>  <span class='co'># Benchmark small democracies / reformers</span></span>
<span>  <span class='st'>"CRI"</span>, <span class='st'>"NZL"</span>, <span class='st'>"URY"</span>,</span>
<span>  </span>
<span>  <span class='co'># Extra small / micro states </span></span>
<span>  <span class='st'>"MUS"</span>,  <span class='co'># Mauritius</span></span>
<span>  <span class='st'>"FJI"</span>,  <span class='co'># Fiji</span></span>
<span>  <span class='st'>"CYP"</span>,  <span class='co'># Cyprus</span></span>
<span>  <span class='st'>"GEO"</span>,  <span class='co'># Georgia</span></span>
<span>  <span class='st'>"BRB"</span>,  <span class='co'># Barbados</span></span>
<span>  <span class='st'>"BHS"</span>,  <span class='co'># Bahamas</span></span>
<span>  <span class='st'>"BTN"</span>,  <span class='co'># Bhutan</span></span>
<span>  <span class='st'>"EST"</span>,  <span class='co'># Estonia</span></span>
<span>  </span>
<span>  <span class='co'># Large emerging economies</span></span>
<span>  <span class='st'>"BRA"</span>, <span class='st'>"IDN"</span>, <span class='st'>"TUR"</span>, <span class='st'>"KOR"</span>,</span>
<span>  </span>
<span>  <span class='co'># Large low-income</span></span>
<span>  <span class='st'>"ETH"</span>, <span class='st'>"BGD"</span>, <span class='st'>"TZA"</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>trajectory_data</span> <span class='op'>&lt;-</span> <span class='va'>df</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span></span>
<span>    <span class='va'>iso3</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='va'>trajectory_countries</span>,</span>
<span>    <span class='va'>year</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1990</span>, <span class='fl'>2022</span><span class='op'>)</span>,</span>
<span>    <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>hdi</span><span class='op'>)</span>,</span>
<span>    <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>co2pc_log1p</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>iso3</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>n</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>==</span> <span class='fl'>2</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='va'>iso3</span>, <span class='va'>year</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>ungroup</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>iso3</span>, <span class='va'>country</span>, <span class='va'>year</span>, <span class='va'>hdi</span>, <span class='va'>co2pc_log1p</span>, <span class='va'>size_group</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>trajectory_arrows</span> <span class='op'>&lt;-</span> <span class='va'>trajectory_data</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>iso3</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span></span>
<span>    country    <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/nth.html'>first</a></span><span class='op'>(</span><span class='va'>country</span><span class='op'>)</span>,</span>
<span>    size_group <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/nth.html'>first</a></span><span class='op'>(</span><span class='va'>size_group</span><span class='op'>)</span>,</span>
<span>    x_start    <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/nth.html'>first</a></span><span class='op'>(</span><span class='va'>co2pc_log1p</span><span class='op'>)</span>,</span>
<span>    y_start    <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/nth.html'>first</a></span><span class='op'>(</span><span class='va'>hdi</span><span class='op'>)</span>,</span>
<span>    x_end      <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/nth.html'>last</a></span><span class='op'>(</span><span class='va'>co2pc_log1p</span><span class='op'>)</span>,</span>
<span>    y_end      <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/nth.html'>last</a></span><span class='op'>(</span><span class='va'>hdi</span><span class='op'>)</span>,</span>
<span>    .groups    <span class='op'>=</span> <span class='st'>"drop"</span></span>
<span>  <span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>abs</a></span><span class='op'>(</span><span class='va'>x_end</span> <span class='op'>-</span> <span class='va'>x_start</span><span class='op'>)</span> <span class='op'>&gt;</span> <span class='fl'>0.1</span> <span class='op'>|</span></span>
<span>      <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>abs</a></span><span class='op'>(</span><span class='va'>y_end</span> <span class='op'>-</span> <span class='va'>y_start</span><span class='op'>)</span> <span class='op'>&gt;</span> <span class='fl'>0.02</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='co'># Jitter &amp; point size for scatter </span></span>
<span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>123</span><span class='op'>)</span></span>
<span><span class='va'>df_model</span> <span class='op'>&lt;-</span> <span class='va'>df_model</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    co2log_jit     <span class='op'>=</span> <span class='va'>co2log_latest</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>n</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='fl'>0</span>, <span class='fl'>0.003</span><span class='op'>)</span>,</span>
<span>    hdi_jit        <span class='op'>=</span> <span class='va'>hdi_latest</span>    <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>n</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='fl'>0</span>, <span class='fl'>0.002</span><span class='op'>)</span>,</span>
<span>    point_size_var <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>pmax</a></span><span class='op'>(</span><span class='va'>pop_latest</span>, <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='co'># Narrative stats bundle</span></span>
<span><span class='va'>model_results</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span></span>
<span>  model_lm          <span class='op'>=</span> <span class='va'>model_lm</span>,</span>
<span>  model_gam         <span class='op'>=</span> <span class='va'>model_gam</span>,</span>
<span>  pred_grid         <span class='op'>=</span> <span class='va'>pred_grid_clean</span>,</span>
<span>  trajectory_arrows <span class='op'>=</span> <span class='va'>trajectory_arrows</span>,</span>
<span>  freedom_by_size   <span class='op'>=</span> <span class='va'>freedom_by_size</span>,</span>
<span>  co2_by_size       <span class='op'>=</span> <span class='va'>co2_by_size</span>,</span>
<span>  decouple_summary  <span class='op'>=</span> <span class='va'>decouple_summary</span>,</span>
<span>  medians_latest    <span class='op'>=</span> <span class='va'>medians_latest</span>,</span>
<span>  medians_delta     <span class='op'>=</span> <span class='va'>medians_delta</span>,</span>
<span>  medians_eff       <span class='op'>=</span> <span class='va'>medians_eff</span>,</span>
<span>  eff_data          <span class='op'>=</span> <span class='va'>eff_data</span>,</span>
<span>  cor_overall       <span class='op'>=</span> <span class='va'>cor_overall</span>,</span>
<span>  cor_by_size       <span class='op'>=</span> <span class='va'>cor_by_size</span>,</span>
<span>  kw_freedom        <span class='op'>=</span> <span class='va'>kw_freedom</span>,</span>
<span>  kw_co2            <span class='op'>=</span> <span class='va'>kw_co2</span>,</span>
<span>  kw_eff            <span class='op'>=</span> <span class='va'>kw_eff</span>,</span>
<span>  narrative_stats   <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span></span>
<span>    freedom_diff_pct <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>freedom_diff_pct</span>, <span class='fl'>1</span><span class='op'>)</span>,</span>
<span>    co2_diff_pct     <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>co2_diff_pct</span>, <span class='fl'>1</span><span class='op'>)</span>,</span>
<span>    gam_rsq          <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>gam_rsq</span>, <span class='fl'>3</span><span class='op'>)</span>,</span>
<span>    aic_improvement  <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>aic_lm</span> <span class='op'>-</span> <span class='va'>aic_gam</span>, <span class='fl'>1</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></span><span class='op'>(</span><span class='va'>model_results</span>, <span class='st'>"data/cache/model_results.rds"</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<h5 id="visualisation">Visualisation</h5>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Helper factor for ridge ordering (big → midsized → small on y-axis)</span></span>
<span></span>
<span><span class='va'>df_model</span> <span class='op'>&lt;-</span> <span class='va'>df_model</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    size_ridge <span class='op'>=</span> <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span></span>
<span>      <span class='va'>size_group</span> <span class='op'>==</span> <span class='st'>"small"</span>    <span class='op'>~</span> <span class='st'>"small states"</span>,</span>
<span>      <span class='va'>size_group</span> <span class='op'>==</span> <span class='st'>"midsized"</span> <span class='op'>~</span> <span class='st'>"midsized states"</span>,</span>
<span>      <span class='va'>size_group</span> <span class='op'>==</span> <span class='st'>"big"</span>      <span class='op'>~</span> <span class='st'>"big states"</span>,</span>
<span>      <span class='cn'>TRUE</span>                     <span class='op'>~</span> <span class='cn'>NA_character_</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    size_ridge <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span></span>
<span>      <span class='va'>size_ridge</span>,</span>
<span>      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"big states"</span>, <span class='st'>"midsized states"</span>, <span class='st'>"small states"</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='co'>#  Shared scales (theme_uc3m is defined before)</span></span>
<span></span>
<span><span class='va'>co2_vals</span>  <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>5</span>, <span class='fl'>10</span>, <span class='fl'>20</span>, <span class='fl'>40</span><span class='op'>)</span></span>
<span><span class='va'>co2_ticks</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log1p</a></span><span class='op'>(</span><span class='va'>co2_vals</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>size_scale</span> <span class='op'>&lt;-</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_size.html'>scale_size_continuous</a></span><span class='op'>(</span>range <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>5</span>, <span class='fl'>10</span><span class='op'>)</span>, guide <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class='co'># Text blocks (bottom-left + main panel A annotation)</span></span>
<span></span>
<span></span>
<span><span class='va'>bottom_left_html</span> <span class='op'>&lt;-</span> <span class='fu'>glue</span><span class='fu'>::</span><span class='fu'><a href='https://glue.tidyverse.org/reference/glue.html'>glue</a></span><span class='op'>(</span></span>
<span> <span class='st'>"These panels show how democracy, CO2 emissions&lt;br&gt;"</span>,</span>
<span>  <span class='st'>"and human development are distributed across&lt;br&gt;"</span>,</span>
<span>  <span class='st'>"three population-size groups:&lt;br&gt;"</span>,</span>
<span>  <span class='st'>"&lt;span style='color:{col_small};'&gt;small states&lt;/span&gt; "</span>,</span>
<span>  <span class='st'>"(&amp;lt;{SMALL_POP/1e6} million people),&lt;br&gt;"</span>,</span>
<span>  <span class='st'>"&lt;span style='color:{col_mid};'&gt;midsized states&lt;/span&gt; "</span>,</span>
<span>  <span class='st'>"({SMALL_POP/1e6}–{MID_POP/1e6} million),&lt;br&gt;"</span>,</span>
<span>  <span class='st'>"and &lt;span style='color:{col_big};'&gt;big states&lt;/span&gt; "</span>,</span>
<span>  <span class='st'>"(&amp;gt;{MID_POP/1e6} million)."</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>panelA_html</span> <span class='op'>&lt;-</span> <span class='fu'>glue</span><span class='fu'>::</span><span class='fu'><a href='https://glue.tidyverse.org/reference/glue.html'>glue</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"There are &lt;span style='color:{col_small}; font-weight:600;'&gt;"</span>,</span>
<span>  <span class='st'>"{sum(df_latest$size_group == 'small', na.rm = TRUE)} small states&lt;/span&gt; "</span>,</span>
<span>  <span class='st'>"in this sample (&amp;lt;{SMALL_POP/1e6} million people).&lt;br&gt;"</span>,</span>
<span>  <span class='st'>"On median they score about &lt;span style='color:{col_small}; font-weight:600;'&gt;"</span>,</span>
<span>  <span class='st'>"{round(freedom_diff_pct, 0)}% higher on democracy&lt;/span&gt; "</span>,<span class='st'>"and emit &lt;span style='color:{col_small}; font-weight:600;'&gt;"</span>,</span>
<span>  <span class='st'>"{round(co2_diff_pct, 0)}% less CO\u2082 per person&lt;/span&gt; "</span>,</span>
<span>  <span class='st'>"than &lt;span style='color:{col_big};'&gt;big states&lt;/span&gt;.&lt;br&gt;"</span>,</span>
<span>  <span class='st'>"Each circle is a country; larger circles represent larger populations,"</span>,</span>
<span>  <span class='st'>"and transparency reflects democracy level (V-Dem).&lt;br&gt;"</span>,</span>
<span>  <span class='st'>"Coloured curves are GAM fits by size group; arrows show changes"</span>,<span class='st'>"from 1990 to 2022."</span></span>
<span></span>
<span><span class='op'>)</span></span>
<span></span>
<span></span>
<span><span class='co'>#  Labelled countries for Panel A</span></span>
<span></span>
<span></span>
<span><span class='va'>outlier_iso3_manual</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>  <span class='co'># Major emitters / big economies</span></span>
<span>  <span class='st'>"USA"</span>, <span class='st'>"CHN"</span>, <span class='st'>"IND"</span>,</span>
<span>  </span>
<span>  <span class='co'># High-income fossil exporters</span></span>
<span>  <span class='st'>"QAT"</span>, <span class='st'>"ARE"</span>, <span class='st'>"KWT"</span>, <span class='st'>"SAU"</span>,</span>
<span>  </span>
<span>  <span class='co'># High-HDI small / midsized in Europe &amp; Asia</span></span>
<span>  <span class='st'>"NOR"</span>, <span class='st'>"ISL"</span>, <span class='st'>"SWE"</span>, <span class='st'>"DNK"</span>,</span>
<span>  <span class='st'>"LUX"</span>, <span class='st'>"SGP"</span>, <span class='st'>"HKG"</span>, <span class='st'>"MLT"</span>,</span>
<span>  </span>
<span>  <span class='co'># Benchmark small democracies / reformers</span></span>
<span>  <span class='st'>"CRI"</span>, <span class='st'>"NZL"</span>, <span class='st'>"URY"</span>,</span>
<span>  </span>
<span>  <span class='co'># Extra small / micro states (mostly islands)</span></span>
<span>  <span class='st'>"MUS"</span>,  <span class='co'># Mauritius</span></span>
<span>  <span class='st'>"FJI"</span>,  <span class='co'># Fiji</span></span>
<span>  <span class='st'>"CYP"</span>,  <span class='co'># Cyprus</span></span>
<span>  <span class='st'>"GEO"</span>,  <span class='co'># Georgia</span></span>
<span>  <span class='st'>"BRB"</span>,  <span class='co'># Barbados</span></span>
<span>  <span class='st'>"BHS"</span>,  <span class='co'># Bahamas</span></span>
<span>  <span class='st'>"BTN"</span>,  <span class='co'># Bhutan</span></span>
<span>  <span class='st'>"EST"</span>,  <span class='co'># Estonia</span></span>
<span>  </span>
<span>  <span class='co'># Large emerging economies</span></span>
<span>  <span class='st'>"BRA"</span>, <span class='st'>"IDN"</span>, <span class='st'>"TUR"</span>, <span class='st'>"KOR"</span>,</span>
<span>  </span>
<span>  <span class='co'># Large low-income</span></span>
<span>  <span class='st'>"ETH"</span>, <span class='st'>"BGD"</span>, <span class='st'>"TZA"</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span></span>
<span><span class='va'>auto_high_hdi</span> <span class='op'>&lt;-</span> <span class='va'>df_model</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/desc.html'>desc</a></span><span class='op'>(</span><span class='va'>hdi_latest</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice_head</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='fl'>35</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/pull.html'>pull</a></span><span class='op'>(</span><span class='va'>iso3</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>auto_low_hdi</span> <span class='op'>&lt;-</span> <span class='va'>df_model</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='va'>hdi_latest</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice_head</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='fl'>30</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/pull.html'>pull</a></span><span class='op'>(</span><span class='va'>iso3</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>auto_high_co2</span> <span class='op'>&lt;-</span> <span class='va'>df_model</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/desc.html'>desc</a></span><span class='op'>(</span><span class='va'>co2pc_latest</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice_head</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='fl'>30</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/pull.html'>pull</a></span><span class='op'>(</span><span class='va'>iso3</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>auto_high_eff</span> <span class='op'>&lt;-</span> <span class='va'>df_model</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>hdi_per_co2_tmp <span class='op'>=</span> <span class='va'>hdi_latest</span> <span class='op'>/</span> <span class='op'>(</span><span class='va'>co2pc_latest</span> <span class='op'>+</span> <span class='fl'>0.01</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/desc.html'>desc</a></span><span class='op'>(</span><span class='va'>hdi_per_co2_tmp</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice_head</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/pull.html'>pull</a></span><span class='op'>(</span><span class='va'>iso3</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>label_iso3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>  <span class='va'>outlier_iso3_manual</span>,</span>
<span>  <span class='va'>auto_high_hdi</span>,</span>
<span>  <span class='va'>auto_low_hdi</span>,</span>
<span>  <span class='va'>auto_high_co2</span>,</span>
<span>  <span class='va'>auto_high_eff</span></span>
<span><span class='op'>)</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span></span>
<span><span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>label_iso3</span><span class='op'>)</span> <span class='op'>&lt;</span> <span class='fl'>70</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>  <span class='va'>extra_iso3</span> <span class='op'>&lt;-</span> <span class='va'>df_model</span> <span class='op'>|&gt;</span></span>
<span>    <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='va'>iso3</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='va'>label_iso3</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>    <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/desc.html'>desc</a></span><span class='op'>(</span><span class='va'>point_size_var</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>    <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice_head</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='fl'>70</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>label_iso3</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>    <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/pull.html'>pull</a></span><span class='op'>(</span><span class='va'>iso3</span><span class='op'>)</span></span>
<span>  <span class='va'>label_iso3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>label_iso3</span>, <span class='va'>extra_iso3</span><span class='op'>)</span></span>
<span><span class='op'>}</span></span>
<span></span>
<span><span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>label_iso3</span><span class='op'>)</span> <span class='op'>&gt;</span> <span class='fl'>70</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>  <span class='va'>label_iso3</span> <span class='op'>&lt;-</span> <span class='va'>label_iso3</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>70</span><span class='op'>]</span></span>
<span><span class='op'>}</span></span>
<span></span>
<span><span class='va'>lab_df</span> <span class='op'>&lt;-</span> <span class='va'>df_model</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter-joins.html'>semi_join</a></span><span class='op'>(</span><span class='fu'>tibble</span><span class='fu'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span>iso3 <span class='op'>=</span> <span class='va'>label_iso3</span><span class='op'>)</span>, by <span class='op'>=</span> <span class='st'>"iso3"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    country <span class='op'>=</span> <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span></span>
<span>      <span class='fu'>stringr</span><span class='fu'>::</span><span class='fu'><a href='https://stringr.tidyverse.org/reference/str_detect.html'>str_detect</a></span><span class='op'>(</span><span class='va'>country</span>, <span class='st'>"\\("</span><span class='op'>)</span>,</span>
<span>      <span class='fu'>stringr</span><span class='fu'>::</span><span class='fu'><a href='https://stringr.tidyverse.org/reference/str_remove.html'>str_remove</a></span><span class='op'>(</span><span class='va'>country</span>, <span class='st'>"\\s*\\(.*\\)"</span><span class='op'>)</span>,</span>
<span>      <span class='va'>country</span></span>
<span>    <span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>df_model</span> <span class='op'>&lt;-</span> <span class='va'>df_model</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    freedom_band <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/cut.html'>cut</a></span><span class='op'>(</span></span>
<span>      <span class='va'>freedom_latest</span>,</span>
<span>      breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='cn'>Inf</span>, <span class='fl'>0.33</span>, <span class='fl'>0.66</span>, <span class='cn'>Inf</span><span class='op'>)</span>,</span>
<span>      labels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>        <span class='st'>"Low (0–0.33)"</span>,</span>
<span>        <span class='st'>"Medium (0.33–0.66)"</span>,</span>
<span>        <span class='st'>"High (0.66–1.0)"</span></span>
<span>      <span class='op'>)</span>,</span>
<span>      right          <span class='op'>=</span> <span class='cn'>TRUE</span>,</span>
<span>      ordered_result <span class='op'>=</span> <span class='cn'>TRUE</span></span>
<span>    <span class='op'>)</span></span>
<span>  <span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'>sf</span><span class='fu'>::</span><span class='fu'><a href='https://r-spatial.github.io/sf/reference/s2.html'>sf_use_s2</a></span><span class='op'>(</span><span class='cn'>TRUE</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>world</span> <span class='op'>&lt;-</span> <span class='fu'>rnaturalearth</span><span class='fu'>::</span><span class='fu'><a href='https://docs.ropensci.org/rnaturalearth/reference/ne_countries.html'>ne_countries</a></span><span class='op'>(</span>scale <span class='op'>=</span> <span class='st'>"medium"</span>, returnclass <span class='op'>=</span> <span class='st'>"sf"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>admin</span> <span class='op'>!=</span> <span class='st'>"Antarctica"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>janitor</span><span class='fu'>::</span><span class='fu'><a href='https://sfirke.github.io/janitor/reference/clean_names.html'>clean_names</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>world_fixed</span> <span class='op'>&lt;-</span> <span class='va'>world</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    iso3_join <span class='op'>=</span> <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span></span>
<span>      <span class='va'>admin</span> <span class='op'>==</span> <span class='st'>"France"</span> <span class='op'>&amp;</span> <span class='va'>iso_a3</span> <span class='op'>==</span> <span class='st'>"-99"</span> <span class='op'>~</span> <span class='st'>"FRA"</span>,</span>
<span>      <span class='va'>admin</span> <span class='op'>==</span> <span class='st'>"Norway"</span>                    <span class='op'>~</span> <span class='st'>"NOR"</span>,</span>
<span>      <span class='va'>iso_a3</span> <span class='op'>==</span> <span class='st'>"-99"</span>                      <span class='op'>~</span> <span class='cn'>NA_character_</span>,</span>
<span>      <span class='cn'>TRUE</span>                                 <span class='op'>~</span> <span class='va'>iso_a3</span></span>
<span>    <span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>df_map_join</span> <span class='op'>&lt;-</span> <span class='va'>df_model</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>iso3</span>, <span class='va'>country</span>, <span class='va'>size_group</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/distinct.html'>distinct</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>map_data</span> <span class='op'>&lt;-</span> <span class='va'>world_fixed</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>df_map_join</span>, by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"iso3_join"</span> <span class='op'>=</span> <span class='st'>"iso3"</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>rob_crs</span>  <span class='op'>&lt;-</span> <span class='fu'>sf</span><span class='fu'>::</span><span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_crs.html'>st_crs</a></span><span class='op'>(</span><span class='st'>"+proj=robin"</span><span class='op'>)</span></span>
<span><span class='va'>map_proj</span> <span class='op'>&lt;-</span> <span class='va'>map_data</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>sf</span><span class='fu'>::</span><span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_transform.html'>st_transform</a></span><span class='op'>(</span><span class='va'>rob_crs</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>tiny_iso</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"MCO"</span>, <span class='st'>"SMR"</span>, <span class='st'>"AND"</span>, <span class='st'>"LIE"</span>, <span class='st'>"LUX"</span>,</span>
<span>  <span class='st'>"SGP"</span>, <span class='st'>"BRN"</span>, <span class='st'>"BHR"</span>, <span class='st'>"MDV"</span>, <span class='st'>"MLT"</span>, <span class='st'>"VAT"</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>tiny_pts</span> <span class='op'>&lt;-</span> <span class='va'>map_proj</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>iso3_join</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='va'>tiny_iso</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>centroid <span class='op'>=</span> <span class='fu'>sf</span><span class='fu'>::</span><span class='fu'><a href='https://r-spatial.github.io/sf/reference/geos_unary.html'>st_point_on_surface</a></span><span class='op'>(</span><span class='va'>geometry</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>sf</span><span class='fu'>::</span><span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_geometry.html'>st_set_geometry</a></span><span class='op'>(</span><span class='st'>"centroid"</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>map_panel</span> <span class='op'>&lt;-</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span></span>
<span>    data   <span class='op'>=</span> <span class='va'>map_proj</span>,</span>
<span>    <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>size_group</span><span class='op'>)</span>,</span>
<span>    color     <span class='op'>=</span> <span class='st'>"grey85"</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='fl'>0.20</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span></span>
<span>    data   <span class='op'>=</span> <span class='va'>tiny_pts</span>,</span>
<span>    <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>size_group</span><span class='op'>)</span>,</span>
<span>    shape  <span class='op'>=</span> <span class='fl'>21</span>,</span>
<span>    size   <span class='op'>=</span> <span class='fl'>1.8</span>,</span>
<span>    color  <span class='op'>=</span> <span class='st'>"grey30"</span>,</span>
<span>    stroke <span class='op'>=</span> <span class='fl'>0.2</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_fill_manual</a></span><span class='op'>(</span></span>
<span>    values   <span class='op'>=</span> <span class='va'>size_colors</span>,</span>
<span>    breaks   <span class='op'>=</span> <span class='va'>order_size</span>,</span>
<span>    na.value <span class='op'>=</span> <span class='st'>"grey92"</span>,</span>
<span>    guide    <span class='op'>=</span> <span class='st'>"none"</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>coord_sf</a></span><span class='op'>(</span>crs <span class='op'>=</span> <span class='va'>rob_crs</span>, clip <span class='op'>=</span> <span class='st'>"on"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Countries Grouped by Population Size"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_void</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    plot.background  <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>bg_col</span>,    color <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span>,</span>
<span>    panel.background <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>ocean_col</span>, color <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span>,</span>
<span>    plot.title       <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      size   <span class='op'>=</span> <span class='fl'>22</span>,</span>
<span>      face   <span class='op'>=</span> <span class='st'>"bold"</span>,</span>
<span>      color  <span class='op'>=</span> <span class='va'>dark_col</span>,</span>
<span>      family <span class='op'>=</span> <span class='va'>base_font</span>,</span>
<span>      hjust  <span class='op'>=</span> <span class='fl'>0.5</span>,</span>
<span>      margin <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>4</span>, b <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>map_panel</span></span></code></pre>
</div>
<p><img src="100502844_files/figure-html5/world-map-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<h6 id="panel-a-main-scatter-hdi-vs-co2-log">Panel A – main scatter: HDI vs CO2 (log)</h6>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>co2_min</span> <span class='op'>&lt;-</span> <span class='fl'>0</span></span>
<span><span class='va'>co2_max</span> <span class='op'>&lt;-</span> <span class='fl'>60</span></span>
<span><span class='va'>co2_seq</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='va'>co2_min</span>, <span class='va'>co2_max</span>, length.out <span class='op'>=</span> <span class='fl'>400</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>pred_grid</span> <span class='op'>&lt;-</span> <span class='fu'>tidyr</span><span class='fu'>::</span><span class='fu'><a href='https://tidyr.tidyverse.org/reference/expand_grid.html'>expand_grid</a></span><span class='op'>(</span></span>
<span>  co2pc_latest <span class='op'>=</span> <span class='va'>co2_seq</span>,</span>
<span>  size_group   <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"small"</span>, <span class='st'>"midsized"</span>, <span class='st'>"big"</span><span class='op'>)</span>,</span>
<span>                        levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"small"</span>, <span class='st'>"midsized"</span>, <span class='st'>"big"</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>co2log_latest <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log1p</a></span><span class='op'>(</span><span class='va'>co2pc_latest</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>gam_pred</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span></span>
<span>  <span class='va'>model_gam</span>,</span>
<span>  newdata <span class='op'>=</span> <span class='va'>pred_grid</span>,</span>
<span>  se.fit  <span class='op'>=</span> <span class='cn'>TRUE</span>,</span>
<span>  type    <span class='op'>=</span> <span class='st'>"response"</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>pred_grid_clean</span> <span class='op'>&lt;-</span> <span class='va'>pred_grid</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    hdi_pred <span class='op'>=</span> <span class='va'>gam_pred</span><span class='op'>$</span><span class='va'>fit</span>,</span>
<span>    hdi_se   <span class='op'>=</span> <span class='va'>gam_pred</span><span class='op'>$</span><span class='va'>se.fit</span>,</span>
<span>    hdi_lwr  <span class='op'>=</span> <span class='va'>hdi_pred</span> <span class='op'>-</span> <span class='fl'>1.96</span> <span class='op'>*</span> <span class='va'>hdi_se</span>,</span>
<span>    hdi_upr  <span class='op'>=</span> <span class='va'>hdi_pred</span> <span class='op'>+</span> <span class='fl'>1.96</span> <span class='op'>*</span> <span class='va'>hdi_se</span></span>
<span>  <span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>hdi_pred</span><span class='op'>)</span>, <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>hdi_lwr</span><span class='op'>)</span>, <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>hdi_upr</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>ref_x</span> <span class='op'>&lt;-</span> <span class='va'>co2_ticks</span></span>
<span><span class='va'>ref_y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fl'>0.30</span>, <span class='fl'>1.00</span>, by <span class='op'>=</span> <span class='fl'>0.10</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>figA</span> <span class='op'>&lt;-</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>df_model</span>, <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>co2log_jit</span>, y <span class='op'>=</span> <span class='va'>hdi_jit</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span></span>
<span>    xintercept <span class='op'>=</span> <span class='va'>ref_x</span>,</span>
<span>    colour     <span class='op'>=</span> <span class='st'>"grey90"</span>,</span>
<span>    linewidth  <span class='op'>=</span> <span class='fl'>2</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_hline</a></span><span class='op'>(</span></span>
<span>    yintercept <span class='op'>=</span> <span class='va'>ref_y</span>,</span>
<span>    colour     <span class='op'>=</span> <span class='st'>"grey90"</span>,</span>
<span>    linewidth  <span class='op'>=</span> <span class='fl'>2</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>    <span class='st'>"richtext"</span>,</span>
<span>    x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log1p</a></span><span class='op'>(</span><span class='fl'>0.77</span><span class='op'>)</span>,</span>
<span>    y <span class='op'>=</span> <span class='fl'>0.42</span>,</span>
<span>    label  <span class='op'>=</span> <span class='va'>panelA_html</span>,</span>
<span>    hjust  <span class='op'>=</span> <span class='fl'>0</span>,</span>
<span>    vjust  <span class='op'>=</span> <span class='fl'>1</span>,</span>
<span>    family <span class='op'>=</span> <span class='va'>base_font</span>,</span>
<span>    size   <span class='op'>=</span> <span class='fl'>10.2</span>,</span>
<span>    color  <span class='op'>=</span> <span class='va'>dark_col</span>,</span>
<span>    fill   <span class='op'>=</span> <span class='va'>bg_col</span>,</span>
<span>    label.color   <span class='op'>=</span> <span class='cn'>NA</span>,</span>
<span>    label.r       <span class='op'>=</span> <span class='fu'>grid</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='st'>"pt"</span><span class='op'>)</span>,</span>
<span>    label.padding <span class='op'>=</span> <span class='fu'>grid</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='st'>"pt"</span><span class='op'>)</span>,</span>
<span>    lineheight    <span class='op'>=</span> <span class='fl'>1</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span></span>
<span>    <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>      fill  <span class='op'>=</span> <span class='va'>size_group</span>,</span>
<span>      alpha <span class='op'>=</span> <span class='va'>freedom_band</span>,</span>
<span>      size  <span class='op'>=</span> <span class='va'>point_size_var</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    shape  <span class='op'>=</span> <span class='fl'>21</span>,</span>
<span>    color  <span class='op'>=</span> <span class='va'>dark_col</span>,</span>
<span>    stroke <span class='op'>=</span> <span class='fl'>0.3</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_ribbon.html'>geom_ribbon</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>pred_grid_clean</span>,</span>
<span>    <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>co2log_latest</span>, ymin <span class='op'>=</span> <span class='va'>hdi_lwr</span>, ymax <span class='op'>=</span> <span class='va'>hdi_upr</span>, fill <span class='op'>=</span> <span class='va'>size_group</span><span class='op'>)</span>,</span>
<span>    alpha       <span class='op'>=</span> <span class='fl'>0.16</span>,</span>
<span>    inherit.aes <span class='op'>=</span> <span class='cn'>FALSE</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>pred_grid_clean</span>,</span>
<span>    <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>co2log_latest</span>, y <span class='op'>=</span> <span class='va'>hdi_pred</span>, color <span class='op'>=</span> <span class='va'>size_group</span><span class='op'>)</span>,</span>
<span>    linewidth   <span class='op'>=</span> <span class='fl'>1.2</span>,</span>
<span>    alpha       <span class='op'>=</span> <span class='fl'>0.8</span>,</span>
<span>    inherit.aes <span class='op'>=</span> <span class='cn'>FALSE</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_segment.html'>geom_segment</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>trajectory_arrows</span>,</span>
<span>    <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>      x    <span class='op'>=</span> <span class='va'>x_start</span>,</span>
<span>      y    <span class='op'>=</span> <span class='va'>y_start</span>,</span>
<span>      xend <span class='op'>=</span> <span class='va'>x_end</span>,</span>
<span>      yend <span class='op'>=</span> <span class='va'>y_end</span>,</span>
<span>      color <span class='op'>=</span> <span class='va'>size_group</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    arrow       <span class='op'>=</span> <span class='fu'>grid</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/grid/arrow.html'>arrow</a></span><span class='op'>(</span>length <span class='op'>=</span> <span class='fu'>grid</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>2.5</span>, <span class='st'>"mm"</span><span class='op'>)</span>, type <span class='op'>=</span> <span class='st'>"closed"</span><span class='op'>)</span>,</span>
<span>    alpha       <span class='op'>=</span> <span class='fl'>0.38</span>,</span>
<span>    linewidth   <span class='op'>=</span> <span class='fl'>0.7</span>,</span>
<span>    inherit.aes <span class='op'>=</span> <span class='cn'>FALSE</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggrepel</span><span class='fu'>::</span><span class='fu'><a href='https://ggrepel.slowkow.com/reference/geom_text_repel.html'>geom_text_repel</a></span><span class='op'>(</span></span>
<span>    data               <span class='op'>=</span> <span class='va'>lab_df</span>,</span>
<span>    <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>co2log_latest</span>, y <span class='op'>=</span> <span class='va'>hdi_latest</span>, label <span class='op'>=</span> <span class='va'>country</span><span class='op'>)</span>,</span>
<span>    size               <span class='op'>=</span> <span class='fl'>7</span>,</span>
<span>    color              <span class='op'>=</span> <span class='va'>dark_col</span>,</span>
<span>    family             <span class='op'>=</span> <span class='va'>base_font</span>,</span>
<span>    max.overlaps       <span class='op'>=</span> <span class='fl'>250</span>,</span>
<span>    box.padding        <span class='op'>=</span> <span class='fl'>0.35</span>,</span>
<span>    point.padding      <span class='op'>=</span> <span class='fl'>0.30</span>,</span>
<span>    min.segment.length <span class='op'>=</span> <span class='fl'>0.05</span>,</span>
<span>    segment.color      <span class='op'>=</span> <span class='st'>"grey60"</span>,</span>
<span>    segment.size       <span class='op'>=</span> <span class='fl'>0.20</span>,</span>
<span>    segment.alpha      <span class='op'>=</span> <span class='fl'>0.7</span>,</span>
<span>    force              <span class='op'>=</span> <span class='fl'>1.6</span>,</span>
<span>    force_pull         <span class='op'>=</span> <span class='fl'>0.5</span>,</span>
<span>    seed               <span class='op'>=</span> <span class='fl'>123</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_fill_manual</a></span><span class='op'>(</span></span>
<span>    values <span class='op'>=</span> <span class='va'>size_colors</span>,</span>
<span>    breaks <span class='op'>=</span> <span class='va'>order_size</span>,</span>
<span>    name   <span class='op'>=</span> <span class='st'>"Country size"</span>,</span>
<span>    labels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Small (&lt;5M)"</span>, <span class='st'>"Midsized (5–35M)"</span>, <span class='st'>"Big (&gt;35M)"</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_color_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>size_colors</span>, guide <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_alpha_manual</a></span><span class='op'>(</span></span>
<span>    name   <span class='op'>=</span> <span class='st'>"Democracy level (V-Dem, 0–1)"</span>,</span>
<span>    values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>      <span class='st'>"Low (0–0.33)"</span>       <span class='op'>=</span> <span class='fl'>0.35</span>,</span>
<span>      <span class='st'>"Medium (0.33–0.66)"</span> <span class='op'>=</span> <span class='fl'>0.60</span>,</span>
<span>      <span class='st'>"High (0.66–1.0)"</span>    <span class='op'>=</span> <span class='fl'>0.95</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    na.translate <span class='op'>=</span> <span class='cn'>FALSE</span>, </span>
<span>    guide <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/guide_legend.html'>guide_legend</a></span><span class='op'>(</span></span>
<span>      order        <span class='op'>=</span> <span class='fl'>1</span>,</span>
<span>      override.aes <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span></span>
<span>        shape  <span class='op'>=</span> <span class='fl'>21</span>,</span>
<span>        size   <span class='op'>=</span> <span class='fl'>9</span>,</span>
<span>        fill   <span class='op'>=</span> <span class='st'>"grey60"</span>,</span>
<span>        colour <span class='op'>=</span> <span class='st'>"grey30"</span>,</span>
<span>        stroke <span class='op'>=</span> <span class='fl'>0.4</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='va'>size_scale</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span></span>
<span>    name   <span class='op'>=</span> <span class='st'>"CO₂ emissions per capita (tons, log scale)"</span>,</span>
<span>    breaks <span class='op'>=</span> <span class='va'>co2_ticks</span>,</span>
<span>    labels <span class='op'>=</span> <span class='va'>co2_vals</span>,</span>
<span>    expand <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expansion.html'>expansion</a></span><span class='op'>(</span>mult <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.02</span>, <span class='fl'>0.08</span><span class='op'>)</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span></span>
<span>    name   <span class='op'>=</span> <span class='st'>"Human Development Index (0–1)"</span>,</span>
<span>    breaks <span class='op'>=</span> <span class='va'>ref_y</span>,</span>
<span>    expand <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expansion.html'>expansion</a></span><span class='op'>(</span>mult <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.02</span>, <span class='fl'>0.05</span><span class='op'>)</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_cartesian.html'>coord_cartesian</a></span><span class='op'>(</span></span>
<span>    xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log1p</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>40</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>    ylim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.30</span>, <span class='fl'>1.00</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>    title <span class='op'>=</span> <span class='st'>"Democratic Governance Enables High Development at Lower Carbon Emissions"</span>,</span>
<span>  subtitle <span class='op'>=</span> <span class='st'>"All countries, coloured by size group. Transparency shows democracy (V-Dem), </span></span>
<span><span class='st'>    curves are GAM fits by size; arrows show 1990–2022 trajectories. </span></span>
<span><span class='st'>  Text highlights how small states compare to big states."</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>theme_uc3m</span><span class='op'>(</span>grid <span class='op'>=</span> <span class='cn'>FALSE</span>, base_size <span class='op'>=</span> <span class='fl'>22</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/guides.html'>guides</a></span><span class='op'>(</span></span>
<span>    fill <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/guide_legend.html'>guide_legend</a></span><span class='op'>(</span></span>
<span>      order        <span class='op'>=</span> <span class='fl'>2</span>,</span>
<span>      nrow         <span class='op'>=</span> <span class='fl'>1</span>,</span>
<span>      override.aes <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span></span>
<span>        shape  <span class='op'>=</span> <span class='fl'>21</span>,</span>
<span>        size   <span class='op'>=</span> <span class='fl'>8</span>,</span>
<span>        stroke <span class='op'>=</span> <span class='fl'>0.3</span>,</span>
<span>        colour <span class='op'>=</span> <span class='va'>dark_col</span>,</span>
<span>        alpha  <span class='op'>=</span> <span class='fl'>1</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    legend.position      <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.97</span>, <span class='fl'>0.05</span><span class='op'>)</span>,</span>
<span>    legend.justification <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>0</span><span class='op'>)</span>,</span>
<span>    legend.direction     <span class='op'>=</span> <span class='st'>"vertical"</span>,</span>
<span>    legend.box           <span class='op'>=</span> <span class='st'>"vertical"</span>,</span>
<span>    legend.key.height <span class='op'>=</span> <span class='fu'>grid</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>16</span>, <span class='st'>"mm"</span><span class='op'>)</span>,</span>
<span>    legend.key.width  <span class='op'>=</span> <span class='fu'>grid</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>26</span>, <span class='st'>"mm"</span><span class='op'>)</span>,</span>
<span>    legend.spacing.y  <span class='op'>=</span> <span class='fu'>grid</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>8</span>, <span class='st'>"pt"</span><span class='op'>)</span>,</span>
<span>    legend.background <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span></span>
<span>      fill      <span class='op'>=</span> <span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org/reference/alpha.html'>alpha</a></span><span class='op'>(</span><span class='st'>"white"</span>, <span class='fl'>0.92</span><span class='op'>)</span>,</span>
<span>      colour    <span class='op'>=</span> <span class='st'>"grey60"</span>,</span>
<span>      linewidth <span class='op'>=</span> <span class='fl'>1</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    legend.text  <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>20</span>, hjust <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span>,</span>
<span>    legend.title <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>face <span class='op'>=</span> <span class='st'>"bold"</span>, size <span class='op'>=</span> <span class='fl'>20</span>, hjust <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span>,</span>
<span>    plot.margin   <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span><span class='fl'>12</span>, <span class='fl'>12</span>, <span class='fl'>12</span>, <span class='fl'>12</span><span class='op'>)</span>,</span>
<span>    plot.subtitle <span class='op'>=</span> <span class='fu'>ggtext</span><span class='fu'>::</span><span class='fu'><a href='https://wilkelab.org/ggtext/reference/element_markdown.html'>element_markdown</a></span><span class='op'>(</span></span>
<span>      size       <span class='op'>=</span> <span class='fl'>30</span>,</span>
<span>      lineheight <span class='op'>=</span> <span class='fl'>1</span>,</span>
<span>      margin     <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>b <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span><span class='va'>figA</span></span></code></pre>
</div>
<p><img src="100502844_files/figure-html5/panel-a-scatter-1.png" width="100%" data-distill-preview=1 style="display: block; margin: auto;" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/exists.html'>exists</a></span><span class='op'>(</span><span class='st'>"label_log1p_tons"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>  <span class='va'>label_log1p_tons</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>    <span class='va'>vals</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>1</span></span>
<span>    <span class='va'>vals</span><span class='op'>[</span><span class='va'>vals</span> <span class='op'>&lt;</span> <span class='fl'>0</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>0</span></span>
<span>    <span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org/reference/number.html'>number</a></span><span class='op'>(</span><span class='va'>vals</span>, accuracy <span class='op'>=</span> <span class='fl'>0.1</span>, big.mark <span class='op'>=</span> <span class='st'>","</span><span class='op'>)</span></span>
<span>  <span class='op'>}</span></span>
<span><span class='op'>}</span></span></code></pre>
</div>
</div>
<h6 id="panel-b-democracy">Panel B – Democracy</h6>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Panel B – Democracy (freedom_latest)</span></span>
<span><span class='va'>figB</span> <span class='op'>&lt;-</span> <span class='va'>df_model</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span></span>
<span>    <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>size_ridge</span><span class='op'>)</span>,</span>
<span>    <span class='fu'><a href='https://rdrr.io/r/base/is.finite.html'>is.finite</a></span><span class='op'>(</span><span class='va'>freedom_latest</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span></span>
<span>    <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>freedom_latest</span>, y <span class='op'>=</span> <span class='va'>size_ridge</span>, fill <span class='op'>=</span> <span class='va'>size_ridge</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggridges</span><span class='fu'>::</span><span class='fu'><a href='https://wilkelab.org/ggridges/reference/geom_density_ridges.html'>geom_density_ridges</a></span><span class='op'>(</span></span>
<span>    scale     <span class='op'>=</span> <span class='fl'>0.9</span>,</span>
<span>    alpha     <span class='op'>=</span> <span class='fl'>0.7</span>,</span>
<span>    color     <span class='op'>=</span> <span class='st'>"white"</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='fl'>1</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span></span>
<span>    data        <span class='op'>=</span> <span class='va'>medians_latest</span>,</span>
<span>    <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>      xintercept <span class='op'>=</span> <span class='va'>median_freedom</span>,</span>
<span>      color      <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>size_group</span>, levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"small"</span>, <span class='st'>"midsized"</span>, <span class='st'>"big"</span><span class='op'>)</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    linetype    <span class='op'>=</span> <span class='st'>"dashed"</span>,</span>
<span>    linewidth   <span class='op'>=</span> <span class='fl'>0.7</span>,</span>
<span>    alpha       <span class='op'>=</span> <span class='fl'>0.8</span>,</span>
<span>    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_fill_manual</a></span><span class='op'>(</span></span>
<span>    values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>      <span class='st'>"small states"</span>    <span class='op'>=</span> <span class='va'>col_small</span>,</span>
<span>      <span class='st'>"midsized states"</span> <span class='op'>=</span> <span class='va'>col_mid</span>,</span>
<span>      <span class='st'>"big states"</span>      <span class='op'>=</span> <span class='va'>col_big</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    guide <span class='op'>=</span> <span class='st'>"none"</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_color_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>size_colors</span>, guide <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span></span>
<span>    name   <span class='op'>=</span> <span class='st'>"V-Dem Liberal Democracy Index (0–1)"</span>,</span>
<span>    breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span>, <span class='fl'>0.2</span><span class='op'>)</span>,</span>
<span>    expand <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expansion.html'>expansion</a></span><span class='op'>(</span>mult <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.02</span>, <span class='fl'>0.02</span><span class='op'>)</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_discrete.html'>scale_y_discrete</a></span><span class='op'>(</span></span>
<span>    expand <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expansion.html'>expansion</a></span><span class='op'>(</span>mult <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.05</span>, <span class='fl'>0.25</span><span class='op'>)</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>    title <span class='op'>=</span> <span class='fu'>glue</span><span class='fu'>::</span><span class='fu'><a href='https://glue.tidyverse.org/reference/glue.html'>glue</a></span><span class='op'>(</span></span>
<span>      <span class='st'>"Small States Are {round(model_results$narrative_stats$freedom_diff_pct, 0)}% More Democratic"</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    subtitle <span class='op'>=</span> <span class='fu'>glue</span><span class='fu'>::</span><span class='fu'><a href='https://glue.tidyverse.org/reference/glue.html'>glue</a></span><span class='op'>(</span></span>
<span>      <span class='st'>"Median: Small = {round(medians_latest$median_freedom[medians_latest$size_group=='small'], 3)}, "</span>,</span>
<span>      <span class='st'>"Mid = {round(medians_latest$median_freedom[medians_latest$size_group=='midsized'], 3)}, "</span>,</span>
<span>      <span class='st'>"Big = {round(medians_latest$median_freedom[medians_latest$size_group=='big'], 3)}"</span></span>
<span>    <span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>theme_uc3m</span><span class='op'>(</span>grid <span class='op'>=</span> <span class='cn'>FALSE</span>, base_size <span class='op'>=</span> <span class='fl'>22</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    plot.title    <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>22</span>, face <span class='op'>=</span> <span class='st'>"bold"</span><span class='op'>)</span>,</span>
<span>    plot.subtitle <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span>,</span>
<span>    axis.title.y  <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    axis.text.y   <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      size  <span class='op'>=</span> <span class='fl'>24</span>,</span>
<span>      face  <span class='op'>=</span> <span class='st'>"italic"</span>,</span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0.5</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    axis.ticks.y  <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    plot.margin   <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span><span class='fl'>6</span>, <span class='fl'>6</span>, <span class='fl'>6</span>, <span class='fl'>6</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>figB</span></span></code></pre>
</div>
<p><img src="100502844_files/figure-html5/panel-b-democracy-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<h6 id="panel-c-co2-log">Panel C – CO2 (log)</h6>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Panel C – CO2 (log)</span></span>
<span><span class='va'>figC</span> <span class='op'>&lt;-</span> <span class='va'>df_model</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span></span>
<span>    <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>size_ridge</span><span class='op'>)</span>,</span>
<span>    <span class='fu'><a href='https://rdrr.io/r/base/is.finite.html'>is.finite</a></span><span class='op'>(</span><span class='va'>co2log_latest</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span></span>
<span>    <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>co2log_latest</span>, y <span class='op'>=</span> <span class='va'>size_ridge</span>, fill <span class='op'>=</span> <span class='va'>size_ridge</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggridges</span><span class='fu'>::</span><span class='fu'><a href='https://wilkelab.org/ggridges/reference/geom_density_ridges.html'>geom_density_ridges</a></span><span class='op'>(</span></span>
<span>    scale     <span class='op'>=</span> <span class='fl'>0.9</span>,</span>
<span>    alpha     <span class='op'>=</span> <span class='fl'>0.7</span>,</span>
<span>    color     <span class='op'>=</span> <span class='st'>"white"</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='fl'>1</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span></span>
<span>    data        <span class='op'>=</span> <span class='va'>medians_latest</span>,</span>
<span>    <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>      xintercept <span class='op'>=</span> <span class='va'>median_co2</span>,</span>
<span>      color      <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>size_group</span>, levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"small"</span>, <span class='st'>"midsized"</span>, <span class='st'>"big"</span><span class='op'>)</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    linetype    <span class='op'>=</span> <span class='st'>"dashed"</span>,</span>
<span>    linewidth   <span class='op'>=</span> <span class='fl'>0.7</span>,</span>
<span>    alpha       <span class='op'>=</span> <span class='fl'>0.8</span>,</span>
<span>    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_fill_manual</a></span><span class='op'>(</span></span>
<span>    values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>      <span class='st'>"small states"</span>    <span class='op'>=</span> <span class='va'>col_small</span>,</span>
<span>      <span class='st'>"midsized states"</span> <span class='op'>=</span> <span class='va'>col_mid</span>,</span>
<span>      <span class='st'>"big states"</span>      <span class='op'>=</span> <span class='va'>col_big</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    guide <span class='op'>=</span> <span class='st'>"none"</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_color_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>size_colors</span>, guide <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span></span>
<span>    name   <span class='op'>=</span> <span class='st'>"CO₂ per capita (tons, log scale)"</span>,</span>
<span>    breaks <span class='op'>=</span> <span class='va'>co2_ticks</span>,</span>
<span>    labels <span class='op'>=</span> <span class='va'>label_log1p_tons</span>,</span>
<span>    expand <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expansion.html'>expansion</a></span><span class='op'>(</span>mult <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.02</span>, <span class='fl'>0.02</span><span class='op'>)</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_discrete.html'>scale_y_discrete</a></span><span class='op'>(</span></span>
<span>    expand <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expansion.html'>expansion</a></span><span class='op'>(</span>mult <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.05</span>, <span class='fl'>0.25</span><span class='op'>)</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>    title <span class='op'>=</span> <span class='fu'>glue</span><span class='fu'>::</span><span class='fu'><a href='https://glue.tidyverse.org/reference/glue.html'>glue</a></span><span class='op'>(</span></span>
<span>      <span class='st'>"Small States Emit {round(model_results$narrative_stats$co2_diff_pct, 0)}% Less CO₂ Per Capita"</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    subtitle <span class='op'>=</span> <span class='fu'>glue</span><span class='fu'>::</span><span class='fu'><a href='https://glue.tidyverse.org/reference/glue.html'>glue</a></span><span class='op'>(</span></span>
<span>      <span class='st'>"Median: Small = {round(medians_latest$median_co2_raw[medians_latest$size_group=='small'], 2)} tons, "</span>,</span>
<span>      <span class='st'>"Mid = {round(medians_latest$median_co2_raw[medians_latest$size_group=='midsized'], 2)} tons, "</span>,</span>
<span>      <span class='st'>"Big = {round(medians_latest$median_co2_raw[medians_latest$size_group=='big'], 2)} tons"</span></span>
<span>    <span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>theme_uc3m</span><span class='op'>(</span>grid <span class='op'>=</span> <span class='cn'>FALSE</span>, base_size <span class='op'>=</span> <span class='fl'>22</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    plot.title    <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>22</span>, face <span class='op'>=</span> <span class='st'>"bold"</span><span class='op'>)</span>,</span>
<span>    plot.subtitle <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span>,</span>
<span>    axis.title.y  <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    axis.text.y   <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    axis.ticks.y  <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    plot.margin   <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span><span class='fl'>6</span>, <span class='fl'>6</span>, <span class='fl'>6</span>, <span class='fl'>6</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span><span class='va'>figC</span></span></code></pre>
</div>
<p><img src="100502844_files/figure-html5/panel-c-co2-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<h6 id="panel-d-hdi">Panel D – HDI</h6>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Panel D – HDI</span></span>
<span><span class='va'>figD</span> <span class='op'>&lt;-</span> <span class='va'>df_model</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span></span>
<span>    <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>size_ridge</span><span class='op'>)</span>,</span>
<span>    <span class='fu'><a href='https://rdrr.io/r/base/is.finite.html'>is.finite</a></span><span class='op'>(</span><span class='va'>hdi_latest</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span></span>
<span>    <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>hdi_latest</span>, y <span class='op'>=</span> <span class='va'>size_ridge</span>, fill <span class='op'>=</span> <span class='va'>size_ridge</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggridges</span><span class='fu'>::</span><span class='fu'><a href='https://wilkelab.org/ggridges/reference/geom_density_ridges.html'>geom_density_ridges</a></span><span class='op'>(</span></span>
<span>    scale     <span class='op'>=</span> <span class='fl'>0.9</span>,</span>
<span>    alpha     <span class='op'>=</span> <span class='fl'>0.7</span>,</span>
<span>    color     <span class='op'>=</span> <span class='st'>"white"</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='fl'>1</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span></span>
<span>    data        <span class='op'>=</span> <span class='va'>medians_latest</span>,</span>
<span>    <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>      xintercept <span class='op'>=</span> <span class='va'>median_hdi</span>,</span>
<span>      color      <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>size_group</span>, levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"small"</span>, <span class='st'>"midsized"</span>, <span class='st'>"big"</span><span class='op'>)</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    linetype    <span class='op'>=</span> <span class='st'>"dashed"</span>,</span>
<span>    linewidth   <span class='op'>=</span> <span class='fl'>0.7</span>,</span>
<span>    alpha       <span class='op'>=</span> <span class='fl'>0.8</span>,</span>
<span>    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_fill_manual</a></span><span class='op'>(</span></span>
<span>    values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>      <span class='st'>"small states"</span>    <span class='op'>=</span> <span class='va'>col_small</span>,</span>
<span>      <span class='st'>"midsized states"</span> <span class='op'>=</span> <span class='va'>col_mid</span>,</span>
<span>      <span class='st'>"big states"</span>      <span class='op'>=</span> <span class='va'>col_big</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    guide <span class='op'>=</span> <span class='st'>"none"</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_color_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>size_colors</span>, guide <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span></span>
<span>    name   <span class='op'>=</span> <span class='st'>"Human Development Index (0–1)"</span>,</span>
<span>    breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fl'>0.3</span>, <span class='fl'>1.0</span>, <span class='fl'>0.1</span><span class='op'>)</span>,</span>
<span>    expand <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expansion.html'>expansion</a></span><span class='op'>(</span>mult <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.02</span>, <span class='fl'>0.02</span><span class='op'>)</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_discrete.html'>scale_y_discrete</a></span><span class='op'>(</span></span>
<span>    expand <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expansion.html'>expansion</a></span><span class='op'>(</span>mult <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.05</span>, <span class='fl'>0.25</span><span class='op'>)</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>    title <span class='op'>=</span> <span class='st'>"HDI Varies Within All Size Groups"</span>,</span>
<span>    subtitle <span class='op'>=</span> <span class='fu'>glue</span><span class='fu'>::</span><span class='fu'><a href='https://glue.tidyverse.org/reference/glue.html'>glue</a></span><span class='op'>(</span></span>
<span>      <span class='st'>"Median: Small = {round(medians_latest$median_hdi[medians_latest$size_group=='small'], 3)}, "</span>,</span>
<span>      <span class='st'>"Mid = {round(medians_latest$median_hdi[medians_latest$size_group=='midsized'], 3)}, "</span>,</span>
<span>      <span class='st'>"Big = {round(medians_latest$median_hdi[medians_latest$size_group=='big'], 3)}"</span></span>
<span>    <span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>theme_uc3m</span><span class='op'>(</span>grid <span class='op'>=</span> <span class='cn'>FALSE</span>, base_size <span class='op'>=</span> <span class='fl'>22</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    plot.title    <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>22</span>, face <span class='op'>=</span> <span class='st'>"bold"</span><span class='op'>)</span>,</span>
<span>    plot.subtitle <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span>,</span>
<span>    axis.title.y  <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    axis.text.y   <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    axis.ticks.y  <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    plot.margin   <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span><span class='fl'>6</span>, <span class='fl'>6</span>, <span class='fl'>6</span>, <span class='fl'>6</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span><span class='va'>figD</span> </span></code></pre>
</div>
<p><img src="100502844_files/figure-html5/panel-d-hdi-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<h6 id="panel-e-efficiency-pair-co2-absolute-hdico2">Panel E – efficiency pair (CO2 absolute &amp; HDI/CO2)</h6>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>eff_data</span> <span class='op'>&lt;-</span> <span class='va'>df_model</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span></span>
<span>    <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>size_group</span><span class='op'>)</span>,</span>
<span>    <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>hdi_per_co2_latest</span><span class='op'>)</span>,</span>
<span>    <span class='fu'><a href='https://rdrr.io/r/base/is.finite.html'>is.finite</a></span><span class='op'>(</span><span class='va'>hdi_per_co2_latest</span><span class='op'>)</span>,</span>
<span>    <span class='fu'><a href='https://rdrr.io/r/base/is.finite.html'>is.finite</a></span><span class='op'>(</span><span class='va'>co2pc_latest</span><span class='op'>)</span>,</span>
<span>    <span class='va'>co2pc_latest</span> <span class='op'>&gt;</span> <span class='fl'>0.1</span>,</span>
<span>    <span class='va'>hdi_per_co2_latest</span> <span class='op'>&gt;</span> <span class='fl'>0</span>,</span>
<span>    <span class='va'>hdi_per_co2_latest</span> <span class='op'>&lt;</span> <span class='fl'>10</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>eff_q</span> <span class='op'>&lt;-</span> <span class='fu'>stats</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/quantile.html'>quantile</a></span><span class='op'>(</span></span>
<span>  <span class='va'>eff_data</span><span class='op'>$</span><span class='va'>hdi_per_co2_latest</span>,</span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.02</span>, <span class='fl'>0.98</span><span class='op'>)</span>,</span>
<span>  na.rm <span class='op'>=</span> <span class='cn'>TRUE</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>eff_data</span> <span class='op'>&lt;-</span> <span class='va'>eff_data</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    hdi_eff_robust <span class='op'>=</span> <span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org/reference/oob.html'>squish</a></span><span class='op'>(</span><span class='va'>hdi_per_co2_latest</span>, range <span class='op'>=</span> <span class='va'>eff_q</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>medians_eff</span> <span class='op'>&lt;-</span> <span class='va'>eff_data</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>size_group</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span></span>
<span>    median_eff <span class='op'>=</span> <span class='fu'>stats</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/median.html'>median</a></span><span class='op'>(</span><span class='va'>hdi_eff_robust</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,</span>
<span>    .groups    <span class='op'>=</span> <span class='st'>"drop"</span></span>
<span>  <span class='op'>)</span></span></code></pre>
</div>
</div>
<h6 id="left-efficiency-panel-absolute-co2">Left efficiency panel – absolute CO2</h6>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Left efficiency panel – absolute CO2</span></span>
<span><span class='va'>figE_left</span> <span class='op'>&lt;-</span> <span class='va'>df_model</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span></span>
<span>    <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>size_group</span><span class='op'>)</span>,</span>
<span>    <span class='fu'><a href='https://rdrr.io/r/base/is.finite.html'>is.finite</a></span><span class='op'>(</span><span class='va'>co2pc_latest</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span></span>
<span>    <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>co2pc_latest</span>, y <span class='op'>=</span> <span class='va'>size_group</span>, fill <span class='op'>=</span> <span class='va'>size_group</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggridges</span><span class='fu'>::</span><span class='fu'><a href='https://wilkelab.org/ggridges/reference/geom_density_ridges.html'>geom_density_ridges</a></span><span class='op'>(</span></span>
<span>    scale     <span class='op'>=</span> <span class='fl'>0.9</span>,</span>
<span>    alpha     <span class='op'>=</span> <span class='fl'>0.7</span>,</span>
<span>    color     <span class='op'>=</span> <span class='st'>"white"</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='fl'>1</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span></span>
<span>    data        <span class='op'>=</span> <span class='va'>medians_latest</span>,</span>
<span>    <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>xintercept <span class='op'>=</span> <span class='va'>median_co2_raw</span>, color <span class='op'>=</span> <span class='va'>size_group</span><span class='op'>)</span>,</span>
<span>    linetype    <span class='op'>=</span> <span class='st'>"dashed"</span>,</span>
<span>    linewidth   <span class='op'>=</span> <span class='fl'>0.7</span>,</span>
<span>    alpha       <span class='op'>=</span> <span class='fl'>0.8</span>,</span>
<span>    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_fill_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>size_colors</span>, guide <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_color_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>size_colors</span>, guide <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span></span>
<span>    name   <span class='op'>=</span> <span class='st'>"CO₂ per capita (tons)"</span>,</span>
<span>    breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>20</span>, <span class='fl'>5</span><span class='op'>)</span>,</span>
<span>    expand <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expansion.html'>expansion</a></span><span class='op'>(</span>mult <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.02</span>, <span class='fl'>0.02</span><span class='op'>)</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_discrete.html'>scale_y_discrete</a></span><span class='op'>(</span></span>
<span>    expand <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expansion.html'>expansion</a></span><span class='op'>(</span>mult <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.05</span>, <span class='fl'>0.25</span><span class='op'>)</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_cartesian.html'>coord_cartesian</a></span><span class='op'>(</span>xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>20</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>    title    <span class='op'>=</span> <span class='st'>"Small States Have the Lowest Absolute Emissions"</span>,</span>
<span>    subtitle <span class='op'>=</span> <span class='st'>"Good for the planet"</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>theme_uc3m</span><span class='op'>(</span>grid <span class='op'>=</span> <span class='cn'>FALSE</span>, base_size <span class='op'>=</span> <span class='fl'>22</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    plot.title    <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>22</span>, face <span class='op'>=</span> <span class='st'>"bold"</span><span class='op'>)</span>,</span>
<span>    plot.subtitle <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>20</span>, color <span class='op'>=</span> <span class='va'>col_small</span>, face <span class='op'>=</span> <span class='st'>"bold"</span><span class='op'>)</span>,</span>
<span>    axis.title.y  <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    axis.text.y   <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    axis.ticks.y  <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    plot.margin   <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span><span class='fl'>6</span>, <span class='fl'>3</span>, <span class='fl'>6</span>, <span class='fl'>6</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span><span class='va'>figE_left</span></span></code></pre>
</div>
<p><img src="100502844_files/figure-html5/panel-e-co2-absolute-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<h6 id="right-efficiency-panel-hdi-per-co2">Right efficiency panel – HDI per CO2</h6>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Right efficiency panel – HDI per CO2</span></span>
<span><span class='va'>figE_right</span> <span class='op'>&lt;-</span> <span class='va'>eff_data</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/is.finite.html'>is.finite</a></span><span class='op'>(</span><span class='va'>hdi_eff_robust</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span></span>
<span>    <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>hdi_eff_robust</span>, y <span class='op'>=</span> <span class='va'>size_group</span>, fill <span class='op'>=</span> <span class='va'>size_group</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggridges</span><span class='fu'>::</span><span class='fu'><a href='https://wilkelab.org/ggridges/reference/geom_density_ridges.html'>geom_density_ridges</a></span><span class='op'>(</span></span>
<span>    scale     <span class='op'>=</span> <span class='fl'>0.9</span>,</span>
<span>    alpha     <span class='op'>=</span> <span class='fl'>0.7</span>,</span>
<span>    color     <span class='op'>=</span> <span class='st'>"white"</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='fl'>1</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span></span>
<span>    data        <span class='op'>=</span> <span class='va'>medians_eff</span>,</span>
<span>    <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>xintercept <span class='op'>=</span> <span class='va'>median_eff</span>, color <span class='op'>=</span> <span class='va'>size_group</span><span class='op'>)</span>,</span>
<span>    linetype    <span class='op'>=</span> <span class='st'>"dashed"</span>,</span>
<span>    linewidth   <span class='op'>=</span> <span class='fl'>0.7</span>,</span>
<span>    alpha       <span class='op'>=</span> <span class='fl'>0.8</span>,</span>
<span>    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_fill_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>size_colors</span>, guide <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_color_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>size_colors</span>, guide <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span></span>
<span>    name   <span class='op'>=</span> <span class='st'>"HDI per unit CO₂ (efficiency)"</span>,</span>
<span>    breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>2</span>, <span class='fl'>0.5</span><span class='op'>)</span>,</span>
<span>    expand <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expansion.html'>expansion</a></span><span class='op'>(</span>mult <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.02</span>, <span class='fl'>0.02</span><span class='op'>)</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_discrete.html'>scale_y_discrete</a></span><span class='op'>(</span></span>
<span>    expand <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expansion.html'>expansion</a></span><span class='op'>(</span>mult <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.05</span>, <span class='fl'>0.25</span><span class='op'>)</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>    title    <span class='op'>=</span> <span class='st'>"Midsized States Have the Highest Efficiency"</span>,</span>
<span>    subtitle <span class='op'>=</span> <span class='st'>"Most HDI per unit CO₂"</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>theme_uc3m</span><span class='op'>(</span>grid <span class='op'>=</span> <span class='cn'>FALSE</span>, base_size <span class='op'>=</span> <span class='fl'>22</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    plot.title    <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>22</span>, face <span class='op'>=</span> <span class='st'>"bold"</span><span class='op'>)</span>,</span>
<span>    plot.subtitle <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>20</span>, color <span class='op'>=</span> <span class='va'>col_mid</span>, face <span class='op'>=</span> <span class='st'>"bold"</span><span class='op'>)</span>,</span>
<span>    axis.title.y  <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    axis.text.y   <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    axis.ticks.y  <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    plot.margin   <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span><span class='fl'>6</span>, <span class='fl'>6</span>, <span class='fl'>6</span>, <span class='fl'>3</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>figE_right</span></span></code></pre>
</div>
<p><img src="100502844_files/figure-html5/panel-e-hdi-per-co2-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>p_bottom_left_text</span> <span class='op'>&lt;-</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/lims.html'>xlim</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/lims.html'>ylim</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_void</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>    <span class='st'>"richtext"</span>,</span>
<span>    x <span class='op'>=</span> <span class='fl'>0</span>, y <span class='op'>=</span> <span class='fl'>0.4</span>,</span>
<span>    label  <span class='op'>=</span> <span class='va'>bottom_left_html</span>,</span>
<span>    hjust  <span class='op'>=</span> <span class='fl'>0</span>, vjust <span class='op'>=</span> <span class='fl'>0.5</span>,</span>
<span>    family <span class='op'>=</span> <span class='va'>base_font</span>,</span>
<span>    size   <span class='op'>=</span> <span class='fl'>8.2</span>,</span>
<span>    color  <span class='op'>=</span> <span class='va'>dark_col</span>,</span>
<span>    fill   <span class='op'>=</span> <span class='va'>bg_col</span>,</span>
<span>    label.color   <span class='op'>=</span> <span class='cn'>NA</span>,</span>
<span>    label.r       <span class='op'>=</span> <span class='fu'>grid</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='st'>"pt"</span><span class='op'>)</span>,</span>
<span>    label.padding <span class='op'>=</span> <span class='fu'>grid</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='st'>"pt"</span><span class='op'>)</span>,</span>
<span>    lineheight    <span class='op'>=</span> <span class='fl'>1</span></span>
<span>  <span class='op'>)</span></span>
<span><span class='va'>p_bottom_left_text</span></span></code></pre>
</div>
<p><img src="100502844_files/figure-html5/bottem-text-panel-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<h6 id="save-panels-and-assemble-layout">Save panels and Assemble Layout</h6>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>all_panels</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span></span>
<span>  map        <span class='op'>=</span> <span class='va'>map_panel</span>,</span>
<span>  figA       <span class='op'>=</span> <span class='va'>figA</span>,</span>
<span>  figB       <span class='op'>=</span> <span class='va'>figB</span>,</span>
<span>  figC       <span class='op'>=</span> <span class='va'>figC</span>,</span>
<span>  figD       <span class='op'>=</span> <span class='va'>figD</span>,</span>
<span>  figE_left  <span class='op'>=</span> <span class='va'>figE_left</span>,</span>
<span>  figE_right <span class='op'>=</span> <span class='va'>figE_right</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/readRDS.html'>saveRDS</a></span><span class='op'>(</span><span class='va'>all_panels</span>, <span class='st'>"data/cache/all_panels.rds"</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>drop_leg</span> <span class='op'>&lt;-</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>map_panel_final</span>  <span class='op'>&lt;-</span> <span class='va'>map_panel</span>  <span class='op'>+</span> <span class='va'>drop_leg</span></span>
<span><span class='va'>figA_final</span>       <span class='op'>&lt;-</span> <span class='va'>figA</span>       <span class='co'># keep legend on main scatter</span></span>
<span><span class='va'>figB_final</span>       <span class='op'>&lt;-</span> <span class='va'>figB</span> <span class='op'>+</span> <span class='va'>drop_leg</span></span>
<span><span class='va'>figC_final</span>       <span class='op'>&lt;-</span> <span class='va'>figC</span> <span class='op'>+</span> <span class='va'>drop_leg</span></span>
<span><span class='va'>figD_final</span>       <span class='op'>&lt;-</span> <span class='va'>figD</span> <span class='op'>+</span> <span class='va'>drop_leg</span></span>
<span><span class='va'>figE_left_final</span>  <span class='op'>&lt;-</span> <span class='va'>figE_left</span>  <span class='op'>+</span> <span class='va'>drop_leg</span></span>
<span><span class='va'>figE_right_final</span> <span class='op'>&lt;-</span> <span class='va'>figE_right</span> <span class='op'>+</span> <span class='va'>drop_leg</span></span>
<span></span>
<span><span class='va'>right_column</span> <span class='op'>&lt;-</span> <span class='fu'>cowplot</span><span class='fu'>::</span><span class='fu'><a href='https://wilkelab.org/cowplot/reference/plot_grid.html'>plot_grid</a></span><span class='op'>(</span></span>
<span>  <span class='va'>map_panel_final</span>,</span>
<span>  <span class='va'>figE_left_final</span>,</span>
<span>  <span class='va'>figE_right_final</span>,</span>
<span>  ncol        <span class='op'>=</span> <span class='fl'>1</span>,</span>
<span>  rel_heights <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.90</span>, <span class='fl'>0.90</span>, <span class='fl'>0.90</span><span class='op'>)</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>bottom_row</span> <span class='op'>&lt;-</span> <span class='fu'>cowplot</span><span class='fu'>::</span><span class='fu'><a href='https://wilkelab.org/cowplot/reference/plot_grid.html'>plot_grid</a></span><span class='op'>(</span></span>
<span>  <span class='va'>p_bottom_left_text</span>,</span>
<span>  <span class='va'>figB_final</span>,</span>
<span>  <span class='va'>figC_final</span>,</span>
<span>  <span class='va'>figD_final</span>,</span>
<span>  ncol       <span class='op'>=</span> <span class='fl'>5</span>,</span>
<span>  rel_widths <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span> , <span class='fl'>2.8</span>, <span class='fl'>2.8</span>, <span class='fl'>2.8</span> <span class='op'>)</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>top_section</span> <span class='op'>&lt;-</span> <span class='fu'>cowplot</span><span class='fu'>::</span><span class='fu'><a href='https://wilkelab.org/cowplot/reference/plot_grid.html'>plot_grid</a></span><span class='op'>(</span></span>
<span>  <span class='va'>figA_final</span>,</span>
<span>  <span class='va'>right_column</span>,</span>
<span>  ncol       <span class='op'>=</span> <span class='fl'>2</span>,</span>
<span>  rel_widths <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>4</span>, <span class='fl'>1</span><span class='op'>)</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>global_caption</span> <span class='op'>&lt;-</span> <span class='fu'>glue</span><span class='fu'>::</span><span class='fu'><a href='https://glue.tidyverse.org/reference/glue.html'>glue</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"Data: UNDP (HDI); Our World in Data (CO2); World Bank (Population); V-Dem v14 (Democracy). "</span>,</span>
<span>  <span class='st'>"Coverage: {YEAR_START}\u2013{YEAR_END}, {dplyr::n_distinct(df$iso3)} countries. "</span>,</span>
<span>  <span class='st'>"Model: GAM (R\u00b2 = {round(gam_rsq, 3)}, \u0394AIC = {round(model_results$narrative_stats$aic_improvement, 1)} vs linear). "</span>,</span>
<span>  <span class='st'>"Size groups: Small &lt;{SMALL_POP/1e6}M (n = {sum(df_latest$size_group == 'small',    na.rm = TRUE)}); "</span>,</span>
<span>  <span class='st'>"Midsized {SMALL_POP/1e6}\u2013{MID_POP/1e6}M (n = {sum(df_latest$size_group == 'midsized', na.rm = TRUE)}); "</span>,</span>
<span>  <span class='st'>"Big &gt;{MID_POP/1e6}M (n = {sum(df_latest$size_group == 'big',    na.rm = TRUE)})."</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>final_figure</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='va'>top_section</span> <span class='op'>/</span> <span class='va'>bottom_row</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>patchwork</span><span class='fu'>::</span><span class='fu'><a href='https://patchwork.data-imaginist.com/reference/plot_layout.html'>plot_layout</a></span><span class='op'>(</span>heights <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>4</span>, <span class='fl'>1.2</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>patchwork</span><span class='fu'>::</span><span class='fu'><a href='https://patchwork.data-imaginist.com/reference/plot_annotation.html'>plot_annotation</a></span><span class='op'>(</span></span>
<span>    caption <span class='op'>=</span> <span class='va'>global_caption</span>,</span>
<span>    theme <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>      plot.background  <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>bg_col</span>, color <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span>,</span>
<span>      panel.background <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>bg_col</span>, color <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span>,</span>
<span>      plot.caption     <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>        size       <span class='op'>=</span> <span class='fl'>18</span>,          </span>
<span>        family     <span class='op'>=</span> <span class='va'>base_font</span>,</span>
<span>        color      <span class='op'>=</span> <span class='va'>dark_col</span>,</span>
<span>        hjust      <span class='op'>=</span> <span class='fl'>0</span>,</span>
<span>        vjust      <span class='op'>=</span> <span class='fl'>0</span>,</span>
<span>        margin     <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>16</span>, b <span class='op'>=</span> <span class='fl'>10</span>, l <span class='op'>=</span> <span class='fl'>14</span>, r <span class='op'>=</span> <span class='fl'>14</span><span class='op'>)</span>,</span>
<span>        lineheight <span class='op'>=</span> <span class='fl'>2</span></span>
<span>      <span class='op'>)</span>,</span>
<span>      plot.margin <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span><span class='fl'>10</span>, <span class='fl'>10</span>, <span class='fl'>10</span>, <span class='fl'>10</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span><span class='va'>final_figure</span></span></code></pre>
</div>
<p><img src="100502844_files/figure-html5/assemble-layout-1.png" width="100%" data-distill-preview=1 style="display: block; margin: auto;" /></p>
</div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="references">References</h3>
  <div id="references-listing"></div>
  <h3 id="reuse">Reuse</h3>
  <p>Text and figures are licensed under Creative Commons Attribution <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>. The figures that have been reused from other sources don't fall under this license and can be recognized by a note in their caption: "Figure from ...".</p>
  <h3 id="citation">Citation</h3>
  <p>For attribution, please cite this work as</p>
  <pre class="citation-appendix short">Tadmuri (2026, Jan. 6). Data Visualization | MSc CSS: Small Stats Can Be Big Players in Development and Good Governance. Retrieved from https://csslab.uc3m.es/dataviz/projects/2025/100502844/</pre>
  <p>BibTeX citation</p>
  <pre class="citation-appendix long">@misc{tadmuri2026small,
  author = {Tadmuri, Abdullah},
  title = {Data Visualization | MSc CSS: Small Stats Can Be Big Players in Development and Good Governance},
  url = {https://csslab.uc3m.es/dataviz/projects/2025/100502844/},
  year = {2026}
}</pre>
</div>
<!--/radix_placeholder_appendices-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<!--radix_placeholder_navigation_after_body--><html><body>
<div class="distill-site-nav distill-site-footer">
<p><img src="../../../assets/acronimo_nombre1l_0.png" width="400"></p>
</div>
<!--/radix_placeholder_navigation_after_body-->
</body></html>


</body>

</html>
