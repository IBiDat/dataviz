<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>


  <!--radix_placeholder_meta_tags-->
<title>Data Visualization | MSc CSS: Energy Production between 2004 and 2014</title>

<meta property="description" itemprop="description" content="This tutorial will replicate and improve a map full of pie charts. It is a perfect example of an information saturated visualization, since it uses a map to represent the total electric energy production as of 2014 by province, its energy sources and the production variation between 2004 and 2014. The objective of this tutorial is to demostrate that, most of the times, less is more."/>

<link rel="canonical" href="https://csslab.uc3m.es/dataviz/projects/2025/100564888/"/>
<link rel="license" href="https://creativecommons.org/licenses/by/4.0/"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2026-01-14"/>
<meta property="article:created" itemprop="dateCreated" content="2026-01-14"/>
<meta name="article:author" content="Noah Emanuel Fürup"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="Data Visualization | MSc CSS: Energy Production between 2004 and 2014"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="This tutorial will replicate and improve a map full of pie charts. It is a perfect example of an information saturated visualization, since it uses a map to represent the total electric energy production as of 2014 by province, its energy sources and the production variation between 2004 and 2014. The objective of this tutorial is to demostrate that, most of the times, less is more."/>
<meta property="og:url" content="https://csslab.uc3m.es/dataviz/projects/2025/100564888/"/>
<meta property="og:image" content="https://csslab.uc3m.es/dataviz/projects/2025/100564888/100564888_files/figure-html5/first plot-1.png"/>
<meta property="og:image:width" content="1248"/>
<meta property="og:image:height" content="768"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="Data Visualization | MSc CSS"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary_large_image"/>
<meta property="twitter:title" content="Data Visualization | MSc CSS: Energy Production between 2004 and 2014"/>
<meta property="twitter:description" content="This tutorial will replicate and improve a map full of pie charts. It is a perfect example of an information saturated visualization, since it uses a map to represent the total electric energy production as of 2014 by province, its energy sources and the production variation between 2004 and 2014. The objective of this tutorial is to demostrate that, most of the times, less is more."/>
<meta property="twitter:url" content="https://csslab.uc3m.es/dataviz/projects/2025/100564888/"/>
<meta property="twitter:image" content="https://csslab.uc3m.es/dataviz/projects/2025/100564888/100564888_files/figure-html5/first plot-1.png"/>
<meta property="twitter:image:width" content="1248"/>
<meta property="twitter:image:height" content="768"/>

<!--  https://scholar.google.com/intl/en/scholar/inclusion.html#indexing -->
<meta name="citation_title" content="Data Visualization | MSc CSS: Energy Production between 2004 and 2014"/>
<meta name="citation_fulltext_html_url" content="https://csslab.uc3m.es/dataviz/projects/2025/100564888/"/>
<meta name="citation_fulltext_world_readable" content=""/>
<meta name="citation_online_date" content="2026/01/14"/>
<meta name="citation_publication_date" content="2026/01/14"/>
<meta name="citation_author" content="Noah Emanuel Fürup"/>
<!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["creative_commons","title","description","categories","author","date","output","citation_url","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["CC BY"]},{"type":"character","attributes":{},"value":["Energy Production between 2004 and 2014"]},{"type":"character","attributes":{},"value":["This tutorial will replicate and improve a map full of pie charts. It is a perfect example of an information saturated visualization, since it uses a map to represent the total electric energy production as of 2014 by province, its energy sources and the production variation between 2004 and 2014. The objective of this tutorial is to demostrate that, most of the times, less is more."]},{"type":"character","attributes":{},"value":["2025"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["Noah Emanuel Fürup"]}]}]},{"type":"character","attributes":{},"value":["2026-01-14"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]}]}]},{"type":"character","attributes":{},"value":["https://csslab.uc3m.es/dataviz/projects/2025/100564888/"]},{"type":"character","attributes":{},"value":["https://csslab.uc3m.es/dataviz/projects/2025/100564888/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["100564888_files/anchor-4.2.2/anchor.min.js","100564888_files/bowser-1.9.3/bowser.min.js","100564888_files/distill-2.2.21/template.v2.js","100564888_files/figure-html5/add canary islands to the main map-1.png","100564888_files/figure-html5/add legend 1-1.png","100564888_files/figure-html5/background and aspect ratio-1.png","100564888_files/figure-html5/canary box-1.png","100564888_files/figure-html5/canary islands map-1.png","100564888_files/figure-html5/canary islands pie charts-1.png","100564888_files/figure-html5/colours without legend-1.png","100564888_files/figure-html5/coordinates fix-1.png","100564888_files/figure-html5/doughnut-1.png","100564888_files/figure-html5/first plot-1.png","100564888_files/figure-html5/legend-1.png","100564888_files/figure-html5/legend pie chart colors-1.png","100564888_files/figure-html5/legend pie charts-1.png","100564888_files/figure-html5/Other details-1.png","100564888_files/figure-html5/pie chart colors-1.png","100564888_files/figure-html5/pie charts without right colours-1.png","100564888_files/figure-html5/unnamed-chunk-1-1.png","100564888_files/figure-html5/unnamed-chunk-10-1.png","100564888_files/figure-html5/unnamed-chunk-2-1.png","100564888_files/figure-html5/unnamed-chunk-3-1.png","100564888_files/figure-html5/unnamed-chunk-4-1.png","100564888_files/figure-html5/unnamed-chunk-5-1.png","100564888_files/figure-html5/unnamed-chunk-6-1.png","100564888_files/figure-html5/unnamed-chunk-8-1.png","100564888_files/figure-html5/unnamed-chunk-9-1.png","100564888_files/header-attrs-2.30/header-attrs.js","100564888_files/jquery-3.6.0/jquery-3.6.0.js","100564888_files/jquery-3.6.0/jquery-3.6.0.min.js","100564888_files/jquery-3.6.0/jquery-3.6.0.min.map","100564888_files/popper-2.6.0/popper.min.js","100564888_files/tippy-6.2.7/tippy-bundle.umd.min.js","100564888_files/tippy-6.2.7/tippy-light-border.css","100564888_files/tippy-6.2.7/tippy.css","100564888_files/tippy-6.2.7/tippy.umd.min.js","100564888_files/webcomponents-2.0.0/webcomponents.js","Original Map.jpg","produccion_electricidad.xls","se89_10_admin_prov_a_x_20140101.CPG","se89_10_admin_prov_a_x_20140101.dbf","se89_10_admin_prov_a_x_20140101.prj","se89_10_admin_prov_a_x_20140101.sbn","se89_10_admin_prov_a_x_20140101.sbx","se89_10_admin_prov_a_x_20140101.shp","se89_10_admin_prov_a_x_20140101.shp.xml","se89_10_admin_prov_a_x_20140101.shx","se89_10_admin_prov_a_y_20140101.CPG","se89_10_admin_prov_a_y_20140101.dbf","se89_10_admin_prov_a_y_20140101.prj","se89_10_admin_prov_a_y_20140101.sbn","se89_10_admin_prov_a_y_20140101.sbx","se89_10_admin_prov_a_y_20140101.shp","se89_10_admin_prov_a_y_20140101.shp.xml","se89_10_admin_prov_a_y_20140101.shx","weezerfont.ttf"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../../site_libs/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"/>
<link href="../../../site_libs/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"/>
<script src="../../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<script src="../../../site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
<script src="../../../site_libs/fuse-6.4.1/fuse.min.js"></script>

<script type="application/javascript">

function getMeta(metaName) {
  var metas = document.getElementsByTagName('meta');
  for (let i = 0; i < metas.length; i++) {
    if (metas[i].getAttribute('name') === metaName) {
      return metas[i].getAttribute('content');
    }
  }
  return '';
}

function offsetURL(url) {
  var offset = getMeta('distill:offset');
  return offset ? offset + '/' + url : url;
}

function createFuseIndex() {

  // create fuse index
  var options = {
    keys: [
      { name: 'title', weight: 20 },
      { name: 'categories', weight: 15 },
      { name: 'description', weight: 10 },
      { name: 'contents', weight: 5 },
    ],
    ignoreLocation: true,
    threshold: 0
  };
  var fuse = new window.Fuse([], options);

  // fetch the main search.json
  return fetch(offsetURL('search.json'))
    .then(function(response) {
      if (response.status == 200) {
        return response.json().then(function(json) {
          // index main articles
          json.articles.forEach(function(article) {
            fuse.add(article);
          });
          // download collections and index their articles
          return Promise.all(json.collections.map(function(collection) {
            return fetch(offsetURL(collection)).then(function(response) {
              if (response.status === 200) {
                return response.json().then(function(articles) {
                  articles.forEach(function(article) {
                    fuse.add(article);
                  });
                })
              } else {
                return Promise.reject(
                  new Error('Unexpected status from search index request: ' +
                            response.status)
                );
              }
            });
          })).then(function() {
            return fuse;
          });
        });

      } else {
        return Promise.reject(
          new Error('Unexpected status from search index request: ' +
                      response.status)
        );
      }
    });
}

window.document.addEventListener("DOMContentLoaded", function (event) {

  // get search element (bail if we don't have one)
  var searchEl = window.document.getElementById('distill-search');
  if (!searchEl)
    return;

  createFuseIndex()
    .then(function(fuse) {

      // make search box visible
      searchEl.classList.remove('hidden');

      // initialize autocomplete
      var options = {
        autoselect: true,
        hint: false,
        minLength: 2,
      };
      window.autocomplete(searchEl, options, [{
        source: function(query, callback) {
          const searchOptions = {
            isCaseSensitive: false,
            shouldSort: true,
            minMatchCharLength: 2,
            limit: 10,
          };
          var results = fuse.search(query, searchOptions);
          callback(results
            .map(function(result) { return result.item; })
          );
        },
        templates: {
          suggestion: function(suggestion) {
            var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
              ? `<img src="${offsetURL(suggestion.preview)}"</img>`
              : '';
            var html = `
              <div class="search-item">
                <h3>${suggestion.title}</h3>
                <div class="search-item-description">
                  ${suggestion.description || ''}
                </div>
                <div class="search-item-preview">
                  ${img}
                </div>
              </div>
            `;
            return html;
          }
        }
      }]).on('autocomplete:selected', function(event, suggestion) {
        window.location.href = offsetURL(suggestion.path);
      });
      // remove inline display style on autocompleter (we want to
      // manage responsive display via css)
      $('.algolia-autocomplete').css("display", "");
    })
    .catch(function(error) {
      console.log(error);
    });

});

</script>

<style type="text/css">

.nav-search {
  font-size: x-small;
}

/* Algolioa Autocomplete */

.algolia-autocomplete {
  display: inline-block;
  margin-left: 10px;
  vertical-align: sub;
  background-color: white;
  color: black;
  padding: 6px;
  padding-top: 8px;
  padding-bottom: 0;
  border-radius: 6px;
  border: 1px #0F2E3D solid;
  width: 180px;
}


@media screen and (max-width: 768px) {
  .distill-site-nav .algolia-autocomplete {
    display: none;
    visibility: hidden;
  }
  .distill-site-nav.responsive .algolia-autocomplete {
    display: inline-block;
    visibility: visible;
  }
  .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
    margin-left: 0;
    width: 400px;
    max-height: 400px;
  }
}

.algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
  width: 90%;
  outline: none;
  border: none;
}

.algolia-autocomplete .aa-hint {
  color: #999;
}
.algolia-autocomplete .aa-dropdown-menu {
  width: 550px;
  max-height: 70vh;
  overflow-x: visible;
  overflow-y: scroll;
  padding: 5px;
  margin-top: 3px;
  margin-left: -150px;
  background-color: #fff;
  border-radius: 5px;
  border: 1px solid #999;
  border-top: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
  cursor: pointer;
  padding: 5px 4px;
  border-bottom: 1px solid #eee;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
  border-bottom: none;
  margin-bottom: 2px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
  overflow: hidden;
  font-size: 0.8em;
  line-height: 1.4em;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
  font-size: 1rem;
  margin-block-start: 0;
  margin-block-end: 5px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
  display: inline-block;
  overflow: hidden;
  height: 2.8em;
  width: 80%;
  margin-right: 4%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
  display: inline-block;
  width: 15%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
  height: 3em;
  width: auto;
  display: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
  display: initial;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
  background-color: #eee;
}
.algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
  font-weight: bold;
  font-style: normal;
}

</style>


<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
  font-size: 100%;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

hr.section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  margin: 0px;
}


d-byline {
  border-top: none;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
  border-top: none;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

/* tweak for Pandoc numbered line within distill */
d-article pre.numberSource code > span {
    left: -2em;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // separator
  var separator = '<hr class="section-separator" style="clear: both"/>';
  // prepend separator above appendix
  $('.d-byline').before(separator);
  $('.d-article').before(separator);

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme, except when numbering line
  // in code chunk
  $('pre:not(.numberLines) code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      var author_name = front_matter.authors[i].author
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', author_name ? 'ORCID ID for ' + author_name : 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      const citeChild = $(this).children()[0]
      // Do not process if @xyz has been used without escaping and without bibliography activated
      // https://github.com/rstudio/distill/issues/466
      if (citeChild === undefined) return true

      if (citeChild.nodeName == "D-FOOTNOTE") {
        var fn = citeChild
        $(this).html(fn.shadowRoot.querySelector("sup"))
        $(this).id = fn.id
        fn.remove()
      }
      var refs = $(this).attr('data-cites').split(" ");
      var refHtml = refs.map(function(ref) {
        // Could use CSS.escape too here, we insure backward compatibility in navigator
        return "<p>" + $('div[id="ref-' + ref + '"]').html() + "</p>";
      }).join("\n");
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // fix footnotes in tables (#411)
    // replacing broken distill.pub feature
    $('table d-footnote').each(function() {
      // we replace internal showAtNode methode which is triggered when hovering a footnote
      this.hoverBox.showAtNode = function(node) {
        // ported from https://github.com/distillpub/template/pull/105/files
        calcOffset = function(elem) {
            let x = elem.offsetLeft;
            let y = elem.offsetTop;
            // Traverse upwards until an `absolute` element is found or `elem`
            // becomes null.
            while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                x += elem.offsetLeft;
                y += elem.offsetTop;
            }

            return { left: x, top: y };
        }
        // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
        const bbox = node.getBoundingClientRect();
        const offset = calcOffset(node);
        this.show([offset.left + bbox.width, offset.top + bbox.height]);
      }
    })

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    // ignore leaflet img layers (#106)
    figures = figures.filter(':not(img[class*="leaflet"])')
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */
</style>
<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */

@import url('https://fonts.googleapis.com/css2?family=Questrial');

html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    "Questrial", sans-serif;
  --mono-font:       monospace;
  --body-font:       "Questrial", sans-serif;
  --navbar-font:     "Questrial", sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #000e78;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #000e78;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */

@media screen and (min-width: 768px) {
  d-article aside {
    height: 0;
  }
  aside.slides {
    margin-left: -148px;
    height: auto;
  }
  aside.slides + h2 {
    white-space: nowrap;
  }
}

d-article li {
  margin-bottom: 0.1em;
}

.posts-list .post-preview .thumbnail {
  max-height: 300px;
  overflow: hidden;
}</style>
<style type="text/css">
/* base style */

/* FONT FAMILIES */

:root {
  --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

body,
.posts-list .post-preview p,
.posts-list .description p {
  font-family: var(--body-font), var(--body-default);
}

h1, h2, h3, h4, h5, h6,
.posts-list .post-preview h2,
.posts-list .description h2 {
  font-family: var(--heading-font), var(--heading-default);
}

d-article div.sourceCode code,
d-article pre code {
  font-family: var(--mono-font), var(--mono-default);
}


/*-- TITLE --*/
d-title h1,
.posts-list > h1 {
  color: var(--title-color, black);
}

d-title h1 {
  font-size: var(--title-size, 50px);
}

/*-- HEADERS --*/
d-article h1,
d-article h2,
d-article h3,
d-article h4,
d-article h5,
d-article h6 {
  color: var(--header-color, rgba(0, 0, 0, 0.8));
}

/*-- BODY --*/
d-article > p,  /* only text inside of <p> tags */
d-article > ul, /* lists */
d-article > ol {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
  font-size: var(--body-size, 1.06rem);
}


/*-- CODE --*/
d-article div.sourceCode code,
d-article pre code {
  font-size: var(--code-size, 14px);
}

/*-- ASIDE --*/
d-article aside {
  font-size: var(--aside-size, 12px);
  color: var(--aside-color, rgba(0, 0, 0, 0.6));
}

/*-- FIGURE CAPTIONS --*/
figure .caption,
figure figcaption,
.figure .caption {
  font-size: var(--fig-cap-size, 13px);
  color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
}

/*-- METADATA --*/
d-byline h3 {
  font-size: var(--heading-size, 0.6rem);
  color: var(--heading-color, rgba(0, 0, 0, 0.5));
}

d-byline {
  font-size: var(--body-size, 0.8rem);
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

d-byline a,
d-article d-byline a {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

/*-- TABLE OF CONTENTS --*/
.d-contents nav h3 {
  font-size: var(--heading-size, 18px);
}

.d-contents nav a {
  font-size: var(--contents-size, 13px);
}

/*-- APPENDIX --*/
d-appendix h3 {
  font-size: var(--heading-size, 15px);
  color: var(--heading-color, rgba(0, 0, 0, 0.65));
}

d-appendix {
  font-size: var(--text-size, 0.8em);
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

d-appendix d-footnote-list a.footnote-backlink {
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

/*-- WEBSITE HEADER + FOOTER --*/
.distill-site-header .title {
  font-size: var(--title-size, 18px);
  font-family: var(--navbar-font), var(--heading-default);
}

.distill-site-header a,
.nav-dropdown .nav-dropbtn {
  font-family: var(--navbar-font), var(--heading-default);
}

.nav-dropdown .nav-dropbtn {
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  font-size: var(--text-size, 15px);
}

.distill-site-header a:hover,
.nav-dropdown:hover .nav-dropbtn {
  color: var(--hover-color, white);
}

.distill-site-header {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer a:hover {
  color: var(--hover-color, white);
}</style>
<!--/radix_placeholder_distill-->
  <script src="../../../site_libs/header-attrs-2.30/header-attrs.js"></script>
  <script src="../../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="../../../site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="../../../site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="../../../site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="../../../site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="../../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Energy Production between 2004 and 2014","description":"This tutorial will replicate and improve a map full of pie charts. It is a perfect example of an information saturated visualization, since it uses a map to represent the total electric energy production as of 2014 by province, its energy sources and the production variation between 2004 and 2014. The objective of this tutorial is to demostrate that, most of the times, less is more.","authors":[{"author":"Noah Emanuel Fürup","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2026-01-14T00:00:00.000+01:00","citationText":"Fürup, 2026"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<span class="logo">
<img src="../../../assets/acronimo_0.png"/>
</span>
<a href="../../../index.html" class="title">Data Visualization | MSc CSS</a>
<input id="distill-search" class="nav-search hidden" type="text" placeholder="Search..."/>
</div>
<div class="nav-right">
<a href="../../../contents.html">Contents</a>
<a href="../../../tutorials.html">Tutorials</a>
<a href="../../../resources.html">Resources</a>
<a href="../../../projects.html">Projects</a>
<a href="https://github.com/IBiDat/dataviz" aria-label="Link to source">
<i class="fab fa-github" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Energy Production between 2004 and 2014</h1>

<!--radix_placeholder_categories-->
<div class="dt-tags">
  <a href="../../../projects.html#category:2025" class="dt-tag">2025</a>
</div>
<!--/radix_placeholder_categories-->
<p><p>This tutorial will replicate and improve a map full of pie charts. It is a perfect example of an information saturated visualization, since it uses a map to represent the total electric energy production as of 2014 by province, its energy sources and the production variation between 2004 and 2014. The objective of this tutorial is to demostrate that, most of the times, less is more.</p></p>
</div>

<div class="d-byline">
  
  Noah Emanuel Fürup
  
<br/>2026-01-14
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#the-data" id="toc-the-data">The Data</a></li>
<li><a href="#replication-of-the-map" id="toc-replication-of-the-map">Replication of the map</a></li>
<li><a href="#improvement" id="toc-improvement">Improvement</a></li>
</ul>
</nav>
</div>
<p><img src="Original%20Map.jpg" /></p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://r-spatial.github.io/sf/'>sf</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://ggplot2.tidyverse.org'>ggplot2</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://readxl.tidyverse.org'>readxl</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://ropengov.github.io/giscoR/'>giscoR</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://ggforce.data-imaginist.com'>ggforce</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>scatterpie</span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://eliocamp.github.io/ggnewscale/'>ggnewscale</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://paleolimbot.github.io/ggspatial/'>ggspatial</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/yixuan/showtext'>showtext</a></span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>The map that I’ll replicate and improve is part of the National Atlas of Spain made by the National Institute of Geography in 2014.</p>
<p>There are three elements represented in this map. The colors within the provinces represent how much variation in terms of energy production there has been made in each province between 2004 and 2014. The pie charts represent both the amount of energy that is produced in each of the 52 provinces by the size of the pie chart and the source of this energy.</p>
<h1 id="the-data">The Data</h1>
<p>The data that is needed to produce this map is available in the following website: <a href="https://centrodedescargas.cnig.es/CentroDescargas/busquedaRedirigida.do?ruta=PUBLICACION_CNIG_DATOS_VARIOS/aneTematico/Espana_Produccion-de-energia-electrica_2004-2014_mapa_15612_spa.pdf">CNIG</a>.</p>
<p>The downloaded file will consist of a folder with a couple of files that will be necessary for the reproduction of our visualization. Even if we get 17 files in the data folder, there are only 3 main ones which will be using: an .xls file with all our data and two shapefiles, which is an older format that contains geometrical information of both the spanish peninsula, and its islands.</p>
<p>The excel has 8 sheets in it, one of them gathering the data on the variation in energy production of each province of Spain from 2004 to 2014 and the other seven representing the energy production by energy source. Sheet nº 9453 takes on hydropower, sheet nº 9454 windpower, sheet nº9454 9455 solar, sheet nº 9456 renowable thermal, sheet nº 9457 carbon, gas, cogeneration, among other sources related to gas, sheet nº 9458 nuclear, sheet nº 9459 is the energy total and sheet nº 9560 is the variation between 2004 and 2014.</p>
<p>In order to put all the information in a tidy dataset, I’ll get each sheet in a separable sheet, selecting only the relevant variables, since there is explanatory metadata in each sheet. After that, I’ll add a “Type” variable to each small dataset. Then, I’ll bind everything together, resulting in our tidy “electricity_” dataset. I called it like that to differenciate it with the “electricity” dataset that will be used for the replication, which has data that won’t be needed for our improved version.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>electricity_excel</span>    <span class='op'>&lt;-</span> <span class='st'>"produccion_electricidad.xls"</span></span>
<span></span>
<span><span class='va'>hydro_2014</span>           <span class='op'>&lt;-</span> <span class='fu'><a href='https://readxl.tidyverse.org/reference/read_excel.html'>read_excel</a></span><span class='op'>(</span><span class='va'>electricity_excel</span>, sheet <span class='op'>=</span> <span class='st'>"Variable_9453"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='st'>"Nombre unidad territorial"</span>, <span class='st'>"Valor del dato"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename</a></span><span class='op'>(</span>Province <span class='op'>=</span> <span class='st'>"Nombre unidad territorial"</span>, MWh <span class='op'>=</span> <span class='st'>"Valor del dato"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>Type <span class='op'>=</span> <span class='st'>"Hidráulica"</span><span class='op'>)</span></span>
<span>  </span>
<span><span class='va'>wind_power_2014</span>      <span class='op'>&lt;-</span> <span class='fu'><a href='https://readxl.tidyverse.org/reference/read_excel.html'>read_excel</a></span><span class='op'>(</span><span class='va'>electricity_excel</span>, sheet <span class='op'>=</span> <span class='st'>"Variable_9454"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='st'>"Nombre unidad territorial"</span>, <span class='st'>"Valor del dato"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename</a></span><span class='op'>(</span>Province <span class='op'>=</span> <span class='st'>"Nombre unidad territorial"</span>, MWh <span class='op'>=</span> <span class='st'>"Valor del dato"</span><span class='op'>)</span>  <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>Type <span class='op'>=</span> <span class='st'>"Eólica"</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>solar_2014</span>           <span class='op'>&lt;-</span> <span class='fu'><a href='https://readxl.tidyverse.org/reference/read_excel.html'>read_excel</a></span><span class='op'>(</span><span class='va'>electricity_excel</span>, sheet <span class='op'>=</span> <span class='st'>"Variable_9455"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='st'>"Nombre unidad territorial"</span>, <span class='st'>"Valor del dato"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename</a></span><span class='op'>(</span>Province <span class='op'>=</span> <span class='st'>"Nombre unidad territorial"</span>, MWh <span class='op'>=</span> <span class='st'>"Valor del dato"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>Type <span class='op'>=</span> <span class='st'>"Solar"</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>rw_thermal_2014</span>      <span class='op'>&lt;-</span> <span class='fu'><a href='https://readxl.tidyverse.org/reference/read_excel.html'>read_excel</a></span><span class='op'>(</span><span class='va'>electricity_excel</span>, sheet <span class='op'>=</span> <span class='st'>"Variable_9456"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='st'>"Nombre unidad territorial"</span>, <span class='st'>"Valor del dato"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename</a></span><span class='op'>(</span>Province <span class='op'>=</span> <span class='st'>"Nombre unidad territorial"</span>, MWh <span class='op'>=</span> <span class='st'>"Valor del dato"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>Type <span class='op'>=</span> <span class='st'>"Térmica renovable y otras"</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>carbon_and_gas_2014</span>     <span class='op'>&lt;-</span> <span class='fu'><a href='https://readxl.tidyverse.org/reference/read_excel.html'>read_excel</a></span><span class='op'>(</span><span class='va'>electricity_excel</span>, sheet <span class='op'>=</span> <span class='st'>"Variable_9457"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='st'>"Nombre unidad territorial"</span>, <span class='st'>"Valor del dato"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename</a></span><span class='op'>(</span>Province <span class='op'>=</span> <span class='st'>"Nombre unidad territorial"</span>, MWh <span class='op'>=</span> <span class='st'>"Valor del dato"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>Type <span class='op'>=</span> <span class='st'>"Carbón, fuelgas, ciclo combinado y cogeneración"</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>nuclear_2014</span>         <span class='op'>&lt;-</span> <span class='fu'><a href='https://readxl.tidyverse.org/reference/read_excel.html'>read_excel</a></span><span class='op'>(</span><span class='va'>electricity_excel</span>, sheet <span class='op'>=</span> <span class='st'>"Variable_9458"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='st'>"Nombre unidad territorial"</span>, <span class='st'>"Valor del dato"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename</a></span><span class='op'>(</span>Province <span class='op'>=</span> <span class='st'>"Nombre unidad territorial"</span>, MWh <span class='op'>=</span> <span class='st'>"Valor del dato"</span><span class='op'>)</span>  <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>Type <span class='op'>=</span> <span class='st'>"Nuclear"</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>total_2014</span>           <span class='op'>&lt;-</span> <span class='fu'><a href='https://readxl.tidyverse.org/reference/read_excel.html'>read_excel</a></span><span class='op'>(</span><span class='va'>electricity_excel</span>, sheet <span class='op'>=</span> <span class='st'>"Variable_9459"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='st'>"Nombre unidad territorial"</span>, <span class='st'>"Valor del dato"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename</a></span><span class='op'>(</span>Province <span class='op'>=</span> <span class='st'>"Nombre unidad territorial"</span>, MWh <span class='op'>=</span> <span class='st'>"Valor del dato"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>Type <span class='op'>=</span> <span class='st'>"Total"</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>variation_2004_2014</span>  <span class='op'>&lt;-</span> <span class='fu'><a href='https://readxl.tidyverse.org/reference/read_excel.html'>read_excel</a></span><span class='op'>(</span><span class='va'>electricity_excel</span>, sheet <span class='op'>=</span> <span class='st'>"Variable_9460"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='st'>"Nombre unidad territorial"</span>, <span class='st'>"Valor del dato"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename</a></span><span class='op'>(</span>Province <span class='op'>=</span> <span class='st'>"Nombre unidad territorial"</span>, MWh <span class='op'>=</span> <span class='st'>"Valor del dato"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>Type <span class='op'>=</span> <span class='st'>"Variación 2004 - 2014"</span><span class='op'>)</span></span>
<span></span>
<span></span>
<span><span class='va'>electricity_</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/bind_rows.html'>bind_rows</a></span><span class='op'>(</span></span>
<span>  <span class='va'>hydro_2014</span>, <span class='va'>wind_power_2014</span>, <span class='va'>solar_2014</span>, <span class='va'>rw_thermal_2014</span>, </span>
<span>  <span class='va'>carbon_and_gas_2014</span>, <span class='va'>nuclear_2014</span>, <span class='va'>total_2014</span>, <span class='va'>variation_2004_2014</span><span class='op'>)</span></span>
<span><span class='va'>electricity_</span></span></code></pre>
</div>
<pre><code># A tibble: 416 × 3
   Province              MWh Type      
   &lt;chr&gt;               &lt;dbl&gt; &lt;chr&gt;     
 1 Araba/Álava       151127. Hidráulica
 2 Albacete          313163. Hidráulica
 3 Alacant/Alicante    2631. Hidráulica
 4 Almería            48040. Hidráulica
 5 Ávila             158772. Hidráulica
 6 Badajoz           204660  Hidráulica
 7 Illes Balears          0  Hidráulica
 8 Barcelona         359347. Hidráulica
 9 Burgos            152779. Hidráulica
10 Cáceres          2912760. Hidráulica
# ℹ 406 more rows</code></pre>
</div>
<p>The variation of energy production between 2004 and 2014 is being placed inside the Type variable. Furthermore, in the original visualization the variation is represented in intervals of Megawatts per hour. Therefore we have to add a new variable that corresponds to the brackets of the variation legend.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>category_variation</span> <span class='op'>&lt;-</span> <span class='va'>electricity_</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Type</span> <span class='op'>==</span> <span class='st'>"Variación 2004 - 2014"</span><span class='op'>)</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    Energy_Variation <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span></span>
<span>      <span class='va'>MWh</span> <span class='op'>&lt;</span> <span class='fl'>50.1</span> <span class='op'>~</span> <span class='st'>"&lt;50,1"</span>,</span>
<span>      <span class='va'>MWh</span> <span class='op'>&gt;=</span> <span class='fl'>50.1</span> <span class='op'>&amp;</span> <span class='va'>MWh</span> <span class='op'>&lt;=</span> <span class='fl'>75.0</span> <span class='op'>~</span> <span class='st'>"50,1 - 75,0"</span>,</span>
<span>      <span class='va'>MWh</span> <span class='op'>&gt;</span> <span class='fl'>75.0</span> <span class='op'>&amp;</span> <span class='va'>MWh</span> <span class='op'>&lt;=</span> <span class='fl'>100.0</span> <span class='op'>~</span> <span class='st'>"75,1 - 100,0"</span>,</span>
<span>      <span class='va'>MWh</span> <span class='op'>&gt;</span> <span class='fl'>100.0</span> <span class='op'>&amp;</span> <span class='va'>MWh</span> <span class='op'>&lt;=</span> <span class='fl'>150.0</span> <span class='op'>~</span> <span class='st'>"100,1 - 150,0"</span>,</span>
<span>      <span class='va'>MWh</span> <span class='op'>&gt;</span> <span class='fl'>150.0</span> <span class='op'>&amp;</span> <span class='va'>MWh</span> <span class='op'>&lt;=</span> <span class='fl'>200.0</span> <span class='op'>~</span> <span class='st'>"150,1 - 200,0"</span>,</span>
<span>      <span class='va'>MWh</span> <span class='op'>&gt;</span> <span class='fl'>200.0</span> <span class='op'>&amp;</span> <span class='va'>MWh</span> <span class='op'>&lt;=</span> <span class='fl'>300.0</span> <span class='op'>~</span> <span class='st'>"200,1 - 300,0"</span>,</span>
<span>      <span class='va'>MWh</span> <span class='op'>&gt;</span> <span class='fl'>300.0</span> <span class='op'>&amp;</span> <span class='va'>MWh</span> <span class='op'>&lt;=</span> <span class='fl'>600.0</span> <span class='op'>~</span> <span class='st'>"300,1 - 600,0"</span>,</span>
<span>      <span class='va'>MWh</span> <span class='op'>&gt;</span> <span class='fl'>1000.0</span> <span class='op'>~</span> <span class='st'>"&gt;1.000,0"</span>,</span>
<span>      <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='cn'>NA_character_</span><span class='op'>)</span>,</span>
<span>    Energy_Variation <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span></span>
<span>      <span class='va'>Energy_Variation</span>, </span>
<span>      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"&lt;50,1"</span>, <span class='st'>"50,1 - 75,0"</span>, <span class='st'>"75,1 - 100,0"</span>,</span>
<span>                 <span class='st'>"100,1 - 150,0"</span>, <span class='st'>"150,1 - 200,0"</span>, </span>
<span>                 <span class='st'>"200,1 - 300,0"</span>, <span class='st'>"300,1 - 600,0"</span>, <span class='st'>"&gt;1.000,0"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>Province</span>, <span class='va'>Energy_Variation</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>electricity</span> <span class='op'>&lt;-</span> <span class='va'>category_variation</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>electricity_</span>, by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Province"</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>electricity</span></span></code></pre>
</div>
<pre><code># A tibble: 416 × 4
   Province    Energy_Variation      MWh Type                         
   &lt;chr&gt;       &lt;fct&gt;               &lt;dbl&gt; &lt;chr&gt;                        
 1 Araba/Álava 100,1 - 150,0     151127. Hidráulica                   
 2 Araba/Álava 100,1 - 150,0     257584. Eólica                       
 3 Araba/Álava 100,1 - 150,0      17653. Solar                        
 4 Araba/Álava 100,1 - 150,0       7182. Térmica renovable y otras    
 5 Araba/Álava 100,1 - 150,0     359081  Carbón, fuelgas, ciclo combi…
 6 Araba/Álava 100,1 - 150,0          0  Nuclear                      
 7 Araba/Álava 100,1 - 150,0     792627. Total                        
 8 Araba/Álava 100,1 - 150,0        114. Variación 2004 - 2014        
 9 Albacete    200,1 - 300,0     313163. Hidráulica                   
10 Albacete    200,1 - 300,0    4513126. Eólica                       
# ℹ 406 more rows</code></pre>
</div>
<p>The data folder also has two stringfiles to create the maps of Spain and the Canary Islands. In order to fit the Canary Islands map in the visualization, we’ll be doing two joint datasets, one for each stringfile. Later on, I will first create the plot with one shapefile and then with the other, so that I can superpose them afterwards in the right framing. To read the files, we will use the function st_read() from the “sf” package.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>peninsula</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_read.html'>st_read</a></span><span class='op'>(</span><span class='st'>"se89_10_admin_prov_a_x_20140101.shp"</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>Reading layer `se89_10_admin_prov_a_x_20140101&#39; from data source 
  `C:\Users\NFuru\Desktop\MASTER\DATA VISUALIZATION\Final Ugly Electric Bull\dataviz\_projects\2025\100564888\se89_10_admin_prov_a_x_20140101.shp&#39; 
  using driver `ESRI Shapefile&#39;
Simple feature collection with 50 features and 18 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -9.298027 ymin: 35.25069 xmax: 4.314508 ymax: 43.77594
Geodetic CRS:  ETRS89</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>canary_islands</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_read.html'>st_read</a></span><span class='op'>(</span><span class='st'>"se89_10_admin_prov_a_y_20140101.shp"</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>Reading layer `se89_10_admin_prov_a_y_20140101&#39; from data source 
  `C:\Users\NFuru\Desktop\MASTER\DATA VISUALIZATION\Final Ugly Electric Bull\dataviz\_projects\2025\100564888\se89_10_admin_prov_a_y_20140101.shp&#39; 
  using driver `ESRI Shapefile&#39;
Simple feature collection with 2 features and 18 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -18.16066 ymin: 27.638 xmax: -13.4192 ymax: 29.29093
Geodetic CRS:  ETRS89</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>electricity_peninsula</span> <span class='op'>&lt;-</span> <span class='va'>peninsula</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>electricity</span>, by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"rotulo"</span> <span class='op'>=</span> <span class='st'>"Province"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename</a></span><span class='op'>(</span><span class='st'>"Province"</span> <span class='op'>=</span> <span class='st'>"rotulo"</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>electricity_canary</span> <span class='op'>&lt;-</span> <span class='va'>canary_islands</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>electricity</span>, by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"rotulo"</span> <span class='op'>=</span> <span class='st'>"Province"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename</a></span><span class='op'>(</span><span class='st'>"Province"</span> <span class='op'>=</span> <span class='st'>"rotulo"</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>With this, we’d get the shape of Spain, but there is one thing missing: the shapes of its bordering countries. Almost all maps that are not minimalistic in style provide information on the bordering countries to have a reference of where it stands. Since we don’t have that information in the folder, we’ll get the shapes via the GiscoR package (GISCO stands for Geographic Information System of the - European - Commision). Since the data for the shape of the borders comes from a different source, we need to make sure that both use the same CRS (Coordinate Reference System), so that there isn’t any offsets in the limits between the countries.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://ropengov.github.io/giscoR/'>giscoR</a></span><span class='op'>)</span></span>
<span><span class='va'>neighbours</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://ropengov.github.io/giscoR/reference/gisco_get.html'>gisco_get_countries</a></span><span class='op'>(</span></span>
<span>  country <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Portugal"</span>, <span class='st'>"France"</span>, <span class='st'>"Marocco"</span>, <span class='st'>"Algeria"</span>, <span class='st'>"Andorra"</span><span class='op'>)</span>,</span>
<span>  year <span class='op'>=</span> <span class='st'>"2013"</span>, </span>
<span>  resolution <span class='op'>=</span> <span class='st'>"10"</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<h1 id="replication-of-the-map">Replication of the map</h1>
<p>Now that we have all the data necessary for our map, we can start plotting the background map, that features the variation in energy from 2004 to 2014. To do that, we have to use geom_sf(), the function that creates geometric objects. Since we want the lines to be black and slightly thick, we’ll specify that directly in the geom_sf() function.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span> <span class='va'>map_replica</span> <span class='op'>&lt;-</span></span>
<span>   <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>electricity_peninsula</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>neighbours</span>,</span>
<span>           fill <span class='op'>=</span> <span class='st'>"#e5e5e5"</span>,</span>
<span>           color <span class='op'>=</span> <span class='st'>"black"</span>,</span>
<span>           size <span class='op'>=</span> <span class='fl'>0.2</span>,<span class='op'>)</span> <span class='op'>+</span></span>
<span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>Energy_Variation</span><span class='op'>)</span>, </span>
<span>            color <span class='op'>=</span> <span class='st'>"black"</span>, size <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span></span>
<span> <span class='va'>map_replica</span></span></code></pre>
</div>
<p><img src="100564888_files/figure-html5/first%20plot-1.png" width="624" /></p>
</div>
<p>There are three noticeable things right of the bat: the framing, the colors and the background, The framing is like that because it plots all pieces of land of the countries that where plotted, meaning that also places that are far of Spain will be plotted. To change the coordinates where the limits of the plot will be, we have to use coord_sf.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>map_replica</span> <span class='op'>&lt;-</span> <span class='va'>map_replica</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>coord_sf</a></span><span class='op'>(</span></span>
<span>    xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>13</span>, <span class='fl'>5.5</span><span class='op'>)</span>,</span>
<span>    ylim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>34.75</span>, <span class='fl'>44.5</span><span class='op'>)</span>,</span>
<span>    expand <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span></span>
<span><span class='va'>map_replica</span></span></code></pre>
</div>
<p><img src="100564888_files/figure-html5/coordinates%20fix-1.png" width="624" /></p>
</div>
<p>To change the background, we have to first eliminate the theme that is there and replace with our own. We want a grey background, a black frame and the sea (interpreted by ggplot as the “panel.background”) to be blue.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>frame</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>12.5</span>, <span class='fl'>5</span>, <span class='fl'>5</span>, <span class='op'>-</span><span class='fl'>12.5</span>, <span class='op'>-</span><span class='fl'>12.5</span><span class='op'>)</span>,</span>
<span>  y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>34.75</span>, <span class='fl'>34.75</span>, <span class='fl'>44.4</span>, <span class='fl'>44.4</span>, <span class='fl'>34.75</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span></span>
<span><span class='va'>map_replica</span> <span class='op'>&lt;-</span></span>
<span>  <span class='va'>map_replica</span> <span class='op'>+</span></span>
<span>   <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_void</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span> <span class='co'># theme_void() eliminates the x and y axis</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_polygon.html'>geom_polygon</a></span><span class='op'>(</span>  <span class='co'># To make the grey background</span></span>
<span>  data <span class='op'>=</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>    x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>15</span>, <span class='fl'>7</span>, <span class='fl'>7</span>, <span class='op'>-</span><span class='fl'>15</span>, <span class='op'>-</span><span class='fl'>15</span>, <span class='op'>-</span><span class='fl'>12.5</span>, <span class='op'>-</span><span class='fl'>12.5</span>, <span class='fl'>5</span>, <span class='fl'>5</span>, <span class='op'>-</span><span class='fl'>12.5</span>, <span class='op'>-</span><span class='fl'>12.5</span>, <span class='op'>-</span><span class='fl'>15</span><span class='op'>)</span>,</span>
<span>    y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>32</span>, <span class='fl'>32</span>, <span class='fl'>46</span>, <span class='fl'>46</span>, <span class='fl'>32</span>, <span class='fl'>34.75</span>, <span class='fl'>44.4</span>, <span class='fl'>44.4</span>, <span class='fl'>34.75</span>, <span class='fl'>34.75</span>, <span class='fl'>32</span>, <span class='fl'>32</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span>,</span>
<span>  fill <span class='op'>=</span> <span class='st'>"#feffff"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>   <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>         <span class='co'># panel.background changes the background</span></span>
<span>     plot.background <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>     panel.background <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span></span>
<span>     fill <span class='op'>=</span> <span class='st'>"#e6ffff"</span>,</span>
<span>     color <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span>,</span>
<span>   aspect.ratio <span class='op'>=</span> <span class='co'># to make it always look the same</span></span>
<span>     <span class='op'>(</span><span class='fl'>44.5</span> <span class='op'>-</span> <span class='fl'>34.75</span><span class='op'>)</span> <span class='op'>/</span> <span class='op'>(</span><span class='fl'>5.5</span> <span class='op'>-</span> <span class='op'>(</span><span class='op'>-</span><span class='fl'>11</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_path</a></span><span class='op'>(</span>      <span class='co'># this creates the frame</span></span>
<span>  data <span class='op'>=</span> <span class='va'>frame</span>,</span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span>,</span>
<span>  colour <span class='op'>=</span> <span class='st'>"black"</span>,</span>
<span>  linewidth <span class='op'>=</span> <span class='fl'>0.3</span><span class='op'>)</span> </span>
<span>  </span>
<span><span class='va'>map_replica</span></span></code></pre>
</div>
<p><img src="100564888_files/figure-html5/background%20and%20aspect%20ratio-1.png" width="624" /></p>
</div>
<p>Now that we have handled the background, it’s time to change the legend that maps the colors of the provinces. The HEX value of the legend will be extracted with an online color picker. Each color will be mapped to a variation category with scale_fill_manual().</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>map_replica</span> <span class='op'>&lt;-</span></span>
<span>  <span class='va'>map_replica</span> <span class='op'>+</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_fill_manual</a></span><span class='op'>(</span>                    <span class='co'># This function is used to give your own color palette</span></span>
<span>    values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>      <span class='st'>"&lt;50,1"</span> <span class='op'>=</span>         <span class='st'>"#e34a32"</span>,</span>
<span>      <span class='st'>"50,1 - 75,0"</span> <span class='op'>=</span>   <span class='st'>"#fd8d58"</span>,</span>
<span>      <span class='st'>"75,1 - 100,0"</span> <span class='op'>=</span>  <span class='st'>"#fcba84"</span>,</span>
<span>      <span class='st'>"100,1 - 150,0"</span> <span class='op'>=</span> <span class='st'>"#d9d9ea"</span>,</span>
<span>      <span class='st'>"150,1 - 200,0"</span> <span class='op'>=</span> <span class='st'>"#bcbcdc"</span>,</span>
<span>      <span class='st'>"200,1 - 300,0"</span> <span class='op'>=</span> <span class='st'>"#9e9ac7"</span>,</span>
<span>      <span class='st'>"300,1 - 600,0"</span> <span class='op'>=</span> <span class='st'>"#746ab1"</span>,</span>
<span>      <span class='st'>"&gt;1.000,0"</span> <span class='op'>=</span>      <span class='st'>"#54268f"</span><span class='op'>)</span>,</span>
<span>      name <span class='op'>=</span> </span>
<span>      <span class='st'>"VARIACIÓN 2004-2014</span></span>
<span><span class='st'>    2004=100</span></span>
<span><span class='st'>    "</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/guides.html'>guides</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/guide_legend.html'>guide_legend</a></span><span class='op'>(</span></span>
<span>    direction <span class='op'>=</span> <span class='st'>"vertical"</span>,           <span class='co'># Vertical legend</span></span>
<span>    title.position <span class='op'>=</span> <span class='st'>"top"</span>,           <span class='co'># Title on top</span></span>
<span>    title.hjust <span class='op'>=</span> <span class='fl'>0.5</span>,                <span class='co'># Centered title</span></span>
<span>    label.position <span class='op'>=</span> <span class='st'>"right"</span>,          <span class='co'># Where each category is</span></span>
<span>    keywidth <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>0.6</span>, <span class='st'>"cm"</span><span class='op'>)</span>,         <span class='co'># This makes the legend wider</span></span>
<span>    keyheight <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>0.31</span>, <span class='st'>"cm"</span><span class='op'>)</span>,     <span class='co'># This makes the legend longer</span></span>
<span>  <span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    legend.position <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.835</span>, <span class='fl'>0.238</span><span class='op'>)</span>,  <span class='co'># Position of the legend</span></span>
<span>    legend.background <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span> <span class='co'># Background of the legend</span></span>
<span>      fill <span class='op'>=</span> <span class='st'>"#FFFFFF"</span>, color <span class='op'>=</span> <span class='st'>"black"</span><span class='op'>)</span>,</span>
<span>    legend.text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>9</span>, hjust <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span>, <span class='co'># Text of the categories of the legends</span></span>
<span>    legend.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>9</span>, lineheight <span class='op'>=</span> <span class='fl'>1</span>, margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>b <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>    legend.margin <span class='op'>=</span> </span>
<span>      <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span><span class='fl'>6</span>, <span class='fl'>4</span>, <span class='fl'>6</span>, <span class='fl'>4</span><span class='op'>)</span>,         <span class='co'># Margin of the legend</span></span>
<span>    legend.key <span class='op'>=</span> </span>
<span>      <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='cn'>NA</span>, fill <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span>,     </span>
<span>    legend.key.spacing.y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>0.01</span>, <span class='st'>"cm"</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>map_replica</span></span></code></pre>
</div>
<p><img src="100564888_files/figure-html5/legend-1.png" width="624" /></p>
</div>
<p>To continue with the rest, sadly, we have to start with the pie charts. First, we have to calculate the centroid of each province, since most are centered in the province..</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>electricity_peninsula</span> <span class='op'>&lt;-</span> <span class='va'>electricity_peninsula</span> <span class='op'>|&gt;</span>     <span class='co'># First we calculate the centre of each</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>centre <span class='op'>=</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/geos_unary.html'>st_centroid</a></span><span class='op'>(</span><span class='va'>geometry</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span>           <span class='co'># province by using st_centroid()</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>longitude <span class='op'>=</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_coordinates.html'>st_coordinates</a></span><span class='op'>(</span><span class='va'>centre</span><span class='op'>)</span><span class='op'>[</span>,<span class='fl'>1</span><span class='op'>]</span>,      <span class='co'># Now we separate longitude and latitude</span></span>
<span>         latitude  <span class='op'>=</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_coordinates.html'>st_coordinates</a></span><span class='op'>(</span><span class='va'>centre</span><span class='op'>)</span><span class='op'>[</span>,<span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span>      <span class='co'># IS THIS NECESSARY?</span></span>
<span></span>
<span><span class='va'>electricity_canary</span> <span class='op'>&lt;-</span> <span class='va'>electricity_canary</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>centre <span class='op'>=</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/geos_unary.html'>st_centroid</a></span><span class='op'>(</span><span class='va'>geometry</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span>           <span class='co'># province by using st_centroid()</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>longitude <span class='op'>=</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_coordinates.html'>st_coordinates</a></span><span class='op'>(</span><span class='va'>centre</span><span class='op'>)</span><span class='op'>[</span>,<span class='fl'>1</span><span class='op'>]</span>,      <span class='co'># Now we separate longitude and latitude</span></span>
<span>         latitude  <span class='op'>=</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_coordinates.html'>st_coordinates</a></span><span class='op'>(</span><span class='va'>centre</span><span class='op'>)</span><span class='op'>[</span>,<span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>In order to do the pie charts, we have to drop the geometries that we had in the table to avoid issues in the pivot we have to perform. Getting the coefficient to get the radius was really a matter of trial and error. Since we eventually will have to do the same for the Canary Islands, we’ll perform the same code for the Canary Islands table.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>untidy_peninsula</span> <span class='op'>&lt;-</span> <span class='va'>electricity_peninsula</span> <span class='op'>|&gt;</span>        </span>
<span>   <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_geometry.html'>st_drop_geometry</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>|&gt;</span>                          </span>
<span>   <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_wider.html'>pivot_wider</a></span><span class='op'>(</span></span>
<span>     names_from <span class='op'>=</span> <span class='va'>Type</span>, </span>
<span>     values_from <span class='op'>=</span> <span class='va'>MWh</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>     radius <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='va'>Total</span> <span class='op'>/</span> <span class='va'>pi</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>0.00031</span><span class='op'>)</span>   <span class='co'># Changing the value of the coefficient until it fits</span></span>
<span></span>
<span><span class='va'>untidy_canary</span> <span class='op'>&lt;-</span> <span class='va'>electricity_canary</span> <span class='op'>|&gt;</span> </span>
<span>     <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_geometry.html'>st_drop_geometry</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>|&gt;</span>                </span>
<span>   <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_wider.html'>pivot_wider</a></span><span class='op'>(</span></span>
<span>     names_from <span class='op'>=</span> <span class='va'>Type</span>, </span>
<span>     values_from <span class='op'>=</span> <span class='va'>MWh</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>     radius <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='va'>Total</span> <span class='op'>/</span> <span class='va'>pi</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>0.00031</span><span class='op'>)</span> </span></code></pre>
</div>
</div>
<p>Alright, now the fun part. If we plotted the pie charts now, it won’t look like the original graph, since not all pie charts are centered. We need to change ever so slightly the position some of the pie charts up front. The coefficients are done by trial and error.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>untidy_peninsula</span> <span class='op'>&lt;-</span> <span class='va'>untidy_peninsula</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    longitude_moved <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span></span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"A Coruña"</span> <span class='op'>~</span> <span class='va'>longitude</span> <span class='op'>-</span> <span class='fl'>0.2</span>,</span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Asturias"</span> <span class='op'>~</span> <span class='va'>longitude</span> <span class='op'>+</span> <span class='fl'>0.1</span>,</span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Lleida"</span> <span class='op'>~</span> <span class='va'>longitude</span> <span class='op'>+</span> <span class='fl'>0.25</span>,         </span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Barcelona"</span> <span class='op'>~</span> <span class='va'>longitude</span> <span class='op'>+</span> <span class='fl'>0.075</span>,    </span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Tarragona"</span> <span class='op'>~</span> <span class='va'>longitude</span> <span class='op'>+</span> <span class='fl'>0.15</span>,     </span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Valencia/València"</span> <span class='op'>~</span> <span class='va'>longitude</span> <span class='op'>+</span> <span class='fl'>0.6</span>,</span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Alacant/Alicante"</span> <span class='op'>~</span> <span class='va'>longitude</span> <span class='op'>-</span> <span class='fl'>0.2</span>,</span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Granada"</span> <span class='op'>~</span> <span class='va'>longitude</span> <span class='op'>-</span> <span class='fl'>0.1</span>,        </span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Cádiz"</span> <span class='op'>~</span> <span class='va'>longitude</span> <span class='op'>-</span> <span class='fl'>0.1</span>,        </span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Ceuta"</span> <span class='op'>~</span> <span class='va'>longitude</span> <span class='op'>+</span> <span class='fl'>0.3</span>,          </span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Melilla"</span> <span class='op'>~</span> <span class='va'>longitude</span> <span class='op'>+</span> <span class='fl'>0.3</span>,       </span>
<span>      <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='va'>longitude</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    latitude_moved <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span></span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"A Coruña"</span> <span class='op'>~</span> <span class='va'>latitude</span> <span class='op'>+</span> <span class='fl'>0.4</span>,        </span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Asturias"</span> <span class='op'>~</span> <span class='va'>latitude</span> <span class='op'>+</span> <span class='fl'>0.3</span>,       </span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Bizkaia"</span> <span class='op'>~</span> <span class='va'>latitude</span> <span class='op'>+</span> <span class='fl'>0.3</span>,         </span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Guadalajara"</span> <span class='op'>~</span> <span class='va'>latitude</span> <span class='op'>-</span> <span class='fl'>0.075</span> ,  </span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Lleida"</span> <span class='op'>~</span> <span class='va'>latitude</span> <span class='op'>+</span> <span class='fl'>0.2</span>,         </span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Barcelona"</span> <span class='op'>~</span> <span class='va'>latitude</span> <span class='op'>-</span> <span class='fl'>0.3</span>,        </span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Tarragona"</span> <span class='op'>~</span> <span class='va'>latitude</span> <span class='op'>-</span> <span class='fl'>0.15</span>,      </span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Valencia/València"</span> <span class='op'>~</span> <span class='va'>latitude</span> <span class='op'>-</span> <span class='fl'>0.2</span>,</span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Alacant/Alicante"</span> <span class='op'>~</span> <span class='va'>latitude</span> <span class='op'>-</span> <span class='fl'>0.1</span>,</span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Murcia"</span> <span class='op'>~</span> <span class='va'>latitude</span> <span class='op'>-</span> <span class='fl'>0.1</span>,        </span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Granada"</span> <span class='op'>~</span> <span class='va'>latitude</span> <span class='op'>-</span> <span class='fl'>0.1</span>,        </span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Cádiz"</span> <span class='op'>~</span> <span class='va'>latitude</span> <span class='op'>-</span> <span class='fl'>0.1</span>,           </span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Melilla"</span> <span class='op'>~</span> <span class='va'>latitude</span> <span class='op'>+</span> <span class='fl'>0.05</span>,         </span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Cáceres"</span> <span class='op'>~</span> <span class='va'>latitude</span> <span class='op'>-</span> <span class='fl'>0.05</span>, </span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Badajoz"</span> <span class='op'>~</span> <span class='va'>latitude</span> <span class='op'>-</span> <span class='fl'>0.2</span>,</span>
<span>      <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='va'>latitude</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>When looking into the map, there is one province, Tarragona, that, because the pie chart would be too big, the designers decided to make it a doughnut instead of a pie chart. Subsequently, the doughnut pie will be our first layer since other pie charts are superposed to it.. In order to plot the pie charts and the doughnut, given that it is so difficult to do with base ggplot, the function geom_scatterpie() of the scatterplot package will be used.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>map_replica</span> <span class='op'>&lt;-</span> <span class='va'>map_replica</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://eliocamp.github.io/ggnewscale/reference/new_scale.html'>new_scale_fill</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://rdrr.io/pkg/scatterpie/man/geom-scatterpie.html'>geom_scatterpie</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>untidy_peninsula</span> <span class='op'>|&gt;</span>      <span class='co'># This wil only apply to the doughnut pie</span></span>
<span>                      <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span></span>
<span>                        <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Tarragona"</span><span class='op'>)</span>,   </span>
<span>                    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>longitude_moved</span>, y <span class='op'>=</span> <span class='va'>latitude_moved</span>, r <span class='op'>=</span> <span class='va'>radius</span><span class='op'>)</span>,</span>
<span>                    cols <span class='op'>=</span> </span>
<span>                      <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Hidráulica"</span>, <span class='st'>"Solar"</span>, <span class='st'>"Eólica"</span>, <span class='co'># The order of the concatenate gives us the order</span></span>
<span>                      <span class='st'>"Térmica renovable y otras"</span>,       <span class='co'># of the colors clockwise </span></span>
<span>                      <span class='st'>"Nuclear"</span>,</span>
<span>                      <span class='st'>"Carbón, fuelgas, ciclo combinado y cogeneración"</span><span class='op'>)</span>,</span>
<span>                    donut_radius <span class='op'>=</span> <span class='fl'>0.42</span>,</span>
<span>                    color <span class='op'>=</span> <span class='st'>"black"</span>, linewidth <span class='op'>=</span> <span class='fl'>0.3</span><span class='op'>)</span> <span class='op'>+</span> <span class='co'># This controls for the lines in the pie itself</span></span>
<span>                    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/guides.html'>guides</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span></span>
<span><span class='va'>map_replica</span></span></code></pre>
</div>
<p><img src="100564888_files/figure-html5/doughnut-1.png" width="624" /></p>
</div>
<p>After this, let’s do the pie charts.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>map_replica</span> <span class='op'>&lt;-</span> <span class='va'>map_replica</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://rdrr.io/pkg/scatterpie/man/geom-scatterpie.html'>geom_scatterpie</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>untidy_peninsula</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Province</span> <span class='op'>!=</span> <span class='st'>"Tarragona"</span><span class='op'>)</span>, </span>
<span>                    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>longitude_moved</span>, y <span class='op'>=</span> <span class='va'>latitude_moved</span>, r <span class='op'>=</span> <span class='va'>radius</span><span class='op'>)</span>,</span>
<span>                    cols <span class='op'>=</span> </span>
<span>                      <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Hidráulica"</span>, <span class='st'>"Solar"</span>, <span class='st'>"Eólica"</span>, <span class='co'># The order gives us the order of the pie charts</span></span>
<span>                      <span class='st'>"Térmica renovable y otras"</span>,       <span class='co'># It is set clockwise, starting from 12  </span></span>
<span>                      <span class='st'>"Nuclear"</span>,</span>
<span>                      <span class='st'>"Carbón, fuelgas, ciclo combinado y cogeneración"</span><span class='op'>)</span>,</span>
<span>                    color <span class='op'>=</span> <span class='st'>"black"</span>, linewidth <span class='op'>=</span> <span class='fl'>0.3</span><span class='op'>)</span> <span class='op'>+</span>  <span class='co'># This controls for the lines in the pie itself</span></span>
<span>                    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/guides.html'>guides</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span></span>
<span><span class='va'>map_replica</span></span></code></pre>
</div>
<p><img src="100564888_files/figure-html5/pie%20charts%20without%20right%20colours-1.png" width="624" /></p>
</div>
<p>Obviously they are in the wrong color, so we have to create the second legend of the map. This one is more difficult because it has a custom geometric figure in the legend. After trying to change the colors’ form to a triangule, I figured that it’s better to annotate it manually, since it isn’t possible to convert these squares to triangules. In order to have the colors and the triangules, we have to create the legend without actually having it featured in the map.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>map_replica</span> <span class='op'>&lt;-</span></span>
<span>  <span class='va'>map_replica</span> <span class='op'>+</span> </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_fill_manual</a></span><span class='op'>(</span></span>
<span>    values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>      <span class='st'>"Hidráulica"</span> <span class='op'>=</span> <span class='st'>"#a6d0e4"</span>,</span>
<span>      <span class='st'>"Solar"</span> <span class='op'>=</span> <span class='st'>"#ffd92e"</span>,</span>
<span>      <span class='st'>"Eólica"</span> <span class='op'>=</span> <span class='st'>"#4caf4a"</span>,</span>
<span>      <span class='st'>"Térmica renovable y otras"</span> <span class='op'>=</span> <span class='st'>"#fcb461"</span>,</span>
<span>      <span class='st'>"Nuclear"</span> <span class='op'>=</span> <span class='st'>"#fb8172"</span>,</span>
<span>      <span class='st'>"Carbón, fuelgas, ciclo combinado y cogeneración"</span> <span class='op'>=</span> <span class='st'>"#d4c0a0"</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    labels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>      <span class='st'>"Carbón, fuelgas, ciclo combinado y cogeneración"</span> <span class='op'>=</span> <span class='st'>"Carbón, fuelgas, ciclo\ncombinado y cogeneración"</span> </span>
<span>    <span class='op'>)</span>,</span>
<span>    name <span class='op'>=</span> <span class='cn'>NULL</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/guides.html'>guides</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span></span>
<span><span class='va'>map_replica</span></span></code></pre>
</div>
<p><img src="100564888_files/figure-html5/pie%20chart%20colors-1.png" width="624" /></p>
</div>
<p>After having put the colors, we can put the triangules into place.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>map_replica</span> <span class='op'>&lt;-</span></span>
<span>  <span class='va'>map_replica</span> <span class='op'>+</span></span>
<span><span class='co'># Hidráulica</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_polygon.html'>geom_polygon</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>11.9</span>, <span class='op'>-</span><span class='fl'>11.9</span>, <span class='op'>-</span><span class='fl'>12.3</span><span class='op'>)</span>, y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>39.52</span>, <span class='fl'>39.78</span>, <span class='fl'>39.65</span><span class='op'>)</span><span class='op'>)</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span>, fill <span class='op'>=</span> <span class='st'>"#a6d0e4"</span>, color <span class='op'>=</span> <span class='st'>"black"</span>, linewidth <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span> <span class='op'>+</span></span>
<span><span class='co'># Solar</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_polygon.html'>geom_polygon</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>11.9</span>, <span class='op'>-</span><span class='fl'>11.9</span>, <span class='op'>-</span><span class='fl'>12.3</span><span class='op'>)</span>, y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>39.07</span>, <span class='fl'>39.33</span>, <span class='fl'>39.2</span><span class='op'>)</span><span class='op'>)</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span>, fill <span class='op'>=</span> <span class='st'>"#ffd92e"</span>, color <span class='op'>=</span> <span class='st'>"black"</span>, linewidth <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span> <span class='op'>+</span></span>
<span><span class='co'># Eólica</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_polygon.html'>geom_polygon</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>11.9</span>, <span class='op'>-</span><span class='fl'>11.9</span>, <span class='op'>-</span><span class='fl'>12.3</span><span class='op'>)</span>, y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>38.62</span>, <span class='fl'>38.88</span>, <span class='fl'>38.75</span><span class='op'>)</span><span class='op'>)</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span>, fill <span class='op'>=</span> <span class='st'>"#4caf4a"</span>, color <span class='op'>=</span> <span class='st'>"black"</span>, linewidth <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span> <span class='op'>+</span></span>
<span><span class='co'># Térmica renovable</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_polygon.html'>geom_polygon</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>11.9</span>, <span class='op'>-</span><span class='fl'>11.9</span>, <span class='op'>-</span><span class='fl'>12.3</span><span class='op'>)</span>, y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>38.17</span>, <span class='fl'>38.43</span>, <span class='fl'>38.3</span><span class='op'>)</span><span class='op'>)</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span>, fill <span class='op'>=</span> <span class='st'>"#fcb461"</span>, color <span class='op'>=</span> <span class='st'>"black"</span>, linewidth <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span> <span class='op'>+</span></span>
<span><span class='co'># Nuclear</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_polygon.html'>geom_polygon</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>11.9</span>, <span class='op'>-</span><span class='fl'>11.9</span>, <span class='op'>-</span><span class='fl'>12.3</span><span class='op'>)</span>, y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>37.72</span>, <span class='fl'>37.98</span>, <span class='fl'>37.85</span><span class='op'>)</span><span class='op'>)</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span>, fill <span class='op'>=</span> <span class='st'>"#fb8172"</span>, color <span class='op'>=</span> <span class='st'>"black"</span>, linewidth <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span> <span class='op'>+</span></span>
<span><span class='co'># Carbón</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_polygon.html'>geom_polygon</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>11.9</span>, <span class='op'>-</span><span class='fl'>11.9</span>, <span class='op'>-</span><span class='fl'>12.3</span><span class='op'>)</span>, y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>37.27</span>, <span class='fl'>37.53</span>, <span class='fl'>37.4</span><span class='op'>)</span><span class='op'>)</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span>, fill <span class='op'>=</span> <span class='st'>"#d4c0a0"</span>, color <span class='op'>=</span> <span class='st'>"black"</span>, linewidth <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span></span>
<span><span class='va'>map_replica</span></span></code></pre>
</div>
<p><img src="100564888_files/figure-html5/unnamed-chunk-1-1.png" width="624" /></p>
</div>
<p>The triangules are in place, but there is a little detail still left. If you look closely, the base of the triangules of the original map is rounded. In order to do that, we have to superpose a small semicircle in the base. For that we’ll create a function, because there is no function for it in ggplot. We’ll add that with geom_polygon() and make the only one bart to have a black line with geom_path().</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Function to create semicircle points</span></span>
<span><span class='va'>semi_circle</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span>, <span class='va'>r</span> <span class='op'>=</span> <span class='fl'>0.12</span>, <span class='va'>n</span> <span class='op'>=</span> <span class='fl'>50</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>  <span class='va'>angles</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='op'>-</span><span class='va'>pi</span><span class='op'>/</span><span class='fl'>2</span>, <span class='va'>pi</span><span class='op'>/</span><span class='fl'>2</span>, length.out <span class='op'>=</span> <span class='va'>n</span><span class='op'>)</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span></span>
<span>    x <span class='op'>=</span> <span class='va'>x</span> <span class='op'>+</span> <span class='va'>r</span> <span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/r/base/Trig.html'>cos</a></span><span class='op'>(</span><span class='va'>angles</span><span class='op'>)</span>,</span>
<span>    y <span class='op'>=</span> <span class='va'>y</span> <span class='op'>+</span> <span class='va'>r</span> <span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/r/base/Trig.html'>sin</a></span><span class='op'>(</span><span class='va'>angles</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span><span class='op'>}</span></span>
<span></span>
<span><span class='va'>map_replica</span> <span class='op'>&lt;-</span> <span class='va'>map_replica</span> <span class='op'>+</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_polygon.html'>geom_polygon</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='fu'>semi_circle</span><span class='op'>(</span><span class='op'>-</span><span class='fl'>11.9</span>, <span class='fl'>39.65</span><span class='op'>)</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span>, fill <span class='op'>=</span> <span class='st'>"#a6d0e4"</span>, color <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span> <span class='op'>+</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_path</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='fu'>semi_circle</span><span class='op'>(</span><span class='op'>-</span><span class='fl'>11.9</span>, <span class='fl'>39.65</span><span class='op'>)</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span>, color <span class='op'>=</span> <span class='st'>"black"</span>, linewidth <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_polygon.html'>geom_polygon</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='fu'>semi_circle</span><span class='op'>(</span><span class='op'>-</span><span class='fl'>11.9</span>, <span class='fl'>39.2</span><span class='op'>)</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span>, fill <span class='op'>=</span> <span class='st'>"#ffd92e"</span>, color <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span> <span class='op'>+</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_path</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='fu'>semi_circle</span><span class='op'>(</span><span class='op'>-</span><span class='fl'>11.9</span>, <span class='fl'>39.2</span><span class='op'>)</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span>, color <span class='op'>=</span> <span class='st'>"black"</span>, linewidth <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_polygon.html'>geom_polygon</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='fu'>semi_circle</span><span class='op'>(</span><span class='op'>-</span><span class='fl'>11.9</span>, <span class='fl'>38.75</span><span class='op'>)</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span>, fill <span class='op'>=</span> <span class='st'>"#4caf4a"</span>, color <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span> <span class='op'>+</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_path</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='fu'>semi_circle</span><span class='op'>(</span><span class='op'>-</span><span class='fl'>11.9</span>, <span class='fl'>38.75</span><span class='op'>)</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span>, color <span class='op'>=</span> <span class='st'>"black"</span>, linewidth <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_polygon.html'>geom_polygon</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='fu'>semi_circle</span><span class='op'>(</span><span class='op'>-</span><span class='fl'>11.9</span>, <span class='fl'>38.3</span><span class='op'>)</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span>, fill <span class='op'>=</span> <span class='st'>"#fcb461"</span>, color <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span> <span class='op'>+</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_path</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='fu'>semi_circle</span><span class='op'>(</span><span class='op'>-</span><span class='fl'>11.9</span>, <span class='fl'>38.3</span><span class='op'>)</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span>, color <span class='op'>=</span> <span class='st'>"black"</span>, linewidth <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_polygon.html'>geom_polygon</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='fu'>semi_circle</span><span class='op'>(</span><span class='op'>-</span><span class='fl'>11.9</span>, <span class='fl'>37.85</span><span class='op'>)</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span>, fill <span class='op'>=</span> <span class='st'>"#fb8172"</span>, color <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span> <span class='op'>+</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_path</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='fu'>semi_circle</span><span class='op'>(</span><span class='op'>-</span><span class='fl'>11.9</span>, <span class='fl'>37.85</span><span class='op'>)</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span>, color <span class='op'>=</span> <span class='st'>"black"</span>, linewidth <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_polygon.html'>geom_polygon</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='fu'>semi_circle</span><span class='op'>(</span><span class='op'>-</span><span class='fl'>11.9</span>, <span class='fl'>37.4</span><span class='op'>)</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span>, fill <span class='op'>=</span> <span class='st'>"#d4c0a0"</span>, color <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span> <span class='op'>+</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_path</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='fu'>semi_circle</span><span class='op'>(</span><span class='op'>-</span><span class='fl'>11.9</span>, <span class='fl'>37.4</span><span class='op'>)</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span>, color <span class='op'>=</span> <span class='st'>"black"</span>, linewidth <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span></span>
<span><span class='va'>map_replica</span></span></code></pre>
</div>
<p><img src="100564888_files/figure-html5/unnamed-chunk-2-1.png" width="624" /></p>
</div>
<p>Now we can add the text. We’ll use the font “weezer”, which is pretty similar to the one the original map has.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/pkg/sysfonts/man/font_add.html'>font_add</a></span><span class='op'>(</span><span class='st'>"weezer"</span>, regular <span class='op'>=</span> <span class='st'>"weezerfont.ttf"</span><span class='op'>)</span> <span class='co'># needed font for the graph</span></span>
<span><span class='fu'><a href='https://rdrr.io/pkg/showtext/man/showtext_auto.html'>showtext_auto</a></span><span class='op'>(</span><span class='op'>)</span> </span>
<span></span>
<span><span class='va'>map_replica</span> <span class='op'>&lt;-</span></span>
<span>  <span class='va'>map_replica</span> <span class='op'>+</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span><span class='st'>"text"</span>, x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>11.6</span>, y <span class='op'>=</span> <span class='fl'>39.65</span>, label <span class='op'>=</span> <span class='st'>"Hidráulica"</span>, hjust <span class='op'>=</span> <span class='fl'>0</span>, size <span class='op'>=</span> <span class='fl'>4</span>, family <span class='op'>=</span> <span class='st'>"weezer"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span><span class='st'>"text"</span>, x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>11.6</span>, y <span class='op'>=</span> <span class='fl'>39.2</span>, label <span class='op'>=</span> <span class='st'>"Solar"</span>, hjust <span class='op'>=</span> <span class='fl'>0</span>, size <span class='op'>=</span> <span class='fl'>4</span>, family <span class='op'>=</span> <span class='st'>"weezer"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span><span class='st'>"text"</span>, x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>11.6</span>, y <span class='op'>=</span> <span class='fl'>38.75</span>, label <span class='op'>=</span> <span class='st'>"Eólica"</span>, hjust <span class='op'>=</span> <span class='fl'>0</span>, size <span class='op'>=</span> <span class='fl'>4</span>, family <span class='op'>=</span> <span class='st'>"weezer"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span><span class='st'>"text"</span>, x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>11.6</span>, y <span class='op'>=</span> <span class='fl'>38.3</span>, label <span class='op'>=</span> <span class='st'>"Térmica renovable y otras"</span>, hjust <span class='op'>=</span> <span class='fl'>0</span>, size <span class='op'>=</span> <span class='fl'>4</span>, family <span class='op'>=</span> <span class='st'>"weezer"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span><span class='st'>"text"</span>, x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>11.6</span>, y <span class='op'>=</span> <span class='fl'>37.85</span>, label <span class='op'>=</span> <span class='st'>"Nuclear"</span>, hjust <span class='op'>=</span> <span class='fl'>0</span>, size <span class='op'>=</span> <span class='fl'>4</span>, family <span class='op'>=</span> <span class='st'>"weezer"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span><span class='st'>"text"</span>, x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>11.6</span>, y <span class='op'>=</span> <span class='fl'>37.4</span>, label <span class='op'>=</span> <span class='st'>"Carbón, fuelgas, ciclo\ncombinado y cogeneración"</span>, hjust <span class='op'>=</span> <span class='fl'>0</span>, size <span class='op'>=</span> <span class='fl'>4</span>, family <span class='op'>=</span> <span class='st'>"weezer"</span>, lineheight <span class='op'>=</span> <span class='fl'>0.8</span><span class='op'>)</span></span>
<span><span class='va'>map_replica</span></span></code></pre>
</div>
<p><img src="100564888_files/figure-html5/unnamed-chunk-3-1.png" width="624" /></p>
</div>
<p>It’s time for the final legend, the one for the pie charts. For this, we need to prepare the radius of each circle, where position of each circle will be, the top of the circle to put the dotted points and the numbers that each circle represents.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>radius</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span>  <span class='fl'>209944.0</span> <span class='op'>/</span> <span class='va'>pi</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>0.00031</span>,</span>
<span>    <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span> <span class='fl'>1504064.7</span> <span class='op'>/</span> <span class='va'>pi</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>0.00031</span>,</span>
<span>    <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span> <span class='fl'>5135063.7</span> <span class='op'>/</span> <span class='va'>pi</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>0.00031</span>,</span>
<span>    <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='fl'>13223198.9</span> <span class='op'>/</span> <span class='va'>pi</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>0.00031</span>,</span>
<span>    <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='fl'>19186882.5</span> <span class='op'>/</span> <span class='va'>pi</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>0.00031</span>,</span>
<span>    <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='fl'>28178775.6</span> <span class='op'>/</span> <span class='va'>pi</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>0.00031</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>y_centers</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>40</span>, <span class='fl'>40.145</span>, <span class='fl'>40.32</span>, <span class='fl'>40.558</span>, <span class='fl'>40.7</span>, <span class='fl'>40.85</span><span class='op'>)</span> <span class='op'>+</span> <span class='fl'>0.5</span></span>
<span></span>
<span><span class='va'>y_tops</span> <span class='op'>&lt;-</span> <span class='va'>y_centers</span> <span class='op'>+</span> <span class='va'>radius</span></span>
<span></span>
<span><span class='va'>legend_data</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  MWh <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>210</span>, <span class='fl'>1.500</span>, <span class='fl'>5.000</span>, <span class='fl'>10.000</span>, <span class='fl'>20.000</span>, <span class='fl'>28.179</span><span class='op'>)</span>,</span>
<span>  radius <span class='op'>=</span> <span class='va'>radius</span>,</span>
<span>  x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>11.5</span>,  <span class='co'># ← TODOS la misma X</span></span>
<span>  y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>40</span>, <span class='fl'>40.145</span>, <span class='fl'>40.32</span>, <span class='fl'>40.558</span>, <span class='fl'>40.7</span>, <span class='fl'>40.85</span><span class='op'>)</span> <span class='op'>+</span> <span class='fl'>0.5</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    x_start <span class='op'>=</span> <span class='va'>x</span> <span class='op'>+</span> <span class='va'>radius</span>,</span>
<span>    y_start <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>With this, we can plot the pie chart legend.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>map_replica</span> <span class='op'>&lt;-</span></span>
<span>  <span class='va'>map_replica</span> <span class='op'>+</span> </span>
<span>  <span class='fu'><a href='https://ggforce.data-imaginist.com/reference/geom_circle.html'>geom_circle</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>legend_data</span>,</span>
<span>               <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x0 <span class='op'>=</span> <span class='va'>x</span>, y0 <span class='op'>=</span> <span class='va'>y</span>, r <span class='op'>=</span> <span class='va'>radius</span><span class='op'>)</span>,</span>
<span>               color <span class='op'>=</span> <span class='st'>"#151d1c"</span>, fill <span class='op'>=</span> <span class='cn'>NA</span>, linewidth <span class='op'>=</span> <span class='fl'>0.3</span><span class='op'>)</span> <span class='op'>+</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_segment.html'>geom_segment</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>legend_data</span>,</span>
<span>               <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, xend <span class='op'>=</span> <span class='op'>-</span><span class='fl'>10.1</span>,  </span>
<span>                   y <span class='op'>=</span> <span class='va'>y_tops</span>, yend <span class='op'>=</span> <span class='va'>y_tops</span><span class='op'>)</span>,               </span>
<span>               linetype <span class='op'>=</span> <span class='st'>"dotted"</span>, linewidth <span class='op'>=</span> <span class='fl'>0.3</span>, color <span class='op'>=</span> <span class='st'>"#151d1c"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>legend_data</span>,</span>
<span>          <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>radius</span><span class='op'>)</span> <span class='op'>+</span> <span class='fl'>0.4</span>, y <span class='op'>=</span> <span class='va'>y_tops</span>,</span>
<span>              label <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/format.html'>format</a></span><span class='op'>(</span><span class='va'>MWh</span>, decimal.mark <span class='op'>=</span> <span class='st'>"."</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>          hjust <span class='op'>=</span> <span class='fl'>0</span>, size <span class='op'>=</span> <span class='fl'>3</span>, family <span class='op'>=</span> <span class='st'>"weezer"</span><span class='op'>)</span></span>
<span><span class='va'>map_replica</span></span></code></pre>
</div>
<p><img src="100564888_files/figure-html5/unnamed-chunk-4-1.png" width="624" /></p>
</div>
<p>To finish the legend, we need to put its title in place.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>map_replica</span> <span class='op'>&lt;-</span></span>
<span>  <span class='va'>map_replica</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span><span class='st'>"text"</span>, x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>10.8</span>, y <span class='op'>=</span> <span class='fl'>42.99</span>,</span>
<span>         label <span class='op'>=</span> <span class='st'>"PRODUCCIÓN DE ENERGÍA\nELÉCTRICA\n2014\n(en miles de MWh)"</span>,</span>
<span>         size <span class='op'>=</span> <span class='fl'>4</span>, hjust <span class='op'>=</span> <span class='fl'>0.5</span>, lineheight <span class='op'>=</span> <span class='fl'>0.4</span><span class='op'>)</span></span>
<span><span class='va'>map_replica</span></span></code></pre>
</div>
<p><img src="100564888_files/figure-html5/unnamed-chunk-5-1.png" width="624" /></p>
</div>
<p>After having done the three legends, we can start doing the Canary Islands plot in the bottom-left. We’ll start by doing the plot of the map separately.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>canary_islands</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>electricity_canary</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>Energy_Variation</span><span class='op'>)</span>,</span>
<span>          color <span class='op'>=</span> <span class='st'>"black"</span>, size <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_void</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    <span class='co'># plot.background = element_rect(fill = "#e6ffff", color = NA),</span></span>
<span>    plot.background <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    plot.margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_fill_manual</a></span><span class='op'>(</span>                    </span>
<span>    values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>      <span class='st'>"&lt;50,1"</span> <span class='op'>=</span>         <span class='st'>"#e34a32"</span>,</span>
<span>      <span class='st'>"50,1 - 75,0"</span> <span class='op'>=</span>   <span class='st'>"#fd8d58"</span>,</span>
<span>      <span class='st'>"75,1 - 100,0"</span> <span class='op'>=</span>  <span class='st'>"#fcba84"</span>,</span>
<span>      <span class='st'>"100,1 - 150,0"</span> <span class='op'>=</span> <span class='st'>"#d9d9ea"</span>,</span>
<span>      <span class='st'>"150,1 - 200,0"</span> <span class='op'>=</span> <span class='st'>"#bcbcdc"</span>,</span>
<span>      <span class='st'>"200,1 - 300,0"</span> <span class='op'>=</span> <span class='st'>"#9e9ac7"</span>,</span>
<span>      <span class='st'>"300,1 - 600,0"</span> <span class='op'>=</span> <span class='st'>"#746ab1"</span>,</span>
<span>      <span class='st'>"&gt;1.000,0"</span> <span class='op'>=</span>      <span class='st'>"#54268f"</span><span class='op'>)</span>,</span>
<span>      name <span class='op'>=</span> </span>
<span>      <span class='st'>"VARIACIÓN 2004-2014</span></span>
<span><span class='st'>    2004=100</span></span>
<span><span class='st'>    "</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/guides.html'>guides</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span></span>
<span>  </span>
<span><span class='va'>canary_islands</span></span></code></pre>
</div>
<p><img src="100564888_files/figure-html5/canary%20islands%20map-1.png" width="624" /></p>
</div>
<p>Looking at the original map, there is a box that separates the islands from the peninsula. We have to do that by hand with geom_polygon() to create the grey area and geom_path() to create the black lines, including the one that separates both provinces.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>canary_box_outer</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>13.2</span>, <span class='op'>-</span><span class='fl'>13.2</span>, <span class='op'>-</span><span class='fl'>13.8</span>, <span class='op'>-</span><span class='fl'>14.05</span>, <span class='op'>-</span><span class='fl'>18.35</span><span class='op'>)</span>,  </span>
<span>  y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>27.5</span>, <span class='fl'>29.65</span>, <span class='fl'>29.65</span>, <span class='fl'>29.3</span>, <span class='fl'>29.3</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>canary_box_inner</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>13.35</span>, <span class='op'>-</span><span class='fl'>13.35</span>, <span class='op'>-</span><span class='fl'>13.75</span>, <span class='op'>-</span><span class='fl'>14</span>, <span class='op'>-</span><span class='fl'>18.35</span><span class='op'>)</span>,  </span>
<span>  y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>27.5</span>, <span class='fl'>29.5</span>, <span class='fl'>29.5</span>, <span class='fl'>29.15</span>, <span class='fl'>29.15</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>canary_band</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>13.2</span>, <span class='op'>-</span><span class='fl'>13.2</span>, <span class='op'>-</span><span class='fl'>13.8</span>, <span class='op'>-</span><span class='fl'>14.05</span>, <span class='op'>-</span><span class='fl'>18.35</span>, <span class='op'>-</span><span class='fl'>18.35</span>, <span class='op'>-</span><span class='fl'>13.2</span>,</span>
<span>        <span class='op'>-</span><span class='fl'>13.2</span>, <span class='op'>-</span><span class='fl'>18.35</span>, <span class='op'>-</span><span class='fl'>18.35</span>, <span class='op'>-</span><span class='fl'>14</span>, <span class='op'>-</span><span class='fl'>13.75</span>, <span class='op'>-</span><span class='fl'>13.35</span>, <span class='op'>-</span><span class='fl'>13.35</span>, <span class='op'>-</span><span class='fl'>13.2</span><span class='op'>)</span>,</span>
<span>  y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>27.5</span>, <span class='fl'>29.65</span>, <span class='fl'>29.65</span>, <span class='fl'>29.3</span>, <span class='fl'>29.3</span>, <span class='fl'>27.5</span>, <span class='fl'>27.5</span>,</span>
<span>        <span class='fl'>27.5</span>, <span class='fl'>27.5</span>, <span class='fl'>29.15</span>, <span class='fl'>29.15</span>, <span class='fl'>29.5</span>, <span class='fl'>29.5</span>, <span class='fl'>27.5</span>, <span class='fl'>27.5</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>canary_islands</span> <span class='op'>&lt;-</span></span>
<span>  <span class='va'>canary_islands</span> <span class='op'>+</span> </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_polygon.html'>geom_polygon</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>canary_band</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span>,</span>
<span>    fill <span class='op'>=</span> <span class='st'>"#feffff"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_path</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>canary_box_outer</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span>,</span>
<span>    colour <span class='op'>=</span> <span class='st'>"black"</span>,</span>
<span>  linewidth <span class='op'>=</span> <span class='fl'>0.3</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_path</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>canary_box_inner</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span>,</span>
<span>    colour <span class='op'>=</span> <span class='st'>"black"</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='fl'>0.3</span><span class='op'>)</span> <span class='op'>+</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_path</a></span><span class='op'>(</span></span>
<span>  data <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>16.25</span>, <span class='op'>-</span><span class='fl'>15.7</span><span class='op'>)</span>, </span>
<span>                    y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>27.7</span>, <span class='fl'>28.75</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span>,</span>
<span>  colour <span class='op'>=</span> <span class='st'>"black"</span>,</span>
<span>  linewidth <span class='op'>=</span> <span class='fl'>0.3</span></span>
<span><span class='op'>)</span></span>
<span><span class='va'>canary_islands</span></span></code></pre>
</div>
<p><img src="100564888_files/figure-html5/canary%20box-1.png" width="624" /></p>
</div>
<p>The pie charts will be added as we did before.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>canary_islands</span> <span class='op'>&lt;-</span> <span class='va'>canary_islands</span> <span class='op'>+</span> </span>
<span>  <span class='fu'><a href='https://eliocamp.github.io/ggnewscale/reference/new_scale.html'>new_scale_fill</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/pkg/scatterpie/man/geom-scatterpie.html'>geom_scatterpie</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>untidy_canary</span>, </span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>      x <span class='op'>=</span> <span class='va'>longitude</span>,</span>
<span>      y <span class='op'>=</span> <span class='va'>latitude</span>,</span>
<span>      r <span class='op'>=</span> <span class='va'>radius</span><span class='op'>)</span>,</span>
<span>    cols <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>      <span class='st'>"Hidráulica"</span>,</span>
<span>      <span class='st'>"Solar"</span>,</span>
<span>      <span class='st'>"Eólica"</span>,</span>
<span>      <span class='st'>"Térmica renovable y otras"</span>,</span>
<span>      <span class='st'>"Nuclear"</span>,</span>
<span>      <span class='st'>"Carbón, fuelgas, ciclo combinado y cogeneración"</span><span class='op'>)</span>,</span>
<span>    color <span class='op'>=</span> <span class='st'>"black"</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='fl'>0.3</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_fill_manual</a></span><span class='op'>(</span></span>
<span>    values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>      <span class='st'>"Hidráulica"</span> <span class='op'>=</span> <span class='st'>"#a6d0e4"</span>,</span>
<span>      <span class='st'>"Solar"</span> <span class='op'>=</span> <span class='st'>"#ffd92e"</span>,</span>
<span>      <span class='st'>"Eólica"</span> <span class='op'>=</span> <span class='st'>"#4caf4a"</span>,</span>
<span>      <span class='st'>"Térmica renovable y otras"</span> <span class='op'>=</span> <span class='st'>"#fcb461"</span>,</span>
<span>      <span class='st'>"Nuclear"</span> <span class='op'>=</span> <span class='st'>"#fb8172"</span>,</span>
<span>      <span class='st'>"Carbón, fuelgas, ciclo combinado y cogeneración"</span> <span class='op'>=</span> <span class='st'>"#d4c0a0"</span></span>
<span>    <span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/guides.html'>guides</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    plot.margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span><span class='op'>)</span>,</span>
<span>    panel.background <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span><span class='va'>canary_islands</span></span></code></pre>
</div>
<p><img src="100564888_files/figure-html5/canary%20islands%20pie%20charts-1.png" width="624" /></p>
</div>
<p>After having put all the features we need, we can grob the visualization to add it again to the replica. In order to get the coordinates, we’ll have to do it by hand again.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>canary_grob</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplotGrob.html'>ggplotGrob</a></span><span class='op'>(</span><span class='va'>canary_islands</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>map_replica</span> <span class='op'>&lt;-</span></span>
<span>  <span class='va'>map_replica</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotation_custom.html'>annotation_custom</a></span><span class='op'>(</span><span class='va'>canary_grob</span>,</span>
<span>    xmin <span class='op'>=</span> <span class='op'>-</span><span class='fl'>14.14</span>,   </span>
<span>    xmax <span class='op'>=</span> <span class='op'>-</span><span class='fl'>5.7</span>,    </span>
<span>    ymin <span class='op'>=</span> <span class='fl'>34.6</span>,    </span>
<span>    ymax <span class='op'>=</span> <span class='fl'>37</span><span class='op'>)</span></span>
<span><span class='va'>map_replica</span></span></code></pre>
</div>
<p><img src="100564888_files/figure-html5/add%20canary%20islands%20to%20the%20main%20map-1.png" width="624" /></p>
</div>
<p>At last, we can put the three final touches of our replica: the scale of the map, the source of teh visualization and the title. The position of the scale’s texts will be infered having the frame as reference.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>map_replica</span> <span class='op'>&lt;-</span> <span class='va'>map_replica</span> <span class='op'>+</span></span>
<span><span class='fu'><a href='https://paleolimbot.github.io/ggspatial/reference/annotation_scale.html'>annotation_scale</a></span><span class='op'>(</span></span>
<span>    location <span class='op'>=</span> <span class='st'>"bl"</span>,</span>
<span>    style <span class='op'>=</span> <span class='st'>"bar"</span>,</span>
<span>    pad_x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>0.8</span>, <span class='st'>"cm"</span><span class='op'>)</span>, </span>
<span>    pad_y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>2.12</span>, <span class='st'>"cm"</span><span class='op'>)</span>,</span>
<span>    bar_cols <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"white"</span>, <span class='st'>"grey"</span>, <span class='st'>"white"</span><span class='op'>)</span>,</span>
<span>    line_width <span class='op'>=</span> <span class='fl'>0.3</span>,</span>
<span>    height <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>0.06</span>, <span class='st'>"cm"</span><span class='op'>)</span>,</span>
<span>    text_family <span class='op'>=</span> <span class='st'>"weezer"</span>,</span>
<span>    text_cex <span class='op'>=</span> <span class='fl'>0</span>,</span>
<span>    unit_category <span class='op'>=</span> <span class='st'>"metric"</span>,</span>
<span>    width_hint <span class='op'>=</span> <span class='fl'>0.25</span><span class='op'>)</span> <span class='op'>+</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span><span class='st'>"text"</span>, x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>12.17</span>, y <span class='op'>=</span> <span class='fl'>36.85</span>, label <span class='op'>=</span> <span class='st'>"0"</span>, size <span class='op'>=</span> <span class='fl'>3</span>, family <span class='op'>=</span> <span class='st'>"weezer"</span>, hjust <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span> <span class='op'>+</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span><span class='st'>"text"</span>, x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>11</span>, y <span class='op'>=</span> <span class='fl'>36.85</span>, label <span class='op'>=</span> <span class='st'>"100"</span>, size <span class='op'>=</span> <span class='fl'>3</span>, family <span class='op'>=</span> <span class='st'>"weezer"</span>, hjust <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span> <span class='op'>+</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span><span class='st'>"text"</span>, x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>9.83</span>, y <span class='op'>=</span> <span class='fl'>36.85</span>, label <span class='op'>=</span> <span class='st'>"200"</span>, size <span class='op'>=</span> <span class='fl'>3</span>, family <span class='op'>=</span> <span class='st'>"weezer"</span>, hjust <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span> <span class='op'>+</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span><span class='st'>"text"</span>, x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>8.64</span>, y <span class='op'>=</span> <span class='fl'>36.85</span>, label <span class='op'>=</span> <span class='st'>"300 km"</span>, size <span class='op'>=</span> <span class='fl'>3</span>, family <span class='op'>=</span> <span class='st'>"weezer"</span>, hjust <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span></span>
<span><span class='va'>map_replica</span></span></code></pre>
</div>
<p><img src="100564888_files/figure-html5/Other%20details-1.png" width="624" /></p>
</div>
<p>To finish off, we’ll put the title and the sources of the map where they correspond.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>map_replica</span> <span class='op'>&lt;-</span></span>
<span><span class='va'>map_replica</span> <span class='op'>+</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"text"</span>,</span>
<span>  x <span class='op'>=</span> <span class='fl'>4.07</span>, y <span class='op'>=</span> <span class='fl'>44</span>,</span>
<span>  label <span class='op'>=</span> <span class='st'>"PRODUCCIÓN DE ENERGÍA ELÉCTRICA"</span>,</span>
<span>  size <span class='op'>=</span> <span class='fl'>6</span>, fontface <span class='op'>=</span> <span class='st'>"bold"</span>, hjust <span class='op'>=</span> <span class='fl'>1</span>, family <span class='op'>=</span> <span class='st'>"sans"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"text"</span>,</span>
<span>  x <span class='op'>=</span> <span class='fl'>4.8</span>, y <span class='op'>=</span> <span class='fl'>35.15</span>,</span>
<span>  label <span class='op'>=</span> <span class='st'>"Fuente: Estadísticas Eléctricas Anuales. MINETAD"</span>,</span>
<span>  size <span class='op'>=</span> <span class='fl'>3</span>, hjust <span class='op'>=</span> <span class='fl'>1</span>, family <span class='op'>=</span> <span class='st'>"weezer"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"text"</span>,</span>
<span>  x <span class='op'>=</span> <span class='fl'>4.8</span>, y <span class='op'>=</span> <span class='fl'>34.9</span>,</span>
<span>  label <span class='op'>=</span> <span class='st'>"Elaborado por: Instituto Geográfico Nacional. Atlas Nacional de España"</span>,</span>
<span>  size <span class='op'>=</span> <span class='fl'>3</span>, hjust <span class='op'>=</span> <span class='fl'>1</span>, fontface <span class='op'>=</span> <span class='st'>"italic"</span>, family <span class='op'>=</span> <span class='st'>"weezer"</span><span class='op'>)</span></span>
<span><span class='va'>map_replica</span></span></code></pre>
</div>
<p><img src="100564888_files/figure-html5/unnamed-chunk-6-1.png" width="624" /></p>
</div>
<p>We have finally finished the replication. As we can see, it looks really similar to the original and I’m really pleased with how it came about, given the difficulty of the replication. Nevertheless, there are slight differences that need to be acknowledged. First of, the positions of both the pie chart’s legend and of the Canary Islands panel are more to the left than in the original. This is due to the difficulties of putting it exactly where it needs to be, specially in the case of the pie chart’s legend. It’s definitely possible to make completely accurate, but the amount of time it requires is exponential. Personally I’m pleased with the positioning I managed. Secondly, the triangules are not exactly as the original ones, which have a flatter semicircle. Same as before, given the amount of detail required for the whole visualization, it looks similar enough. Finally, the letters of the sources are a bit small, but given the scaling of the variation legend, there is no more space to make it bigger.</p>
<h1 id="improvement">Improvement</h1>
<p>There is a lot to improve upon in this visualization. The main issue of the map is how saturation with information it is. It’s trying to be too many things, specifically three: it tries to visualize evolution of energy production by province, energy sources and total production. Wanting to provide all this information in a map makes it almost impossible to be clear. Or main objective will be to make a really simple graph in comparison.</p>
<p>Therefore the first thing that we’ll decide is to get rid of the map entirely. A map would be interesting if we wanted to know how the energy production is spread out geographically. This map doesn’t really do that, since it only says how much energy production each province has, not where these power plants are located.</p>
<p>A lollipop chart would be much better, since it is clean and can be faceted by energy source, which makes it even cleaner. We’ll proceed to code exactly that right now. For starters, we’ll change the data a bit. Specifically, we’ll pivot the data to create 3 energy variation intervals: 50 - 100 %, 100 - 200 %, 200 - 1000 %. We’ll also feature engineer the 2004 total and the main energy source of each province, so that we can later facet the lollipop chart by source.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># font_add_google(name = "Anton", family = "Impact")  # Alternativa similar a Impact</span></span>
<span><span class='co'># showtext_auto()</span></span>
<span></span>
<span><span class='va'>electricity_w</span> <span class='op'>&lt;-</span> <span class='va'>electricity_</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_wider.html'>pivot_wider</a></span><span class='op'>(</span>names_from <span class='op'>=</span> <span class='va'>Type</span>, values_from <span class='op'>=</span> <span class='va'>MWh</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    total_2004 <span class='op'>=</span> <span class='va'>Total</span> <span class='op'>/</span> <span class='op'>(</span><span class='fl'>1</span> <span class='op'>+</span> <span class='va'>`Variación 2004 - 2014`</span> <span class='op'>/</span> <span class='fl'>100</span><span class='op'>)</span>,</span>
<span>    total_2014 <span class='op'>=</span> <span class='va'>Total</span>,</span>
<span>    Variation <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span></span>
<span>      <span class='va'>`Variación 2004 - 2014`</span> <span class='op'>&lt;</span> <span class='fl'>100</span> <span class='op'>~</span> <span class='st'>"50 - 100 %"</span>,</span>
<span>      <span class='va'>`Variación 2004 - 2014`</span> <span class='op'>&gt;=</span> <span class='fl'>100</span> <span class='op'>&amp;</span> <span class='va'>`Variación 2004 - 2014`</span> <span class='op'>&lt;=</span> <span class='fl'>200</span> <span class='op'>~</span> <span class='st'>"100 - 200 %"</span>,</span>
<span>      <span class='va'>`Variación 2004 - 2014`</span> <span class='op'>&gt;</span> <span class='fl'>200</span> <span class='op'>~</span> <span class='st'>"200 - 1000 %"</span>,</span>
<span>      <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='cn'>NA_character_</span><span class='op'>)</span>,</span>
<span>    Variation <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>Variation</span>, levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"50 - 100 %"</span>, <span class='st'>"100 - 200 %"</span>, <span class='st'>"200 - 1000 %"</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>    main_energy <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span></span>
<span>      <span class='va'>Hidráulica</span> <span class='op'>&gt;=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>pmax</a></span><span class='op'>(</span><span class='va'>Eólica</span>, <span class='va'>Solar</span>, <span class='va'>`Térmica renovable y otras`</span>, <span class='va'>Nuclear</span>, <span class='va'>`Carbón, fuelgas, ciclo combinado y cogeneración`</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"Hidráulica"</span>,</span>
<span>      <span class='va'>Eólica</span> <span class='op'>&gt;=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>pmax</a></span><span class='op'>(</span><span class='va'>Hidráulica</span>, <span class='va'>Solar</span>, <span class='va'>`Térmica renovable y otras`</span>, <span class='va'>Nuclear</span>, <span class='va'>`Carbón, fuelgas, ciclo combinado y cogeneración`</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"Eólica"</span>,</span>
<span>      <span class='va'>Solar</span> <span class='op'>&gt;=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>pmax</a></span><span class='op'>(</span><span class='va'>Hidráulica</span>, <span class='va'>Eólica</span>, <span class='va'>`Térmica renovable y otras`</span>, <span class='va'>Nuclear</span>, <span class='va'>`Carbón, fuelgas, ciclo combinado y cogeneración`</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"Solar"</span>,</span>
<span>      <span class='va'>`Térmica renovable y otras`</span> <span class='op'>&gt;=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>pmax</a></span><span class='op'>(</span><span class='va'>Hidráulica</span>, <span class='va'>Eólica</span>, <span class='va'>Solar</span>, <span class='va'>Nuclear</span>, <span class='va'>`Carbón, fuelgas, ciclo combinado y cogeneración`</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"Térmica renovable y otras"</span>,</span>
<span>      <span class='va'>Nuclear</span> <span class='op'>&gt;=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>pmax</a></span><span class='op'>(</span><span class='va'>Hidráulica</span>, <span class='va'>Eólica</span>, <span class='va'>Solar</span>, <span class='va'>`Térmica renovable y otras`</span>, <span class='va'>`Carbón, fuelgas, ciclo combinado y cogeneración`</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"Nuclear"</span>,</span>
<span>      <span class='va'>`Carbón, fuelgas, ciclo combinado y cogeneración`</span> <span class='op'>&gt;=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>pmax</a></span><span class='op'>(</span><span class='va'>Hidráulica</span>, <span class='va'>Eólica</span>, <span class='va'>Solar</span>, <span class='va'>`Térmica renovable y otras`</span>, <span class='va'>Nuclear</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"Carbón, fuelgas, ciclo combinado y cogeneración"</span>,</span>
<span>      <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='cn'>NA_character_</span></span>
<span>    <span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='va'>total_2014</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>Province <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>Province</span>, levels <span class='op'>=</span> <span class='va'>Province</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>Now we can start plotting the graph. We’ll use a continuous scale for the variation percentages and</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>improved_version</span> <span class='op'>&lt;-</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>electricity_w</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_segment.html'>geom_segment</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>total_2004</span>, </span>
<span>        xend <span class='op'>=</span> <span class='va'>total_2014</span>, </span>
<span>        y <span class='op'>=</span> <span class='va'>Province</span>, </span>
<span>        yend <span class='op'>=</span> <span class='va'>Province</span><span class='op'>)</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>total_2014</span>, y <span class='op'>=</span> <span class='va'>Province</span>, colour <span class='op'>=</span> <span class='va'>`Variación 2004 - 2014`</span><span class='op'>)</span>,</span>
<span>    size <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_viridis.html'>scale_colour_viridis_c</a></span><span class='op'>(</span></span>
<span>    option <span class='op'>=</span> <span class='st'>"plasma"</span>,</span>
<span>    breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>50</span>, <span class='fl'>100</span>, <span class='fl'>200</span>, <span class='fl'>500</span>, <span class='fl'>1000</span><span class='op'>)</span>,</span>
<span>    name <span class='op'>=</span> <span class='st'>"Variación 2004-2014 (%)"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span></span>
<span>    labels <span class='op'>=</span> <span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org/reference/label_number.html'>label_number</a></span><span class='op'>(</span>big.mark <span class='op'>=</span> <span class='st'>","</span><span class='op'>)</span>,</span>
<span>    breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>30000000</span>, by <span class='op'>=</span> <span class='fl'>5000000</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/guides.html'>guides</a></span><span class='op'>(</span>colour <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/guide_colourbar.html'>guide_colorbar</a></span><span class='op'>(</span>barheight <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>7</span>, <span class='st'>"cm"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_minimal</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    legend.position <span class='op'>=</span> <span class='st'>"right"</span>,</span>
<span>    legend.background <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='st'>"#F1FAEE"</span>, color <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span>,</span>
<span>    legend.text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"black"</span>, size <span class='op'>=</span> <span class='fl'>16</span><span class='op'>)</span>,</span>
<span>    legend.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"black"</span>, size <span class='op'>=</span> <span class='fl'>16</span>, face <span class='op'>=</span> <span class='st'>"bold"</span><span class='op'>)</span>,</span>
<span>    panel.grid <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    axis.text.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>family <span class='op'>=</span> <span class='st'>"sans"</span>, size <span class='op'>=</span> <span class='fl'>16</span>, color <span class='op'>=</span> <span class='st'>"black"</span><span class='op'>)</span>,</span>
<span>    axis.text.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>10</span>, color <span class='op'>=</span> <span class='st'>"black"</span><span class='op'>)</span>,</span>
<span>    plot.background <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='st'>"#F1FAEE"</span>, color <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span>,</span>
<span>    panel.background <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='st'>"#F1FAEE"</span>, color <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>xlab</a></span><span class='op'>(</span><span class='st'>"Miles de MWh"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ylab</a></span><span class='op'>(</span><span class='st'>""</span><span class='op'>)</span></span>
<span><span class='va'>improved_version</span></span></code></pre>
</div>
<p><img src="100564888_files/figure-html5/unnamed-chunk-8-1.png" width="1152" /></p>
</div>
<p>Almost all have a variation between 50 - 200 %, that’s why almost all is blue. This visualization makes us see that the province that has more variation is Malaga, which couldn’t be seen as clearly in the previous visualization.</p>
<p>Having 50 provinces, the plot looks a bit too busy. Faceting will make it cleaner and it will clasify the provinces by its source, which makes us keep all the information of the original.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Fuentes</span></span>
<span><span class='co'># font_add_google(name = "Roboto Slab", family = "Roboto Slab")</span></span>
<span><span class='co'># showtext_auto()</span></span>
<span></span>
<span><span class='va'>improved_version</span> <span class='op'>&lt;-</span> <span class='va'>improved_version</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggforce.data-imaginist.com/reference/facet_row.html'>facet_col</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/vars.html'>vars</a></span><span class='op'>(</span><span class='va'>main_energy</span><span class='op'>)</span>, </span>
<span>    scales <span class='op'>=</span> <span class='st'>"free_y"</span>,</span>
<span>    space <span class='op'>=</span> <span class='st'>"free"</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    strip.text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>face <span class='op'>=</span> <span class='st'>"bold"</span>, size <span class='op'>=</span> <span class='fl'>12</span><span class='op'>)</span>,</span>
<span>    strip.background <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>improved_version</span></span></code></pre>
</div>
<p><img src="100564888_files/figure-html5/unnamed-chunk-9-1.png" width="1152" /></p>
</div>
<p>Here we can see all the information of the map but in a much nicer way. The stories that could be taken out of the map are much more intuitive now. For example, the fact that Malaga and Badajoz were in 2014 the provinces that grew the most in the last ten years but that that doesn’t mean it could compare to other regions is much more visible now. The fact that regions with nuclear as its main energy source tend to have much more energy is also clearer. The plot could be set up in a less vertical way so that it looks tidier, but the trade-off is that the provinces not as easily comparable.</p>
<p>Adding the title, we’re good to go.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>improved_version</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Producción de energía eléctrica en España"</span>,</span>
<span>       subtitle <span class='op'>=</span> <span class='st'>"Evolución 2004 - 2014"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    strip.text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>face <span class='op'>=</span> <span class='st'>"bold"</span>, size <span class='op'>=</span> <span class='fl'>14</span><span class='op'>)</span>,</span>
<span>    strip.background <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>hjust <span class='op'>=</span> <span class='fl'>0</span>, face <span class='op'>=</span> <span class='st'>"bold"</span>, size <span class='op'>=</span> <span class='fl'>18</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
<p><img src="100564888_files/figure-html5/unnamed-chunk-10-1.png" width="1152" /></p>
</div>
<p>All in all, this improvement, as simple as it is, improves the previous visualization a lot, just by removing the map, which constraint the plot completely.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="reuse">Reuse</h3>
  <p>Text and figures are licensed under Creative Commons Attribution <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>. The figures that have been reused from other sources don't fall under this license and can be recognized by a note in their caption: "Figure from ...".</p>
  <h3 id="citation">Citation</h3>
  <p>For attribution, please cite this work as</p>
  <pre class="citation-appendix short">Fürup (2026, Jan. 14). Data Visualization | MSc CSS: Energy Production between 2004 and 2014. Retrieved from https://csslab.uc3m.es/dataviz/projects/2025/100564888/</pre>
  <p>BibTeX citation</p>
  <pre class="citation-appendix long">@misc{fürup2026energy,
  author = {Fürup, Noah Emanuel},
  title = {Data Visualization | MSc CSS: Energy Production between 2004 and 2014},
  url = {https://csslab.uc3m.es/dataviz/projects/2025/100564888/},
  year = {2026}
}</pre>
</div>
<!--/radix_placeholder_appendices-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<!--radix_placeholder_navigation_after_body--><html><body>
<div class="distill-site-nav distill-site-footer">
<p><img src="../../../assets/acronimo_nombre1l_0.png" width="400"></p>
</div>
<!--/radix_placeholder_navigation_after_body-->
</body></html>


</body>

</html>
