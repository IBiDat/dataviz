<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>


  <!--radix_placeholder_meta_tags-->
<title>Data visualization | MSc CSS: Is the World Moving Enough?</title>

<meta property="description" itemprop="description" content="A look at the mortality due to low physical activity worldwide."/>

<link rel="canonical" href="https://csslab.uc3m.es/dataviz/projects/2023/100517341/"/>
<link rel="license" href="https://creativecommons.org/licenses/by/4.0/"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2024-01-28"/>
<meta property="article:created" itemprop="dateCreated" content="2024-01-28"/>
<meta name="article:author" content="Mathieu Bietrix"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="Data visualization | MSc CSS: Is the World Moving Enough?"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="A look at the mortality due to low physical activity worldwide."/>
<meta property="og:url" content="https://csslab.uc3m.es/dataviz/projects/2023/100517341/"/>
<meta property="og:image" content="https://csslab.uc3m.es/dataviz/projects/2023/100517341/100517341_files/figure-html5/unnamed-chunk-14-1.png"/>
<meta property="og:image:width" content="1248"/>
<meta property="og:image:height" content="768"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="Data visualization | MSc CSS"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary_large_image"/>
<meta property="twitter:title" content="Data visualization | MSc CSS: Is the World Moving Enough?"/>
<meta property="twitter:description" content="A look at the mortality due to low physical activity worldwide."/>
<meta property="twitter:url" content="https://csslab.uc3m.es/dataviz/projects/2023/100517341/"/>
<meta property="twitter:image" content="https://csslab.uc3m.es/dataviz/projects/2023/100517341/100517341_files/figure-html5/unnamed-chunk-14-1.png"/>
<meta property="twitter:image:width" content="1248"/>
<meta property="twitter:image:height" content="768"/>

<!--  https://scholar.google.com/intl/en/scholar/inclusion.html#indexing -->
<meta name="citation_title" content="Data visualization | MSc CSS: Is the World Moving Enough?"/>
<meta name="citation_fulltext_html_url" content="https://csslab.uc3m.es/dataviz/projects/2023/100517341/"/>
<meta name="citation_fulltext_world_readable" content=""/>
<meta name="citation_online_date" content="2024/01/28"/>
<meta name="citation_publication_date" content="2024/01/28"/>
<meta name="citation_author" content="Mathieu Bietrix"/>
<!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["creative_commons","title","description","categories","author","date","output","citation_url","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["CC BY"]},{"type":"character","attributes":{},"value":["Is the World Moving Enough?"]},{"type":"character","attributes":{},"value":["A look at the mortality due to low physical activity worldwide."]},{"type":"character","attributes":{},"value":["2023"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["Mathieu Bietrix"]}]}]},{"type":"character","attributes":{},"value":["2024-01-28"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]}]}]},{"type":"character","attributes":{},"value":["https://csslab.uc3m.es/dataviz/projects/2023/100517341/"]},{"type":"character","attributes":{},"value":["https://csslab.uc3m.es/dataviz/projects/2023/100517341/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["100517341_files/figure-html5/unnamed-chunk-1-1.png","100517341_files/figure-html5/unnamed-chunk-10-1.png","100517341_files/figure-html5/unnamed-chunk-12-1.png","100517341_files/figure-html5/unnamed-chunk-14-1.png","100517341_files/figure-html5/unnamed-chunk-17-1.png","100517341_files/figure-html5/unnamed-chunk-18-1.png","100517341_files/figure-html5/unnamed-chunk-19-1.png","100517341_files/figure-html5/unnamed-chunk-2-1.png","100517341_files/figure-html5/unnamed-chunk-20-1.png","100517341_files/figure-html5/unnamed-chunk-21-1.png","100517341_files/figure-html5/unnamed-chunk-33-1.png","100517341_files/figure-html5/unnamed-chunk-35-1.png","100517341_files/figure-html5/unnamed-chunk-35-2.png","100517341_files/figure-html5/unnamed-chunk-4-1.png","100517341_files/figure-html5/unnamed-chunk-7-1.png","100517341_files/figure-html5/unnamed-chunk-8-1.png","100517341_files/figure-html5/unnamed-chunk-9-1.png","Final_Project_Dataset.csv","original-graph.png","Population_per_country_per_year.csv"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../../site_libs/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"/>
<link href="../../../site_libs/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"/>
<script src="../../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<script src="../../../site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
<script src="../../../site_libs/fuse-6.4.1/fuse.min.js"></script>

<script type="application/javascript">

function getMeta(metaName) {
  var metas = document.getElementsByTagName('meta');
  for (let i = 0; i < metas.length; i++) {
    if (metas[i].getAttribute('name') === metaName) {
      return metas[i].getAttribute('content');
    }
  }
  return '';
}

function offsetURL(url) {
  var offset = getMeta('distill:offset');
  return offset ? offset + '/' + url : url;
}

function createFuseIndex() {

  // create fuse index
  var options = {
    keys: [
      { name: 'title', weight: 20 },
      { name: 'categories', weight: 15 },
      { name: 'description', weight: 10 },
      { name: 'contents', weight: 5 },
    ],
    ignoreLocation: true,
    threshold: 0
  };
  var fuse = new window.Fuse([], options);

  // fetch the main search.json
  return fetch(offsetURL('search.json'))
    .then(function(response) {
      if (response.status == 200) {
        return response.json().then(function(json) {
          // index main articles
          json.articles.forEach(function(article) {
            fuse.add(article);
          });
          // download collections and index their articles
          return Promise.all(json.collections.map(function(collection) {
            return fetch(offsetURL(collection)).then(function(response) {
              if (response.status === 200) {
                return response.json().then(function(articles) {
                  articles.forEach(function(article) {
                    fuse.add(article);
                  });
                })
              } else {
                return Promise.reject(
                  new Error('Unexpected status from search index request: ' +
                            response.status)
                );
              }
            });
          })).then(function() {
            return fuse;
          });
        });

      } else {
        return Promise.reject(
          new Error('Unexpected status from search index request: ' +
                      response.status)
        );
      }
    });
}

window.document.addEventListener("DOMContentLoaded", function (event) {

  // get search element (bail if we don't have one)
  var searchEl = window.document.getElementById('distill-search');
  if (!searchEl)
    return;

  createFuseIndex()
    .then(function(fuse) {

      // make search box visible
      searchEl.classList.remove('hidden');

      // initialize autocomplete
      var options = {
        autoselect: true,
        hint: false,
        minLength: 2,
      };
      window.autocomplete(searchEl, options, [{
        source: function(query, callback) {
          const searchOptions = {
            isCaseSensitive: false,
            shouldSort: true,
            minMatchCharLength: 2,
            limit: 10,
          };
          var results = fuse.search(query, searchOptions);
          callback(results
            .map(function(result) { return result.item; })
          );
        },
        templates: {
          suggestion: function(suggestion) {
            var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
              ? `<img src="${offsetURL(suggestion.preview)}"</img>`
              : '';
            var html = `
              <div class="search-item">
                <h3>${suggestion.title}</h3>
                <div class="search-item-description">
                  ${suggestion.description || ''}
                </div>
                <div class="search-item-preview">
                  ${img}
                </div>
              </div>
            `;
            return html;
          }
        }
      }]).on('autocomplete:selected', function(event, suggestion) {
        window.location.href = offsetURL(suggestion.path);
      });
      // remove inline display style on autocompleter (we want to
      // manage responsive display via css)
      $('.algolia-autocomplete').css("display", "");
    })
    .catch(function(error) {
      console.log(error);
    });

});

</script>

<style type="text/css">

.nav-search {
  font-size: x-small;
}

/* Algolioa Autocomplete */

.algolia-autocomplete {
  display: inline-block;
  margin-left: 10px;
  vertical-align: sub;
  background-color: white;
  color: black;
  padding: 6px;
  padding-top: 8px;
  padding-bottom: 0;
  border-radius: 6px;
  border: 1px #0F2E3D solid;
  width: 180px;
}


@media screen and (max-width: 768px) {
  .distill-site-nav .algolia-autocomplete {
    display: none;
    visibility: hidden;
  }
  .distill-site-nav.responsive .algolia-autocomplete {
    display: inline-block;
    visibility: visible;
  }
  .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
    margin-left: 0;
    width: 400px;
    max-height: 400px;
  }
}

.algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
  width: 90%;
  outline: none;
  border: none;
}

.algolia-autocomplete .aa-hint {
  color: #999;
}
.algolia-autocomplete .aa-dropdown-menu {
  width: 550px;
  max-height: 70vh;
  overflow-x: visible;
  overflow-y: scroll;
  padding: 5px;
  margin-top: 3px;
  margin-left: -150px;
  background-color: #fff;
  border-radius: 5px;
  border: 1px solid #999;
  border-top: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
  cursor: pointer;
  padding: 5px 4px;
  border-bottom: 1px solid #eee;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
  border-bottom: none;
  margin-bottom: 2px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
  overflow: hidden;
  font-size: 0.8em;
  line-height: 1.4em;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
  font-size: 1rem;
  margin-block-start: 0;
  margin-block-end: 5px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
  display: inline-block;
  overflow: hidden;
  height: 2.8em;
  width: 80%;
  margin-right: 4%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
  display: inline-block;
  width: 15%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
  height: 3em;
  width: auto;
  display: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
  display: initial;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
  background-color: #eee;
}
.algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
  font-weight: bold;
  font-style: normal;
}

</style>


<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
  font-size: 100%;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

hr.section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  margin: 0px;
}


d-byline {
  border-top: none;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
  border-top: none;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

/* tweak for Pandoc numbered line within distill */
d-article pre.numberSource code > span {
    left: -2em;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // separator
  var separator = '<hr class="section-separator" style="clear: both"/>';
  // prepend separator above appendix
  $('.d-byline').before(separator);
  $('.d-article').before(separator);

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme, except when numbering line
  // in code chunk
  $('pre:not(.numberLines) code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      var author_name = front_matter.authors[i].author
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', author_name ? 'ORCID ID for ' + author_name : 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      const citeChild = $(this).children()[0]
      // Do not process if @xyz has been used without escaping and without bibliography activated
      // https://github.com/rstudio/distill/issues/466
      if (citeChild === undefined) return true

      if (citeChild.nodeName == "D-FOOTNOTE") {
        var fn = citeChild
        $(this).html(fn.shadowRoot.querySelector("sup"))
        $(this).id = fn.id
        fn.remove()
      }
      var refs = $(this).attr('data-cites').split(" ");
      var refHtml = refs.map(function(ref) {
        // Could use CSS.escape too here, we insure backward compatibility in navigator
        return "<p>" + $('div[id="ref-' + ref + '"]').html() + "</p>";
      }).join("\n");
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // fix footnotes in tables (#411)
    // replacing broken distill.pub feature
    $('table d-footnote').each(function() {
      // we replace internal showAtNode methode which is triggered when hovering a footnote
      this.hoverBox.showAtNode = function(node) {
        // ported from https://github.com/distillpub/template/pull/105/files
        calcOffset = function(elem) {
            let x = elem.offsetLeft;
            let y = elem.offsetTop;
            // Traverse upwards until an `absolute` element is found or `elem`
            // becomes null.
            while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                x += elem.offsetLeft;
                y += elem.offsetTop;
            }

            return { left: x, top: y };
        }
        // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
        const bbox = node.getBoundingClientRect();
        const offset = calcOffset(node);
        this.show([offset.left + bbox.width, offset.top + bbox.height]);
      }
    })

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    // ignore leaflet img layers (#106)
    figures = figures.filter(':not(img[class*="leaflet"])')
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */
</style>
<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */

@import url('https://fonts.googleapis.com/css2?family=Questrial');

html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    "Questrial", sans-serif;
  --mono-font:       monospace;
  --body-font:       "Questrial", sans-serif;
  --navbar-font:     "Questrial", sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #000e78;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #000e78;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */

@media screen and (min-width: 768px) {
  d-article aside {
    height: 0;
  }
  aside.slides {
    margin-left: -148px;
    height: auto;
  }
  aside.slides + h2 {
    white-space: nowrap;
  }
}

d-article li {
  margin-bottom: 0.1em;
}

.posts-list .post-preview .thumbnail {
  max-height: 300px;
  overflow: hidden;
}</style>
<style type="text/css">
/* base style */

/* FONT FAMILIES */

:root {
  --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

body,
.posts-list .post-preview p,
.posts-list .description p {
  font-family: var(--body-font), var(--body-default);
}

h1, h2, h3, h4, h5, h6,
.posts-list .post-preview h2,
.posts-list .description h2 {
  font-family: var(--heading-font), var(--heading-default);
}

d-article div.sourceCode code,
d-article pre code {
  font-family: var(--mono-font), var(--mono-default);
}


/*-- TITLE --*/
d-title h1,
.posts-list > h1 {
  color: var(--title-color, black);
}

d-title h1 {
  font-size: var(--title-size, 50px);
}

/*-- HEADERS --*/
d-article h1,
d-article h2,
d-article h3,
d-article h4,
d-article h5,
d-article h6 {
  color: var(--header-color, rgba(0, 0, 0, 0.8));
}

/*-- BODY --*/
d-article > p,  /* only text inside of <p> tags */
d-article > ul, /* lists */
d-article > ol {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
  font-size: var(--body-size, 1.06rem);
}


/*-- CODE --*/
d-article div.sourceCode code,
d-article pre code {
  font-size: var(--code-size, 14px);
}

/*-- ASIDE --*/
d-article aside {
  font-size: var(--aside-size, 12px);
  color: var(--aside-color, rgba(0, 0, 0, 0.6));
}

/*-- FIGURE CAPTIONS --*/
figure .caption,
figure figcaption,
.figure .caption {
  font-size: var(--fig-cap-size, 13px);
  color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
}

/*-- METADATA --*/
d-byline h3 {
  font-size: var(--heading-size, 0.6rem);
  color: var(--heading-color, rgba(0, 0, 0, 0.5));
}

d-byline {
  font-size: var(--body-size, 0.8rem);
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

d-byline a,
d-article d-byline a {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

/*-- TABLE OF CONTENTS --*/
.d-contents nav h3 {
  font-size: var(--heading-size, 18px);
}

.d-contents nav a {
  font-size: var(--contents-size, 13px);
}

/*-- APPENDIX --*/
d-appendix h3 {
  font-size: var(--heading-size, 15px);
  color: var(--heading-color, rgba(0, 0, 0, 0.65));
}

d-appendix {
  font-size: var(--text-size, 0.8em);
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

d-appendix d-footnote-list a.footnote-backlink {
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

/*-- WEBSITE HEADER + FOOTER --*/
.distill-site-header .title {
  font-size: var(--title-size, 18px);
  font-family: var(--navbar-font), var(--heading-default);
}

.distill-site-header a,
.nav-dropdown .nav-dropbtn {
  font-family: var(--navbar-font), var(--heading-default);
}

.nav-dropdown .nav-dropbtn {
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  font-size: var(--text-size, 15px);
}

.distill-site-header a:hover,
.nav-dropdown:hover .nav-dropbtn {
  color: var(--hover-color, white);
}

.distill-site-header {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer a:hover {
  color: var(--hover-color, white);
}</style>
<!--/radix_placeholder_distill-->
  <script src="../../../site_libs/header-attrs-2.25/header-attrs.js"></script>
  <script src="../../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="../../../site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="../../../site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="../../../site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="../../../site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="../../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Is the World Moving Enough?","description":"A look at the mortality due to low physical activity worldwide.","authors":[{"author":"Mathieu Bietrix","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2024-01-28T00:00:00.000+01:00","citationText":"Bietrix, 2024"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<span class="logo">
<img src="../../../assets/acronimo_0.png"/>
</span>
<a href="../../../index.html" class="title">Data visualization | MSc CSS</a>
<input id="distill-search" class="nav-search hidden" type="text" placeholder="Search..."/>
</div>
<div class="nav-right">
<a href="../../../contents.html">Contents</a>
<a href="../../../tutorials.html">Tutorials</a>
<a href="../../../resources.html">Resources</a>
<a href="../../../projects.html">Projects</a>
<a href="https://github.com/IBiDat/dataviz" aria-label="Link to source">
<i class="fab fa-github" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Is the World Moving Enough?</h1>

<!--radix_placeholder_categories-->
<div class="dt-tags">
  <a href="../../../projects.html#category:2023" class="dt-tag">2023</a>
</div>
<!--/radix_placeholder_categories-->
<p><p>A look at the mortality due to low physical activity worldwide.</p></p>
</div>

<div class="d-byline">
  
  Mathieu Bietrix
  
<br/>2024-01-28
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#original-graph" id="toc-original-graph">Original graph</a></li>
<li><a href="#the-data" id="toc-the-data">The data</a>
<ul>
<li><a href="#deaths-due-to-low-physical-activity" id="toc-deaths-due-to-low-physical-activity">Deaths due to low physical activity</a></li>
<li><a href="#worlds-population-data" id="toc-worlds-population-data">World’s population data</a></li>
<li><a href="#world-data" id="toc-world-data">World data</a></li>
<li><a href="#final-dataset" id="toc-final-dataset">Final dataset</a></li>
</ul></li>
<li><a href="#main-chart" id="toc-main-chart">Main chart</a>
<ul>
<li><a href="#creating-the-world-map" id="toc-creating-the-world-map">Creating the world map</a></li>
<li><a href="#adding-the-text-elements" id="toc-adding-the-text-elements">Adding the text elements</a></li>
<li><a href="#theme" id="toc-theme">Theme</a></li>
<li><a href="#adding-the-data" id="toc-adding-the-data">Adding the data</a></li>
<li><a href="#adjustments" id="toc-adjustments">Adjustments</a></li>
<li><a href="#interactive-version-of-the-plot" id="toc-interactive-version-of-the-plot">Interactive version of the plot</a></li>
</ul></li>
<li><a href="#the-line-graph" id="toc-the-line-graph">The line graph</a>
<ul>
<li><a href="#coordinate-and-axes" id="toc-coordinate-and-axes">Coordinate and axes</a></li>
<li><a href="#theme-and-labs" id="toc-theme-and-labs">Theme and labs</a></li>
<li><a href="#adding-the-data-1" id="toc-adding-the-data-1">Adding the data</a></li>
<li><a href="#annotations" id="toc-annotations">Annotations</a></li>
<li><a href="#ggiraph-version-of-the-line-plot" id="toc-ggiraph-version-of-the-line-plot"><code>{ggiraph}</code> version of the line plot</a></li>
<li><a href="#adjustments-2" id="toc-adjustments-2">Adjustments</a></li>
</ul></li>
<li><a href="#alternative-graphs" id="toc-alternative-graphs">Alternative graphs</a>
<ul>
<li><a href="#the-data-1" id="toc-the-data-1">The data</a></li>
<li><a href="#alternative-map" id="toc-alternative-map">Alternative map</a></li>
<li><a href="#alternative-line-graph" id="toc-alternative-line-graph">Alternative line graph</a></li>
</ul></li>
<li><a href="#project-takeaways-and-what-i-learned" id="toc-project-takeaways-and-what-i-learned">Project takeaways and what I learned</a></li>
</ul>
</nav>
</div>
<h2 id="original-graph">Original graph</h2>
<p>The original graph can be found following <a href="https://ourworldindata.org/grapher/deaths-due-to-low-physical-activity?time=latest&amp;country=Eastern+Mediterranean+Region+%28WHO%29~Scotland~SRB~GNQ~TTO~SWZ~UKR~PHL~ATG">this link</a>.</p>
<figure>
<img src="original-graph.png" class="external" alt="Original graph" />
<figcaption aria-hidden="true">Original graph</figcaption>
</figure>
<h2 id="the-data">The data</h2>
<h3 id="deaths-due-to-low-physical-activity">Deaths due to low physical activity</h3>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Libraries used</span></span>
<span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/mhahsler/arules'>arules</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://r-spatial.github.io/sf/'>sf</a></span><span class='op'>)</span> </span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://docs.ropensci.org/rnaturalearth/'>rnaturalearth</a></span><span class='op'>)</span>  </span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://wilkelab.org/ggtext/'>ggtext</a></span><span class='op'>)</span>  </span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://davidgohel.github.io/ggiraph/'>ggiraph</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/slowkow/ggrepel'>ggrepel</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://haozhu233.github.io/kableExtra/'>kableExtra</a></span><span class='op'>)</span> </span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://gt.rstudio.com'>gt</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/jthomasmock/gtExtras'>gtExtras</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://docs.r4photobiology.info/ggpp/'>ggpp</a></span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>Fortunately, the data used to create this graph was already available on Our Word In Data and can be downloaded in a CSV format. This dataset was originally published by the Institute of Health Metrics and Evaluation, an American research institute in the area of global health statistics. It consists of the number of deaths attributed to low physical activity per country per year. As the data is already available, I will not make use of the <code>{owidR}</code> package that enable to load OWID data in R. Let’s import the dataset.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>data</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://readr.tidyverse.org/reference/read_delim.html'>read_csv</a></span><span class='op'>(</span>file <span class='op'>=</span> <span class='st'>"Final_Project_Dataset.csv"</span><span class='op'>)</span>  </span></code></pre>
</div>
</div>
<p>The dataset is already tidy data, and is ready to be used.</p>
<h3 id="worlds-population-data">World’s population data</h3>
<p>In order to facilitate the modifications that we would like to do to the original graph later, we need to add a new column to the dataset with the population of the countries. To do so, we need a dataset of the total population of these countries from 1990 to 2019. One can be found one via <a href="https://ourworldindata.org/population-growth#interactive-charts-on-population-growth">another chart created by Our World In Data</a>.</p>
<p>We need to filter the data to only keep the data from 1990 to 2019. Also, the <code>population</code> dataset contains the total population per continent. These rows are easy to spot, they have missing values as country codes.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>population</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://readr.tidyverse.org/reference/read_delim.html'>read_csv</a></span><span class='op'>(</span>file <span class='op'>=</span> <span class='st'>"Population_per_country_per_year.csv"</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>population</span> <span class='op'>&lt;-</span> <span class='va'>population</span> <span class='op'>|&gt;</span></span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Year</span> <span class='op'>&gt;=</span> <span class='fl'>1990</span> <span class='op'>&amp;</span> <span class='va'>Year</span> <span class='op'>&lt;=</span> <span class='fl'>2019</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>    <span class='fu'><a href='https://tidyr.tidyverse.org/reference/drop_na.html'>drop_na</a></span><span class='op'>(</span><span class='va'>Code</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>Now that we have the <code>population</code> dataset containing the total population of countries between 1990 and 2019, we can create a new dataset that joins the <code>data</code> tibble and the <code>population</code> tibble and that contains a column with the total population of each country for each year.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>data</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>inner_join</a></span><span class='op'>(</span><span class='va'>data</span>, <span class='va'>population</span>, </span>
<span>             by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'Code'</span><span class='op'>=</span><span class='st'>'Code'</span>, <span class='st'>'Year'</span><span class='op'>=</span><span class='st'>'Year'</span>, <span class='st'>'Entity'</span><span class='op'>=</span><span class='st'>'Entity'</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span><span class='co'># Let's rename the columns for better readability</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>    Deaths <span class='op'>=</span> <span class='va'>`Deaths that are from all causes attributed to low physical activity, in both sexes aged all ages`</span>,</span>
<span>    Population <span class='op'>=</span> <span class='va'>`Population (historical estimates)`</span></span>
<span>           <span class='op'>)</span></span>
<span>         <span class='op'>)</span></span></code></pre>
</div>
</div>
<p>We are almost done. As we can see on the original Our World in Data graph, the color attributed to each country is assigned on the basis of the range of number of deaths due to low activity in the country for a given year. Therefore, we need to discretize this variable in 9 different ranges, as the color scale used by OWID contains 9 ranges. After searching on the Web, I found that such an operation could be performed thanks to the <code>{arules}</code> package, using the <code>discretize()</code> function.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/mhahsler/arules'>arules</a></span><span class='op'>)</span>  </span>
<span></span>
<span><span class='co'># We define a vector that contains the values of the edges of each range used in the color scale of the original graph.</span></span>
<span></span>
<span><span class='va'>breaks_map</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>500</span>, <span class='fl'>1000</span>, <span class='fl'>2500</span>, <span class='fl'>5000</span>, <span class='fl'>10000</span>, <span class='fl'>25000</span>, <span class='fl'>50000</span>, <span class='fl'>100000</span>, <span class='fl'>250000</span><span class='op'>)</span></span>
<span><span class='va'>data</span> <span class='op'>&lt;-</span>   </span>
<span>  <span class='va'>data</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>Deaths_disc <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/arules/man/discretize.html'>discretize</a></span><span class='op'>(</span><span class='va'>Deaths</span>, method <span class='op'>=</span> <span class='st'>'fixed'</span>, breaks <span class='op'>=</span> <span class='va'>breaks_map</span><span class='op'>)</span>,</span>
<span>         .after <span class='op'>=</span> <span class='va'>Deaths</span><span class='op'>)</span> </span></code></pre>
</div>
</div>
<h3 id="world-data">World data</h3>
<p>To plot a map of the deaths due to low physical activity, we obviously need a map. To build this map, we need data as longitudes and latitudes of the countries worldwide. We will use the <code>{sf}</code> package to represent visally the geographic data (which are polygons) and the <code>{rnaturalearth}</code> to obtain this data.</p>
<p>First, we use the <code>ne_countries()</code> function from the <code>rnaturalearth</code> package. This function contains predownloaded vector maps for the world’s countries. We also want to make our world data a <code>sf</code> object, so that we can use the <code>sf</code> package in the future. The latter can be done by providing the argument <code>returnclass = 'sf'</code> (the default).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://r-spatial.github.io/sf/'>sf</a></span><span class='op'>)</span> </span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://docs.ropensci.org/rnaturalearth/'>rnaturalearth</a></span><span class='op'>)</span>  </span>
<span></span>
<span><span class='va'>world</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://docs.ropensci.org/rnaturalearth/reference/ne_countries.html'>ne_countries</a></span><span class='op'>(</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<h3 id="final-dataset">Final dataset</h3>
<p>We know need to join the <code>world</code> dataset and the <code>data</code> dataset to create the dataset that will be used to project the world map in ggplot2 and display the number of deaths due to low physical activity at the same time.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>data</span> <span class='op'>&lt;-</span></span>
<span>  <span class='va'>world</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>data</span>, by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'adm0_a3'</span> <span class='op'>=</span> <span class='st'>'Code'</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>Finally, let’s clean up our <code>data</code> dataset a bit so that R may have less difficulty to run the code that we will write to create the graph. Indeed, there are a vast majority of columns that we are not going to be using to display the data of interest with ggplot. The only columns that we need are :</p>
<ul>
<li><p><code>geometry</code>, which is used by <code>geom_sf()</code> to plot the shapes of the countries.</p></li>
<li><p><code>Entity</code>: the name of the country</p></li>
<li><p><code>continent</code></p></li>
<li><p><code>subregion</code></p></li>
<li><p><code>Year</code></p></li>
<li><p><code>Deaths</code></p></li>
<li><p><code>Deaths_disc</code></p></li>
<li><p><code>Population</code></p></li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>data</span> <span class='op'>&lt;-</span></span>
<span>  <span class='va'>data</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>Entity</span>,</span>
<span>         <span class='va'>continent</span>,         </span>
<span>         <span class='va'>subregion</span>,          </span>
<span>         <span class='va'>Year</span>,          </span>
<span>         <span class='va'>Deaths</span>,          </span>
<span>         <span class='va'>Deaths_disc</span>,          </span>
<span>         <span class='va'>Population</span>,          </span>
<span>         <span class='va'>geometry</span><span class='op'>)</span>  </span></code></pre>
</div>
</div>
<p>On a visual standpoint, the OWID graph doesn’t show Antartica, so we can remove the data linked to it in our dataset. Lastly, there are many islands that might pop on our graph. The simplest solution is to clear our <code>data</code> dataset from some of these islands, which seem to be Polynesia.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>data</span> <span class='op'>&lt;-</span>   </span>
<span>  <span class='va'>data</span> <span class='op'>|&gt;</span>   </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>continent</span> <span class='op'>!=</span> <span class='st'>'Antarctica'</span><span class='op'>)</span> <span class='op'>|&gt;</span>    </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>subregion</span> <span class='op'>!=</span> <span class='st'>'Polynesia'</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<h2 id="main-chart">Main chart</h2>
<h3 id="creating-the-world-map">Creating the world map</h3>
<p>The first thing we need to do is to create a projection of the world. As mentioned earlier, we will use the <code>{sf}</code> package, particularly the <code>geom_sf()</code> geom that enables to easily visualize <code>sf</code> objects. One of the advantage of this geom is that it is smart enough to understand the geometry type to draw according to the dataset we provide it.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>p</span> <span class='op'>&lt;-</span>    </span>
<span>  <span class='va'>data</span> <span class='op'>|&gt;</span>    </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span><span class='op'>)</span>  </span>
<span></span>
<span><span class='va'>p</span></span></code></pre>
</div>
<p><img src="100517341_files/figure-html5/unnamed-chunk-1-1.png" width="624" /></p>
</div>
<p>At this point, we have generated an empty map of the world. One thing we can notice is that the projection (meaning the way a 3D object, the world, is represented in 2D) used by default by <code>geom_sf()</code> is not exactly the same as the one used by Our World In Data. It seems that the latter is a “Robinson” projection. We can use the <code>coord_sf()</code> function to change our projection to a Robinson one.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>p</span> <span class='op'>&lt;-</span>    </span>
<span>  <span class='va'>p</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>coord_sf</a></span><span class='op'>(</span>crs <span class='op'>=</span> <span class='st'>"+proj=robin"</span><span class='op'>)</span>  </span>
<span></span>
<span><span class='va'>p</span></span></code></pre>
</div>
<p><img src="100517341_files/figure-html5/unnamed-chunk-2-1.png" width="624" /></p>
</div>
<h3 id="adding-the-text-elements">Adding the text elements</h3>
<p>Let’s add:</p>
<ul>
<li><p>The title: “Deaths due to low physical activity, 2019”,</p></li>
<li><p>The subtitle: “Estimated annual number of deaths attributed to low physical activity”,</p></li>
<li><p>And the caption “<strong>Data source:</strong> IHME, Global Burden of Disease (2019) – Learn more about this data</p>
<p><a href="https://ourworldindata.org/causes-of-death">OurWorldInData.org/causes-of-death</a> | <a href="https://creativecommons.org/licenses/by/4.0/">CC BY</a>”</p></li>
</ul>
<p>After going further, it appeared that the caption was more easily handled if we divided it in two parts: a caption and a tag. Note that for the moment, the tag position is clearly not good, as well as the size of its text, which will both be addressed when setting the theme. For convenience until then, let’s comment the tag.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>plot_title</span> <span class='op'>&lt;-</span> <span class='st'>"Deaths due to low physical activity, 2019"</span> </span>
<span><span class='va'>plot_subtitle</span> <span class='op'>&lt;-</span> <span class='st'>"Estimated annual number of deaths attributed to low physical activity."</span></span>
<span><span class='va'>plot_caption</span> <span class='op'>&lt;-</span> <span class='st'>"Data source: IHME, Global Burden of Disease (2019) - Learn more about this data"</span> </span>
<span><span class='va'>plot_tag</span> <span class='op'>&lt;-</span> <span class='st'>"OurWorldInData.org/causes-of-death | CC BY"</span>  </span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>p</span> <span class='op'>&lt;-</span>   </span>
<span>  <span class='va'>p</span> <span class='op'>+</span>  </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title <span class='op'>=</span> <span class='va'>plot_title</span>,        </span>
<span>       subtitle <span class='op'>=</span> <span class='va'>plot_subtitle</span>,        </span>
<span>       caption <span class='op'>=</span> <span class='va'>plot_caption</span>        </span>
<span>       <span class='co'>#tag = plot_tag        </span></span>
<span>       <span class='op'>)</span>  </span>
<span></span>
<span><span class='va'>p</span></span></code></pre>
</div>
<p><img src="100517341_files/figure-html5/unnamed-chunk-4-1.png" width="624" /></p>
</div>
<h3 id="theme">Theme</h3>
<p>One thing that we notice is that the OWID graph has a clean white background, without any displayed meridian. As the meridians are already colored in white, adding a <code>theme_classic()</code> should give us the look we are looking for. But we also want to get rid of the longitude axis. Then, the most appropriate theme to use is the <code>theme_void()</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>p</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='va'>p</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_void</a></span><span class='op'>(</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>Also the caption of the OWID plot has to be moved on the left, the size of the font has to be modified so that the subtitle and caption are smaller, and the title bigger. Finally, the font of the title can be switched to something approximating the Times New Roman font. Unfortunately, we were unable to use the latter font (which remains the biggest mystery of my year 2023 as it’s the most basic font ever), so we needed to get an equivalent from the Google Font, the Merriweather font.</p>
<p>We can also de-comment the tag, and set its size and position in the <code>theme()</code>. After unsuccessfully trying several positions for the tag, such as ‘bottom’, and ‘bottomleft’, it appeared that the easiest solution was to manually set its position using <code>plot.tag.position = 'bottom'</code> (which gets the tag under the caption but in the center of the plot), and the <code>margin</code> argument of <code>plot.tag = element_text()</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'>sysfonts</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/sysfonts/man/font_add_google.html'>font_add_google</a></span><span class='op'>(</span><span class='st'>'Merriweather'</span>, family <span class='op'>=</span> <span class='st'>'merriweather'</span><span class='op'>)</span> </span>
<span><span class='fu'>showtext</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/showtext/man/showtext_auto.html'>showtext_auto</a></span><span class='op'>(</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>p</span> <span class='op'>&lt;-</span>   </span>
<span>  <span class='va'>data</span> <span class='op'>|&gt;</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>coord_sf</a></span><span class='op'>(</span>crs <span class='op'>=</span> <span class='st'>'+proj=robin'</span><span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title <span class='op'>=</span> <span class='va'>plot_title</span>,        </span>
<span>       subtitle <span class='op'>=</span> <span class='va'>plot_subtitle</span>,        </span>
<span>       caption <span class='op'>=</span> <span class='va'>plot_caption</span>,        </span>
<span>       tag <span class='op'>=</span> <span class='va'>plot_tag</span><span class='op'>)</span> <span class='op'>+</span> <span class='co'># adding the tag   </span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_void</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>family <span class='op'>=</span> <span class='st'>'merriweather'</span>, size <span class='op'>=</span> <span class='fl'>15</span><span class='op'>)</span>,         </span>
<span>        plot.caption <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>hjust <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span>,         </span>
<span>        plot.tag.position <span class='op'>=</span> <span class='st'>'bottom'</span>,         </span>
<span>        plot.tag <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>10</span>, <span class='co'># customizing tag's size and position</span></span>
<span>                                margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>l <span class='op'>=</span> <span class='op'>-</span><span class='fl'>340</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>  </span>
<span></span>
<span><span class='va'>p</span></span></code></pre>
</div>
<p><img src="100517341_files/figure-html5/unnamed-chunk-7-1.png" width="624" /></p>
</div>
<h3 id="adding-the-data">Adding the data</h3>
<p>So far, we have a chart that has some common appearance traits shared with the Our World in Data graph. We can now add the information we want to display, focusing on a single year: 2019.</p>
<p>The first step is to filter the data to obtain only the data from 2019. Then, we can add an aesthetic to the <code>geom_sf()</code> geom to display the number of <code>Deaths</code> from low physical activity around the world. Since we want to color the map according to this variable, we will use the <code>fill</code> aesthetic.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>p</span> <span class='op'>&lt;-</span>    </span>
<span>  <span class='va'>data</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Year</span> <span class='op'>==</span> <span class='fl'>2019</span><span class='op'>)</span> <span class='op'>|&gt;</span> <span class='co'># filtering by year   </span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>Deaths_disc</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>coord_sf</a></span><span class='op'>(</span>crs <span class='op'>=</span> <span class='st'>'+proj=robin'</span><span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title <span class='op'>=</span> <span class='va'>plot_title</span>,        </span>
<span>       subtitle <span class='op'>=</span> <span class='va'>plot_subtitle</span>,        </span>
<span>       caption <span class='op'>=</span> <span class='va'>plot_caption</span>,        </span>
<span>       tag <span class='op'>=</span> <span class='va'>plot_tag</span><span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_void</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>family <span class='op'>=</span> <span class='st'>'merriweather'</span>, size <span class='op'>=</span> <span class='fl'>15</span><span class='op'>)</span>,   </span>
<span>        plot.caption <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>hjust <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span>,</span>
<span>        plot.tag.position <span class='op'>=</span> <span class='st'>'bottom'</span>,</span>
<span>        plot.tag <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>10</span>,    </span>
<span>                                margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>l <span class='op'>=</span> <span class='op'>-</span><span class='fl'>340</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>p</span></span></code></pre>
</div>
<p><img src="100517341_files/figure-html5/unnamed-chunk-8-1.png" width="624" /></p>
</div>
<h3 id="adjustments">Adjustments</h3>
<p>One striking difference with the original plot is the legend. We need to move the legend to the bottom of the chart and change the color palette. We need to change the legend key into a color bar. This can be done by using a “<a href="https://ggplot2.tidyverse.org/reference/guide_coloursteps.html">Discretized colourbar guide</a>”: the <code>guide_colorsteps()</code> guide. Within this guide, the “YlorRd” palette seems exactly the one that was used by Our Word In Data for their map.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>p</span> <span class='op'>&lt;-</span>    </span>
<span>  <span class='va'>data</span> <span class='op'>|&gt;</span>   </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Year</span> <span class='op'>==</span> <span class='fl'>2019</span><span class='op'>)</span> <span class='op'>|&gt;</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>Deaths_disc</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>coord_sf</a></span><span class='op'>(</span>crs <span class='op'>=</span> <span class='st'>'+proj=robin'</span><span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title <span class='op'>=</span> <span class='va'>plot_title</span>,        </span>
<span>       subtitle <span class='op'>=</span> <span class='va'>plot_subtitle</span>,        </span>
<span>       caption <span class='op'>=</span> <span class='va'>plot_caption</span>,        </span>
<span>       tag <span class='op'>=</span> <span class='va'>plot_tag</span><span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_void</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      family <span class='op'>=</span> <span class='st'>'merriweather'</span>,</span>
<span>      size <span class='op'>=</span> <span class='fl'>15</span><span class='op'>)</span>,</span>
<span>    plot.caption <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span>,</span>
<span>    plot.tag.position <span class='op'>=</span> <span class='st'>'bottom'</span>,         </span>
<span>    plot.tag <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      size <span class='op'>=</span> <span class='fl'>10</span>,                                  </span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>l <span class='op'>=</span> <span class='op'>-</span><span class='fl'>340</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>    legend.position <span class='op'>=</span> <span class='st'>'bottom'</span>, <span class='co'># moving the legend around           </span></span>
<span>    legend.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_brewer.html'>scale_fill_brewer</a></span><span class='op'>(</span>palette <span class='op'>=</span> <span class='st'>'YlOrRd'</span>,</span>
<span>                    guide <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/guide_coloursteps.html'>guide_coloursteps</a></span><span class='op'>(</span> <span class='co'># Modifying the default legend guide</span></span>
<span>                      ticks <span class='op'>=</span> <span class='cn'>TRUE</span>,  </span>
<span>                      barwidth <span class='op'>=</span> <span class='fl'>25</span>,  </span>
<span>                      barheight <span class='op'>=</span> <span class='fl'>0.5</span>, </span>
<span>                      frame.colour <span class='op'>=</span> <span class='st'>'black'</span>,  </span>
<span>                      frame.linewidth <span class='op'>=</span> <span class='fl'>0.01</span>,      </span>
<span>                      ticks.colour <span class='op'>=</span> <span class='st'>'black'</span>,   </span>
<span>                      ticks.linewidth <span class='op'>=</span> <span class='fl'>0.01</span><span class='op'>)</span> </span>
<span>                    <span class='op'>)</span>   </span>
<span></span>
<span><span class='va'>p</span></span></code></pre>
</div>
<p><img src="100517341_files/figure-html5/unnamed-chunk-9-1.png" width="624" /></p>
</div>
<p>Our plot starts looking a bit similar to the OWID one. Let’s move the legend’s labels on top of the legend, and display the limits of the legend. I thought that the first operation could be done by modifying the <code>legend.text</code> in the <code>theme()</code> function, but it seems not possible. Therefore, we can play on the <code>margin</code> argument of the <code>element_text()</code> function in the <code>theme()</code> to move the legend’s label around.<br />
The limits are ruled by an argument of the previously used <code>guide_colorsteps()</code>: <code>show.limits</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>p</span> <span class='op'>&lt;-</span>    </span>
<span>  <span class='va'>data</span> <span class='op'>|&gt;</span>   </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Year</span> <span class='op'>==</span> <span class='fl'>2019</span><span class='op'>)</span> <span class='op'>|&gt;</span>    </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>  </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>Deaths_disc</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>coord_sf</a></span><span class='op'>(</span>crs <span class='op'>=</span> <span class='st'>'+proj=robin'</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title <span class='op'>=</span> <span class='va'>plot_title</span>,</span>
<span>       subtitle <span class='op'>=</span> <span class='va'>plot_subtitle</span>,</span>
<span>       caption <span class='op'>=</span> <span class='va'>plot_caption</span>,</span>
<span>       tag <span class='op'>=</span> <span class='va'>plot_tag</span><span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_void</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      family <span class='op'>=</span> <span class='st'>'merriweather'</span>,</span>
<span>      size <span class='op'>=</span> <span class='fl'>15</span><span class='op'>)</span>,</span>
<span>    plot.caption <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span>,</span>
<span>    plot.tag.position <span class='op'>=</span> <span class='st'>'bottom'</span>,         </span>
<span>    plot.tag <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      size <span class='op'>=</span> <span class='fl'>10</span>,</span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>l <span class='op'>=</span> <span class='op'>-</span><span class='fl'>340</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>    legend.position <span class='op'>=</span> <span class='st'>'bottom'</span>,</span>
<span>    legend.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    legend.text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>           </span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='op'>-</span><span class='fl'>22</span><span class='op'>)</span> <span class='co'># adjusting the position of legend's labels</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_brewer.html'>scale_fill_brewer</a></span><span class='op'>(</span>palette <span class='op'>=</span> <span class='st'>'YlOrRd'</span>,</span>
<span>                    guide <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/guide_coloursteps.html'>guide_coloursteps</a></span><span class='op'>(</span>  </span>
<span>                      show.limits <span class='op'>=</span> <span class='cn'>TRUE</span>, <span class='co'># adding the scale limits to the legend</span></span>
<span>                      ticks <span class='op'>=</span> <span class='cn'>TRUE</span>,      </span>
<span>                      barwidth <span class='op'>=</span> <span class='fl'>25</span>,                       </span>
<span>                      barheight <span class='op'>=</span> <span class='fl'>0.5</span>,                       </span>
<span>                      frame.colour <span class='op'>=</span> <span class='st'>'black'</span>,</span>
<span>                      frame.linewidth <span class='op'>=</span> <span class='fl'>0.01</span>,                       </span>
<span>                      ticks.colour <span class='op'>=</span> <span class='st'>'black'</span>,</span>
<span>                      ticks.linewidth <span class='op'>=</span> <span class='fl'>0.01</span><span class='op'>)</span></span>
<span>                    <span class='op'>)</span>   </span>
<span></span>
<span><span class='va'>p</span></span></code></pre>
</div>
<p><img src="100517341_files/figure-html5/unnamed-chunk-10-1.png" width="624" /></p>
</div>
<p>Now the caption is slightly overriding the legend. We couldn’t fix it in the <code>theme()</code> by specifying a <code>vjust</code> argument to <code>plot.caption</code>, so rather decided to add a <code>\n</code> at the beginning of the caption to create an empty line.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># We added a newline character at the beginning of the string to create space over the caption</span></span>
<span><span class='va'>plot_caption</span> <span class='op'>&lt;-</span> <span class='st'>"\nData source: IHME, Global Burden of Disease (2019) - Learn more about this data"</span> </span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>p</span> </span></code></pre>
</div>
<p><img src="100517341_files/figure-html5/unnamed-chunk-12-1.png" width="624" /></p>
</div>
<p>Some adjustments also need to be done:</p>
<ul>
<li><p>The borders of the polygons projected by <code>geom_sf()</code> seem to be a bit thicker than on our original OWID graph.</p></li>
<li><p>Many islands remain on the graph, giving it a messier look than the original one.</p></li>
<li><p>The title, subtitle, caption and tag need to be spaced a bit from the border of the graph.</p></li>
</ul>
<p>For the first two issues, it seems that the solution could lie in the fact that the resolution/definition of the geometry variable used to project polygons on the graph and thus create a world map, is too high. I tried to use the <code>st_simplify()</code> function from the <code>sf</code> package but wasn’t able to then map my data. However, a much simpler way to do so worked well, by just lowering the <code>scale</code> of the <code>ne_countries()</code> function. This results in less details in the geometry variable, and thus, a less messy visual appearance. Of course, this option is not the optimal one in terms of precision, but it seems that Our World In Data opted for displaying the data for not all countries and island worldwide.</p>
<p>The 3rd issue can easily be solved with some little modifications of the <code>theme()</code> by passing a <code>hjust</code> argument to <code>plot.title = element_text()</code> and so on for the subtitle and caption.</p>
<p>The look is a lot cleaner, with softer edges. Let’s then try to :</p>
<ul>
<li><p>Space the title, subtitle, caption, and tag a bit from the left of the plot. This can be achieved by playing on the <code>hjust</code> (<code>margin</code> for the tag) argument of each of these <code>element_text()</code> in the <code>theme()</code>.</p></li>
<li><p>Get the title bold, the caption at the same size as the subtitle, the size of the tag a bit lower than the caption. To do so, we will add <code>face</code> and <code>size</code> arguments to <code>element_text()</code> in the <code>theme()</code>.</p></li>
<li><p>Get the “Data source” string in the caption bold. For this, we will modify the plot_caption variable, load the <code>{ggtext}</code> library, and set <code>plot.caption</code> to <code>ggtext::element_markdown</code>.</p></li>
</ul>
<p>Finally, the color of the text is not black in the original plot, but this color: #5b5b5b.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Recap of the data processing with the modification on the ne_countries() function</span></span>
<span></span>
<span><span class='va'>data</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://readr.tidyverse.org/reference/read_delim.html'>read_csv</a></span><span class='op'>(</span>file <span class='op'>=</span> <span class='st'>"Final_Project_Dataset.csv"</span><span class='op'>)</span>  </span>
<span></span>
<span><span class='va'>population</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://readr.tidyverse.org/reference/read_delim.html'>read_csv</a></span><span class='op'>(</span>file <span class='op'>=</span> <span class='st'>"Population_per_country_per_year.csv"</span><span class='op'>)</span>  </span>
<span></span>
<span><span class='va'>population</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='va'>population</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Year</span> <span class='op'>&gt;=</span> <span class='fl'>1990</span> <span class='op'>&amp;</span> <span class='va'>Year</span> <span class='op'>&lt;=</span> <span class='fl'>2019</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/drop_na.html'>drop_na</a></span><span class='op'>(</span><span class='va'>Code</span><span class='op'>)</span>  </span>
<span></span>
<span><span class='va'>data</span> <span class='op'>&lt;-</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>inner_join</a></span><span class='op'>(</span></span>
<span>    <span class='va'>data</span>, </span>
<span>    <span class='va'>population</span>, </span>
<span>    by<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'Code'</span><span class='op'>=</span><span class='st'>'Code'</span>, <span class='st'>'Year'</span><span class='op'>=</span><span class='st'>'Year'</span>, <span class='st'>'Entity'</span><span class='op'>=</span><span class='st'>'Entity'</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>Deaths <span class='op'>=</span> <span class='va'>`Deaths that are from all causes attributed to low physical activity, in both sexes aged all ages`</span>,</span>
<span>           Population <span class='op'>=</span> <span class='va'>`Population (historical estimates)`</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>breaks_map</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>500</span>, <span class='fl'>1000</span>, <span class='fl'>2500</span>, <span class='fl'>5000</span>, <span class='fl'>10000</span>, <span class='fl'>25000</span>, <span class='fl'>50000</span>, <span class='fl'>100000</span>, <span class='fl'>250000</span><span class='op'>)</span>  </span>
<span></span>
<span><span class='va'>data</span> <span class='op'>&lt;-</span></span>
<span>  <span class='va'>data</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>Deaths_disc <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/arules/man/discretize.html'>discretize</a></span><span class='op'>(</span></span>
<span>      <span class='va'>Deaths</span>, </span>
<span>      method <span class='op'>=</span> <span class='st'>'fixed'</span>, </span>
<span>      breaks <span class='op'>=</span> <span class='va'>breaks_map</span><span class='op'>)</span>,          </span>
<span>    .after <span class='op'>=</span> <span class='va'>Deaths</span><span class='op'>)</span>  </span>
<span></span>
<span><span class='va'>world</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='fu'><a href='https://docs.ropensci.org/rnaturalearth/reference/ne_countries.html'>ne_countries</a></span><span class='op'>(</span>   </span>
<span>    scale <span class='op'>=</span> <span class='st'>'small'</span>, <span class='co'># setting the value of the scale from "large" to "small"   </span></span>
<span>    returnclass <span class='op'>=</span> <span class='st'>'sf'</span></span>
<span>    <span class='op'>)</span>  </span>
<span></span>
<span><span class='va'>data</span> <span class='op'>&lt;-</span></span>
<span>  <span class='va'>world</span> <span class='op'>|&gt;</span>    </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>data</span>, </span>
<span>            by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'adm0_a3'</span> <span class='op'>=</span> <span class='st'>'Code'</span><span class='op'>)</span><span class='op'>)</span>   </span>
<span></span>
<span><span class='va'>data</span> <span class='op'>&lt;-</span>  </span>
<span>  <span class='va'>data</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>Entity</span>,          </span>
<span>         <span class='va'>continent</span>,          </span>
<span>         <span class='va'>subregion</span>,          </span>
<span>         <span class='va'>Year</span>,          </span>
<span>         <span class='va'>Deaths</span>,          </span>
<span>         <span class='va'>Deaths_disc</span>,          </span>
<span>         <span class='va'>Population</span>,          </span>
<span>         <span class='va'>geometry</span><span class='op'>)</span>  </span>
<span></span>
<span><span class='va'>data</span> <span class='op'>&lt;-</span></span>
<span>  <span class='va'>data</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>continent</span> <span class='op'>!=</span> <span class='st'>'Antarctica'</span><span class='op'>)</span> <span class='op'>|&gt;</span>    </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>subregion</span> <span class='op'>!=</span> <span class='st'>'Polynesia'</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># The plot, with these changes</span></span>
<span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://wilkelab.org/ggtext/'>ggtext</a></span><span class='op'>)</span>  </span>
<span></span>
<span><span class='va'>plot_caption</span> <span class='op'>&lt;-</span> <span class='st'>"\n**Data source**: IHME, Global Burden of Disease (2019) - Learn more about this data"</span>  </span>
<span></span>
<span><span class='va'>p</span> <span class='op'>&lt;-</span></span>
<span>  <span class='va'>data</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Year</span> <span class='op'>==</span> <span class='fl'>2019</span><span class='op'>)</span> <span class='op'>|&gt;</span>    </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>Deaths_disc</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>coord_sf</a></span><span class='op'>(</span>crs <span class='op'>=</span> <span class='st'>'+proj=robin'</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>    title <span class='op'>=</span> <span class='va'>plot_title</span>,        </span>
<span>    subtitle <span class='op'>=</span> <span class='va'>plot_subtitle</span>,        </span>
<span>    caption <span class='op'>=</span> <span class='va'>plot_caption</span>,        </span>
<span>    tag <span class='op'>=</span> <span class='va'>plot_tag</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_void</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    </span>
<span>    <span class='co'># We add more space to the title, subtitle, caption and tag, using hjust, vjust, and margin. </span></span>
<span>    <span class='co'># We also play on the size of these text elements.</span></span>
<span>    plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      family <span class='op'>=</span> <span class='st'>'merriweather'</span>,                                    </span>
<span>      color <span class='op'>=</span> <span class='st'>'#5b5b5b'</span>, <span class='co'># We add the grey color for text elements (modif 1)</span></span>
<span>      face <span class='op'>=</span> <span class='st'>'bold'</span>,</span>
<span>      size <span class='op'>=</span> <span class='fl'>23</span>,                                   </span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0.08</span>,</span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='op'>-</span><span class='fl'>10</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    </span>
<span>    plot.subtitle <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      color <span class='op'>=</span> <span class='st'>'#5b5b5b'</span>, <span class='co'># grey color added</span></span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0.1</span>,                                     </span>
<span>      size <span class='op'>=</span> <span class='fl'>18</span><span class='op'>)</span>,</span>
<span>    </span>
<span>    plot.caption <span class='op'>=</span> <span class='fu'>ggtext</span><span class='fu'>::</span><span class='fu'><a href='https://wilkelab.org/ggtext/reference/element_markdown.html'>element_markdown</a></span><span class='op'>(</span></span>
<span>      color <span class='op'>=</span> <span class='st'>'#5b5b5b'</span>, <span class='co'># grey color added</span></span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0.1</span>,</span>
<span>      size <span class='op'>=</span> <span class='fl'>18</span>,</span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span>,       </span>
<span>    </span>
<span>    plot.tag.position <span class='op'>=</span> <span class='st'>'bottom'</span>,     </span>
<span>    </span>
<span>    plot.tag <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      color <span class='op'>=</span> <span class='st'>'#5b5b5b'</span>, <span class='co'># grey color added</span></span>
<span>      size <span class='op'>=</span> <span class='fl'>16</span>,                                  </span>
<span>      vjust <span class='op'>=</span> <span class='op'>-</span><span class='fl'>1</span>,</span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>l <span class='op'>=</span> <span class='op'>-</span><span class='fl'>280</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span>,          </span>
<span>    legend.position <span class='op'>=</span> <span class='st'>'bottom'</span>,</span>
<span>    legend.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,         </span>
<span>    legend.text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      size <span class='op'>=</span> <span class='fl'>20</span>,         </span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='op'>-</span><span class='fl'>22</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  </span>
<span>  <span class='co'># No change in the scale</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_brewer.html'>scale_fill_brewer</a></span><span class='op'>(</span></span>
<span>    palette <span class='op'>=</span> <span class='st'>'YlOrRd'</span>,</span>
<span>    guide <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/guide_coloursteps.html'>guide_coloursteps</a></span><span class='op'>(</span>                        </span>
<span>      show.limits <span class='op'>=</span> <span class='cn'>TRUE</span>,</span>
<span>      ticks <span class='op'>=</span> <span class='cn'>TRUE</span>,            </span>
<span>      barwidth <span class='op'>=</span> <span class='fl'>25</span>,           </span>
<span>      barheight <span class='op'>=</span> <span class='fl'>0.5</span>,        </span>
<span>      frame.colour <span class='op'>=</span> <span class='st'>'black'</span>, </span>
<span>      frame.linewidth <span class='op'>=</span> <span class='fl'>0.01</span>,    </span>
<span>      ticks.colour <span class='op'>=</span> <span class='st'>'black'</span>, </span>
<span>      ticks.linewidth <span class='op'>=</span> <span class='fl'>0.01</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span> </span>
<span></span>
<span><span class='va'>p</span> </span></code></pre>
</div>
<p><img src="100517341_files/figure-html5/unnamed-chunk-14-1.png" width="624" data-distill-preview=1 /></p>
</div>
<h3 id="interactive-version-of-the-plot">Interactive version of the plot</h3>
<p>Exactly as in the <strong>gapminder</strong> project, one of the point of the graph is to get it display an evolution over time. So far, we’ve been plotting the data only for year 2019, but it would be nice to create a more interactive plot, just as the original Our World In Data graph, that enables the user to filter the data by year and continent. Unfortunately for me, the integration of <code>geom_sf()</code> into the <code>plotly</code> library is not optimal, rendering a plot that is dynamic, but looks awful, with quite all of the modifications to the <code>theme()</code> not taken into account.</p>
<p>A solution that I found was to use the <code>{ggiraph}</code> package to make the plot interactive. The filtering function seems requiring some features to create interfaces that ggplot cannot provide, such as integrating the plot in a Shiny application. Therefore, we will give up this last feature.</p>
<p>The ggiraph package is very easy to use and works the following way :</p>
<ul>
<li><p>We make the geoms interactive by appending the “_interactive” to them.</p></li>
<li><p>We provide two aesthetics: <code>tooltip</code>, and <code>data_id</code>.<br />
<code>tooltip</code> enables to specify which variable needs to be displayed in the tooltip generated by the package.<br />
On the other hand, <code>data_id</code> enables to indicate the variables that will be linked to visual effects, that we can define with CSS code paired with the argument <code>options</code> of the <code>girafe()</code> function.</p></li>
<li><p>We create a new and interactive graph by passing our plot to the <code>girafe()</code> function.</p></li>
</ul>
<h4 id="ggiraph-version-of-the-map-plot"><code>{ggiraph}</code> version of the map plot</h4>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://davidgohel.github.io/ggiraph/'>ggiraph</a></span><span class='op'>)</span>  </span>
<span></span>
<span><span class='va'>p_girafe</span> <span class='op'>&lt;-</span>    </span>
<span>  <span class='va'>data</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Year</span> <span class='op'>==</span> <span class='fl'>2019</span><span class='op'>)</span> <span class='op'>|&gt;</span>    </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://davidgohel.github.io/ggiraph/reference/geom_sf_interactive.html'>geom_sf_interactive</a></span><span class='op'>(</span> <span class='co'># Switching geom_sf to its ggiraph version       </span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>      fill <span class='op'>=</span> <span class='va'>Deaths_disc</span>,        </span>
<span>      tooltip <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sprintf.html'>sprintf</a></span><span class='op'>(</span><span class='st'>"%s: %.3f"</span>, <span class='va'>Entity</span>, <span class='va'>Deaths</span><span class='op'>)</span>  <span class='co'># Enables to get a tooltip when hovering over the countries with name and percentage of death       </span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>coord_sf</a></span><span class='op'>(</span>crs <span class='op'>=</span> <span class='st'>"+proj=robin"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>    title <span class='op'>=</span> <span class='va'>plot_title</span>,        </span>
<span>    subtitle <span class='op'>=</span> <span class='va'>plot_subtitle</span>,        </span>
<span>    caption <span class='op'>=</span> <span class='va'>plot_caption</span>,        </span>
<span>    tag <span class='op'>=</span> <span class='va'>plot_tag</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_void</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      family <span class='op'>=</span> <span class='st'>"merriweather"</span>,                                    </span>
<span>      color <span class='op'>=</span> <span class='st'>"#5b5b5b"</span>,</span>
<span>      face <span class='op'>=</span> <span class='st'>"bold"</span>,</span>
<span>      size <span class='op'>=</span> <span class='fl'>15</span>,                                  </span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0.1</span>,                                   </span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='op'>-</span><span class='fl'>10</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    plot.subtitle <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      color <span class='op'>=</span> <span class='st'>"#5b5b5b"</span>,</span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0.11</span>,                                      </span>
<span>      size <span class='op'>=</span> <span class='fl'>11</span></span>
<span>      <span class='op'>)</span>,         </span>
<span>    plot.caption <span class='op'>=</span> <span class='fu'>ggtext</span><span class='fu'>::</span><span class='fu'><a href='https://wilkelab.org/ggtext/reference/element_markdown.html'>element_markdown</a></span><span class='op'>(</span></span>
<span>      color <span class='op'>=</span> <span class='st'>"#5b5b5b"</span>,</span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0.11</span>,</span>
<span>      size <span class='op'>=</span> <span class='fl'>11</span>,                                                 </span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span>,          </span>
<span>    plot.tag.position <span class='op'>=</span> <span class='st'>"bottom"</span>,</span>
<span>    plot.tag <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      color <span class='op'>=</span> <span class='st'>"#5b5b5b"</span>,</span>
<span>      size <span class='op'>=</span> <span class='fl'>10</span>,                                  </span>
<span>      vjust <span class='op'>=</span> <span class='op'>-</span><span class='fl'>1</span>,                                 </span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>l <span class='op'>=</span> <span class='op'>-</span><span class='fl'>301</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    legend.position <span class='op'>=</span> <span class='st'>"bottom"</span>,</span>
<span>    legend.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,         </span>
<span>    legend.text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>           </span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='op'>-</span><span class='fl'>22</span><span class='op'>)</span>          </span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_brewer.html'>scale_fill_brewer</a></span><span class='op'>(</span></span>
<span>    palette <span class='op'>=</span> <span class='st'>"YlOrRd"</span>,</span>
<span>    guide <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/guide_coloursteps.html'>guide_coloursteps</a></span><span class='op'>(</span>                        </span>
<span>      show.limits <span class='op'>=</span> <span class='cn'>TRUE</span>,                        </span>
<span>      ticks <span class='op'>=</span> <span class='cn'>TRUE</span>,                       </span>
<span>      barwidth <span class='op'>=</span> <span class='fl'>25</span>,                       </span>
<span>      barheight <span class='op'>=</span> <span class='fl'>0.5</span>,                       </span>
<span>      frame.colour <span class='op'>=</span> <span class='st'>"black"</span>,</span>
<span>      frame.linewidth <span class='op'>=</span> <span class='fl'>0.01</span>,                       </span>
<span>      ticks.colour <span class='op'>=</span> <span class='st'>"black"</span>,</span>
<span>      ticks.linewidth <span class='op'>=</span> <span class='fl'>0.01</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span>  </span>
<span></span>
<span><span class='fu'><a href='https://davidgohel.github.io/ggiraph/reference/girafe.html'>girafe</a></span><span class='op'>(</span>ggobj <span class='op'>=</span> <span class='va'>p_girafe</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>Yay it works ! A few things need to be modifed. “A few”.</p>
<h4 id="adjustments-1">Adjustments</h4>
<p>First, the position of the plot in the panel is not good. After a few iterations, I noticed that this was just a matter of playing on the margins already existing in our ggplot. Similarly, other <code>theme()</code> elements need to be adjusted.</p>
<p>However, one drawback of the <code>{ggiraph}</code> package is that, without really knowing why:</p>
<ul>
<li><p>It sizes the theme elements in a differently than the original plot, which requires a lot of micro-adjustment.</p></li>
<li><p>It seems that its integration to the different types of rendering such as Quarto Presentations or html also requires a lot of these micro-adjustments.</p></li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Micro adjustments of size, margin arguments, nothing mindblowing here</span></span>
<span><span class='va'>p_girafe</span> <span class='op'>&lt;-</span></span>
<span>  <span class='va'>data</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Year</span> <span class='op'>==</span> <span class='fl'>2019</span><span class='op'>)</span> <span class='op'>|&gt;</span>    </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://davidgohel.github.io/ggiraph/reference/geom_sf_interactive.html'>geom_sf_interactive</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>        </span>
<span>      fill <span class='op'>=</span> <span class='va'>Deaths_disc</span>,        </span>
<span>      tooltip <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sprintf.html'>sprintf</a></span><span class='op'>(</span><span class='st'>"%s: %.0f"</span>, <span class='va'>Entity</span>, <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>Deaths</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># btw, this was copied from the ggiraph documentation       </span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span>    </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>coord_sf</a></span><span class='op'>(</span>crs <span class='op'>=</span> <span class='st'>"+proj=robin"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>    title <span class='op'>=</span> <span class='va'>plot_title</span>,        </span>
<span>    subtitle <span class='op'>=</span> <span class='va'>plot_subtitle</span>,        </span>
<span>    caption <span class='op'>=</span> <span class='va'>plot_caption</span>,</span>
<span>    tag <span class='op'>=</span> <span class='va'>plot_tag</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_void</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      family <span class='op'>=</span> <span class='st'>"merriweather"</span>,</span>
<span>      color <span class='op'>=</span> <span class='st'>"#5b5b5b"</span>,</span>
<span>      face <span class='op'>=</span> <span class='st'>"bold"</span>,                                   </span>
<span>      size <span class='op'>=</span> <span class='fl'>12</span>,                                   </span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0.1</span>,                                   </span>
<span>      <span class='op'>)</span>,          </span>
<span>    plot.subtitle <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      color <span class='op'>=</span> <span class='st'>"#5b5b5b"</span>,</span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0.1</span>,                                      </span>
<span>      size <span class='op'>=</span> <span class='fl'>8</span><span class='op'>)</span>,</span>
<span>    plot.caption <span class='op'>=</span> <span class='fu'>ggtext</span><span class='fu'>::</span><span class='fu'><a href='https://wilkelab.org/ggtext/reference/element_markdown.html'>element_markdown</a></span><span class='op'>(</span></span>
<span>      color <span class='op'>=</span> <span class='st'>"#5b5b5b"</span>,</span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0.11</span>,                                                 </span>
<span>      size <span class='op'>=</span> <span class='fl'>8</span>,</span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    plot.tag.position <span class='op'>=</span> <span class='st'>"bottom"</span>,</span>
<span>    plot.tag <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      color <span class='op'>=</span> <span class='st'>"#5b5b5b"</span>,                                 </span>
<span>      size <span class='op'>=</span> <span class='fl'>7</span>,</span>
<span>      vjust <span class='op'>=</span> <span class='op'>-</span><span class='fl'>1</span>,</span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>l <span class='op'>=</span> <span class='op'>-</span><span class='fl'>261</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span>,          </span>
<span>    legend.position <span class='op'>=</span> <span class='st'>"bottom"</span>,</span>
<span>    legend.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,         </span>
<span>    legend.text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>           </span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0.8</span>,           </span>
<span>      size <span class='op'>=</span> <span class='fl'>8</span>,           </span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='op'>-</span><span class='fl'>22</span><span class='op'>)</span>         </span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_brewer.html'>scale_fill_brewer</a></span><span class='op'>(</span></span>
<span>    palette <span class='op'>=</span> <span class='st'>"YlOrRd"</span>,</span>
<span>    guide <span class='op'>=</span> <span class='fu'><a href='https://davidgohel.github.io/ggiraph/reference/guide_coloursteps_interactive.html'>guide_coloursteps_interactive</a></span><span class='op'>(</span></span>
<span>      show.limits <span class='op'>=</span> <span class='cn'>TRUE</span>,                        </span>
<span>      ticks <span class='op'>=</span> <span class='cn'>TRUE</span>,                       </span>
<span>      barwidth <span class='op'>=</span> <span class='fl'>25</span>,            </span>
<span>      barheight <span class='op'>=</span> <span class='fl'>0.5</span>,          </span>
<span>      frame.colour <span class='op'>=</span> <span class='st'>"black"</span>,    </span>
<span>      frame.linewidth <span class='op'>=</span> <span class='fl'>0.1</span>,      </span>
<span>      ticks.colour <span class='op'>=</span> <span class='st'>"black"</span>,</span>
<span>      ticks.linewidth <span class='op'>=</span> <span class='fl'>0.1</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span>  </span>
<span></span>
<span><span class='fu'><a href='https://davidgohel.github.io/ggiraph/reference/girafe.html'>girafe</a></span><span class='op'>(</span>ggobj <span class='op'>=</span> <span class='va'>p_girafe</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>Here are some improvements that we can still do:</p>
<ul>
<li><p>Give the tooltip a better appearance and make them display the absolute number of deaths due to low physical activity.<br />
This interactivity with the plot will be created by adding an <code>options</code> in the <code>girafe()</code> function.</p></li>
<li><p>This require to create a CSS declarations for the style we want for the elements that are hovered, and pass these declarations to the <code>css</code> argument of the <code>hover_opt()</code> functions and functions related. These functions enable us to tailor the effects of hovering parts of the graph with our mouse. For sake of efficiency and because of my lack of knowledge in CSS, the declarations are generated by AI and adjusted if needed.</p></li>
</ul>
<p>Note: After knitting, I end up with a location of the graph in the panel that is really not good. The aspect of the plot in R Studio is not how it will be rendered. I think I may have used an argument in a way that it is not purposed to, but I couldn’t figure it out.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># A " ' " symbol for the country "Cote d'Ivoire" was producing errors in ggiraph (God Bless French subtleties)  </span></span>
<span></span>
<span><span class='va'>data</span> <span class='op'>&lt;-</span></span>
<span>  <span class='va'>data</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>Entity <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>Entity</span> <span class='op'>==</span> <span class='st'>"Cote d'Ivoire"</span>, <span class='st'>"Cote d Ivoire"</span>, <span class='va'>Entity</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Defining the style of the tooltip  </span></span>
<span><span class='va'>tooltip_css</span> <span class='op'>&lt;-</span> <span class='st'>"background-color: rgba(245, 245, 245, 1); </span></span>
<span><span class='st'>                color: #000000; </span></span>
<span><span class='st'>                font-family: 'Arial', sans-serif;</span></span>
<span><span class='st'>                font-size: 11px; </span></span>
<span><span class='st'>                border-radius: 4px;</span></span>
<span><span class='st'>                border: 1px solid #d9d9d9; </span></span>
<span><span class='st'>                padding: 8px;"</span>  </span>
<span></span>
<span><span class='va'>p_map_girafe</span> <span class='op'>&lt;-</span></span>
<span>  <span class='va'>data</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Year</span> <span class='op'>==</span> <span class='fl'>2019</span><span class='op'>)</span> <span class='op'>|&gt;</span>    </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://davidgohel.github.io/ggiraph/reference/geom_sf_interactive.html'>geom_sf_interactive</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>        </span>
<span>      fill <span class='op'>=</span> <span class='va'>Deaths_disc</span>,        </span>
<span>      tooltip <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"&lt;b&gt;"</span>, <span class='va'>Entity</span>,<span class='st'>"&lt;/b&gt;"</span>, <span class='st'>"\nNumber of Deaths: "</span>, <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>Deaths</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>      data_id <span class='op'>=</span> <span class='va'>Entity</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>coord_sf</a></span><span class='op'>(</span>crs <span class='op'>=</span> <span class='st'>"+proj=robin"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>    title <span class='op'>=</span> <span class='va'>plot_title</span>,        </span>
<span>    subtitle <span class='op'>=</span> <span class='va'>plot_subtitle</span>,        </span>
<span>    caption <span class='op'>=</span> <span class='va'>plot_caption</span>,       </span>
<span>    tag <span class='op'>=</span> <span class='va'>plot_tag</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_void</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      family <span class='op'>=</span> <span class='st'>"merriweather"</span>,</span>
<span>      color <span class='op'>=</span> <span class='st'>"#5b5b5b"</span>,</span>
<span>      face <span class='op'>=</span> <span class='st'>"bold"</span>,</span>
<span>      size <span class='op'>=</span> <span class='fl'>12</span>,                                   </span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0.1</span>,  </span>
<span>      <span class='op'>)</span>, </span>
<span>    plot.subtitle <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      color <span class='op'>=</span> <span class='st'>"#5b5b5b"</span>,</span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0.1</span>,                                      </span>
<span>      size <span class='op'>=</span> <span class='fl'>8</span></span>
<span>      <span class='op'>)</span>,         </span>
<span>    plot.caption <span class='op'>=</span> <span class='fu'>ggtext</span><span class='fu'>::</span><span class='fu'><a href='https://wilkelab.org/ggtext/reference/element_markdown.html'>element_markdown</a></span><span class='op'>(</span></span>
<span>      color <span class='op'>=</span> <span class='st'>"#5b5b5b"</span>,</span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0.1</span>,                                                 </span>
<span>      size <span class='op'>=</span> <span class='fl'>8</span>,                                                 </span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    plot.tag.position <span class='op'>=</span> <span class='st'>"bottom"</span>,</span>
<span>    plot.tag <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      color <span class='op'>=</span> <span class='st'>"#5b5b5b"</span>,</span>
<span>      size <span class='op'>=</span> <span class='fl'>7</span>,</span>
<span>      vjust <span class='op'>=</span> <span class='op'>-</span><span class='fl'>1</span>,</span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>l <span class='op'>=</span> <span class='op'>-</span><span class='fl'>292</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span>,          </span>
<span>    legend.position <span class='op'>=</span> <span class='st'>"bottom"</span>,</span>
<span>    legend.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,         </span>
<span>    legend.text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>         </span>
<span>      size <span class='op'>=</span> <span class='fl'>8</span>,</span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='op'>-</span><span class='fl'>22</span><span class='op'>)</span>          </span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_brewer.html'>scale_fill_brewer</a></span><span class='op'>(</span>     </span>
<span>    palette <span class='op'>=</span> <span class='st'>"YlOrRd"</span>,     </span>
<span>    guide <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/guide_coloursteps.html'>guide_coloursteps</a></span><span class='op'>(</span>       </span>
<span>      show.limits <span class='op'>=</span> <span class='cn'>TRUE</span>,        </span>
<span>      ticks <span class='op'>=</span> <span class='cn'>TRUE</span>,       </span>
<span>      barwidth <span class='op'>=</span> <span class='fl'>25</span>,</span>
<span>      barheight <span class='op'>=</span> <span class='fl'>0.4</span>,       </span>
<span>      frame.colour <span class='op'>=</span> <span class='st'>"black"</span>,</span>
<span>      frame.linewidth <span class='op'>=</span> <span class='fl'>0.1</span>,       </span>
<span>      ticks.colour <span class='op'>=</span> <span class='st'>"black"</span>,    </span>
<span>      ticks.linewidth <span class='op'>=</span> <span class='fl'>0.1</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span>  </span>
<span></span>
<span><span class='co'># * Lowering the opacity of all the non-hovered elements </span></span>
<span><span class='co'>## * Defining borders around the hovered elements</span></span>
<span></span>
<span><span class='fu'><a href='https://davidgohel.github.io/ggiraph/reference/girafe.html'>girafe</a></span><span class='op'>(</span>ggobj <span class='op'>=</span> <span class='va'>p_map_girafe</span>,        </span>
<span>       options <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>          </span>
<span>         <span class='fu'><a href='https://davidgohel.github.io/ggiraph/reference/opts_hover.html'>opts_hover_inv</a></span><span class='op'>(</span>css <span class='op'>=</span> <span class='st'>"opacity:0.7;"</span><span class='op'>)</span>, <span class='co'># *          </span></span>
<span>         <span class='fu'><a href='https://davidgohel.github.io/ggiraph/reference/opts_hover.html'>opts_hover</a></span><span class='op'>(</span>css <span class='op'>=</span> <span class='st'>"stroke-width:1.2;stroke:black;"</span><span class='op'>)</span>, <span class='co'># **          </span></span>
<span>         <span class='fu'><a href='https://davidgohel.github.io/ggiraph/reference/opts_tooltip.html'>opts_tooltip</a></span><span class='op'>(</span>css <span class='op'>=</span> <span class='va'>tooltip_css</span><span class='op'>)</span></span>
<span>         <span class='op'>)</span></span>
<span>       <span class='op'>)</span>  </span></code></pre>
</div>
</div>
<p>At this stage, I think my map is complete.</p>
<h2 id="the-line-graph">The line graph</h2>
<p>A second graph is joined to the map, in a new tab, that contributes to make this Our World In Data plot so complete. It shows the evolution of the number of deaths due to low physical activity year after year between 1990 and 2019. Since we already have the dataset, we can create a line plot. It has to be noted we are not plotting the entire dataset, as you could access it on the original graph.</p>
<p>If fact, one of the cool features that it has is that it provides a filter that enables you to select which countries you want to see on the graph. This greatly facilitates the comparison of evolutions between countries. However, I couldn’t find ways to provide this feature other than placing the graph into a Shiny Application. Since I really don’t know anything about Shiny, I’ll focus on a graph of the 10 countries with most Deaths by year.</p>
<h3 id="coordinate-and-axes">Coordinate and axes</h3>
<p>Unlike the map, this type of graph has axis. These axes have:</p>
<ul>
<li><p>No label</p></li>
<li><p>Incrementation of 5 years (for x axis) and 5000 deaths (for y axis)</p></li>
<li><p>Starting points at the origin of the coordinate system</p></li>
</ul>
<p>The plot also has horizontal lines for each 5000 deaths. We had to add also a <code>geom_vline()</code> because without it, the x-axis was disappearing.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>p_line</span> <span class='op'>&lt;-</span>    </span>
<span>  <span class='va'>data</span> <span class='op'>|&gt;</span>    </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span></span>
<span>         <span class='op'>(</span>x <span class='op'>=</span> <span class='va'>Year</span>, </span>
<span>           y <span class='op'>=</span> <span class='va'>Deaths</span><span class='op'>)</span></span>
<span>         <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span>xintercept <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_hline</a></span><span class='op'>(</span></span>
<span>    yintercept <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span>from <span class='op'>=</span> <span class='fl'>20000</span>, to <span class='op'>=</span> <span class='fl'>140000</span>, by <span class='op'>=</span> <span class='fl'>20000</span><span class='op'>)</span>,              </span>
<span>    linetype <span class='op'>=</span> <span class='st'>'dashed'</span>, </span>
<span>    color <span class='op'>=</span> <span class='st'>'#dddddd'</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_cartesian.html'>coord_cartesian</a></span><span class='op'>(</span></span>
<span>    xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1990</span>, <span class='fl'>2019</span><span class='op'>)</span>, </span>
<span>    ylim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>140000</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span></span>
<span>    breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1990</span>, <span class='fl'>1995</span>, <span class='fl'>2000</span>, <span class='fl'>2005</span>, <span class='fl'>2010</span>, <span class='fl'>2015</span>, <span class='fl'>2019</span><span class='op'>)</span>, </span>
<span>    expand <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expansion.html'>expansion</a></span><span class='op'>(</span>mult <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0.1</span><span class='op'>)</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span></span>
<span>    breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span>from <span class='op'>=</span> <span class='fl'>0</span>, to <span class='op'>=</span> <span class='fl'>140000</span>, by <span class='op'>=</span> <span class='fl'>20000</span><span class='op'>)</span>,</span>
<span>    expand <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expansion.html'>expansion</a></span><span class='op'>(</span>mult <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0.1</span><span class='op'>)</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span>  </span>
<span></span>
<span><span class='va'>p_line</span></span></code></pre>
</div>
<p><img src="100517341_files/figure-html5/unnamed-chunk-17-1.png" width="624" /></p>
</div>
<h3 id="theme-and-labs">Theme and labs</h3>
<p>Let’s now add some elements of <code>theme</code> to the plot, according to the original graph:</p>
<ul>
<li><p>The y axis is removed, as well as the ticks,</p></li>
<li><p>We have no titles for both x and y axes,</p></li>
<li><p>The values displayed along the axes are colored in the same grey as the title, subtitle, caption, and tag of the map,</p></li>
<li><p>The background is removed, which can be easily done with a <code>theme_classic()</code></p></li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>p_line</span> <span class='op'>&lt;-</span></span>
<span>  <span class='va'>data</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>    x <span class='op'>=</span> <span class='va'>Year</span>, </span>
<span>    y <span class='op'>=</span> <span class='va'>Deaths</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span>    </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span>xintercept <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_hline</a></span><span class='op'>(</span>yintercept <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span>from <span class='op'>=</span> <span class='fl'>20000</span>, to <span class='op'>=</span> <span class='fl'>140000</span>, by <span class='op'>=</span> <span class='fl'>20000</span><span class='op'>)</span>,        </span>
<span>             linetype <span class='op'>=</span> <span class='st'>'dashed'</span>,</span>
<span>             color <span class='op'>=</span> <span class='st'>'#dddddd'</span></span>
<span>             <span class='op'>)</span> <span class='op'>+</span>    </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_cartesian.html'>coord_cartesian</a></span><span class='op'>(</span></span>
<span>    xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1990</span>, <span class='fl'>2019</span><span class='op'>)</span>,</span>
<span>    ylim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>140000</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span></span>
<span>    breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1990</span>, <span class='fl'>1995</span>, <span class='fl'>2000</span>, <span class='fl'>2005</span>, <span class='fl'>2010</span>, <span class='fl'>2015</span>, <span class='fl'>2019</span><span class='op'>)</span>,</span>
<span>    expand <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expansion.html'>expansion</a></span><span class='op'>(</span>mult <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0.1</span><span class='op'>)</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span></span>
<span>    breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span>from <span class='op'>=</span> <span class='fl'>0</span>, to <span class='op'>=</span> <span class='fl'>140000</span>, by <span class='op'>=</span> <span class='fl'>20000</span><span class='op'>)</span>,</span>
<span>    expand <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expansion.html'>expansion</a></span><span class='op'>(</span>mult <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0.1</span><span class='op'>)</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_classic</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    axis.line.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,         </span>
<span>    axis.ticks.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    axis.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    axis.text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>           </span>
<span>      size <span class='op'>=</span> <span class='fl'>13</span>,</span>
<span>      color <span class='op'>=</span> <span class='st'>"#5b5b5b"</span>         </span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span>  </span>
<span></span>
<span><span class='va'>p_line</span></span></code></pre>
</div>
<p><img src="100517341_files/figure-html5/unnamed-chunk-18-1.png" width="624" /></p>
</div>
<p>Now, we can add the labs, which are almost the same as on our map.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>p_line</span> <span class='op'>&lt;-</span></span>
<span>  <span class='va'>data</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>    x <span class='op'>=</span> <span class='va'>Year</span>, </span>
<span>    y <span class='op'>=</span> <span class='va'>Deaths</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span>xintercept <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_hline</a></span><span class='op'>(</span></span>
<span>    yintercept <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span>from <span class='op'>=</span> <span class='fl'>20000</span>, to <span class='op'>=</span> <span class='fl'>140000</span>, by <span class='op'>=</span> <span class='fl'>20000</span><span class='op'>)</span>,              </span>
<span>    linetype <span class='op'>=</span> <span class='st'>'dashed'</span>,</span>
<span>    color <span class='op'>=</span> <span class='st'>'#dddddd'</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_cartesian.html'>coord_cartesian</a></span><span class='op'>(</span></span>
<span>    xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1990</span>, <span class='fl'>2019</span><span class='op'>)</span>,</span>
<span>    ylim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>140000</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span></span>
<span>    breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1990</span>, <span class='fl'>1995</span>, <span class='fl'>2000</span>, <span class='fl'>2005</span>, <span class='fl'>2010</span>, <span class='fl'>2015</span>, <span class='fl'>2019</span><span class='op'>)</span>,</span>
<span>    expand <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expansion.html'>expansion</a></span><span class='op'>(</span>mult <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0.1</span><span class='op'>)</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span>breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span>from <span class='op'>=</span> <span class='fl'>0</span>, to <span class='op'>=</span> <span class='fl'>140000</span>, by <span class='op'>=</span> <span class='fl'>20000</span><span class='op'>)</span>,</span>
<span>                     expand <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expansion.html'>expansion</a></span><span class='op'>(</span>mult <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0.1</span><span class='op'>)</span><span class='op'>)</span></span>
<span>                     <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='co'># Copy and paste the labs from our map   </span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>    title <span class='op'>=</span> <span class='va'>plot_title</span>,        </span>
<span>    subtitle <span class='op'>=</span> <span class='va'>plot_subtitle</span>,        </span>
<span>    caption <span class='op'>=</span> <span class='va'>plot_caption</span>,        </span>
<span>    tag <span class='op'>=</span> <span class='va'>plot_tag</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_classic</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    axis.line.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,         </span>
<span>    axis.ticks.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    axis.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    axis.text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>           </span>
<span>      size <span class='op'>=</span> <span class='fl'>13</span>,</span>
<span>      color <span class='op'>=</span> <span class='st'>"#5b5b5b"</span><span class='op'>)</span>,</span>
<span>    <span class='co'># Copy paste the theme elements associated to the labs from the map</span></span>
<span>    plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      family <span class='op'>=</span> <span class='st'>'merriweather'</span>,                                    </span>
<span>      color <span class='op'>=</span> <span class='st'>'#5b5b5b'</span>,</span>
<span>      face <span class='op'>=</span> <span class='st'>'bold'</span>,</span>
<span>      size <span class='op'>=</span> <span class='fl'>15</span>,                                   </span>
<span>      hjust <span class='op'>=</span> <span class='op'>-</span><span class='fl'>0.18</span>, <span class='co'># Adjusted                                 </span></span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span> <span class='co'># Adjusted</span></span>
<span>      <span class='op'>)</span>,         </span>
<span>    plot.subtitle <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      color <span class='op'>=</span> <span class='st'>'#5b5b5b'</span>,</span>
<span>      hjust <span class='op'>=</span> <span class='op'>-</span><span class='fl'>0.205</span>, <span class='co'># Adjusted                                       </span></span>
<span>      size <span class='op'>=</span> <span class='fl'>11</span>,</span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span> <span class='co'># Added</span></span>
<span>      <span class='op'>)</span>, </span>
<span>    plot.caption <span class='op'>=</span> <span class='fu'>ggtext</span><span class='fu'>::</span><span class='fu'><a href='https://wilkelab.org/ggtext/reference/element_markdown.html'>element_markdown</a></span><span class='op'>(</span></span>
<span>      color <span class='op'>=</span> <span class='st'>'#5b5b5b'</span>,</span>
<span>      hjust <span class='op'>=</span> <span class='op'>-</span><span class='fl'>0.280</span>, <span class='co'># Adjusted</span></span>
<span>      size <span class='op'>=</span> <span class='fl'>11</span>,</span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span>,          </span>
<span>    plot.tag.position <span class='op'>=</span> <span class='st'>'bottom'</span>,</span>
<span>    plot.tag <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      color <span class='op'>=</span> <span class='st'>'#5b5b5b'</span>,</span>
<span>      size <span class='op'>=</span> <span class='fl'>10</span>,</span>
<span>      vjust <span class='op'>=</span> <span class='op'>-</span><span class='fl'>1</span>,                                 </span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>b <span class='op'>=</span> <span class='fl'>10</span>, <span class='co'># Added</span></span>
<span>                      l <span class='op'>=</span> <span class='op'>-</span><span class='fl'>320</span><span class='op'>)</span> <span class='co'># Adjusted</span></span>
<span>      <span class='op'>)</span>          </span>
<span>    <span class='op'>)</span>   </span>
<span></span>
<span><span class='va'>p_line</span></span></code></pre>
</div>
<p><img src="100517341_files/figure-html5/unnamed-chunk-19-1.png" width="624" /></p>
</div>
<h3 id="adding-the-data-1">Adding the data</h3>
<p>The aesthetic we want to get is <code>color</code>, with each color representing a country, so we map <code>Entity</code> to color. However, since there are more than 150 countries in our <code>data</code> dataset, the best option that we have for the moment is to filter our data with certain countries. For instance, we can get the 10 countries with most deaths in 2019.</p>
<p>Also, the original plot has a second geom, that is <code>geom_point()</code> so let’s add it.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Defining a vector of the 10 countries with most Deaths in 2019</span></span>
<span><span class='va'>top10_countries_2019</span> <span class='op'>&lt;-</span></span>
<span>  <span class='va'>data</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Year</span> <span class='op'>==</span> <span class='fl'>2019</span><span class='op'>)</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice_max</a></span><span class='op'>(</span>order_by <span class='op'>=</span> <span class='va'>Deaths</span>, n <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>Entity</span><span class='op'>)</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_geometry.html'>st_drop_geometry</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://purrr.tidyverse.org/reference/as_vector.html'>as_vector</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>p_line</span> <span class='op'>&lt;-</span></span>
<span>  <span class='va'>data</span> <span class='op'>|&gt;</span>  </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Entity</span> <span class='op'><a href='https://rdrr.io/pkg/arules/man/match.html'>%in%</a></span> <span class='va'>top10_countries_2019</span><span class='op'>)</span> <span class='op'>|&gt;</span> <span class='co'># Now, our data is filtered</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>    x <span class='op'>=</span> <span class='va'>Year</span>, </span>
<span>    y <span class='op'>=</span> <span class='va'>Deaths</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span>  </span>
<span>  <span class='co'># Adding the points layer to the plot</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='va'>Entity</span><span class='op'>)</span>,</span>
<span>    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span>,</span>
<span>    size <span class='op'>=</span> <span class='fl'>0.7</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='va'>Entity</span><span class='op'>)</span>,</span>
<span>    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span>xintercept <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_hline</a></span><span class='op'>(</span></span>
<span>    yintercept <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span>from <span class='op'>=</span> <span class='fl'>20000</span>, to <span class='op'>=</span> <span class='fl'>140000</span>, by <span class='op'>=</span> <span class='fl'>20000</span><span class='op'>)</span>,</span>
<span>    linetype <span class='op'>=</span> <span class='st'>'dashed'</span>,    </span>
<span>    color <span class='op'>=</span> <span class='st'>'#dddddd'</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_cartesian.html'>coord_cartesian</a></span><span class='op'>(</span></span>
<span>    xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1990</span>, <span class='fl'>2019</span><span class='op'>)</span>,</span>
<span>    ylim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>140000</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span></span>
<span>    breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1990</span>, <span class='fl'>1995</span>, <span class='fl'>2000</span>, <span class='fl'>2005</span>, <span class='fl'>2010</span>, <span class='fl'>2015</span>, <span class='fl'>2019</span><span class='op'>)</span>,</span>
<span>    expand <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expansion.html'>expansion</a></span><span class='op'>(</span>mult <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0.1</span><span class='op'>)</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span></span>
<span>    breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span>from <span class='op'>=</span> <span class='fl'>0</span>, to <span class='op'>=</span> <span class='fl'>140000</span>, by <span class='op'>=</span> <span class='fl'>20000</span><span class='op'>)</span>,</span>
<span>    expand <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expansion.html'>expansion</a></span><span class='op'>(</span>mult <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0.1</span><span class='op'>)</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>    title <span class='op'>=</span> <span class='va'>plot_title</span>,        </span>
<span>    subtitle <span class='op'>=</span> <span class='va'>plot_subtitle</span>,        </span>
<span>    caption <span class='op'>=</span> <span class='va'>plot_caption</span>,        </span>
<span>    tag <span class='op'>=</span> <span class='va'>plot_tag</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_classic</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    axis.line.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,         </span>
<span>    axis.ticks.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,         </span>
<span>    axis.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    axis.text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>           </span>
<span>      size <span class='op'>=</span> <span class='fl'>13</span>,</span>
<span>      color <span class='op'>=</span> <span class='st'>"#5b5b5b"</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      family <span class='op'>=</span> <span class='st'>'merriweather'</span>,</span>
<span>      color <span class='op'>=</span> <span class='st'>'#5b5b5b'</span>,</span>
<span>      face <span class='op'>=</span> <span class='st'>'bold'</span>,</span>
<span>      size <span class='op'>=</span> <span class='fl'>25</span>,</span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0</span>,                                    </span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span>,          </span>
<span>    plot.subtitle <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      color <span class='op'>=</span> <span class='st'>'#5b5b5b'</span>,</span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0</span>,                                       </span>
<span>      size <span class='op'>=</span> <span class='fl'>16</span>,</span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span>,         </span>
<span>    plot.caption <span class='op'>=</span> <span class='fu'>ggtext</span><span class='fu'>::</span><span class='fu'><a href='https://wilkelab.org/ggtext/reference/element_markdown.html'>element_markdown</a></span><span class='op'>(</span></span>
<span>      color <span class='op'>=</span> <span class='st'>'#5b5b5b'</span>,</span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0</span>,                                                  </span>
<span>      size <span class='op'>=</span> <span class='fl'>16</span>,                                                 </span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span>,          </span>
<span>    plot.tag.position <span class='op'>=</span> <span class='st'>'bottom'</span>,</span>
<span>    plot.tag <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      color <span class='op'>=</span> <span class='st'>'#5b5b5b'</span>,</span>
<span>      size <span class='op'>=</span> <span class='fl'>15</span>,                                  </span>
<span>      vjust <span class='op'>=</span> <span class='op'>-</span><span class='fl'>1</span>,</span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>b <span class='op'>=</span> <span class='fl'>10</span>,</span>
<span>                      l <span class='op'>=</span> <span class='op'>-</span><span class='fl'>270</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span></span>
<span>    <span class='op'>)</span>   </span>
<span></span>
<span><span class='va'>p_line</span></span></code></pre>
</div>
<p><img src="100517341_files/figure-html5/unnamed-chunk-20-1.png" width="624" /></p>
</div>
<h3 id="annotations">Annotations</h3>
<p>We can add the annotations thanks to the <code>{ggrepel}</code> package. To be honest, I had a lot of struggle to find the good balance between the size of the annotation, the segments and the alignment of the annotations. At this stage, it was mostly a matter of iterations playing on the arguments of the <code>geom_text_repel()</code> function.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/slowkow/ggrepel'>ggrepel</a></span><span class='op'>)</span> </span>
<span></span>
<span><span class='va'>p_line</span> <span class='op'>&lt;-</span>   </span>
<span>  <span class='va'>data</span> <span class='op'>|&gt;</span>  </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Entity</span> <span class='op'><a href='https://rdrr.io/pkg/arules/man/match.html'>%in%</a></span> <span class='va'>top10_countries_2019</span><span class='op'>)</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>    x <span class='op'>=</span> <span class='va'>Year</span>, </span>
<span>    y <span class='op'>=</span> <span class='va'>Deaths</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='va'>Entity</span><span class='op'>)</span>,</span>
<span>    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span>,</span>
<span>    size <span class='op'>=</span> <span class='fl'>0.7</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='va'>Entity</span><span class='op'>)</span>,</span>
<span>    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span>xintercept <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_hline</a></span><span class='op'>(</span>yintercept <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span>from <span class='op'>=</span> <span class='fl'>20000</span>, to <span class='op'>=</span> <span class='fl'>140000</span>, by <span class='op'>=</span> <span class='fl'>20000</span><span class='op'>)</span>,  </span>
<span>             linetype <span class='op'>=</span> <span class='st'>'dashed'</span>,</span>
<span>             color <span class='op'>=</span> <span class='st'>'#dddddd'</span></span>
<span>             <span class='op'>)</span> <span class='op'>+</span>    </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_cartesian.html'>coord_cartesian</a></span><span class='op'>(</span></span>
<span>    xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1990</span>, <span class='fl'>2019</span><span class='op'>)</span>, </span>
<span>    ylim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>140000</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span></span>
<span>    breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1990</span>, <span class='fl'>1995</span>, <span class='fl'>2000</span>, <span class='fl'>2005</span>, <span class='fl'>2010</span>, <span class='fl'>2015</span>, <span class='fl'>2019</span><span class='op'>)</span>,</span>
<span>    expand <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expansion.html'>expansion</a></span><span class='op'>(</span>mult <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0.2</span><span class='op'>)</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span></span>
<span>    breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span>from <span class='op'>=</span> <span class='fl'>0</span>, to <span class='op'>=</span> <span class='fl'>140000</span>, by <span class='op'>=</span> <span class='fl'>20000</span><span class='op'>)</span>,               </span>
<span>    expand <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expansion.html'>expansion</a></span><span class='op'>(</span>mult <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0.1</span><span class='op'>)</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>    title <span class='op'>=</span> <span class='va'>plot_title</span>,        </span>
<span>    subtitle <span class='op'>=</span> <span class='va'>plot_subtitle</span>,        </span>
<span>    caption <span class='op'>=</span> <span class='va'>plot_caption</span>,        </span>
<span>    tag <span class='op'>=</span> <span class='va'>plot_tag</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_classic</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    axis.line.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    axis.ticks.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    axis.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    axis.text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>           </span>
<span>      size <span class='op'>=</span> <span class='fl'>13</span>,</span>
<span>      color <span class='op'>=</span> <span class='st'>"#5b5b5b"</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      family <span class='op'>=</span> <span class='st'>'merriweather'</span>,                                    </span>
<span>      color <span class='op'>=</span> <span class='st'>'#5b5b5b'</span>,</span>
<span>      face <span class='op'>=</span> <span class='st'>'bold'</span>,</span>
<span>      size <span class='op'>=</span> <span class='fl'>25</span>,                                   </span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0</span>,                                    </span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    plot.subtitle <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      color <span class='op'>=</span> <span class='st'>'#5b5b5b'</span>,</span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0</span>,                                       </span>
<span>      size <span class='op'>=</span> <span class='fl'>16</span>,</span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    plot.caption <span class='op'>=</span> <span class='fu'>ggtext</span><span class='fu'>::</span><span class='fu'><a href='https://wilkelab.org/ggtext/reference/element_markdown.html'>element_markdown</a></span><span class='op'>(</span></span>
<span>      color <span class='op'>=</span> <span class='st'>'#5b5b5b'</span>,</span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0</span>,                                                  </span>
<span>      size <span class='op'>=</span> <span class='fl'>16</span>,                                                 </span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    plot.tag.position <span class='op'>=</span> <span class='st'>'bottom'</span>,</span>
<span>    plot.tag <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      color <span class='op'>=</span> <span class='st'>'#5b5b5b'</span>,</span>
<span>      size <span class='op'>=</span> <span class='fl'>15</span>,                                  </span>
<span>      vjust <span class='op'>=</span> <span class='op'>-</span><span class='fl'>1</span>,                                 </span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>b <span class='op'>=</span> <span class='fl'>10</span>,</span>
<span>                      l <span class='op'>=</span> <span class='op'>-</span><span class='fl'>255</span><span class='op'>)</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># Adding the different annotations       </span></span>
<span>  <span class='fu'><a href='https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html'>geom_text_repel</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>    label <span class='op'>=</span> <span class='va'>Entity</span>,                           </span>
<span>    color <span class='op'>=</span> <span class='va'>Entity</span>,                           </span>
<span>    segment.shape <span class='op'>=</span> <span class='fl'>0</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span>,</span>
<span>    data <span class='op'>=</span> <span class='va'>data</span> <span class='op'>|&gt;</span></span>
<span>      <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Year</span> <span class='op'>==</span> <span class='fl'>2019</span> <span class='op'>&amp;</span> <span class='va'>Entity</span> <span class='op'><a href='https://rdrr.io/pkg/arules/man/match.html'>%in%</a></span> <span class='va'>top10_countries_2019</span><span class='op'>)</span>,</span>
<span>    size <span class='op'>=</span> <span class='fl'>4</span>,                           </span>
<span>    force <span class='op'>=</span> <span class='fl'>0.5</span>,                           </span>
<span>    position <span class='op'>=</span> <span class='fu'><a href='https://docs.r4photobiology.info/ggpp/reference/position_nudge_to.html'>position_nudge_to</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fl'>2021</span><span class='op'>)</span>,</span>
<span>    direction <span class='op'>=</span> <span class='st'>"y"</span>,</span>
<span>    hjust <span class='op'>=</span> <span class='fl'>0</span>,</span>
<span>    segment.curvature <span class='op'>=</span> <span class='op'>-</span><span class='fl'>0.0000001</span>,</span>
<span>    segment.linetype <span class='op'>=</span> <span class='st'>'dotted'</span></span>
<span>    <span class='op'>)</span>   </span>
<span></span>
<span><span class='va'>p_line</span></span></code></pre>
</div>
<p><img src="100517341_files/figure-html5/unnamed-chunk-21-1.png" width="624" /></p>
</div>
<p>This is <strong>my final line graph</strong>.<br />
Now, let’s try to apply what we learned about <code>{ggiraph}</code> here.</p>
<h3 id="ggiraph-version-of-the-line-plot"><code>{ggiraph}</code> version of the line plot</h3>
<p>The <code>{ggiraph}</code> version follows the same logic as the map we previously created. We’re therefore appending “_interactive” to the <code>geom_line()</code> and to the <code>geom_point()</code> geoms.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>p_line_girafe</span> <span class='op'>&lt;-</span></span>
<span>  <span class='va'>data</span> <span class='op'>|&gt;</span>  </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Entity</span> <span class='op'><a href='https://rdrr.io/pkg/arules/man/match.html'>%in%</a></span> <span class='va'>top10_countries_2019</span><span class='op'>)</span> <span class='op'>|&gt;</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>    x <span class='op'>=</span> <span class='va'>Year</span>, </span>
<span>    y <span class='op'>=</span> <span class='va'>Deaths</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='co'># Making the line interactive   </span></span>
<span>  <span class='fu'><a href='https://davidgohel.github.io/ggiraph/reference/geom_point_interactive.html'>geom_point_interactive</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>      color <span class='op'>=</span> <span class='va'>Entity</span>,     </span>
<span>      tooltip <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>Year</span>, <span class='st'>" "</span>, <span class='va'>Deaths</span><span class='op'>)</span>,     </span>
<span>      data_id <span class='op'>=</span> <span class='va'>Year</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span>,     </span>
<span>    size <span class='op'>=</span> <span class='fl'>0.7</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span>    </span>
<span>  <span class='co'># Making the points interactive   </span></span>
<span>  <span class='fu'><a href='https://davidgohel.github.io/ggiraph/reference/geom_path_interactive.html'>geom_line_interactive</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>   </span>
<span>      color <span class='op'>=</span> <span class='va'>Entity</span>,     </span>
<span>      tooltip <span class='op'>=</span> <span class='va'>Deaths</span>,     </span>
<span>      data_id <span class='op'>=</span> <span class='va'>Year</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span>xintercept <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_hline</a></span><span class='op'>(</span></span>
<span>    yintercept <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span>from <span class='op'>=</span> <span class='fl'>20000</span>, to <span class='op'>=</span> <span class='fl'>140000</span>, by <span class='op'>=</span> <span class='fl'>20000</span><span class='op'>)</span>,</span>
<span>    linetype <span class='op'>=</span> <span class='st'>'dashed'</span>,</span>
<span>    color <span class='op'>=</span> <span class='st'>'#dddddd'</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_cartesian.html'>coord_cartesian</a></span><span class='op'>(</span></span>
<span>    xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1990</span>, <span class='fl'>2019</span><span class='op'>)</span>,</span>
<span>    ylim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>140000</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span></span>
<span>    breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1990</span>, <span class='fl'>1995</span>, <span class='fl'>2000</span>, <span class='fl'>2005</span>, <span class='fl'>2010</span>, <span class='fl'>2015</span>, <span class='fl'>2019</span><span class='op'>)</span>,</span>
<span>    expand <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expansion.html'>expansion</a></span><span class='op'>(</span>mult <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0.2</span><span class='op'>)</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span></span>
<span>    breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span>from <span class='op'>=</span> <span class='fl'>0</span>, to <span class='op'>=</span> <span class='fl'>140000</span>, by <span class='op'>=</span> <span class='fl'>20000</span><span class='op'>)</span>,</span>
<span>    expand <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expansion.html'>expansion</a></span><span class='op'>(</span>mult <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0.1</span><span class='op'>)</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>    title <span class='op'>=</span> <span class='va'>plot_title</span>,        </span>
<span>    subtitle <span class='op'>=</span> <span class='va'>plot_subtitle</span>,</span>
<span>    caption <span class='op'>=</span> <span class='va'>plot_caption</span>,        </span>
<span>    tag <span class='op'>=</span> <span class='va'>plot_tag</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_classic</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>axis.line.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,         </span>
<span>        axis.ticks.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>        axis.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,         </span>
<span>        axis.text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>           </span>
<span>          size <span class='op'>=</span> <span class='fl'>13</span>,   </span>
<span>          color <span class='op'>=</span> <span class='st'>"#5b5b5b"</span></span>
<span>          <span class='op'>)</span>,         </span>
<span>        plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>          family <span class='op'>=</span> <span class='st'>'merriweather'</span>,                                    </span>
<span>          color <span class='op'>=</span> <span class='st'>'#5b5b5b'</span>,</span>
<span>          face <span class='op'>=</span> <span class='st'>'bold'</span>,</span>
<span>          size <span class='op'>=</span> <span class='fl'>15</span>,                                   </span>
<span>          hjust <span class='op'>=</span> <span class='op'>-</span><span class='fl'>0.18</span>,                                    </span>
<span>          margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span></span>
<span>          <span class='op'>)</span>,          </span>
<span>        plot.subtitle <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>          color <span class='op'>=</span> <span class='st'>'#5b5b5b'</span>,</span>
<span>          hjust <span class='op'>=</span> <span class='op'>-</span><span class='fl'>0.205</span>,                                       </span>
<span>          size <span class='op'>=</span> <span class='fl'>11</span>,</span>
<span>          margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span></span>
<span>          <span class='op'>)</span>,</span>
<span>        plot.caption <span class='op'>=</span> <span class='fu'>ggtext</span><span class='fu'>::</span><span class='fu'><a href='https://wilkelab.org/ggtext/reference/element_markdown.html'>element_markdown</a></span><span class='op'>(</span></span>
<span>          color <span class='op'>=</span> <span class='st'>'#5b5b5b'</span>,</span>
<span>          hjust <span class='op'>=</span> <span class='op'>-</span><span class='fl'>0.280</span>,                                                  </span>
<span>          size <span class='op'>=</span> <span class='fl'>11</span>,</span>
<span>          margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span></span>
<span>          <span class='op'>)</span>,</span>
<span>        plot.tag.position <span class='op'>=</span> <span class='st'>'bottom'</span>,</span>
<span>        plot.tag <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>          color <span class='op'>=</span> <span class='st'>'#5b5b5b'</span>,</span>
<span>          size <span class='op'>=</span> <span class='fl'>10</span>,</span>
<span>          vjust <span class='op'>=</span> <span class='op'>-</span><span class='fl'>1</span>,</span>
<span>          margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>b <span class='op'>=</span> <span class='fl'>10</span>,                                           </span>
<span>                          l <span class='op'>=</span> <span class='op'>-</span><span class='fl'>320</span><span class='op'>)</span><span class='op'>)</span></span>
<span>        <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html'>geom_text_repel</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>      label <span class='op'>=</span> <span class='va'>Entity</span>,</span>
<span>      color <span class='op'>=</span> <span class='va'>Entity</span>,                           </span>
<span>      segment.shape   <span class='op'>=</span> <span class='fl'>0</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span>,                       </span>
<span>    data <span class='op'>=</span> <span class='va'>data</span> <span class='op'>|&gt;</span>                          </span>
<span>      <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Year</span> <span class='op'>==</span> <span class='fl'>2019</span> <span class='op'>&amp;</span> <span class='va'>Entity</span> <span class='op'><a href='https://rdrr.io/pkg/arules/man/match.html'>%in%</a></span> <span class='va'>top10_countries_2019</span><span class='op'>)</span>,</span>
<span>    size <span class='op'>=</span> <span class='fl'>3</span>,</span>
<span>    force <span class='op'>=</span> <span class='fl'>0.5</span>, </span>
<span>    position <span class='op'>=</span> <span class='fu'><a href='https://docs.r4photobiology.info/ggpp/reference/position_nudge_to.html'>position_nudge_to</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fl'>2021</span><span class='op'>)</span>,</span>
<span>    direction <span class='op'>=</span> <span class='st'>"y"</span>,</span>
<span>    hjust <span class='op'>=</span> <span class='fl'>0</span>,                          </span>
<span>    segment.curvature <span class='op'>=</span> <span class='op'>-</span><span class='fl'>0.0000001</span></span>
<span>    <span class='op'>)</span>   </span>
<span></span>
<span><span class='fu'><a href='https://davidgohel.github.io/ggiraph/reference/girafe.html'>girafe</a></span><span class='op'>(</span>ggobj <span class='op'>=</span> <span class='va'>p_line_girafe</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<h3 id="adjustments-2">Adjustments</h3>
<p>We can notice that the lines are displaying the number of deaths due to low physical activity for year 1990 (which is not what we want), and that even if the points display the year and number of deaths, they are super hard to hover over with the mouse. A cool feature that has been included on the OWID graph is that when you hover your mouse over the graph, a table is displayed with the following information :</p>
<ul>
<li><p>The year that corresponds to the position of your mouse on the graph,</p></li>
<li><p>The unit of what is measured (deaths),</p></li>
<li><p>The legend followed by the number of deaths of each country for this specific year.</p></li>
</ul>
<p>I actually don’t know if I can include the legend, but it seems to me that I read something in the <code>{ggiraph}</code> documentation about possibilty to make tables pop on your graph interactively, so let’s give it a try.</p>
<p>Edit: I actually found a great tutorial to do so: <a href="https://uncharteddata.netlify.app/posts/2022-09-30-interactive-tooltip-tables/" class="uri">https://uncharteddata.netlify.app/posts/2022-09-30-interactive-tooltip-tables/</a></p>
<h4 id="create-the-table-for-the-tooltip">Create the table for the tooltip</h4>
<p>We first need to create a summary table of the pieces of information we want to display in our tooltip. We can do so by extracting the following columns from our <code>data</code> dataset: <code>Entity</code>, <code>Year</code>, <code>Deaths</code>. It is advised to use the <code>{kableExtra}</code> package to do so.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://haozhu233.github.io/kableExtra/'>kableExtra</a></span><span class='op'>)</span> </span>
<span></span>
<span><span class='co'># This code chunk is not run, it shows the process followed to build the function</span></span>
<span><span class='co'># that creates these tables for all rows of the dataset.</span></span>
<span></span>
<span><span class='va'>tooltip_table</span> <span class='op'>&lt;-</span>    </span>
<span>  <span class='va'>data</span> <span class='op'>|&gt;</span>  </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Entity</span> <span class='op'><a href='https://rdrr.io/pkg/arules/man/match.html'>%in%</a></span> <span class='va'>top10_countries_2019</span><span class='op'>)</span> <span class='op'>|&gt;</span>    </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>Entity</span>, <span class='va'>Year</span>, <span class='va'>Deaths</span><span class='op'>)</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_geometry.html'>st_drop_geometry</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://rdrr.io/pkg/kableExtra/man/kbl.html'>kbl</a></span><span class='op'>(</span>row.names <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<h4 id="creating-a-table-for-each-observation">Creating a table for each observation</h4>
<p>If we pass the newly created table to our <code>tooltip</code> aesthetic in the line graph, each tooltip will show the whole table. To only show the table part that correspond to the <code>Year</code> we are hovering with the mouse, the author of the tutorial suggests to create a new column in <code>data</code> that will contain a sub-table for each Year. To do so, he creates a function that loops trough each row and create the corresponding table.</p>
<p>Note: I find it genius, especially because I would have never thought about crafting a function to assign a table to each row. Well, I didn’t even know it was possible, but I still wouldn’t have thought about it.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'>#Not run, process</span></span>
<span></span>
<span><span class='va'>make_table</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='kw'>function</span><span class='op'>(</span><span class='va'>year</span><span class='op'>)</span><span class='op'>{</span></span>
<span>    <span class='va'>data</span> <span class='op'>|&gt;</span></span>
<span>      <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Entity</span> <span class='op'><a href='https://rdrr.io/pkg/arules/man/match.html'>%in%</a></span> <span class='va'>top10_countries_2019</span><span class='op'>)</span> <span class='op'>|&gt;</span>   </span>
<span>      <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Year</span> <span class='op'>==</span> <span class='va'>year</span><span class='op'>)</span> <span class='op'>|&gt;</span>    </span>
<span>      <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>Entity</span>, <span class='va'>Year</span>, <span class='va'>Deaths</span><span class='op'>)</span> <span class='op'>|&gt;</span>    </span>
<span>      <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_geometry.html'>st_drop_geometry</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>|&gt;</span>  <span class='co'># Only way I found to remove the geometry column</span></span>
<span>      <span class='fu'><a href='https://rdrr.io/pkg/kableExtra/man/kbl.html'>kbl</a></span><span class='op'>(</span>row.names <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>  </span>
<span>  <span class='op'>}</span></span></code></pre>
</div>
</div>
<p>This function is intended to create a table from the <code>data</code> dataset according to the specified year parameter. However, expecting that my computer is going to go crazy if we do so with the more than 5000 rows of the dataset, we can apply it to only the top 10 countries used until now in our line graph. To apply this function to each row, we can use the <code>map()</code> function from the <code>{purrr}</code> library. I purposefully don’t run these code chunk because creating a table for every single line in very heavy on my computer and takes forever. I will therefore only run the final function and “tooltip_table” variable.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>tooltip_table</span> <span class='op'>&lt;-</span>    </span>
<span>  <span class='va'>data</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Entity</span> <span class='op'><a href='https://rdrr.io/pkg/arules/man/match.html'>%in%</a></span> <span class='va'>top10_countries_2019</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>tooltip_table <span class='op'>=</span> <span class='fu'>purrr</span><span class='fu'>::</span><span class='fu'><a href='https://purrr.tidyverse.org/reference/map.html'>map</a></span><span class='op'>(</span><span class='va'>Year</span>, <span class='va'>make_table</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>Entity</span>, <span class='va'>Year</span>, <span class='va'>Deaths</span>, <span class='va'>tooltip_table</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<h4 id="customizing-the-table-shown-by-the-tooltip">Customizing the table shown by the tooltip</h4>
<p>To do so, the author advises to modify the style of the table directly in the function that created them, the <code>make_table()</code> function. Also, it seems that a good appearance can be achieved by using the <code>{gt}</code> and <code>{gtExtras}</code> packages. We will start from the styling of the author and try to customize it.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>make_table</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='kw'>function</span><span class='op'>(</span><span class='va'>year</span><span class='op'>)</span><span class='op'>{</span></span>
<span>    <span class='va'>data</span> <span class='op'>|&gt;</span></span>
<span>      <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Entity</span> <span class='op'><a href='https://rdrr.io/pkg/arules/man/match.html'>%in%</a></span> <span class='va'>top10_countries_2019</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>      <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Year</span> <span class='op'>==</span> <span class='va'>year</span><span class='op'>)</span> <span class='op'>|&gt;</span>    </span>
<span>      <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>Entity</span>, <span class='va'>Deaths</span><span class='op'>)</span> <span class='op'>|&gt;</span>    </span>
<span>      <span class='fu'>sf</span><span class='fu'>::</span><span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_geometry.html'>st_drop_geometry</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>      <span class='fu'><a href='https://gt.rstudio.com/reference/gt.html'>gt</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>      <span class='fu'>gt</span><span class='fu'>::</span><span class='fu'><a href='https://gt.rstudio.com/reference/fmt_number.html'>fmt_number</a></span><span class='op'>(</span>columns <span class='op'>=</span> <span class='va'>Deaths</span>, decimals <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>      <span class='co'># adjust column widths   </span></span>
<span>      <span class='fu'>gt</span><span class='fu'>::</span><span class='fu'><a href='https://gt.rstudio.com/reference/cols_width.html'>cols_width</a></span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/everything.html'>everything</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>~</span> <span class='fu'><a href='https://gt.rstudio.com/reference/px.html'>px</a></span><span class='op'>(</span><span class='fl'>120</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>      <span class='co'># apply the nytimes theme from {gtExtras}   </span></span>
<span>      <span class='fu'>gtExtras</span><span class='fu'>::</span><span class='fu'><a href='https://jthomasmock.github.io/gtExtras/reference/gt_theme_nytimes.html'>gt_theme_nytimes</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>      <span class='co'># add a title and subtitle to the table   </span></span>
<span>      <span class='co'># in the original graph, the title is the Year we are hovering with the mouse   </span></span>
<span>      <span class='fu'>gt</span><span class='fu'>::</span><span class='fu'><a href='https://gt.rstudio.com/reference/tab_header.html'>tab_header</a></span><span class='op'>(</span>title <span class='op'>=</span> <span class='va'>year</span>, subtitle <span class='op'>=</span> <span class='st'>"in deaths"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>      <span class='co'># get HTML content of table   </span></span>
<span>      <span class='fu'>gt</span><span class='fu'>::</span><span class='fu'><a href='https://gt.rstudio.com/reference/as_raw_html.html'>as_raw_html</a></span><span class='op'>(</span><span class='op'>)</span> </span>
<span>  <span class='op'>}</span></span></code></pre>
</div>
</div>
<p>IT WORKS. Let’s add some new adjustments:</p>
<ul>
<li><p>We want to make the tables a little smaller, which can be modified in the function <code>make_table()</code> that create the tables.</p></li>
<li><p>Let’s also reproduce the kind of animation that makes the user see the tables that corresponds to the year her mouse is hovering over. I couldn’t find how to reproduce it exactly, so let’s opt for creating vertical reference lines with <code>geom_vline_interactive()</code>, and make them transparent thanks to the <code>alpha</code> argument. We will make these lines sufficiently wide to reproduce the effect of the OWID graph, which is that whenever the user hovers the graph, a table appears.</p></li>
<li><p>Add an effect that does the following: when hovering over the name of a country, the lines of the other countries get lower opacity, as on the original OWID graph. This can be done by providing a <code>data_id</code> aesthetic to <code>geom_point_interactive</code>, <code>geom_line_interactive</code> and <code>geom_text_repel_interactive</code>, and adding a first a <code>opt_hover()</code> and <code>opts_hover_inv()</code> similar to the one on the map we previously created.</p></li>
<li><p>Tweaking the style of our tooltip tables a bit.</p></li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://gt.rstudio.com'>gt</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/jthomasmock/gtExtras'>gtExtras</a></span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>make_table</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>year</span><span class='op'>)</span><span class='op'>{</span>     </span>
<span>    <span class='va'>data</span> <span class='op'>|&gt;</span>     </span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice_max</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='fl'>10</span>, order_by <span class='op'>=</span> <span class='va'>Deaths</span>, by <span class='op'>=</span> <span class='va'>Year</span><span class='op'>)</span> <span class='op'>|&gt;</span>     </span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Year</span> <span class='op'>==</span> <span class='va'>year</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>Entity</span>, <span class='va'>Deaths</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>    <span class='fu'>sf</span><span class='fu'>::</span><span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_geometry.html'>st_drop_geometry</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>|&gt;</span>     </span>
<span>    <span class='fu'><a href='https://tidyr.tidyverse.org/reference/drop_na.html'>drop_na</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>    <span class='fu'><a href='https://gt.rstudio.com/reference/gt.html'>gt</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>    <span class='fu'>gt</span><span class='fu'>::</span><span class='fu'><a href='https://gt.rstudio.com/reference/fmt_number.html'>fmt_number</a></span><span class='op'>(</span>columns <span class='op'>=</span> <span class='va'>Deaths</span>, decimals <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>    <span class='co'># Adding the Arial font     </span></span>
<span>    <span class='fu'><a href='https://gt.rstudio.com/reference/opt_table_font.html'>opt_table_font</a></span><span class='op'>(</span>font <span class='op'>=</span> <span class='st'>"Arial"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>    <span class='co'># making the Deaths column bold     </span></span>
<span>    <span class='fu'><a href='https://gt.rstudio.com/reference/tab_style.html'>tab_style</a></span><span class='op'>(</span>       </span>
<span>      style <span class='op'>=</span>  <span class='fu'><a href='https://gt.rstudio.com/reference/cell_text.html'>cell_text</a></span><span class='op'>(</span>weight <span class='op'>=</span> <span class='st'>"bold"</span><span class='op'>)</span>,</span>
<span>      locations <span class='op'>=</span> <span class='fu'><a href='https://gt.rstudio.com/reference/cells_body.html'>cells_body</a></span><span class='op'>(</span>columns <span class='op'>=</span> <span class='va'>Deaths</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>    <span class='co'># lowering column widths and row height</span></span>
<span>    <span class='fu'>gt</span><span class='fu'>::</span><span class='fu'><a href='https://gt.rstudio.com/reference/tab_options.html'>tab_options</a></span><span class='op'>(</span>data_row.padding <span class='op'>=</span> <span class='fu'><a href='https://gt.rstudio.com/reference/px.html'>px</a></span><span class='op'>(</span><span class='fl'>4</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>    <span class='fu'>gt</span><span class='fu'>::</span><span class='fu'><a href='https://gt.rstudio.com/reference/cols_width.html'>cols_width</a></span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/everything.html'>everything</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>~</span> <span class='fu'><a href='https://gt.rstudio.com/reference/px.html'>px</a></span><span class='op'>(</span><span class='fl'>100</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>    <span class='co'># Modifying the font size     </span></span>
<span>    <span class='fu'>gt</span><span class='fu'>::</span><span class='fu'><a href='https://gt.rstudio.com/reference/tab_options.html'>tab_options</a></span><span class='op'>(</span></span>
<span>      table.font.size <span class='op'>=</span> <span class='fl'>11</span>,</span>
<span>      heading.background.color <span class='op'>=</span> <span class='st'>"lightgrey"</span></span>
<span>    <span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>    <span class='fu'>gt</span><span class='fu'>::</span><span class='fu'><a href='https://gt.rstudio.com/reference/tab_header.html'>tab_header</a></span><span class='op'>(</span>title <span class='op'>=</span> <span class='va'>year</span>,                    </span>
<span>                   subtitle <span class='op'>=</span> <span class='st'>"in deaths"</span></span>
<span>    <span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>    <span class='fu'>gt</span><span class='fu'>::</span><span class='fu'><a href='https://gt.rstudio.com/reference/as_raw_html.html'>as_raw_html</a></span><span class='op'>(</span><span class='op'>)</span>   </span>
<span><span class='op'>}</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>tooltip_table</span> <span class='op'>&lt;-</span>    </span>
<span>  <span class='va'>data</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice_max</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='fl'>10</span>, order_by <span class='op'>=</span> <span class='va'>Deaths</span>, by <span class='op'>=</span> <span class='va'>Year</span><span class='op'>)</span> <span class='op'>|&gt;</span>   </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>table <span class='op'>=</span> <span class='fu'>purrr</span><span class='fu'>::</span><span class='fu'><a href='https://purrr.tidyverse.org/reference/map.html'>map</a></span><span class='op'>(</span><span class='va'>Year</span>, <span class='va'>make_table</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>Entity</span>, <span class='va'>Year</span>, <span class='va'>Deaths</span>, <span class='va'>table</span><span class='op'>)</span>  </span>
<span></span>
<span><span class='va'>p_line_girafe</span> <span class='op'>&lt;-</span></span>
<span>  <span class='va'>tooltip_table</span> <span class='op'>|&gt;</span>  </span>
<span>  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/drop_na.html'>drop_na</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>    x <span class='op'>=</span> <span class='va'>Year</span>, </span>
<span>    y <span class='op'>=</span> <span class='va'>Deaths</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span>    </span>
<span>  <span class='fu'><a href='https://davidgohel.github.io/ggiraph/reference/geom_point_interactive.html'>geom_point_interactive</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>      </span>
<span>    color <span class='op'>=</span> <span class='va'>Entity</span>,     </span>
<span>    data_id <span class='op'>=</span> <span class='va'>Entity</span><span class='op'>)</span>,</span>
<span>    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span>, </span>
<span>    size <span class='op'>=</span> <span class='fl'>0.45</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://davidgohel.github.io/ggiraph/reference/geom_path_interactive.html'>geom_line_interactive</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>     </span>
<span>    color <span class='op'>=</span> <span class='va'>Entity</span>,     </span>
<span>    data_id <span class='op'>=</span> <span class='va'>Entity</span><span class='op'>)</span>,</span>
<span>    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span>,</span>
<span>    size <span class='op'>=</span> <span class='fl'>0.3</span><span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='co'># Adding the vertical reference lines that, when hovered will display the tables with data for the corresponding year.   </span></span>
<span>  <span class='fu'><a href='https://davidgohel.github.io/ggiraph/reference/geom_abline_interactive.html'>geom_vline_interactive</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>    xintercept <span class='op'>=</span> <span class='va'>Year</span>,</span>
<span>    tooltip <span class='op'>=</span> <span class='va'>table</span><span class='op'>)</span>,</span>
<span>    alpha <span class='op'>=</span> <span class='fl'>0</span>,                          </span>
<span>    size <span class='op'>=</span> <span class='fl'>4.75</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_hline</a></span><span class='op'>(</span></span>
<span>    yintercept <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span>from <span class='op'>=</span> <span class='fl'>20000</span>, to <span class='op'>=</span> <span class='fl'>140000</span>, by <span class='op'>=</span> <span class='fl'>20000</span><span class='op'>)</span>,</span>
<span>    linetype <span class='op'>=</span> <span class='st'>'dotted'</span>,</span>
<span>    color <span class='op'>=</span> <span class='st'>'#dddddd'</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_cartesian.html'>coord_cartesian</a></span><span class='op'>(</span></span>
<span>    xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1990</span>, <span class='fl'>2019</span><span class='op'>)</span>,</span>
<span>    ylim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>140000</span><span class='op'>)</span>,</span>
<span>    clip <span class='op'>=</span> <span class='st'>'off'</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span>breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1990</span>, <span class='fl'>1995</span>, <span class='fl'>2000</span>, <span class='fl'>2005</span>, <span class='fl'>2010</span>, <span class='fl'>2015</span>, <span class='fl'>2019</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span></span>
<span>    breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span>from <span class='op'>=</span> <span class='fl'>0</span>, to <span class='op'>=</span> <span class='fl'>140000</span>, by <span class='op'>=</span> <span class='fl'>20000</span><span class='op'>)</span>,                      </span>
<span>    expand <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expansion.html'>expansion</a></span><span class='op'>(</span>mult <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0.1</span><span class='op'>)</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>    title <span class='op'>=</span> <span class='va'>plot_title</span>,        </span>
<span>    subtitle <span class='op'>=</span> <span class='va'>plot_subtitle</span>,        </span>
<span>    caption <span class='op'>=</span> <span class='va'>plot_caption</span>,        </span>
<span>    tag <span class='op'>=</span> <span class='va'>plot_tag</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_classic</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    axis.line.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    axis.ticks.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    axis.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    axis.text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>           </span>
<span>      size <span class='op'>=</span> <span class='fl'>9.5</span>,</span>
<span>      color <span class='op'>=</span> <span class='st'>"#5b5b5b"</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    axis.line <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_line</a></span><span class='op'>(</span>linewidth <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span>,</span>
<span>    plot.margin <span class='op'>=</span> </span>
<span>      <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>r <span class='op'>=</span> <span class='fl'>60</span>,</span>
<span>             b <span class='op'>=</span> <span class='fl'>10</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      family <span class='op'>=</span> <span class='st'>'merriweather'</span>,</span>
<span>      color <span class='op'>=</span> <span class='st'>'#5b5b5b'</span>,</span>
<span>      face <span class='op'>=</span> <span class='st'>'bold'</span>,</span>
<span>      size <span class='op'>=</span> <span class='fl'>13</span>,                                    </span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0</span>,                                    </span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    plot.subtitle <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      color <span class='op'>=</span> <span class='st'>'#5b5b5b'</span>,</span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0</span>,                                      </span>
<span>      size <span class='op'>=</span> <span class='fl'>9</span>,</span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    plot.caption <span class='op'>=</span> <span class='fu'>ggtext</span><span class='fu'>::</span><span class='fu'><a href='https://wilkelab.org/ggtext/reference/element_markdown.html'>element_markdown</a></span><span class='op'>(</span></span>
<span>      color <span class='op'>=</span> <span class='st'>'#5b5b5b'</span>,</span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0</span>,                                                  </span>
<span>      size <span class='op'>=</span> <span class='fl'>9</span>,                                                  </span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    plot.tag.position <span class='op'>=</span> <span class='st'>'bottom'</span>,</span>
<span>    plot.tag <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      color <span class='op'>=</span> <span class='st'>'#5b5b5b'</span>,       </span>
<span>      size <span class='op'>=</span> <span class='fl'>8</span>,</span>
<span>      vjust <span class='op'>=</span> <span class='op'>-</span><span class='fl'>1</span>,</span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>l <span class='op'>=</span> <span class='op'>-</span><span class='fl'>173</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span> </span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://davidgohel.github.io/ggiraph/reference/geom_text_repel_interactive.html'>geom_text_repel_interactive</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>      label <span class='op'>=</span> <span class='va'>Entity</span>,                       </span>
<span>      color <span class='op'>=</span> <span class='va'>Entity</span>,                       </span>
<span>      segment.shape   <span class='op'>=</span> <span class='fl'>0</span>,</span>
<span>      data_id <span class='op'>=</span> <span class='va'>Entity</span><span class='op'>)</span>,</span>
<span>    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span>,</span>
<span>    data <span class='op'>=</span> <span class='va'>data</span> <span class='op'>|&gt;</span></span>
<span>      <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Year</span> <span class='op'>==</span> <span class='fl'>2019</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>      <span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice_max</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='fl'>10</span>, order_by <span class='op'>=</span> <span class='va'>Deaths</span><span class='op'>)</span>,</span>
<span>    size <span class='op'>=</span> <span class='fl'>2.5</span>,                    </span>
<span>    force <span class='op'>=</span> <span class='fl'>0.5</span>,</span>
<span>    position <span class='op'>=</span> <span class='fu'><a href='https://docs.r4photobiology.info/ggpp/reference/position_nudge_to.html'>position_nudge_to</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fl'>2022</span><span class='op'>)</span>,   </span>
<span>    direction <span class='op'>=</span> <span class='st'>"y"</span>,                  </span>
<span>    hjust <span class='op'>=</span> <span class='fl'>0</span>,       </span>
<span>    segment.curvature <span class='op'>=</span> <span class='op'>-</span><span class='fl'>0.0000001</span>,    </span>
<span>    segment.size <span class='op'>=</span> <span class='fl'>0.1</span>,                   </span>
<span>    xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='cn'>NA</span>, <span class='cn'>Inf</span><span class='op'>)</span>                 </span>
<span>  <span class='op'>)</span>   </span>
<span></span>
<span><span class='fu'><a href='https://davidgohel.github.io/ggiraph/reference/girafe.html'>girafe</a></span><span class='op'>(</span>ggobj <span class='op'>=</span> <span class='va'>p_line_girafe</span>,        </span>
<span>       options <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>          </span>
<span>         <span class='fu'><a href='https://davidgohel.github.io/ggiraph/reference/opts_hover.html'>opts_hover</a></span><span class='op'>(</span>css <span class='op'>=</span> <span class='st'>"color:;"</span><span class='op'>)</span>,          </span>
<span>         <span class='fu'><a href='https://davidgohel.github.io/ggiraph/reference/opts_hover.html'>opts_hover_inv</a></span><span class='op'>(</span>css <span class='op'>=</span> <span class='st'>"opacity:0.15;"</span><span class='op'>)</span></span>
<span>       <span class='op'>)</span></span>
<span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>I know that these elements might not be the core of the Data Viz projects, but I am still super proud of having explored the <code>{ggiraph}</code> package that much, and to have replicated a feature that I thought it would be impossible to make.</p>
<h2 id="alternative-graphs">Alternative graphs</h2>
<p>To be honest, I find that the original Our World In Data graph is very complete, especially because it consists of two graphs that enables us to compare very easily countries between each other thanks to the map, but also take a look at the evolution through the years, and even compare evolutions thanks to the line graph.</p>
<p>However, all the data that is displayed by these graphs are absolute numbers. We now that China is the country with most deaths due to low physical activity in 2019, but China is also the country with the most deaths all causes combined, because China is of course the most populated country in the world. Therefore, it seemed to me that these absolute values failed to convey the information we want to extract from the graphs, which might be something like: “Which country best meet physical activity standards in the world?” for instance.</p>
<p>Therefore, the alternative graphs proposed are replicates of the original, but showing the data as percentages of the population that died from low physical activity.</p>
<h3 id="the-data-1">The data</h3>
<p>Thanks to the <code>Population</code> column that we added during the first process of the data to replicate the original graph, we just need to add a <code>Percentage</code> column to the ‘data’ dataset (for sake of clarity, we’ll create a second dataset for the alternative graphs, called <code>data_alt</code> and to discretize the Percentage variable for the alternative map.</p>
<p>Also, based on an advice of Iñaki, I chose to multiply by 1000 the percentages since they are very small, to enables a better visualization of the numbers, and to better compare them between each other.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>data_alt</span> <span class='op'>&lt;-</span>    </span>
<span>  <span class='va'>data</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    Percentage <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>Deaths</span><span class='op'>/</span><span class='va'>Population</span><span class='op'>)</span><span class='op'>*</span><span class='fl'>100</span><span class='op'>*</span><span class='fl'>1000</span>, digits <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span>,</span>
<span>    .after <span class='op'>=</span> <span class='va'>Deaths_disc</span></span>
<span>    <span class='op'>)</span> <span class='op'>|&gt;</span>  <span class='co'># the round() function is used for simpler visualization of the legend later.   </span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    Percentage_disc <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/arules/man/discretize.html'>discretize</a></span><span class='op'>(</span><span class='va'>Percentage</span>, method <span class='op'>=</span> <span class='st'>'frequency'</span>, breaks <span class='op'>=</span> <span class='fl'>9</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span></span></code></pre>
</div>
</div>
<h3 id="alternative-map">Alternative map</h3>
<h4 id="static-version">Static version</h4>
<p>The only change is therefore that we are using the <code>data_alt</code> dataset. We also have to modify the subtitle to precise that the numbers are not actual percentages, but thousandths of percentage.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>plot_subtitle_alt</span> <span class='op'>&lt;-</span> <span class='st'>"Estimated annual thousandth of percentage of the populations with deaths attributed to low physical activity."</span> </span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>p_map_alt</span> <span class='op'>&lt;-</span>    </span>
<span>  <span class='co'># Using data_alt instead of data   </span></span>
<span>  <span class='va'>data_alt</span> <span class='op'>|&gt;</span>   </span>
<span>  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/drop_na.html'>drop_na</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Year</span> <span class='op'>==</span> <span class='fl'>2019</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='co'># Using the column 'Percentage_disc' instead of 'Deaths"  </span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>Percentage_disc</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>coord_sf</a></span><span class='op'>(</span>crs <span class='op'>=</span> <span class='st'>'+proj=robin'</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>    title <span class='op'>=</span> <span class='va'>plot_title</span>,        </span>
<span>    subtitle <span class='op'>=</span> <span class='va'>plot_subtitle_alt</span>,        </span>
<span>    caption <span class='op'>=</span> <span class='va'>plot_caption</span>,        </span>
<span>    tag <span class='op'>=</span> <span class='va'>plot_tag</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_void</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>plot.title <span class='op'>=</span></span>
<span>          <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>            family <span class='op'>=</span> <span class='st'>'merriweather'</span>,                                    </span>
<span>            color <span class='op'>=</span> <span class='st'>'#5b5b5b'</span>,</span>
<span>            face <span class='op'>=</span> <span class='st'>'bold'</span>,</span>
<span>            size <span class='op'>=</span> <span class='fl'>20</span>,</span>
<span>            hjust <span class='op'>=</span> <span class='fl'>0.125</span>,                                   </span>
<span>            margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='op'>-</span><span class='fl'>10</span><span class='op'>)</span></span>
<span>            <span class='op'>)</span>,</span>
<span>        plot.subtitle <span class='op'>=</span> </span>
<span>          <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>            color <span class='op'>=</span> <span class='st'>'#5b5b5b'</span>,</span>
<span>            hjust <span class='op'>=</span> <span class='fl'>0.42</span>,</span>
<span>            size <span class='op'>=</span> <span class='fl'>16</span></span>
<span>            <span class='op'>)</span>,         </span>
<span>        plot.caption <span class='op'>=</span> <span class='fu'>ggtext</span><span class='fu'>::</span><span class='fu'><a href='https://wilkelab.org/ggtext/reference/element_markdown.html'>element_markdown</a></span><span class='op'>(</span></span>
<span>          color <span class='op'>=</span> <span class='st'>'#5b5b5b'</span>,</span>
<span>          hjust <span class='op'>=</span> <span class='fl'>0.2</span>,</span>
<span>          size <span class='op'>=</span> <span class='fl'>16</span>,</span>
<span>          margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span></span>
<span>          <span class='op'>)</span>,</span>
<span>        plot.tag.position <span class='op'>=</span> <span class='st'>'bottom'</span>,</span>
<span>        plot.tag <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>          color <span class='op'>=</span> <span class='st'>'#5b5b5b'</span>,</span>
<span>          size <span class='op'>=</span> <span class='fl'>15</span>,</span>
<span>          vjust <span class='op'>=</span> <span class='op'>-</span><span class='fl'>1</span>,</span>
<span>          margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>l <span class='op'>=</span> <span class='op'>-</span><span class='fl'>248</span><span class='op'>)</span></span>
<span>          <span class='op'>)</span>,</span>
<span>        legend.position <span class='op'>=</span> <span class='st'>'bottom'</span>,</span>
<span>        legend.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>        legend.text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>           </span>
<span>          margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='op'>-</span><span class='fl'>22</span><span class='op'>)</span></span>
<span>          <span class='op'>)</span></span>
<span>        <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_brewer.html'>scale_fill_brewer</a></span><span class='op'>(</span>palette <span class='op'>=</span> <span class='st'>'YlOrRd'</span>,</span>
<span>                    guide <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/guide_coloursteps.html'>guide_coloursteps</a></span><span class='op'>(</span>                        </span>
<span>                      show.limits <span class='op'>=</span> <span class='cn'>TRUE</span>,                        </span>
<span>                      ticks <span class='op'>=</span> <span class='cn'>TRUE</span>,</span>
<span>                      barwidth <span class='op'>=</span> <span class='fl'>25</span>,</span>
<span>                      barheight <span class='op'>=</span> <span class='fl'>0.5</span>,                       </span>
<span>                      frame.colour <span class='op'>=</span> <span class='st'>'black'</span>,</span>
<span>                      frame.linewidth <span class='op'>=</span> <span class='fl'>0.01</span>,                       </span>
<span>                      ticks.colour <span class='op'>=</span> <span class='st'>'black'</span>,</span>
<span>                      ticks.linewidth <span class='op'>=</span> <span class='fl'>0.01</span><span class='op'>)</span></span>
<span>                    <span class='op'>)</span> </span>
<span></span>
<span><span class='va'>p_map_alt</span></span></code></pre>
</div>
</div>
<h4 id="interactive-version">Interactive version</h4>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Still a ' symbol for the country "Cote d'Ivoire" causing errors in ggiraph </span></span>
<span><span class='va'>data_alt</span> <span class='op'>&lt;-</span></span>
<span>  <span class='va'>data_alt</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>Entity <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>Entity</span> <span class='op'>==</span> <span class='st'>"Cote d'Ivoire"</span>, <span class='st'>"Cote d Ivoire"</span>, <span class='va'>Entity</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>tooltip_css</span> <span class='op'>&lt;-</span> <span class='st'>"background-color: rgba(245, 245, 245, 1);</span></span>
<span><span class='st'>                color: #000000; font-family: 'Arial', sans-serif;</span></span>
<span><span class='st'>                font-size: 11px;</span></span>
<span><span class='st'>                border-radius: 4px;</span></span>
<span><span class='st'>                border: 1px solid #d9d9d9;</span></span>
<span><span class='st'>                padding: 8px;"</span></span>
<span></span>
<span><span class='va'>p_map_alt_girafe</span> <span class='op'>&lt;-</span>   </span>
<span>  <span class='va'>data_alt</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Year</span> <span class='op'>==</span> <span class='fl'>2019</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://davidgohel.github.io/ggiraph/reference/geom_sf_interactive.html'>geom_sf_interactive</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>        </span>
<span>    fill <span class='op'>=</span> <span class='va'>Percentage_disc</span>,        </span>
<span>    tooltip <span class='op'>=</span> </span>
<span>      <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/sprintf.html'>sprintf</a></span><span class='op'>(</span><span class='st'>"&lt;b&gt;%s&lt;/b&gt;: %.2f"</span>, <span class='va'>Entity</span>, <span class='va'>Percentage</span><span class='op'>)</span>, <span class='st'>"\nNumber of Deaths: "</span>, <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>Deaths</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>    data_id <span class='op'>=</span> <span class='va'>Entity</span></span>
<span>  <span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>coord_sf</a></span><span class='op'>(</span>crs <span class='op'>=</span> <span class='st'>"+proj=robin"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title <span class='op'>=</span> <span class='va'>plot_title</span>,        </span>
<span>       subtitle <span class='op'>=</span> <span class='va'>plot_subtitle_alt</span>,        </span>
<span>       caption <span class='op'>=</span> <span class='va'>plot_caption</span>,        </span>
<span>       tag <span class='op'>=</span> <span class='va'>plot_tag</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_void</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      family <span class='op'>=</span> <span class='st'>"merriweather"</span>,</span>
<span>      color <span class='op'>=</span> <span class='st'>"#5b5b5b"</span>,</span>
<span>      face <span class='op'>=</span> <span class='st'>"bold"</span>,</span>
<span>      size <span class='op'>=</span> <span class='fl'>12</span>,    </span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0.12</span>                                   </span>
<span>    <span class='op'>)</span>,</span>
<span>    <span class='co'>#margin modified         </span></span>
<span>    plot.subtitle <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      color <span class='op'>=</span> <span class='st'>"#5b5b5b"</span>,</span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0.32</span>,                                      </span>
<span>      size <span class='op'>=</span> <span class='fl'>8</span></span>
<span>      <span class='op'>)</span>,</span>
<span>    plot.caption <span class='op'>=</span> <span class='fu'>ggtext</span><span class='fu'>::</span><span class='fu'><a href='https://wilkelab.org/ggtext/reference/element_markdown.html'>element_markdown</a></span><span class='op'>(</span></span>
<span>      color <span class='op'>=</span> <span class='st'>"#5b5b5b"</span>,</span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0.14</span>,                                                 </span>
<span>      size <span class='op'>=</span> <span class='fl'>8</span>,                                                 </span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    plot.tag.position <span class='op'>=</span> <span class='st'>"bottom"</span>,</span>
<span>    plot.tag <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      color <span class='op'>=</span> <span class='st'>"#5b5b5b"</span>,</span>
<span>      size <span class='op'>=</span> <span class='fl'>7</span>,  </span>
<span>      vjust <span class='op'>=</span> <span class='op'>-</span><span class='fl'>1</span>,</span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>l <span class='op'>=</span> <span class='op'>-</span><span class='fl'>278</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span>,          </span>
<span>    legend.position <span class='op'>=</span> <span class='st'>"bottom"</span>,</span>
<span>    legend.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    legend.text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>           </span>
<span>      size <span class='op'>=</span> <span class='fl'>8</span>,</span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='op'>-</span><span class='fl'>22</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://davidgohel.github.io/ggiraph/reference/scale_colour_brewer_interactive.html'>scale_fill_brewer_interactive</a></span><span class='op'>(</span></span>
<span>    palette <span class='op'>=</span> <span class='st'>"YlOrRd"</span>,</span>
<span>    <span class='co'># making the legend interactive</span></span>
<span>    guide <span class='op'>=</span> <span class='fu'><a href='https://davidgohel.github.io/ggiraph/reference/guide_coloursteps_interactive.html'>guide_coloursteps_interactive</a></span><span class='op'>(</span>                        </span>
<span>      show.limits <span class='op'>=</span> <span class='cn'>TRUE</span>,                       </span>
<span>      ticks <span class='op'>=</span> <span class='cn'>TRUE</span>,</span>
<span>      barwidth <span class='op'>=</span> <span class='fl'>25</span>,</span>
<span>      barheight <span class='op'>=</span> <span class='fl'>0.4</span>,</span>
<span>      frame.colour <span class='op'>=</span> <span class='st'>"black"</span>,                       </span>
<span>      frame.linewidth <span class='op'>=</span> <span class='fl'>0.1</span>,                       </span>
<span>      ticks.colour <span class='op'>=</span> <span class='st'>"black"</span>,</span>
<span>      ticks.linewidth <span class='op'>=</span> <span class='fl'>0.1</span><span class='op'>)</span>   </span>
<span>  <span class='op'>)</span> </span>
<span></span>
<span><span class='fu'><a href='https://davidgohel.github.io/ggiraph/reference/girafe.html'>girafe</a></span><span class='op'>(</span>ggobj <span class='op'>=</span> <span class='va'>p_map_alt_girafe</span>,        </span>
<span>       options <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>          </span>
<span>         <span class='fu'><a href='https://davidgohel.github.io/ggiraph/reference/opts_hover.html'>opts_hover_inv</a></span><span class='op'>(</span>css <span class='op'>=</span> <span class='st'>"opacity:0.7;"</span><span class='op'>)</span>,          </span>
<span>         <span class='fu'><a href='https://davidgohel.github.io/ggiraph/reference/opts_hover.html'>opts_hover</a></span><span class='op'>(</span>css <span class='op'>=</span> <span class='st'>"stroke-width:1.2;stroke:black;"</span><span class='op'>)</span>,          </span>
<span>         <span class='fu'><a href='https://davidgohel.github.io/ggiraph/reference/opts_tooltip.html'>opts_tooltip</a></span><span class='op'>(</span>css <span class='op'>=</span> <span class='va'>tooltip_css</span>        </span>
<span>         <span class='op'>)</span></span>
<span>       <span class='op'>)</span></span>
<span><span class='op'>)</span></span></code></pre>
</div>
</div>
<h3 id="alternative-line-graph">Alternative line graph</h3>
<h4 id="static-version-1">Static version</h4>
<p>In order to stay consistent with the first graph, I decided to plot the same countries as on the first replicate to have a comparison between the absolute numbers and percentage trends.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Countries that have the highest percentage of Deaths in 2019  </span></span>
<span></span>
<span><span class='va'>countries_top10</span> <span class='op'>&lt;-</span></span>
<span>  <span class='va'>data_alt</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Year</span> <span class='op'>==</span> <span class='fl'>2019</span><span class='op'>)</span> <span class='op'>|&gt;</span>    </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice_max</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='fl'>10</span>, with_ties <span class='op'>=</span> <span class='cn'>FALSE</span>, order_by <span class='op'>=</span> <span class='va'>Deaths</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>Entity</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>sf</span><span class='fu'>::</span><span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_geometry.html'>st_drop_geometry</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://purrr.tidyverse.org/reference/as_vector.html'>as_vector</a></span><span class='op'>(</span><span class='op'>)</span>  </span>
<span></span>
<span><span class='va'>p_line_alt</span> <span class='op'>&lt;-</span>    </span>
<span>  <span class='co'># We use the same filtering process to get the same data as on the first line graph  </span></span>
<span>  <span class='va'>data_alt</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Entity</span> <span class='op'><a href='https://rdrr.io/pkg/arules/man/match.html'>%in%</a></span> <span class='va'>countries_top10</span><span class='op'>)</span> <span class='op'>|&gt;</span>  </span>
<span>  <span class='co'># Switching from the "Deaths" column to the "Percentage" one</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>    x <span class='op'>=</span> <span class='va'>Year</span>,</span>
<span>    y <span class='op'>=</span> <span class='va'>Percentage</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>    color <span class='op'>=</span> <span class='va'>Entity</span><span class='op'>)</span>,</span>
<span>    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span>,     </span>
<span>    size <span class='op'>=</span> <span class='fl'>0.7</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='va'>Entity</span><span class='op'>)</span>,      </span>
<span>    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span>xintercept <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='co'># The reference lines will not be the same. As the max percentages between the countries plotted are around 4 units, let's set a horizontal reference line each 1   </span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_hline</a></span><span class='op'>(</span></span>
<span>    yintercept <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span>from <span class='op'>=</span> <span class='fl'>0</span>, to <span class='op'>=</span> <span class='fl'>40</span>, by <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span>,</span>
<span>    linetype <span class='op'>=</span> <span class='st'>'dashed'</span>,            </span>
<span>    color <span class='op'>=</span> <span class='st'>'#dddddd'</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='co'># The ylim will also not be the same   </span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_cartesian.html'>coord_cartesian</a></span><span class='op'>(</span></span>
<span>    xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1990</span>, <span class='fl'>2019</span><span class='op'>)</span>,</span>
<span>    ylim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>40</span><span class='op'>)</span>,</span>
<span>    clip <span class='op'>=</span> <span class='st'>'off'</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span>breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1990</span>, <span class='fl'>1995</span>, <span class='fl'>2000</span>, <span class='fl'>2005</span>, <span class='fl'>2010</span>, <span class='fl'>2015</span>, <span class='fl'>2019</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> <span class='co'># expand removed</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span>breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span>from <span class='op'>=</span> <span class='fl'>0</span>, to <span class='op'>=</span> <span class='fl'>40</span>, by <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span>, <span class='co'># Also Adjusted</span></span>
<span>                     expand <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expansion.html'>expansion</a></span><span class='op'>(</span>mult <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0.1</span><span class='op'>)</span></span>
<span>                     <span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>    title <span class='op'>=</span> <span class='va'>plot_title</span>,        </span>
<span>    subtitle <span class='op'>=</span> <span class='va'>plot_subtitle</span>,        </span>
<span>    caption <span class='op'>=</span> <span class='va'>plot_caption</span>,        </span>
<span>    tag <span class='op'>=</span> <span class='va'>plot_tag</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_classic</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    axis.line.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    axis.ticks.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    axis.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    axis.text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>           </span>
<span>      size <span class='op'>=</span> <span class='fl'>13</span>,           </span>
<span>      color <span class='op'>=</span> <span class='st'>"#5b5b5b"</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    plot.margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>r <span class='op'>=</span> <span class='fl'>60</span><span class='op'>)</span>, <span class='co'># Added</span></span>
<span>    plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>family <span class='op'>=</span> <span class='st'>'merriweather'</span>,</span>
<span>                              color <span class='op'>=</span> <span class='st'>'#5b5b5b'</span>,                                   </span>
<span>                              face <span class='op'>=</span> <span class='st'>'bold'</span>,</span>
<span>                              size <span class='op'>=</span> <span class='fl'>15</span>,</span>
<span>                              hjust <span class='op'>=</span> <span class='fl'>0</span>,                                    </span>
<span>                              margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    plot.subtitle <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      color <span class='op'>=</span> <span class='st'>'#5b5b5b'</span>,</span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0</span>,                                       </span>
<span>      size <span class='op'>=</span> <span class='fl'>11</span>,</span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    plot.caption <span class='op'>=</span> <span class='fu'>ggtext</span><span class='fu'>::</span><span class='fu'><a href='https://wilkelab.org/ggtext/reference/element_markdown.html'>element_markdown</a></span><span class='op'>(</span></span>
<span>      color <span class='op'>=</span> <span class='st'>'#5b5b5b'</span>,</span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0</span>,                                                  </span>
<span>      size <span class='op'>=</span> <span class='fl'>11</span>,</span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    plot.tag.position <span class='op'>=</span> <span class='st'>'bottom'</span>,</span>
<span>    plot.tag <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      color <span class='op'>=</span> <span class='st'>'#5b5b5b'</span>,                                </span>
<span>      size <span class='op'>=</span> <span class='fl'>10</span>,</span>
<span>      vjust <span class='op'>=</span> <span class='op'>-</span><span class='fl'>1</span>,</span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>b <span class='op'>=</span> <span class='fl'>10</span>,</span>
<span>                      l <span class='op'>=</span> <span class='op'>-</span><span class='fl'>320</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span>         </span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html'>geom_text_repel</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>      label <span class='op'>=</span> <span class='va'>Entity</span>,                       </span>
<span>      color <span class='op'>=</span> <span class='va'>Entity</span>,                       </span>
<span>      segment.shape   <span class='op'>=</span> <span class='fl'>0</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span>,                       </span>
<span>    data <span class='op'>=</span> <span class='va'>data_alt</span> <span class='op'>|&gt;</span></span>
<span>      <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Year</span> <span class='op'>==</span> <span class='fl'>2019</span> <span class='op'>&amp;</span> <span class='va'>Entity</span> <span class='op'><a href='https://rdrr.io/pkg/arules/man/match.html'>%in%</a></span> <span class='va'>countries_top10</span><span class='op'>)</span>,</span>
<span>    <span class='co'>#slice_max(n = 10, order_by = Deaths),</span></span>
<span>    size <span class='op'>=</span> <span class='fl'>2.5</span>, <span class='co'># Adjusted</span></span>
<span>    force <span class='op'>=</span> <span class='fl'>0.5</span>,                       </span>
<span>    position <span class='op'>=</span> <span class='fu'><a href='https://docs.r4photobiology.info/ggpp/reference/position_nudge_to.html'>position_nudge_to</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fl'>2022</span><span class='op'>)</span>,</span>
<span>    direction <span class='op'>=</span> <span class='st'>"y"</span>,</span>
<span>    hjust <span class='op'>=</span> <span class='fl'>0</span>,</span>
<span>    segment.curvature <span class='op'>=</span> <span class='op'>-</span><span class='fl'>0.0000001</span>,                       </span>
<span>    segment.size <span class='op'>=</span> <span class='fl'>0.1</span>, <span class='co'># Making segments thiner</span></span>
<span>    xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='cn'>NA</span>, <span class='cn'>Inf</span><span class='op'>)</span> <span class='co'># Added to enable labels to past the boundaries of the plot</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>p_line_alt</span></span></code></pre>
</div>
<p><img src="100517341_files/figure-html5/unnamed-chunk-33-1.png" width="624" /></p>
</div>
<p>The line graph is now a bit messier since the values for mortality due to low physical activity are actually quite close between countries. It seems to me that putting all these lines into a Slope chart might be clearer.</p>
<h4 id="slope-charts">Slope charts</h4>
<p>I still had the problem of having to choose which countries to plot. As I can’t replicate the filter function of the OWID graph, I made compromises. To me, the evolution is what we seek and the reason why we have the data available from 1990. Therefore, I chose to answer both following questions:</p>
<ul>
<li><p>What is the evolution of the countries that had the highest deaths-due-to-low-physical-activity rate in the past ?</p></li>
<li><p>On the other hand, what evolution led the countries that have the highest rates today, to this situation ?</p></li>
</ul>
<p>Answering this means plotting on the one hand the 10 countries that had the highest percentages in 1990 and on the other hand, those who had the highest rates in 2019.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>countries_top_percentage_2019</span> <span class='op'>&lt;-</span></span>
<span>  <span class='va'>data_alt</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Year</span> <span class='op'>==</span> <span class='fl'>2019</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice_max</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='fl'>10</span>, with_ties <span class='op'>=</span> <span class='cn'>FALSE</span>, order_by <span class='op'>=</span> <span class='va'>Percentage</span><span class='op'>)</span> <span class='op'>|&gt;</span>    </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>Entity</span><span class='op'>)</span> <span class='op'>|&gt;</span>    </span>
<span>  <span class='fu'>sf</span><span class='fu'>::</span><span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_geometry.html'>st_drop_geometry</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://purrr.tidyverse.org/reference/as_vector.html'>as_vector</a></span><span class='op'>(</span><span class='op'>)</span>  </span>
<span></span>
<span><span class='va'>countries_top_percentage_1990</span> <span class='op'>&lt;-</span></span>
<span>  <span class='va'>data_alt</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Year</span> <span class='op'>==</span> <span class='fl'>1990</span><span class='op'>)</span> <span class='op'>|&gt;</span>    </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice_max</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='fl'>10</span>, with_ties <span class='op'>=</span> <span class='cn'>FALSE</span>, order_by <span class='op'>=</span> <span class='va'>Percentage</span><span class='op'>)</span> <span class='op'>|&gt;</span>  </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>Entity</span><span class='op'>)</span> <span class='op'>|&gt;</span>    </span>
<span>  <span class='fu'>sf</span><span class='fu'>::</span><span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_geometry.html'>st_drop_geometry</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://purrr.tidyverse.org/reference/as_vector.html'>as_vector</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Slope graph of the countries which had the highest death rates in 1990.</span></span>
<span><span class='va'>p_slope_1990</span> <span class='op'>&lt;-</span>    </span>
<span>  <span class='va'>data_alt</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Entity</span> <span class='op'><a href='https://rdrr.io/pkg/arules/man/match.html'>%in%</a></span> <span class='va'>countries_top_percentage_1990</span>, <span class='va'>Year</span> <span class='op'>==</span> <span class='fl'>1990</span> <span class='op'>|</span> <span class='va'>Year</span> <span class='op'>==</span> <span class='fl'>2019</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>      x <span class='op'>=</span> <span class='va'>Year</span>, </span>
<span>      y <span class='op'>=</span> <span class='va'>Percentage</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='va'>Entity</span><span class='op'>)</span>,</span>
<span>    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='va'>Entity</span><span class='op'>)</span>,</span>
<span>    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_cartesian.html'>coord_cartesian</a></span><span class='op'>(</span></span>
<span>    xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1975</span>, <span class='fl'>2034</span><span class='op'>)</span>,</span>
<span>    ylim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>10</span>, <span class='fl'>60</span><span class='op'>)</span>,</span>
<span>    clip <span class='op'>=</span> <span class='st'>'off'</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span>     </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span>breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1990</span>, <span class='fl'>2019</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>     </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span></span>
<span>    breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span>from <span class='op'>=</span> <span class='fl'>10</span>, to <span class='op'>=</span> <span class='fl'>60</span>, by <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span>,</span>
<span>    expand <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expansion.html'>expansion</a></span><span class='op'>(</span>mult <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0.1</span><span class='op'>)</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>    title <span class='op'>=</span> <span class='st'>"The 10 countries with most deaths from low physical activity in 1990"</span>,</span>
<span>    subtitle <span class='op'>=</span> <span class='va'>plot_subtitle_alt</span>,        </span>
<span>    caption <span class='op'>=</span> <span class='va'>plot_caption</span>,        </span>
<span>    tag <span class='op'>=</span> <span class='va'>plot_tag</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_classic</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    axis.line.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    axis.line.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_line</a></span><span class='op'>(</span></span>
<span>      linetype <span class='op'>=</span> <span class='st'>'dashed'</span>,</span>
<span>      color <span class='op'>=</span> <span class='st'>'#dddddd'</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    axis.ticks.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    axis.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    axis.text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      size <span class='op'>=</span> <span class='fl'>15</span>,</span>
<span>      color <span class='op'>=</span> <span class='st'>"#5b5b5b"</span></span>
<span>    <span class='op'>)</span>,         </span>
<span>    plot.margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>r <span class='op'>=</span> <span class='fl'>50</span>,</span>
<span>                         l <span class='op'>=</span> <span class='fl'>50</span><span class='op'>)</span>,</span>
<span>    plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      family <span class='op'>=</span> <span class='st'>'merriweather'</span>,</span>
<span>      color <span class='op'>=</span> <span class='st'>'#5b5b5b'</span>,</span>
<span>      face <span class='op'>=</span> <span class='st'>'bold'</span>,</span>
<span>      size <span class='op'>=</span> <span class='fl'>18</span>,</span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0</span>,                                    </span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    plot.subtitle <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      color <span class='op'>=</span> <span class='st'>'#5b5b5b'</span>,  </span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0</span>,</span>
<span>      size <span class='op'>=</span> <span class='fl'>14</span>,</span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    plot.caption <span class='op'>=</span> <span class='fu'>ggtext</span><span class='fu'>::</span><span class='fu'><a href='https://wilkelab.org/ggtext/reference/element_markdown.html'>element_markdown</a></span><span class='op'>(</span></span>
<span>      color <span class='op'>=</span> <span class='st'>'#5b5b5b'</span>,</span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0</span>,                                                  </span>
<span>      size <span class='op'>=</span> <span class='fl'>14</span>,                                                 </span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span>,          </span>
<span>    plot.tag.position <span class='op'>=</span> <span class='st'>'bottom'</span>,</span>
<span>    plot.tag <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      color <span class='op'>=</span> <span class='st'>'#5b5b5b'</span>,</span>
<span>      size <span class='op'>=</span> <span class='fl'>13</span>,</span>
<span>      vjust <span class='op'>=</span> <span class='op'>-</span><span class='fl'>1</span>,</span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>b <span class='op'>=</span> <span class='fl'>10</span>,                                             </span>
<span>                      l <span class='op'>=</span> <span class='op'>-</span><span class='fl'>215</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span>         </span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html'>geom_text_repel</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>      label <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>Percentage</span>,<span class='fl'>1</span><span class='op'>)</span>, <span class='st'>" "</span>,<span class='va'>Entity</span><span class='op'>)</span>,                       </span>
<span>      color <span class='op'>=</span> <span class='va'>Entity</span><span class='op'>)</span>,</span>
<span>    data <span class='op'>=</span> <span class='va'>data_alt</span> <span class='op'>|&gt;</span></span>
<span>      <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Year</span> <span class='op'>==</span> <span class='fl'>2019</span><span class='op'>)</span> <span class='op'>|&gt;</span>                        </span>
<span>      <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Entity</span> <span class='op'><a href='https://rdrr.io/pkg/arules/man/match.html'>%in%</a></span> <span class='va'>countries_top_percentage_1990</span><span class='op'>)</span>,                       </span>
<span>    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span>,</span>
<span>    direction <span class='op'>=</span> <span class='st'>'y'</span>,</span>
<span>    nudge_x <span class='op'>=</span> <span class='fl'>5.5</span>,                       </span>
<span>    size <span class='op'>=</span> <span class='fl'>5</span>,</span>
<span>    hjust <span class='op'>=</span> <span class='fl'>0</span>,</span>
<span>    segment.alpha <span class='op'>=</span> <span class='fl'>1</span>,                      </span>
<span>    segment.linetype <span class='op'>=</span> <span class='st'>'dotted'</span>                      </span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html'>geom_text_repel</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>      label <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>Entity</span>, <span class='st'>" "</span>, <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>Percentage</span>,<span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>      color <span class='op'>=</span> <span class='va'>Entity</span><span class='op'>)</span>,</span>
<span>    data <span class='op'>=</span> <span class='va'>data_alt</span> <span class='op'>|&gt;</span></span>
<span>      <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Year</span> <span class='op'>==</span> <span class='fl'>1990</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>      <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Entity</span> <span class='op'><a href='https://rdrr.io/pkg/arules/man/match.html'>%in%</a></span> <span class='va'>countries_top_percentage_1990</span><span class='op'>)</span>,</span>
<span>    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span>,                      </span>
<span>    direction <span class='op'>=</span> <span class='st'>'y'</span>,</span>
<span>    nudge_x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>5.5</span>,                       </span>
<span>    size <span class='op'>=</span> <span class='fl'>5</span>,</span>
<span>    hjust <span class='op'>=</span> <span class='fl'>1</span>,</span>
<span>    segment.alpha <span class='op'>=</span> <span class='fl'>1</span>,</span>
<span>    segment.linetype <span class='op'>=</span> <span class='st'>'dotted'</span>                     </span>
<span>  <span class='op'>)</span> <span class='op'>+</span>     </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span>xintercept <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_hline</a></span><span class='op'>(</span></span>
<span>    yintercept <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span>from <span class='op'>=</span> <span class='fl'>10</span>, to <span class='op'>=</span> <span class='fl'>60</span>, by <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span>,</span>
<span>    linetype <span class='op'>=</span> <span class='st'>'dashed'</span>,</span>
<span>    color <span class='op'>=</span> <span class='st'>'#dddddd'</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='co'># Slope graph of the countries which had the highest death rates in 2019.</span></span>
<span><span class='va'>p_slope_2019</span> <span class='op'>&lt;-</span>    </span>
<span>  <span class='va'>data_alt</span> <span class='op'>|&gt;</span>      </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Entity</span> <span class='op'><a href='https://rdrr.io/pkg/arules/man/match.html'>%in%</a></span> <span class='va'>countries_top_percentage_2019</span>, <span class='va'>Year</span> <span class='op'>==</span> <span class='fl'>1990</span> <span class='op'>|</span> <span class='va'>Year</span> <span class='op'>==</span> <span class='fl'>2019</span><span class='op'>)</span> <span class='op'>|&gt;</span>  </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>    x <span class='op'>=</span> <span class='va'>Year</span>, </span>
<span>    y <span class='op'>=</span> <span class='va'>Percentage</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='va'>Entity</span><span class='op'>)</span>,</span>
<span>    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span>  </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='va'>Entity</span><span class='op'>)</span>,</span>
<span>    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_cartesian.html'>coord_cartesian</a></span><span class='op'>(</span></span>
<span>    xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1975</span>, <span class='fl'>2034</span><span class='op'>)</span>,</span>
<span>    ylim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>10</span>, <span class='fl'>60</span><span class='op'>)</span>,</span>
<span>    clip <span class='op'>=</span> <span class='st'>'off'</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span>breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1990</span>, <span class='fl'>2019</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span></span>
<span>    breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span>from <span class='op'>=</span> <span class='fl'>0</span>, to <span class='op'>=</span> <span class='fl'>60</span>, by <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span>,</span>
<span>    expand <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expansion.html'>expansion</a></span><span class='op'>(</span>mult <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0.1</span><span class='op'>)</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span></span>
<span>    title <span class='op'>=</span> <span class='st'>"The 10 countries with most deaths from low physical activity in 2019"</span>,        </span>
<span>    subtitle <span class='op'>=</span> <span class='va'>plot_subtitle_alt</span>,        </span>
<span>    caption <span class='op'>=</span> <span class='va'>plot_caption</span>,        </span>
<span>    tag <span class='op'>=</span> <span class='va'>plot_tag</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_classic</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>   </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    axis.line.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,         </span>
<span>    axis.line.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_line</a></span><span class='op'>(</span></span>
<span>      linetype <span class='op'>=</span> <span class='st'>'dashed'</span>,</span>
<span>      color <span class='op'>=</span> <span class='st'>'#dddddd'</span></span>
<span>    <span class='op'>)</span>,         </span>
<span>    axis.ticks.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    axis.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,         </span>
<span>    axis.text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>           </span>
<span>      size <span class='op'>=</span> <span class='fl'>15</span>,</span>
<span>      color <span class='op'>=</span> <span class='st'>"#5b5b5b"</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    plot.margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>r <span class='op'>=</span> <span class='fl'>50</span>,                              </span>
<span>                         l <span class='op'>=</span> <span class='fl'>50</span><span class='op'>)</span>, <span class='co'># Adjusted for making the slope plot thinner</span></span>
<span>    plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      family <span class='op'>=</span> <span class='st'>'merriweather'</span>,</span>
<span>      color <span class='op'>=</span> <span class='st'>'#5b5b5b'</span>,</span>
<span>      face <span class='op'>=</span> <span class='st'>'bold'</span>,</span>
<span>      size <span class='op'>=</span> <span class='fl'>18</span>,</span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0</span>,                                    </span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    plot.subtitle <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      color <span class='op'>=</span> <span class='st'>'#5b5b5b'</span>,                                      </span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0</span>,                                       </span>
<span>      size <span class='op'>=</span> <span class='fl'>14</span>,</span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    plot.caption <span class='op'>=</span> <span class='fu'>ggtext</span><span class='fu'>::</span><span class='fu'><a href='https://wilkelab.org/ggtext/reference/element_markdown.html'>element_markdown</a></span><span class='op'>(</span></span>
<span>      color <span class='op'>=</span> <span class='st'>'#5b5b5b'</span>,</span>
<span>      hjust <span class='op'>=</span> <span class='fl'>0</span>,                                                  </span>
<span>      size <span class='op'>=</span> <span class='fl'>14</span>,                                                 </span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    plot.tag.position <span class='op'>=</span> <span class='st'>'bottom'</span>,</span>
<span>    plot.tag <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span></span>
<span>      color <span class='op'>=</span> <span class='st'>'#5b5b5b'</span>,</span>
<span>      size <span class='op'>=</span> <span class='fl'>13</span>,</span>
<span>      vjust <span class='op'>=</span> <span class='op'>-</span><span class='fl'>1</span>,</span>
<span>      margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>b <span class='op'>=</span> <span class='fl'>10</span>,</span>
<span>                      l <span class='op'>=</span> <span class='op'>-</span><span class='fl'>215</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span>         </span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html'>geom_text_repel</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>      label <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>Percentage</span>,<span class='fl'>1</span><span class='op'>)</span>, <span class='st'>" "</span>,<span class='va'>Entity</span><span class='op'>)</span>,</span>
<span>      color <span class='op'>=</span> <span class='va'>Entity</span><span class='op'>)</span>,</span>
<span>    data <span class='op'>=</span> <span class='va'>data_alt</span> <span class='op'>|&gt;</span>  </span>
<span>      <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Year</span> <span class='op'>==</span> <span class='fl'>2019</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>      <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Entity</span> <span class='op'><a href='https://rdrr.io/pkg/arules/man/match.html'>%in%</a></span> <span class='va'>countries_top_percentage_2019</span><span class='op'>)</span>,                       </span>
<span>    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span>,                       </span>
<span>    direction <span class='op'>=</span> <span class='st'>'y'</span>,</span>
<span>    nudge_x <span class='op'>=</span> <span class='fl'>5.5</span>,                       </span>
<span>    size <span class='op'>=</span> <span class='fl'>5</span>,</span>
<span>    hjust <span class='op'>=</span> <span class='fl'>0</span>,</span>
<span>    segment.alpha <span class='op'>=</span> <span class='fl'>1</span>,</span>
<span>    segment.linetype <span class='op'>=</span> <span class='st'>'dotted'</span>                      </span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html'>geom_text_repel</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>      label <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>Entity</span>, <span class='st'>" "</span>, <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>Percentage</span>,<span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>      color <span class='op'>=</span> <span class='va'>Entity</span><span class='op'>)</span>,</span>
<span>    data <span class='op'>=</span> <span class='va'>data_alt</span> <span class='op'>|&gt;</span></span>
<span>      <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Year</span> <span class='op'>==</span> <span class='fl'>1990</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>      <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Entity</span> <span class='op'><a href='https://rdrr.io/pkg/arules/man/match.html'>%in%</a></span> <span class='va'>countries_top_percentage_2019</span><span class='op'>)</span>,                       </span>
<span>    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span>,                      </span>
<span>    direction <span class='op'>=</span> <span class='st'>'y'</span>,</span>
<span>    nudge_x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>5.5</span>,                       </span>
<span>    size <span class='op'>=</span> <span class='fl'>5</span>,</span>
<span>    hjust <span class='op'>=</span> <span class='fl'>1</span>,</span>
<span>    segment.alpha <span class='op'>=</span> <span class='fl'>1</span>,</span>
<span>    segment.linetype <span class='op'>=</span> <span class='st'>'dotted'</span>                     </span>
<span>  <span class='op'>)</span> <span class='op'>+</span>     </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span>xintercept <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_hline</a></span><span class='op'>(</span>yintercept <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span>from <span class='op'>=</span> <span class='fl'>10</span>, to <span class='op'>=</span> <span class='fl'>60</span>, by <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span>,</span>
<span>             linetype <span class='op'>=</span> <span class='st'>'dashed'</span>,</span>
<span>             color <span class='op'>=</span> <span class='st'>'#dddddd'</span></span>
<span>  <span class='op'>)</span>   </span></code></pre>
</div>
</div>
<p>I think this slope chart conveys the evolution of the mortality due to low physical activity a bit better than the line graph. To make it even clearer, I’d like to make the countries which have a downward slope blue and the ones which have an upward slope red. To do this, I’ll define a vector that will contain the color palette and manually add the assign each color to the countries.</p>
<p>In the beginning, I wanted to use <code>pivot_wider()</code> to create a column 1990 and a column 2019 that contained the Percentages of each country for these years, then use <code>mutate()</code> to create a new column equals to 2019 - 1990, and then <code>pivot_longer()</code> on both 1990 and 2019 columns to get back tidy data. However, when using the <code>pivot_wider()</code> function on the<br />
<code>data_alt</code> data set, I repetedly got the error message “Object Year can’t be found” and couldn’t get the solution to this issue.</p>
<p>Therefore, I manually pointed the upward slopes and the downward ones, and crafted the vector in a specific order to align the blue colors with downward slopes and the red ones to the upward ones.</p>
<p>An improvement that I could still do: tailor the shade of the color to the slope of the line.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>color_palette_1990</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>   </span>
<span>    <span class='st'>'#FF0000'</span>,   </span>
<span>    <span class='st'>'#001EE0'</span>,</span>
<span>    <span class='st'>'#FF3C00'</span>,</span>
<span>    <span class='st'>'#0021F5'</span>,</span>
<span>    <span class='st'>'#0A2BFF'</span>,   </span>
<span>    <span class='st'>'#1F3DFF'</span>,</span>
<span>    <span class='st'>'#334EFF'</span>,  </span>
<span>    <span class='st'>'#FF531F'</span>,</span>
<span>    <span class='st'>'#4760FF'</span>,</span>
<span>    <span class='st'>'#FF6333'</span> </span>
<span>  <span class='op'>)</span>  </span>
<span></span>
<span><span class='va'>color_palette_2019</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>   </span>
<span>    <span class='st'>'#FF0000'</span>,</span>
<span>    <span class='st'>'#FF2800'</span>,</span>
<span>    <span class='st'>'#FF3C00'</span>,</span>
<span>    <span class='st'>'#FF4F00'</span>,</span>
<span>    <span class='st'>'#FF5900'</span>,</span>
<span>    <span class='st'>'#FF6300'</span>,</span>
<span>    <span class='st'>'#FF7600'</span>,</span>
<span>    <span class='st'>'#FF8300'</span>,</span>
<span>    <span class='st'>'#FF9000'</span>,</span>
<span>    <span class='st'>'#FF9D00'</span> </span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>p_slope_1990</span> <span class='op'>&lt;-</span>   </span>
<span>  <span class='va'>p_slope_1990</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_color_manual</a></span><span class='op'>(</span></span>
<span>    breaks <span class='op'>=</span> <span class='va'>countries_top_percentage_1990</span>,                      </span>
<span>    values <span class='op'>=</span> <span class='va'>color_palette_1990</span>,                      </span>
<span>    labels <span class='op'>=</span> <span class='va'>countries_top_percentage_1990</span></span>
<span>  <span class='op'>)</span>  </span>
<span></span>
<span><span class='va'>p_slope_2019</span> <span class='op'>&lt;-</span></span>
<span>  <span class='va'>p_slope_2019</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_color_manual</a></span><span class='op'>(</span></span>
<span>    breaks <span class='op'>=</span> <span class='va'>countries_top_percentage_2019</span>,                      </span>
<span>    values <span class='op'>=</span> <span class='va'>color_palette_2019</span>,</span>
<span>    labels <span class='op'>=</span> <span class='va'>countries_top_percentage_2019</span></span>
<span>  <span class='op'>)</span>  </span>
<span></span>
<span><span class='va'>p_slope_1990</span> </span></code></pre>
</div>
<img src="100517341_files/figure-html5/unnamed-chunk-35-1.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>p_slope_2019</span>  </span></code></pre>
</div>
<p><img src="100517341_files/figure-html5/unnamed-chunk-35-2.png" width="624" /></p>
</div>
<h2 id="project-takeaways-and-what-i-learned">Project takeaways and what I learned</h2>
<p>This project was the best of the semester to be honest. It was the best because of how far it required us to push our newly acquired skills in {<code>ggplot}</code>. Actually, I really did not expect it to be that exciting. This excitment of exploring and failing then testing and finally succeeding can be seen with capital “IT WORKS” that I could have included a loooot more often in this article.</p>
<p>More seriously, at the end of the day, it might be one of the learning project that I found the most meaningful. Shoutout to Iñaki for enabling us to end the semester with much higher skills in Data.</p>
<p>My advices (For what they’re worth)</p>
<ul>
<li><p>Dig deep in documentations, everyone say it, teachers say it. Okay now I understand.<br />
I’m currently learning Python, and having discovered the importance of understanding what’s in a library and how it works it so powerful.</p></li>
<li><p>Start veeeeery soon. Unlike other projects, this one is given on the very first day of class, and that’s a huge chance to take the time to do a cool project that is interesting and valuable in my opinion Word of a dude who started in end of November and made the pull request 30 minutes before the deadline.</p></li>
<li><p>Margins are a nightmare to render. A nightmare. They never end up where I expect them to be. I guess I’m just using them poorly lol</p></li>
<li><p>Include a pie chart in your project. Be braver than us ahahaha</p></li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="reuse">Reuse</h3>
  <p>Text and figures are licensed under Creative Commons Attribution <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>. The figures that have been reused from other sources don't fall under this license and can be recognized by a note in their caption: "Figure from ...".</p>
  <h3 id="citation">Citation</h3>
  <p>For attribution, please cite this work as</p>
  <pre class="citation-appendix short">Bietrix (2024, Jan. 28). Data visualization | MSc CSS: Is the World Moving Enough?. Retrieved from https://csslab.uc3m.es/dataviz/projects/2023/100517341/</pre>
  <p>BibTeX citation</p>
  <pre class="citation-appendix long">@misc{bietrix2024is,
  author = {Bietrix, Mathieu},
  title = {Data visualization | MSc CSS: Is the World Moving Enough?},
  url = {https://csslab.uc3m.es/dataviz/projects/2023/100517341/},
  year = {2024}
}</pre>
</div>
<!--/radix_placeholder_appendices-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<!--radix_placeholder_navigation_after_body--><html><body>
<div class="distill-site-nav distill-site-footer">
<p><img src="../../../assets/acronimo_nombre1l_0.png" width="400"></p>
</div>
<!--/radix_placeholder_navigation_after_body-->
</body></html>


</body>

</html>
