<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>


  <!--radix_placeholder_meta_tags-->
<title>Data visualization | MSc CSS: Winners and losers of tax legislation changes</title>

<meta property="description" itemprop="description" content="Recreating the ABC news article Graph for MCSS Data Viz 24/25"/>

<link rel="canonical" href="https://csslab.uc3m.es/dataviz/projects/2024/100535241/"/>
<link rel="license" href="https://creativecommons.org/licenses/by/4.0/"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2025-01-16"/>
<meta property="article:created" itemprop="dateCreated" content="2025-01-16"/>
<meta name="article:author" content="Brad McKenzie"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="Data visualization | MSc CSS: Winners and losers of tax legislation changes"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="Recreating the ABC news article Graph for MCSS Data Viz 24/25"/>
<meta property="og:url" content="https://csslab.uc3m.es/dataviz/projects/2024/100535241/"/>
<meta property="og:image" content="https://csslab.uc3m.es/dataviz/projects/2024/100535241/100535241_files/figure-html5/final-legend-joinplot-1.png"/>
<meta property="og:image:width" content="2304"/>
<meta property="og:image:height" content="1536"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="Data visualization | MSc CSS"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary_large_image"/>
<meta property="twitter:title" content="Data visualization | MSc CSS: Winners and losers of tax legislation changes"/>
<meta property="twitter:description" content="Recreating the ABC news article Graph for MCSS Data Viz 24/25"/>
<meta property="twitter:url" content="https://csslab.uc3m.es/dataviz/projects/2024/100535241/"/>
<meta property="twitter:image" content="https://csslab.uc3m.es/dataviz/projects/2024/100535241/100535241_files/figure-html5/final-legend-joinplot-1.png"/>
<meta property="twitter:image:width" content="2304"/>
<meta property="twitter:image:height" content="1536"/>

<!--  https://scholar.google.com/intl/en/scholar/inclusion.html#indexing -->
<meta name="citation_title" content="Data visualization | MSc CSS: Winners and losers of tax legislation changes"/>
<meta name="citation_fulltext_html_url" content="https://csslab.uc3m.es/dataviz/projects/2024/100535241/"/>
<meta name="citation_fulltext_world_readable" content=""/>
<meta name="citation_online_date" content="2025/01/16"/>
<meta name="citation_publication_date" content="2025/01/16"/>
<meta name="citation_author" content="Brad McKenzie"/>
<!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["creative_commons","title","description","categories","author","date","output","citation_url","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["CC BY"]},{"type":"character","attributes":{},"value":["Winners and losers of tax legislation changes"]},{"type":"character","attributes":{},"value":["Recreating the ABC news article Graph for MCSS Data Viz 24/25"]},{"type":"character","attributes":{},"value":["2024"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["Brad McKenzie"]}]}]},{"type":"character","attributes":{},"value":["2025-01-16"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]}]}]},{"type":"character","attributes":{},"value":["https://csslab.uc3m.es/dataviz/projects/2024/100535241/"]},{"type":"character","attributes":{},"value":["https://csslab.uc3m.es/dataviz/projects/2024/100535241/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["100535241_files/anchor-4.2.2/anchor.min.js","100535241_files/bowser-1.9.3/bowser.min.js","100535241_files/distill-2.2.21/template.v2.js","100535241_files/figure-html5/basic_femaleplot-1.png","100535241_files/figure-html5/basic_maleplot-1.png","100535241_files/figure-html5/besswarm-1.png","100535241_files/figure-html5/develop-legend-1.png","100535241_files/figure-html5/final-legend-joinplot-1.png","100535241_files/figure-html5/first-combined-plot-1.png","100535241_files/figure-html5/log-plot-ntile-1.png","100535241_files/figure-html5/specify-female-plot2-1.png","100535241_files/figure-html5/specify-maleplot2-1.png","100535241_files/figure-html5/test-plot-1.png","100535241_files/figure-html5/violin-1.png","100535241_files/header-attrs-2.29/header-attrs.js","100535241_files/jquery-3.6.0/jquery-3.6.0.js","100535241_files/jquery-3.6.0/jquery-3.6.0.min.js","100535241_files/jquery-3.6.0/jquery-3.6.0.min.map","100535241_files/popper-2.6.0/popper.min.js","100535241_files/tippy-6.2.7/tippy-bundle.umd.min.js","100535241_files/tippy-6.2.7/tippy-light-border.css","100535241_files/tippy-6.2.7/tippy.css","100535241_files/tippy-6.2.7/tippy.umd.min.js","100535241_files/webcomponents-2.0.0/webcomponents.js","ABC_tax_income_plot.png","ts21individual15occupationsex.xlsx","ts21individual16percentiledistributionontaxableincomebysex.xlsx"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../../site_libs/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"/>
<link href="../../../site_libs/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"/>
<script src="../../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<script src="../../../site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
<script src="../../../site_libs/fuse-6.4.1/fuse.min.js"></script>

<script type="application/javascript">

function getMeta(metaName) {
  var metas = document.getElementsByTagName('meta');
  for (let i = 0; i < metas.length; i++) {
    if (metas[i].getAttribute('name') === metaName) {
      return metas[i].getAttribute('content');
    }
  }
  return '';
}

function offsetURL(url) {
  var offset = getMeta('distill:offset');
  return offset ? offset + '/' + url : url;
}

function createFuseIndex() {

  // create fuse index
  var options = {
    keys: [
      { name: 'title', weight: 20 },
      { name: 'categories', weight: 15 },
      { name: 'description', weight: 10 },
      { name: 'contents', weight: 5 },
    ],
    ignoreLocation: true,
    threshold: 0
  };
  var fuse = new window.Fuse([], options);

  // fetch the main search.json
  return fetch(offsetURL('search.json'))
    .then(function(response) {
      if (response.status == 200) {
        return response.json().then(function(json) {
          // index main articles
          json.articles.forEach(function(article) {
            fuse.add(article);
          });
          // download collections and index their articles
          return Promise.all(json.collections.map(function(collection) {
            return fetch(offsetURL(collection)).then(function(response) {
              if (response.status === 200) {
                return response.json().then(function(articles) {
                  articles.forEach(function(article) {
                    fuse.add(article);
                  });
                })
              } else {
                return Promise.reject(
                  new Error('Unexpected status from search index request: ' +
                            response.status)
                );
              }
            });
          })).then(function() {
            return fuse;
          });
        });

      } else {
        return Promise.reject(
          new Error('Unexpected status from search index request: ' +
                      response.status)
        );
      }
    });
}

window.document.addEventListener("DOMContentLoaded", function (event) {

  // get search element (bail if we don't have one)
  var searchEl = window.document.getElementById('distill-search');
  if (!searchEl)
    return;

  createFuseIndex()
    .then(function(fuse) {

      // make search box visible
      searchEl.classList.remove('hidden');

      // initialize autocomplete
      var options = {
        autoselect: true,
        hint: false,
        minLength: 2,
      };
      window.autocomplete(searchEl, options, [{
        source: function(query, callback) {
          const searchOptions = {
            isCaseSensitive: false,
            shouldSort: true,
            minMatchCharLength: 2,
            limit: 10,
          };
          var results = fuse.search(query, searchOptions);
          callback(results
            .map(function(result) { return result.item; })
          );
        },
        templates: {
          suggestion: function(suggestion) {
            var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
              ? `<img src="${offsetURL(suggestion.preview)}"</img>`
              : '';
            var html = `
              <div class="search-item">
                <h3>${suggestion.title}</h3>
                <div class="search-item-description">
                  ${suggestion.description || ''}
                </div>
                <div class="search-item-preview">
                  ${img}
                </div>
              </div>
            `;
            return html;
          }
        }
      }]).on('autocomplete:selected', function(event, suggestion) {
        window.location.href = offsetURL(suggestion.path);
      });
      // remove inline display style on autocompleter (we want to
      // manage responsive display via css)
      $('.algolia-autocomplete').css("display", "");
    })
    .catch(function(error) {
      console.log(error);
    });

});

</script>

<style type="text/css">

.nav-search {
  font-size: x-small;
}

/* Algolioa Autocomplete */

.algolia-autocomplete {
  display: inline-block;
  margin-left: 10px;
  vertical-align: sub;
  background-color: white;
  color: black;
  padding: 6px;
  padding-top: 8px;
  padding-bottom: 0;
  border-radius: 6px;
  border: 1px #0F2E3D solid;
  width: 180px;
}


@media screen and (max-width: 768px) {
  .distill-site-nav .algolia-autocomplete {
    display: none;
    visibility: hidden;
  }
  .distill-site-nav.responsive .algolia-autocomplete {
    display: inline-block;
    visibility: visible;
  }
  .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
    margin-left: 0;
    width: 400px;
    max-height: 400px;
  }
}

.algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
  width: 90%;
  outline: none;
  border: none;
}

.algolia-autocomplete .aa-hint {
  color: #999;
}
.algolia-autocomplete .aa-dropdown-menu {
  width: 550px;
  max-height: 70vh;
  overflow-x: visible;
  overflow-y: scroll;
  padding: 5px;
  margin-top: 3px;
  margin-left: -150px;
  background-color: #fff;
  border-radius: 5px;
  border: 1px solid #999;
  border-top: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
  cursor: pointer;
  padding: 5px 4px;
  border-bottom: 1px solid #eee;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
  border-bottom: none;
  margin-bottom: 2px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
  overflow: hidden;
  font-size: 0.8em;
  line-height: 1.4em;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
  font-size: 1rem;
  margin-block-start: 0;
  margin-block-end: 5px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
  display: inline-block;
  overflow: hidden;
  height: 2.8em;
  width: 80%;
  margin-right: 4%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
  display: inline-block;
  width: 15%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
  height: 3em;
  width: auto;
  display: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
  display: initial;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
  background-color: #eee;
}
.algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
  font-weight: bold;
  font-style: normal;
}

</style>


<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
  font-size: 100%;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

hr.section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  margin: 0px;
}


d-byline {
  border-top: none;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
  border-top: none;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

/* tweak for Pandoc numbered line within distill */
d-article pre.numberSource code > span {
    left: -2em;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // separator
  var separator = '<hr class="section-separator" style="clear: both"/>';
  // prepend separator above appendix
  $('.d-byline').before(separator);
  $('.d-article').before(separator);

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme, except when numbering line
  // in code chunk
  $('pre:not(.numberLines) code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      var author_name = front_matter.authors[i].author
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', author_name ? 'ORCID ID for ' + author_name : 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      const citeChild = $(this).children()[0]
      // Do not process if @xyz has been used without escaping and without bibliography activated
      // https://github.com/rstudio/distill/issues/466
      if (citeChild === undefined) return true

      if (citeChild.nodeName == "D-FOOTNOTE") {
        var fn = citeChild
        $(this).html(fn.shadowRoot.querySelector("sup"))
        $(this).id = fn.id
        fn.remove()
      }
      var refs = $(this).attr('data-cites').split(" ");
      var refHtml = refs.map(function(ref) {
        // Could use CSS.escape too here, we insure backward compatibility in navigator
        return "<p>" + $('div[id="ref-' + ref + '"]').html() + "</p>";
      }).join("\n");
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // fix footnotes in tables (#411)
    // replacing broken distill.pub feature
    $('table d-footnote').each(function() {
      // we replace internal showAtNode methode which is triggered when hovering a footnote
      this.hoverBox.showAtNode = function(node) {
        // ported from https://github.com/distillpub/template/pull/105/files
        calcOffset = function(elem) {
            let x = elem.offsetLeft;
            let y = elem.offsetTop;
            // Traverse upwards until an `absolute` element is found or `elem`
            // becomes null.
            while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                x += elem.offsetLeft;
                y += elem.offsetTop;
            }

            return { left: x, top: y };
        }
        // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
        const bbox = node.getBoundingClientRect();
        const offset = calcOffset(node);
        this.show([offset.left + bbox.width, offset.top + bbox.height]);
      }
    })

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    // ignore leaflet img layers (#106)
    figures = figures.filter(':not(img[class*="leaflet"])')
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */
</style>
<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */

@import url('https://fonts.googleapis.com/css2?family=Questrial');

html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    "Questrial", sans-serif;
  --mono-font:       monospace;
  --body-font:       "Questrial", sans-serif;
  --navbar-font:     "Questrial", sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #000e78;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #000e78;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */

@media screen and (min-width: 768px) {
  d-article aside {
    height: 0;
  }
  aside.slides {
    margin-left: -148px;
    height: auto;
  }
  aside.slides + h2 {
    white-space: nowrap;
  }
}

d-article li {
  margin-bottom: 0.1em;
}

.posts-list .post-preview .thumbnail {
  max-height: 300px;
  overflow: hidden;
}</style>
<style type="text/css">
/* base style */

/* FONT FAMILIES */

:root {
  --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

body,
.posts-list .post-preview p,
.posts-list .description p {
  font-family: var(--body-font), var(--body-default);
}

h1, h2, h3, h4, h5, h6,
.posts-list .post-preview h2,
.posts-list .description h2 {
  font-family: var(--heading-font), var(--heading-default);
}

d-article div.sourceCode code,
d-article pre code {
  font-family: var(--mono-font), var(--mono-default);
}


/*-- TITLE --*/
d-title h1,
.posts-list > h1 {
  color: var(--title-color, black);
}

d-title h1 {
  font-size: var(--title-size, 50px);
}

/*-- HEADERS --*/
d-article h1,
d-article h2,
d-article h3,
d-article h4,
d-article h5,
d-article h6 {
  color: var(--header-color, rgba(0, 0, 0, 0.8));
}

/*-- BODY --*/
d-article > p,  /* only text inside of <p> tags */
d-article > ul, /* lists */
d-article > ol {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
  font-size: var(--body-size, 1.06rem);
}


/*-- CODE --*/
d-article div.sourceCode code,
d-article pre code {
  font-size: var(--code-size, 14px);
}

/*-- ASIDE --*/
d-article aside {
  font-size: var(--aside-size, 12px);
  color: var(--aside-color, rgba(0, 0, 0, 0.6));
}

/*-- FIGURE CAPTIONS --*/
figure .caption,
figure figcaption,
.figure .caption {
  font-size: var(--fig-cap-size, 13px);
  color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
}

/*-- METADATA --*/
d-byline h3 {
  font-size: var(--heading-size, 0.6rem);
  color: var(--heading-color, rgba(0, 0, 0, 0.5));
}

d-byline {
  font-size: var(--body-size, 0.8rem);
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

d-byline a,
d-article d-byline a {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

/*-- TABLE OF CONTENTS --*/
.d-contents nav h3 {
  font-size: var(--heading-size, 18px);
}

.d-contents nav a {
  font-size: var(--contents-size, 13px);
}

/*-- APPENDIX --*/
d-appendix h3 {
  font-size: var(--heading-size, 15px);
  color: var(--heading-color, rgba(0, 0, 0, 0.65));
}

d-appendix {
  font-size: var(--text-size, 0.8em);
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

d-appendix d-footnote-list a.footnote-backlink {
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

/*-- WEBSITE HEADER + FOOTER --*/
.distill-site-header .title {
  font-size: var(--title-size, 18px);
  font-family: var(--navbar-font), var(--heading-default);
}

.distill-site-header a,
.nav-dropdown .nav-dropbtn {
  font-family: var(--navbar-font), var(--heading-default);
}

.nav-dropdown .nav-dropbtn {
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  font-size: var(--text-size, 15px);
}

.distill-site-header a:hover,
.nav-dropdown:hover .nav-dropbtn {
  color: var(--hover-color, white);
}

.distill-site-header {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer a:hover {
  color: var(--hover-color, white);
}</style>
<!--/radix_placeholder_distill-->
  <script src="../../../site_libs/header-attrs-2.29/header-attrs.js"></script>
  <script src="../../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="../../../site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="../../../site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="../../../site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="../../../site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="../../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Winners and losers of tax legislation changes","description":"Recreating the ABC news article Graph for MCSS Data Viz 24/25","authors":[{"author":"Brad McKenzie","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2025-01-16T00:00:00.000+01:00","citationText":"McKenzie, 2025"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<span class="logo">
<img src="../../../assets/acronimo_0.png"/>
</span>
<a href="../../../index.html" class="title">Data visualization | MSc CSS</a>
<input id="distill-search" class="nav-search hidden" type="text" placeholder="Search..."/>
</div>
<div class="nav-right">
<a href="../../../contents.html">Contents</a>
<a href="../../../tutorials.html">Tutorials</a>
<a href="../../../resources.html">Resources</a>
<a href="../../../projects.html">Projects</a>
<a href="https://github.com/IBiDat/dataviz" aria-label="Link to source">
<i class="fab fa-github" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Winners and losers of tax legislation changes</h1>

<!--radix_placeholder_categories-->
<div class="dt-tags">
  <a href="../../../projects.html#category:2024" class="dt-tag">2024</a>
</div>
<!--/radix_placeholder_categories-->
<p><p>Recreating the ABC news article Graph for MCSS Data Viz 24/25</p></p>
</div>

<div class="d-byline">
  
  Brad McKenzie
  
<br/>2025-01-16
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#about-the-graph" id="toc-about-the-graph">About the graph</a></li>
<li><a href="#setup" id="toc-setup">Setup</a>
<ul>
<li><a href="#load-required-packages" id="toc-load-required-packages">Load required packages</a></li>
<li><a href="#load-data" id="toc-load-data">Load data</a></li>
<li><a href="#set-parameters" id="toc-set-parameters">Set parameters</a></li>
</ul></li>
<li><a href="#data-cleaning" id="toc-data-cleaning">Data cleaning</a>
<ul>
<li><a href="#basic-plotting-to-check-variable-functionality" id="toc-basic-plotting-to-check-variable-functionality">Basic plotting to check variable functionality</a></li>
</ul></li>
<li><a href="#replication" id="toc-replication">Replication</a>
<ul>
<li><a href="#create-male-plot" id="toc-create-male-plot">Create male plot</a></li>
<li><a href="#create-basic-female-plot" id="toc-create-basic-female-plot">Create basic female plot</a></li>
<li><a href="#initial-combining-of-plots" id="toc-initial-combining-of-plots">Initial combining of plots</a></li>
<li><a href="#create-the-legend-for-the-plot" id="toc-create-the-legend-for-the-plot">Create the legend for the plot</a></li>
</ul></li>
<li><a href="#final-replication" id="toc-final-replication">Final replication</a>
<ul>
<li><a href="#compare-to-the-original" id="toc-compare-to-the-original">Compare to the original</a></li>
</ul></li>
<li><a href="#alternative-plots" id="toc-alternative-plots">Alternative plots</a>
<ul>
<li><a href="#violin-plot" id="toc-violin-plot">Violin plot</a></li>
<li><a href="#beeswarm-graph" id="toc-beeswarm-graph">Beeswarm graph</a></li>
<li><a href="#additional-option---using-percentile-data" id="toc-additional-option---using-percentile-data">Additional option - using percentile data</a></li>
</ul></li>
</ul>
</nav>
</div>
<h2 id="about-the-graph">About the graph</h2>
<p>I have recreated the following graph from <a href="https://www.abc.net.au/news/2024-02-02/biggest-winners-and-losers-of-revised-stage-3-tax-cuts/103415830">this February 2024 article by ABC news Australia</a>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:original-plot"></span>
<img src="ABC_tax_income_plot.png" alt="Original graph from ABC article" width="1280" class=external />
<p class="caption">
Figure 1: Original graph from ABC article
</p>
</div>
</div>
<p>The graph shows the median income of Australians by occupation compared to who would benefit from proposed tax changes. The graph highlights those who will benefit under the changes and those who will be worse off. To distinguish the two groups, the authors use a horizontal line from the y-axis at the benefit cutoff point, $146,486, and background shading.</p>
<p>The purpose of the graph is to highlight that most people are expected to be better off under the changes. Instead of estimating the number of people in raw terms that would benefit, the plot uses disagregated tax data by occupation and gender to display which groups are better and worse off.</p>
<p>The graph is effective because you can easily conclude that the majority of people will be better off under the changes, regardless of sex or occupation. The use of a linear y-axis to show income is effective in isolating the very high income occupations which are outliers to the data. It creates a white space which contrasts against the concentrated grouping of occupations below the cutoff point.</p>
<h2 id="setup">Setup</h2>
<p>Load packages, set global and local parameters, and read in our dataset.</p>
<h3 id="load-required-packages">Load required packages</h3>
<p>The packages are for data cleaning, graph generation, adding themes and organising subplots into the final graph.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://readxl.tidyverse.org'>readxl</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://patchwork.data-imaginist.com'>patchwork</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>grid</span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://docs.ropensci.org/magick/'>magick</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/eclarke/ggbeeswarm'>ggbeeswarm</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://wilkelab.org/cowplot/'>cowplot</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/yixuan/showtext'>showtext</a></span><span class='op'>)</span> <span class='co'># most similar font found but couldn't match exact</span></span>
<span><span class='fu'>sysfonts</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/sysfonts/man/font_add_google.html'>font_add_google</a></span><span class='op'>(</span><span class='st'>"Hind"</span>, family<span class='op'>=</span><span class='st'>"hind"</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/pkg/showtext/man/showtext_auto.html'>showtext_auto</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://allancameron.github.io/geomtextpath/'>geomtextpath</a></span><span class='op'>)</span></span></code></pre>
</div>
</div>
<h3 id="load-data">Load data</h3>
<p>Now we load the data from the <code>data.gov.au</code> page. The data comes from Table 15B of the 2020-21 Australian Tax Office individual statistics.</p>
<p>This is some of the most granular tax data available. This choice of data allows the authors to create a graph with these dimensions:</p>
<ul>
<li><p>Occupation</p></li>
<li><p>Number of employees in the occupation (shown as % of total employees on the x-axis)</p></li>
<li><p>Median income of each occupation</p></li>
<li><p>Splits by gender</p></li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'>## if reading from web</span></span>
<span><span class='co'># library(httr)</span></span>
<span><span class='co'># url &lt;- "https://data.gov.au/data/dataset/07b51b39-254a-4177-8b4c-497f17eddb80/resource/1535c9eb-8385-41af-ae65-f71b2be77d6d/download/ts21individual15occupationsex.xlsx"</span></span>
<span><span class='co'># response &lt;- GET(url)</span></span>
<span><span class='co'># file_path &lt;- tempfile(fileext = ".xlsx")</span></span>
<span><span class='co'># writeBin(content(response, "raw"), file_path)</span></span>
<span><span class='co'># </span></span>
<span><span class='co'># data &lt;- read_excel(file_path,</span></span>
<span><span class='co'>#                    sheet="Table 15B",</span></span>
<span><span class='co'>#                    skip=1) # Initial clean step to remove unused row</span></span>
<span></span>
<span></span>
<span><span class='va'>data</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://readxl.tidyverse.org/reference/read_excel.html'>read_excel</a></span><span class='op'>(</span><span class='st'>"ts21individual15occupationsex.xlsx"</span>,</span>
<span>                   sheet <span class='op'>=</span> <span class='st'>"Table 15B"</span>,</span>
<span>                   skip <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>data</span>, <span class='fl'>5</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code># A tibble: 5 × 10
  `Occupation - sub-major group1`         Occupation - unit gr…¹ Sex4 
  &lt;chr&gt;                                   &lt;chr&gt;                  &lt;chr&gt;
1 00 Occupation blank                     0000 Occupation blank  Fema…
2 00 Occupation blank                     0000 Occupation blank  Male 
3 00 Occupation blank                     0000 Occupation blank  Total
4 11 Chief executives, general managers … 1100 Manager or direc… Male 
5 11 Chief executives, general managers … 1100 Manager or direc… Total
# ℹ abbreviated name: ¹​`Occupation - unit group1`
# ℹ 7 more variables: `Individuals\r\nno.` &lt;dbl&gt;,
#   `Average taxable income2,5\r\n$` &lt;dbl&gt;,
#   `Median taxable income2,5\r\n$` &lt;dbl&gt;,
#   `Average salary or wage income5 \r\n$` &lt;dbl&gt;,
#   `Median salary or wage income5\r\n$` &lt;dbl&gt;,
#   `Average total income2,5\r\n$` &lt;dbl&gt;, …</code></pre>
</div>
<p><em>Important data consideration:</em> The original graph was published in February 2024, the ATO then revised the data in March 2024 (as seen on the data updated row of the metadata online). This has led to some variation between figures in our graph and in the actual graph I will recreate. So I am not able to create a 100% like for like replication. Spot checks have been completed and the occupation and number of employee figures appear the same. There appears to be more revisions to some median income figures however the changes are minor overall.</p>
<h3 id="set-parameters">Set parameters</h3>
<p>Define parameters that are used multiple times through the recreation. This saves us writing them out multiple times, including the income cutoff point and colours.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>benefit_cut</span> <span class='op'>&lt;-</span> <span class='fl'>146486</span> <span class='co'># Those below $146,486 benefit from the redesigned plan</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/options.html'>options</a></span><span class='op'>(</span>scipen <span class='op'>=</span> <span class='fl'>999</span><span class='op'>)</span> </span>
<span></span>
<span></span>
<span><span class='co'># colour for female purple; HEX = #a175b4 or RGB rgba(161,117,180,255)</span></span>
<span><span class='va'>colour_fem</span> <span class='op'>&lt;-</span> <span class='st'>"#a175b4"</span></span>
<span><span class='co'># colour for male blue; HEX = #ca555d or RGB rgba(202,85,93,255)</span></span>
<span><span class='va'>colour_male</span> <span class='op'>&lt;-</span> <span class='st'>"#ca555d"</span></span></code></pre>
</div>
</div>
<h2 id="data-cleaning">Data cleaning</h2>
<p>First, remove unused columns, clean column names and also filter rows to only have the groups by gender we are interested in (remove totals).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>clean_data</span> <span class='op'>&lt;-</span> <span class='va'>data</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename</a></span><span class='op'>(</span><span class='st'>"occupation"</span> <span class='op'>=</span> <span class='st'>"Occupation - unit group1"</span>,</span>
<span>         <span class='st'>"sex"</span> <span class='op'>=</span> <span class='st'>"Sex4"</span>,</span>
<span>         <span class='st'>"count"</span> <span class='op'>=</span> <span class='st'>"Individuals\r\nno."</span>,</span>
<span>         <span class='st'>"income"</span> <span class='op'>=</span> <span class='st'>"Median taxable income2,5\r\n$"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>occupation</span>, <span class='va'>sex</span>, <span class='va'>count</span>, <span class='va'>income</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>sex</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Female"</span>, <span class='st'>"Male"</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>Second, create the additional variable required, which is % of total workers in that occupation. I also create a negative income % variable for females, this is used to create the mirrored graphs by gender in later stages.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>clean_data</span> <span class='op'>&lt;-</span> <span class='va'>clean_data</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>sex</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>prop_workers_sex <span class='op'>=</span> <span class='va'>count</span><span class='op'>/</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>count</span><span class='op'>)</span>, <span class='co'># create proportion of workers variable</span></span>
<span>         income_display <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>sex</span><span class='op'>==</span><span class='st'>"Female"</span>, <span class='op'>-</span><span class='va'>prop_workers_sex</span>, <span class='va'>prop_workers_sex</span><span class='op'>)</span><span class='op'>)</span><span class='op'>|&gt;</span> <span class='co'># create negative female proportion variable</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>ungroup</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>occupation</span> <span class='op'>!=</span> <span class='st'>"0000 Occupation blank"</span><span class='op'>)</span> <span class='co'># remove unused occupation</span></span></code></pre>
</div>
</div>
<p>The authors make their calculations of total % of workers including the “0000 Occupation blank” variable, but then remove it from all of the visualisations.</p>
<h3 id="basic-plotting-to-check-variable-functionality">Basic plotting to check variable functionality</h3>
<p>Now, to check all the required variables are available, I create a very basic version of the graph to check our data completeness. Some parameters for axis are included for comparison purposes.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>basic_test_plot</span> <span class='op'>&lt;-</span> <span class='va'>clean_data</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>occupation</span> <span class='op'>!=</span> <span class='st'>"0000 Occupation blank"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>income_display</span>, y<span class='op'>=</span><span class='va'>income</span>, size<span class='op'>=</span><span class='va'>count</span> ,color<span class='op'>=</span><span class='va'>sex</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span>alpha<span class='op'>=</span><span class='fl'>0.8</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># now add split around the y axis and change the x axis to be equal, plus change the axix units</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span>name <span class='op'>=</span> <span class='st'>"Percentage of workers"</span>,</span>
<span>                     breaks<span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>0.04</span>, <span class='op'>-</span><span class='fl'>0.035</span>, <span class='op'>-</span><span class='fl'>0.03</span>, <span class='op'>-</span><span class='fl'>0.025</span>, <span class='op'>-</span><span class='fl'>0.02</span>, <span class='op'>-</span><span class='fl'>0.015</span>, <span class='op'>-</span><span class='fl'>0.01</span>, <span class='op'>-</span><span class='fl'>0.005</span>,</span>
<span>                               <span class='fl'>0</span>,</span>
<span>                               <span class='fl'>0.005</span>, <span class='fl'>0.01</span>, <span class='fl'>0.015</span>, <span class='fl'>0.02</span>, <span class='fl'>0.025</span>, <span class='fl'>0.03</span>, <span class='fl'>0.035</span>, <span class='fl'>0.04</span><span class='op'>)</span>,</span>
<span>                     minor_breaks <span class='op'>=</span> <span class='cn'>NULL</span>,</span>
<span>                     limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>0.04</span>, <span class='fl'>0.04</span><span class='op'>)</span>,</span>
<span>                     labels <span class='op'>=</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>abs</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org/reference/percent_format.html'>percent</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span> <span class='co'># apply absolute vals</span></span>
<span>  </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span>name <span class='op'>=</span> <span class='st'>"Median taxable income ($)"</span>,</span>
<span>                     breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>50000</span>, <span class='fl'>100000</span>, <span class='fl'>150000</span>, <span class='fl'>200000</span>, <span class='fl'>250000</span>,</span>
<span>                                <span class='fl'>300000</span>, <span class='fl'>350000</span>, <span class='fl'>400000</span>, <span class='fl'>450000</span>, <span class='fl'>500000</span><span class='op'>)</span>,</span>
<span>                     minor_breaks <span class='op'>=</span> <span class='cn'>NULL</span>,</span>
<span>                     limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>500000</span><span class='op'>)</span>,</span>
<span>                     labels <span class='op'>=</span> <span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org/reference/label_number.html'>label_number</a></span><span class='op'>(</span>suffix<span class='op'>=</span><span class='st'>"k"</span>, scale <span class='op'>=</span> <span class='fl'>1e-3</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_minimal</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>basic_test_plot</span></span></code></pre>
</div>
<p><img src="100535241_files/figure-html5/test-plot-1.png" width="624" style="display: block; margin: auto;" /></p>
</div>
<p>The initial plotting shows that I have all required variables for our graph.</p>
<p><em>Challenge detected:</em></p>
<p>There is one one major problem in the basic replication. <u>There are two X=0 values on the original graph with a gap without data to divide the male and female data. </u> I need to replicate this gap and double y-axis aesthetic for the replication too.</p>
<p>There is no option to do this manually within one ggplot. Instead, I will create two separate graphs (for male and female) that are manually positioned together with <code>patchwork</code> to create the mirrored effect. This mirrored presentation also means we have to create two positive X-axis graphs, however the X-axis are going in opposite directions.</p>
<p>This is a source of repetition in the next few steps to create almost identical but symmetrical plots.</p>
<h2 id="replication">Replication</h2>
<p>Primarily because I cannot impute the gap around x=0, individual graphs by gender are created. To start, I split the data by gender to work with on each graph.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>data_male</span> <span class='op'>&lt;-</span> <span class='va'>clean_data</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>sex</span> <span class='op'>==</span> <span class='st'>"Male"</span><span class='op'>)</span></span>
<span><span class='va'>data_female</span> <span class='op'>&lt;-</span> <span class='va'>clean_data</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>sex</span> <span class='op'>==</span> <span class='st'>"Female"</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<h3 id="create-male-plot">Create male plot</h3>
<p>First, create the basic male plot, these are all positive values and easier to work with.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>plot_male</span> <span class='op'>&lt;-</span> <span class='va'>data_male</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>occupation</span> <span class='op'>!=</span> <span class='st'>"0000 Occupation blank"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='va'>occupation</span><span class='op'>)</span> <span class='op'>|&gt;</span> <span class='co'># this matches the layering of plot points </span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>income_display</span>, y<span class='op'>=</span><span class='va'>income</span>, size <span class='op'>=</span> <span class='va'>prop_workers_sex</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span><span class='st'>"rect"</span>, xmin <span class='op'>=</span> <span class='op'>-</span><span class='cn'>Inf</span>, xmax <span class='op'>=</span> <span class='cn'>Inf</span>, ymin <span class='op'>=</span> <span class='op'>-</span><span class='cn'>Inf</span>, ymax <span class='op'>=</span> <span class='va'>benefit_cut</span>,</span>
<span>           fill <span class='op'>=</span> <span class='st'>"grey"</span>, alpha <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span> <span class='op'>+</span>  <span class='co'># add a background box for the benefit area</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"white"</span>, </span>
<span>             fill <span class='op'>=</span> <span class='va'>colour_male</span>, </span>
<span>             shape <span class='op'>=</span> <span class='fl'>21</span>, <span class='co'># circle with different fill and border</span></span>
<span>             alpha <span class='op'>=</span> <span class='fl'>0.85</span>,</span>
<span>             position <span class='op'>=</span> <span class='st'>"identity"</span><span class='op'>)</span><span class='op'>+</span></span>
<span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_hline</a></span><span class='op'>(</span>yintercept <span class='op'>=</span> <span class='va'>benefit_cut</span>, linetype <span class='op'>=</span> <span class='st'>'dashed'</span><span class='op'>)</span><span class='op'>+</span> <span class='co'># add cutoff line </span></span>
<span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span><span class='st'>"text"</span>, x<span class='op'>=</span><span class='fl'>0.04</span>, y<span class='op'>=</span><span class='fl'>135000</span>, <span class='co'># add label for cutoff line</span></span>
<span>           label <span class='op'>=</span> <span class='st'>"Bigger tax cut"</span>,</span>
<span>           size <span class='op'>=</span> <span class='fl'>3.3</span>,</span>
<span>           hjust <span class='op'>=</span> <span class='fl'>0.85</span>,</span>
<span>           family <span class='op'>=</span> <span class='st'>"hind"</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>y<span class='op'>=</span><span class='st'>"Median taxable income $"</span>,</span>
<span>       x<span class='op'>=</span><span class='st'>"Percentage of workers"</span><span class='op'>)</span> <span class='co'># include both of these so the labels combine with female site in patchwork join. </span></span>
<span></span>
<span><span class='va'>plot_male</span></span></code></pre>
</div>
<p><img src="100535241_files/figure-html5/basic_maleplot-1.png" width="624" style="display: block; margin: auto;" /></p>
</div>
<h4 id="specify-male-plot-axis-and-theme-settings">Specify male plot axis and theme settings</h4>
<p>Now, I update some of the presentation and layout of the male graph. This includes things such as updating the x and y axis scales, manipulating the size of the plot points, setting limits and updating different theme settings.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>plot_male2</span> <span class='op'>&lt;-</span> <span class='va'>plot_male</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># set x-axis, percentages will only show decimil point if non-zero. </span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span>n.breaks<span class='op'>=</span> <span class='fl'>9</span>,</span>
<span>                     minor_breaks <span class='op'>=</span> <span class='cn'>NULL</span>,</span>
<span>                     limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0.04</span><span class='op'>)</span>,</span>
<span>                <span class='co'>#     labels = function(x) abs(x) %&gt;% scales::percent()+</span></span>
<span>                     labels <span class='op'>=</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>100</span>, <span class='st'>"%"</span><span class='op'>)</span><span class='op'>}</span><span class='op'>)</span><span class='op'>+</span> </span>
<span>  </span>
<span>    <span class='co'># specify y-axis conditions </span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span>n.breaks <span class='op'>=</span> <span class='fl'>11</span>,</span>
<span>                     minor_breaks <span class='op'>=</span> <span class='cn'>NULL</span>,</span>
<span>                     limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>500000</span><span class='op'>)</span>,</span>
<span>                     labels <span class='op'>=</span> <span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org/reference/label_number.html'>label_number</a></span><span class='op'>(</span>suffix<span class='op'>=</span><span class='st'>"k"</span>, scale <span class='op'>=</span> <span class='fl'>1e-3</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span></span>
<span></span>
<span>  <span class='co'># set scale size for plot points (manual for consistency with female plot)</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_size.html'>scale_size</a></span><span class='op'>(</span>range <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>10</span><span class='op'>)</span>,</span>
<span>             breaks<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1000</span>, <span class='fl'>290000</span><span class='op'>)</span>,</span>
<span>             labels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"&lt;1000 individuals"</span>, <span class='st'>"290k individuals"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span></span>
<span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Male"</span><span class='op'>)</span> <span class='op'>+</span> <span class='co'># add title, then add details below for title colour and position</span></span>
<span>  </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    <span class='co'># update title, position and color</span></span>
<span>    plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>hjust <span class='op'>=</span> <span class='fl'>0.5</span>,</span>
<span>                                  color <span class='op'>=</span> <span class='va'>colour_male</span>,</span>
<span>                                  size <span class='op'>=</span> <span class='fl'>14</span>,</span>
<span>                                  family <span class='op'>=</span> <span class='st'>"sans"</span>, <span class='co'># closest font but not perfect</span></span>
<span>                                  face <span class='op'>=</span> <span class='st'>"bold"</span><span class='op'>)</span>, </span>
<span>    </span>
<span>    <span class='co'># update x axis positions and conditions</span></span>
<span>      axis.ticks.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>      axis.title.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>12</span>, family <span class='op'>=</span> <span class='st'>"hind"</span>, </span>
<span>                                  margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span><span class='op'>)</span>, <span class='co'># no X-axis label </span></span>
<span>      axis.text.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>10</span>, family <span class='op'>=</span> <span class='st'>"hind"</span>,</span>
<span>                                 margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span><span class='op'>)</span>, <span class='co'># X-axis values, move values off axis a little</span></span>
<span></span>
<span>    <span class='co'># y axis conditions</span></span>
<span>    axis.ticks.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='co'>#remove the x and y axis labels and tick marks</span></span>
<span>    axis.title.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    axis.text.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='co'># remove y axis labels to join upto female graph</span></span>
<span>        </span>
<span>    <span class='co'># general conditions </span></span>
<span>    plot.margin <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.5</span>, <span class='fl'>0.5</span>, <span class='fl'>0.5</span>, <span class='op'>-</span><span class='fl'>0.1</span><span class='op'>)</span>, <span class='st'>"cm"</span><span class='op'>)</span>,   <span class='co'>#move the graph -0.1cm to the left so it is touching the female graph when they combine in grid.arrange</span></span>
<span>    legend.position <span class='op'>=</span> <span class='st'>"none"</span>, <span class='co'># remove legend</span></span>
<span></span>
<span></span>
<span>    <span class='co'># Other visualisation conditions</span></span>
<span>    panel.background <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='st'>"white"</span><span class='op'>)</span>,</span>
<span>    panel.border <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"grey"</span>,</span>
<span>                                fill <span class='op'>=</span> <span class='cn'>NA</span>,</span>
<span>                                size <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span>,</span>
<span>    panel.grid <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_line</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"grey"</span>,</span>
<span>                              size <span class='op'>=</span> <span class='fl'>0.2</span>,</span>
<span>                              linetype <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>,</span>
<span>    axis.line.y.left <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># Ensure left border removed to match up with Female graph</span></span>
<span></span>
<span></span>
<span><span class='va'>plot_male2</span></span></code></pre>
</div>
<p><img src="100535241_files/figure-html5/specify-maleplot2-1.png" width="624" style="display: block; margin: auto;" /></p>
</div>
<h3 id="create-basic-female-plot">Create basic female plot</h3>
<p>This is similar to the initial male plot development. All of the conditions around borders, shading and axis have to be identical, so the two plots can be combined and give the impression of being a single plot.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'>### now replicate with female, minor changes</span></span>
<span><span class='va'>plot_female</span> <span class='op'>&lt;-</span> <span class='va'>data_female</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>occupation</span> <span class='op'>!=</span> <span class='st'>"0000 Occupation blank"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='va'>occupation</span><span class='op'>)</span> <span class='op'>|&gt;</span> <span class='co'>#same as male, order appearance of plots </span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>income_display</span>, y<span class='op'>=</span><span class='va'>income</span>, size<span class='op'>=</span><span class='va'>prop_workers_sex</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span><span class='st'>"rect"</span>, xmin <span class='op'>=</span> <span class='op'>-</span><span class='cn'>Inf</span>, xmax <span class='op'>=</span> <span class='cn'>Inf</span>, ymin <span class='op'>=</span> <span class='op'>-</span><span class='cn'>Inf</span>, ymax <span class='op'>=</span> <span class='va'>benefit_cut</span>,</span>
<span>           fill <span class='op'>=</span> <span class='st'>"grey"</span>, alpha <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span> <span class='op'>+</span>  <span class='co'># add a background box in for colouring the line under cutoff</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"white"</span>, fill <span class='op'>=</span> <span class='va'>colour_fem</span>, shape <span class='op'>=</span> <span class='fl'>21</span>, alpha <span class='op'>=</span> <span class='fl'>0.85</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_hline</a></span><span class='op'>(</span>yintercept <span class='op'>=</span> <span class='va'>benefit_cut</span>, linetype <span class='op'>=</span> <span class='st'>'dashed'</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span><span class='st'>"text"</span>, x<span class='op'>=</span><span class='op'>-</span><span class='fl'>0.04</span>, y<span class='op'>=</span><span class='fl'>135000</span>, </span>
<span>         label <span class='op'>=</span> <span class='st'>"Bigger tax cut"</span>,</span>
<span>         size <span class='op'>=</span> <span class='fl'>3.3</span>,</span>
<span>         hjust <span class='op'>=</span> <span class='fl'>0.15</span>,</span>
<span>         family <span class='op'>=</span> <span class='st'>"hind"</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>y<span class='op'>=</span><span class='st'>"Median taxable income $"</span>,</span>
<span>       x<span class='op'>=</span><span class='st'>"Percentage of workers"</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>plot_female</span></span></code></pre>
</div>
<p><img src="100535241_files/figure-html5/basic_femaleplot-1.png" width="624" style="display: block; margin: auto;" /></p>
</div>
<h4 id="specify-female-plot-axis-and-theme-settings">Specify female plot axis and theme settings</h4>
<p>Now I refine the left hand side plot. It is very similar to the male updates, where we add in the scale and conditions. This plot is a positive axis left of the y-axis. To create this effect, negative values are used, but their absolute values are displayed on the x-axis.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>plot_female2</span> <span class='op'>&lt;-</span> <span class='va'>plot_female</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># update labels to percentage, but this will only show the decimal point if it is non-zero</span></span>
<span>  <span class='co'># need to apply absolute vals first for label, otherwise it gives an error as the scales function returns a vector of characters for the label</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span>n.breaks<span class='op'>=</span> <span class='fl'>9</span>,</span>
<span>                     minor_breaks <span class='op'>=</span> <span class='cn'>NULL</span>,</span>
<span>                     limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>0.04</span>, <span class='fl'>0</span><span class='op'>)</span>, </span>
<span>                     labels <span class='op'>=</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>abs</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>100</span>, <span class='st'>"%"</span><span class='op'>)</span><span class='op'>}</span><span class='op'>)</span><span class='op'>+</span> </span>
<span>  </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span>n.breaks <span class='op'>=</span> <span class='fl'>11</span>,</span>
<span>                     minor_breaks <span class='op'>=</span> <span class='cn'>NULL</span>,</span>
<span>                     limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>500000</span><span class='op'>)</span>,</span>
<span>                     labels <span class='op'>=</span> <span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org/reference/label_number.html'>label_number</a></span><span class='op'>(</span>suffix<span class='op'>=</span><span class='st'>"k"</span>, scale <span class='op'>=</span> <span class='fl'>1e-3</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Female"</span><span class='op'>)</span> <span class='op'>+</span> <span class='co'># add title, then add details below for title colour and posiiton</span></span>
<span>  </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_size.html'>scale_size</a></span><span class='op'>(</span>breaks<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1000</span>, <span class='fl'>290000</span><span class='op'>)</span>,</span>
<span>             labels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"&lt;1000 individuals"</span>, <span class='st'>"290k individuals"</span><span class='op'>)</span>,</span>
<span>             range <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>14</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>        <span class='co'># title conditions, colour</span></span>
<span>        plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>hjust <span class='op'>=</span> <span class='fl'>0.5</span>,</span>
<span>                                  color <span class='op'>=</span> <span class='va'>colour_fem</span>,</span>
<span>                                  size <span class='op'>=</span> <span class='fl'>14</span>,</span>
<span>                                  family <span class='op'>=</span> <span class='st'>"sans"</span>,</span>
<span>                                  face <span class='op'>=</span> <span class='st'>"bold"</span><span class='op'>)</span>, </span>
<span>        </span>
<span>        <span class='co'># update x axis positions and conditions</span></span>
<span>      axis.ticks.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>      axis.title.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>12</span>, family <span class='op'>=</span> <span class='st'>"hind"</span>, </span>
<span>                                  margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span><span class='op'>)</span>, <span class='co'># move X-axis label </span></span>
<span>      axis.text.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>10</span>, family <span class='op'>=</span> <span class='st'>"hind"</span>,</span>
<span>                                 margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span><span class='op'>)</span>, <span class='co'># X-axis values, move values off axis a little</span></span>
<span></span>
<span></span>
<span>        <span class='co'># y-axis conditions and position, incl move further away from axis with margin</span></span>
<span>        axis.title.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>12</span>, family <span class='op'>=</span> <span class='st'>"hind"</span>, </span>
<span>                                    margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>r<span class='op'>=</span><span class='fl'>10</span><span class='op'>)</span><span class='op'>)</span>, <span class='co'># Y-axis label</span></span>
<span>        axis.text.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>10</span>, family <span class='op'>=</span> <span class='st'>"hind"</span>, </span>
<span>                                   margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>r<span class='op'>=</span><span class='fl'>10</span><span class='op'>)</span><span class='op'>)</span>, <span class='co'># Y-axis values </span></span>
<span>        axis.ticks.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='co'>#remove the x and y axis labels and tick marks</span></span>
<span></span>
<span>        </span>
<span>        <span class='co'># general conditions</span></span>
<span>        plot.margin <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.5</span>, <span class='fl'>0</span>, <span class='fl'>0.5</span>, <span class='fl'>0.5</span><span class='op'>)</span>, <span class='st'>"cm"</span><span class='op'>)</span>,</span>
<span>        legend.position <span class='op'>=</span> <span class='st'>"none"</span>, <span class='co'># Adjust left margin to overlap slightly</span></span>
<span></span>
<span></span>
<span>        <span class='co'># create border and update function for female graph - remov the right border</span></span>
<span>        panel.background <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='st'>"white"</span><span class='op'>)</span>,</span>
<span>        panel.border <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"grey"</span>,</span>
<span>                                    fill <span class='op'>=</span> <span class='cn'>NA</span>,</span>
<span>                                    size <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span>,</span>
<span>        panel.grid <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_line</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"grey"</span>,</span>
<span>                                  size <span class='op'>=</span> <span class='fl'>0.2</span>,</span>
<span>                                  linetype <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>,</span>
<span>        </span>
<span>        axis.line.y.right <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># Ensure right border is removed</span></span>
<span>          </span>
<span></span>
<span><span class='va'>plot_female2</span></span></code></pre>
</div>
<p><img src="100535241_files/figure-html5/specify-female-plot2-1.png" width="624" style="display: block; margin: auto;" /></p>
</div>
<h3 id="initial-combining-of-plots">Initial combining of plots</h3>
<p>Here, I test the join of the plots using patchwork. As our plot axis and design are built to be very similar, they do join together well. The key settings that create the impression of a single plot are:</p>
<ul>
<li><p>Use plot margin to remove gaps where the graphs will be joined (i.e. right y-axis for female graph and left hand y-axis for male plot)</p></li>
<li><p>For the female plot, we adjust the plot margin to be zero on the right hand side <code>plot_margin = unit(c(0.5, 0, 0.5, 0.5), "cm")</code></p></li>
<li><p>For males, we remove the left margin and actually make it negative to allow for the overlapping, <code>plot.margin = unit(c(0.5, 0.5, 0.5, -0.1), "cm")</code></p></li>
<li><p>The final gap removal is through setting the right hand axis tick marks to zero. Even though there is no data on the male y axis, R still leaves space for the tick marks. We remove this gap too with <code>axis.ticks.length.y = unit(0, "pt"))</code> in our combination.</p></li>
</ul>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># First test -Combine the plots without space between them and with one legend</span></span>
<span><span class='va'>combined_plot</span> <span class='op'>&lt;-</span> <span class='va'>plot_female2</span> <span class='op'>+</span> <span class='va'>plot_male2</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://patchwork.data-imaginist.com/reference/plot_layout.html'>plot_layout</a></span><span class='op'>(</span>ncol <span class='op'>=</span> <span class='fl'>2</span>, widths <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>6</span>,<span class='fl'>6</span><span class='op'>)</span>, </span>
<span>              guides <span class='op'>=</span> <span class='st'>"collect"</span>,</span>
<span>              axis_titles <span class='op'>=</span> <span class='st'>"collect"</span><span class='op'>)</span> <span class='op'>+</span> <span class='co'># to join the two x-axis labels into one</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>panel.background <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='st'>"white"</span><span class='op'>)</span>,</span>
<span>        panel.border <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"grey"</span>,</span>
<span>                                fill <span class='op'>=</span> <span class='cn'>NA</span>,</span>
<span>                                size <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span>,</span>
<span>        panel.grid <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_line</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"grey"</span>,</span>
<span>                                  size <span class='op'>=</span> <span class='fl'>0.2</span>,</span>
<span>                                  linetype <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>,</span>
<span>        <span class='co'>#axis.title.x = element_text(size = 16, family = "roboto", margin = margin(t = 10)),</span></span>
<span>        axis.ticks.length.y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='st'>"pt"</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># to remove the axis gaps on the Male y-axis</span></span>
<span></span>
<span></span>
<span><span class='va'>combined_plot</span></span></code></pre>
</div>
<p><img src="100535241_files/figure-html5/first-combined-plot-1.png" width="624" style="display: block; margin: auto;" /></p>
</div>
<p>This is getting closer to a nice replication of the original. There is one major piece missing however, the legend.</p>
<h3 id="create-the-legend-for-the-plot">Create the legend for the plot</h3>
<p>One of the biggest challenges for the replication has been the legend. The legend uses concentric circles that are outside of the plot area, have different colours to the actual plot and use specific call out labels.</p>
<p>Because of these issues, I have built the legend manually then used <code>inset_element</code> to position it with the other plots. The legend is created as a grob, saved as an image and then called back and sized and positioned. Sizing and positioning within the two other plots has been a big challenge.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Create data for concentric circles</span></span>
<span><span class='va'>circle_data</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>radius</span>, <span class='va'>npoints</span><span class='op'>=</span><span class='fl'>100</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>  <span class='va'>angles</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>2</span><span class='op'>*</span><span class='va'>pi</span>, length.out <span class='op'>=</span> <span class='va'>npoints</span><span class='op'>)</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span></span>
<span>    x <span class='op'>=</span> <span class='va'>radius</span> <span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/r/base/Trig.html'>cos</a></span><span class='op'>(</span><span class='va'>angles</span><span class='op'>)</span>,</span>
<span>    y <span class='op'>=</span> <span class='va'>radius</span> <span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/r/base/Trig.html'>sin</a></span><span class='op'>(</span><span class='va'>angles</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span><span class='op'>}</span></span>
<span></span>
<span><span class='co'># Create concentric circles data</span></span>
<span><span class='va'>circlesmall</span> <span class='op'>&lt;-</span> <span class='fu'>circle_data</span><span class='op'>(</span><span class='fl'>0.7</span><span class='op'>)</span></span>
<span><span class='va'>circlebig</span> <span class='op'>&lt;-</span> <span class='fu'>circle_data</span><span class='op'>(</span><span class='fl'>3</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Plot concentric circles with grey fill</span></span>
<span><span class='va'>concentric_plot</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_polygon.html'>geom_polygon</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>circlebig</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span>, fill <span class='op'>=</span> <span class='st'>"grey90"</span>, color <span class='op'>=</span> <span class='st'>"black"</span>, linewidth<span class='op'>=</span><span class='fl'>0.3</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_polygon.html'>geom_polygon</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>circlesmall</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span> <span class='op'>-</span> <span class='fl'>2.3</span><span class='op'>)</span>, fill <span class='op'>=</span> <span class='st'>"grey90"</span>, color <span class='op'>=</span> <span class='st'>"black"</span>, linewidth<span class='op'>=</span><span class='fl'>0.3</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/lims.html'>lims</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>,<span class='fl'>21</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span><span class='st'>"segment"</span>, <span class='co'># line for &lt;1k label</span></span>
<span>           x<span class='op'>=</span><span class='fl'>0</span>, xend <span class='op'>=</span> <span class='fl'>6</span>,</span>
<span>           y<span class='op'>=</span><span class='op'>-</span><span class='fl'>2.3</span>, yend <span class='op'>=</span> <span class='op'>-</span><span class='fl'>2.3</span>,</span>
<span>           size<span class='op'>=</span><span class='fl'>0.3</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span><span class='st'>"segment"</span>, </span>
<span>           x <span class='op'>=</span> <span class='fl'>0</span>, xend <span class='op'>=</span> <span class='fl'>6</span>, </span>
<span>         y <span class='op'>=</span> <span class='fl'>0</span>, yend <span class='op'>=</span> <span class='fl'>0</span>,</span>
<span>         size<span class='op'>=</span><span class='fl'>0.3</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span><span class='st'>"text"</span>, x <span class='op'>=</span> <span class='fl'>6.5</span>, y <span class='op'>=</span> <span class='op'>-</span><span class='fl'>2.3</span>, label <span class='op'>=</span> <span class='st'>"&lt;1k individuals"</span>, size <span class='op'>=</span> <span class='fl'>3</span>, hjust <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span><span class='st'>"text"</span>, x <span class='op'>=</span> <span class='fl'>6.5</span>, y <span class='op'>=</span> <span class='fl'>0</span>, label <span class='op'>=</span> <span class='st'>"290k individuals"</span>, size <span class='op'>=</span> <span class='fl'>3</span>, hjust <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_fixed.html'>coord_fixed</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_void</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>concentric_plot</span></span></code></pre>
</div>
<p><img src="100535241_files/figure-html5/develop-legend-1.png" width="624" style="display: block; margin: auto;" /></p>
</div>
<h2 id="final-replication">Final replication</h2>
<p>To include the legend, I re-build our combined plot with the order of 1) set female plot, 2) join on legend and position, and 3) join onto the male plot as above. The plot is layered in this way because of issues when trying to combined the to initial plots then add on the legend. When creating the combined plot first, the legend would obscure parts of the female plot. With this layering, the inset_element does not disturb the female plot.</p>
<p>This is the final version of the replication!</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>final_plot</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='co'># first layer of female plot</span></span>
<span>  <span class='va'>plot_female2</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># use inset_element to include our legend and position appropriately </span></span>
<span>  <span class='fu'><a href='https://patchwork.data-imaginist.com/reference/inset_element.html'>inset_element</a></span><span class='op'>(</span><span class='va'>concentric_plot</span>,</span>
<span>                              left<span class='op'>=</span><span class='fl'>0.01</span>,</span>
<span>                              bottom<span class='op'>=</span><span class='fl'>0.955</span>,</span>
<span>                              right<span class='op'>=</span><span class='fl'>0.4</span>,</span>
<span>                              top<span class='op'>=</span><span class='fl'>1.01</span>,</span>
<span>                              align_to<span class='op'>=</span><span class='st'>"full"</span>,</span>
<span>                              on_top <span class='op'>=</span> <span class='cn'>FALSE</span>,</span>
<span>                              clip<span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># add in our male plot with patchwork too</span></span>
<span>  <span class='va'>plot_male2</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># set the join conditions for patchwork again. These are the same as our first combined plot attempt</span></span>
<span>  <span class='fu'><a href='https://patchwork.data-imaginist.com/reference/plot_layout.html'>plot_layout</a></span><span class='op'>(</span>ncol <span class='op'>=</span> <span class='fl'>2</span>, widths <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>6</span>,<span class='fl'>6</span><span class='op'>)</span>,</span>
<span>              guides <span class='op'>=</span> <span class='st'>"collect"</span>,</span>
<span>              axis_titles <span class='op'>=</span> <span class='st'>"collect"</span><span class='op'>)</span> <span class='op'>+</span> <span class='co'># to join the two x-axis labels into one</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>panel.background <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='st'>"white"</span><span class='op'>)</span>,</span>
<span>        panel.border <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"lightgrey"</span>,</span>
<span>                                fill <span class='op'>=</span> <span class='cn'>NA</span>,</span>
<span>                                size <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span>,</span>
<span>        panel.grid <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_line</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"lightgrey"</span>,</span>
<span>                                  size <span class='op'>=</span> <span class='fl'>0.2</span>,</span>
<span>                                  linetype <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>,</span>
<span>        axis.ticks.length.y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='st'>"pt"</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># to remove the axis gaps on the Male y-axis</span></span>
<span></span>
<span><span class='va'>final_plot</span></span></code></pre>
</div>
<p><img src="100535241_files/figure-html5/final-legend-joinplot-1.png" width="1152" data-distill-preview=1 style="display: block; margin: auto;" /></p>
</div>
<h3 id="compare-to-the-original">Compare to the original</h3>
<div class="layout-chunk" data-layout="l-body-outset">
<p><img src="ABC_tax_income_plot.png" width="1280" style="display: block; margin: auto;" /></p>
</div>
<h2 id="alternative-plots">Alternative plots</h2>
<p>Here I have created alternatives of the original plot. The focus of the alternatives is conveying the message that <em>most people will be better off under the tax changes</em>. To do this, I attempted to make more simple plots with fewer dimensions. Three alternative plots have been created:</p>
<ul>
<li><p>A violin plot, to better represent the volume of occupations that will benefit at their medium income level</p></li>
<li><p>A beeswarm plot, to show a plot that still uses bubbles for occupation data, but is more clean with less overlap and a categorical x-axis (sex) instead of the initial continuous X-axis (% of workers).</p></li>
<li><p>A line plot using information on taxable income percentiles to estimate the proportion of people that will benefit rather than occupation numbers.</p></li>
</ul>
<p>With each, I have tried to include different presentation characteristics such as relabeling the text to help the reader take away key messages, however I tried to include elements from the initital plot I liked, such as the shading and colouring.</p>
<p>One of the changes I use in the alternatives is having income on a log scale. Even though the original plot uses white space effectively to show the disparity of incomes by occupation, we will use the log scale to highlight the majority of occupations are in the benefit area.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># create a new data to work with for improvements</span></span>
<span><span class='va'>improv</span> <span class='op'>&lt;-</span> <span class='va'>clean_data</span></span>
<span></span>
<span><span class='va'>improv</span> <span class='op'>&lt;-</span> <span class='va'>improv</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>benefit <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>income</span> <span class='op'>&lt;=</span> <span class='va'>benefit_cut</span>, <span class='cn'>TRUE</span>, <span class='cn'>FALSE</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<h3 id="violin-plot">Violin plot</h3>
<p>In this plot, we will only drop one dimension; number of workers by occupation. In the original plot, this % of workers shown twice, as the size of circles and the x-axis. However, neither add much value because the overall message is that most occupations are better off.</p>
<p>In this violin plot, the volume of occupations is still represented by the width of the violin. It could be considered a limitation that each occupation is weighted equally here, but individual occupations are hard to distinguish in the original, so we don’t lose any meaning here.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Create the violin plot</span></span>
<span><span class='va'>improv</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>occupation</span> <span class='op'>!=</span> <span class='st'>"0000 Occupation blank"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>sex</span>, y<span class='op'>=</span><span class='va'>income</span>, fill <span class='op'>=</span> <span class='va'>sex</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span><span class='st'>"rect"</span>, xmin <span class='op'>=</span> <span class='op'>-</span><span class='cn'>Inf</span>, xmax <span class='op'>=</span> <span class='cn'>Inf</span>, ymin <span class='op'>=</span> <span class='fl'>0</span>, ymax <span class='op'>=</span> <span class='va'>benefit_cut</span>,</span>
<span>           fill <span class='op'>=</span> <span class='st'>"green"</span>, alpha <span class='op'>=</span> <span class='fl'>0.1</span><span class='op'>)</span><span class='op'>+</span>  <span class='co'># add a background box in for colouring the pos area</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span><span class='st'>"rect"</span>, xmin <span class='op'>=</span> <span class='op'>-</span><span class='cn'>Inf</span>, xmax <span class='op'>=</span> <span class='cn'>Inf</span>, ymin <span class='op'>=</span> <span class='va'>benefit_cut</span>, ymax <span class='op'>=</span> <span class='cn'>Inf</span>,</span>
<span>           fill <span class='op'>=</span> <span class='st'>"red"</span>, alpha <span class='op'>=</span> <span class='fl'>0.1</span><span class='op'>)</span><span class='op'>+</span>  <span class='co'># add a background box in for colouring the neg area</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_violin.html'>geom_violin</a></span><span class='op'>(</span>trim<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_fill_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Female"</span> <span class='op'>=</span> <span class='va'>colour_fem</span>, <span class='st'>"Male"</span> <span class='op'>=</span> <span class='va'>colour_male</span><span class='op'>)</span>, name <span class='op'>=</span> <span class='st'>"sex"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Will you be better off under the new tax changes?"</span>,</span>
<span>       caption <span class='op'>=</span> <span class='st'>"Each occupation weighted equally, number of employees is not factored in.\n Log scale for income used."</span>,</span>
<span>       y <span class='op'>=</span> <span class='st'>"Median income ($)"</span>,</span>
<span>       x <span class='op'>=</span> <span class='st'>""</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_minimal</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>+</span> </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_hline</a></span><span class='op'>(</span>yintercept <span class='op'>=</span> <span class='va'>benefit_cut</span>, color <span class='op'>=</span> <span class='st'>"black"</span>, linetype <span class='op'>=</span> <span class='st'>"dashed"</span><span class='op'>)</span> <span class='op'>+</span> <span class='co'># Cutoff line</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span><span class='st'>"text"</span>, </span>
<span>           x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.65</span>,<span class='fl'>0.65</span><span class='op'>)</span>, </span>
<span>           y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>125000</span>,<span class='fl'>170000</span><span class='op'>)</span>,</span>
<span>           label <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Better off"</span>, <span class='st'>"Worse off"</span><span class='op'>)</span> ,</span>
<span>           color<span class='op'>=</span><span class='st'>"black"</span>,</span>
<span>           size<span class='op'>=</span><span class='fl'>4</span>,</span>
<span>           face <span class='op'>=</span> <span class='st'>"sans"</span>,</span>
<span>           fontface<span class='op'>=</span><span class='st'>"bold"</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  </span>
<span>    <span class='co'>## adding label with annotate and geom_label to point to plots</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span><span class='st'>"segment"</span>, y <span class='op'>=</span> <span class='fl'>20000</span>, yend <span class='op'>=</span> <span class='fl'>50000</span>,</span>
<span>           x <span class='op'>=</span> <span class='fl'>1.5</span>, xend <span class='op'>=</span> <span class='fl'>1</span>,</span>
<span>           colour <span class='op'>=</span> <span class='st'>"black"</span>, size<span class='op'>=</span><span class='fl'>0.75</span>, alpha<span class='op'>=</span><span class='fl'>0.5</span>,</span>
<span>           linetype <span class='op'>=</span> <span class='st'>"dotted"</span><span class='op'>)</span><span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span><span class='st'>"segment"</span>, y <span class='op'>=</span> <span class='fl'>20000</span>, yend <span class='op'>=</span> <span class='fl'>50000</span>,</span>
<span>           x <span class='op'>=</span> <span class='fl'>1.5</span>, xend <span class='op'>=</span> <span class='fl'>2</span>,</span>
<span>           colour <span class='op'>=</span> <span class='st'>"black"</span>, size<span class='op'>=</span><span class='fl'>0.75</span>, alpha<span class='op'>=</span><span class='fl'>0.5</span>,</span>
<span>           linetype <span class='op'>=</span> <span class='st'>"dotted"</span><span class='op'>)</span><span class='op'>+</span></span>
<span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_label</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fl'>1.5</span>, y <span class='op'>=</span> <span class='fl'>20000</span>, </span>
<span>                 label <span class='op'>=</span> <span class='st'>"Nearly every occupation will benefit\n at the median income level "</span><span class='op'>)</span>, fill <span class='op'>=</span> <span class='st'>"lightyellow"</span>, </span>
<span>             color <span class='op'>=</span> <span class='st'>"black"</span>, size <span class='op'>=</span> <span class='fl'>3</span>, fontface <span class='op'>=</span> <span class='st'>"bold"</span><span class='op'>)</span><span class='op'>+</span></span>
<span></span>
<span>  </span>
<span><span class='co'>#  scale_y_continuous(labels = scales::label_number(suffix="k", scale = 1e-3))+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_log10</a></span><span class='op'>(</span>labels <span class='op'>=</span> <span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org/reference/label_number.html'>label_number</a></span><span class='op'>(</span>suffix<span class='op'>=</span><span class='st'>"k"</span>, scale <span class='op'>=</span> <span class='fl'>1e-3</span><span class='op'>)</span>,</span>
<span>                n.breaks<span class='op'>=</span><span class='fl'>6</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span></span></code></pre>
</div>
<p><img src="100535241_files/figure-html5/violin-1.png" width="624" style="display: block; margin: auto;" /></p>
</div>
<h3 id="beeswarm-graph">Beeswarm graph</h3>
<p>To try and update the individual to a plot that also uses one individual plot point for each occupation, I have created a beeswarm graph. I have also re-included the number of workers as the size of the plot points here. This is to try and reduce data loss from the original plot. However only those with over 1000 workers are included to reduce clutter and overlapping, which I don’t like in the original plot around the two y-axes.</p>
<p>Further, I have updated the labels with arrows to draw the readers attention and added in other potentially relevant information.</p>
<p>Finally, I have included the overall median income by gender (<code>male = $59,415 female = $44,547</code>). Overlaying aggregate statistics allows the reader to compare between groups. While it is clear that both male and female median incomes are well under the cutoff, trends by sex are hard to identify in the original plot. This provides an easy overall comparion.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>improv_small</span> <span class='op'>&lt;-</span> <span class='va'>improv</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>occupation</span> <span class='op'>!=</span> <span class='st'>"0000 Occupation blank"</span>,</span>
<span>         <span class='va'>count</span> <span class='op'>&gt;</span> <span class='fl'>1000</span><span class='op'>)</span></span>
<span><span class='va'>male_med</span> <span class='op'>&lt;-</span> <span class='fl'>59415</span></span>
<span><span class='va'>fem_med</span> <span class='op'>&lt;-</span> <span class='fl'>44547</span></span>
<span><span class='co'>####### BEESWARM GRAPH</span></span>
<span></span>
<span><span class='co'># Basic beeswarm plot in ggplot2</span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>improv_small</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>sex</span>,</span>
<span>                         y <span class='op'>=</span> <span class='va'>income</span>,</span>
<span>                         colour <span class='op'>=</span> <span class='va'>sex</span>,</span>
<span>                         size<span class='op'>=</span><span class='va'>prop_workers_sex</span>,</span>
<span>                         <span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span><span class='st'>"rect"</span>, xmin <span class='op'>=</span> <span class='op'>-</span><span class='cn'>Inf</span>, xmax <span class='op'>=</span> <span class='cn'>Inf</span>, ymin <span class='op'>=</span> <span class='fl'>0</span>, ymax <span class='op'>=</span> <span class='va'>benefit_cut</span>,</span>
<span>           fill <span class='op'>=</span> <span class='st'>"grey"</span>, alpha <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span><span class='op'>+</span>  <span class='co'># add a background box in for colouring the pos area</span></span>
<span></span>
<span>  <span class='fu'><a href='https://rdrr.io/pkg/ggbeeswarm/man/geom_quasirandom.html'>geom_quasirandom</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Most people will be better off under the tax bracket changes"</span>,</span>
<span>       caption <span class='op'>=</span> <span class='st'>"Only includes occupations with over 1000 workers by gender"</span>,</span>
<span>       x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>       y <span class='op'>=</span> <span class='st'>"Median income $"</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_color_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Female"</span> <span class='op'>=</span> <span class='va'>colour_fem</span>, <span class='st'>"Male"</span> <span class='op'>=</span> <span class='va'>colour_male</span><span class='op'>)</span>, name <span class='op'>=</span> <span class='st'>"sex"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_minimal</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>+</span> </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>axis.text.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>14</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># add cutoff line and label</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_hline</a></span><span class='op'>(</span>yintercept <span class='op'>=</span> <span class='va'>benefit_cut</span>, color <span class='op'>=</span> <span class='st'>"black"</span>, linetype <span class='op'>=</span> <span class='st'>"dashed"</span><span class='op'>)</span> <span class='op'>+</span> <span class='co'># Cutoff line</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span><span class='st'>"text"</span>, x<span class='op'>=</span><span class='fl'>0.6</span>, y<span class='op'>=</span><span class='fl'>135000</span>, <span class='co'># add label for cutoff line</span></span>
<span>           label <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Cutoff: $"</span>,<span class='va'>benefit_cut</span><span class='op'>)</span>,</span>
<span>           size <span class='op'>=</span> <span class='fl'>3.3</span>,</span>
<span>           hjust <span class='op'>=</span> <span class='fl'>0.35</span>,</span>
<span>           family <span class='op'>=</span> <span class='st'>"sans"</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># add labels for the median income by gender</span></span>
<span>  <span class='fu'><a href='https://allancameron.github.io/geomtextpath/reference/geom_textsegment.html'>geom_labelsegment</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='fl'>0.6</span>, xend<span class='op'>=</span><span class='fl'>1.4</span>, y<span class='op'>=</span><span class='va'>fem_med</span>, yend<span class='op'>=</span><span class='va'>fem_med</span>,</span>
<span>                    label <span class='op'>=</span> <span class='st'>"Median = $44,547"</span><span class='op'>)</span>, fill <span class='op'>=</span> <span class='st'>"lightyellow"</span>, size<span class='op'>=</span><span class='fl'>3</span>,</span>
<span>                    inherit.aes <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span><span class='op'>+</span></span>
<span></span>
<span>  <span class='fu'><a href='https://allancameron.github.io/geomtextpath/reference/geom_textsegment.html'>geom_labelsegment</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='fl'>1.6</span>, xend<span class='op'>=</span><span class='fl'>2.4</span>, y<span class='op'>=</span><span class='va'>male_med</span>, yend<span class='op'>=</span><span class='va'>male_med</span>,</span>
<span>                    label <span class='op'>=</span> <span class='st'>"Median = $59,415"</span><span class='op'>)</span>, fill <span class='op'>=</span> <span class='st'>"lightyellow"</span>,size <span class='op'>=</span> <span class='fl'>3</span>,</span>
<span>                    inherit.aes <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># add directional arrows and labels for axis</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>    <span class='st'>"textsegment"</span>,</span>
<span>    x <span class='op'>=</span> <span class='fl'>0.5</span>, xend <span class='op'>=</span> <span class='fl'>0.5</span>, yend <span class='op'>=</span> <span class='va'>benefit_cut</span><span class='op'>-</span><span class='fl'>25000</span>, y <span class='op'>=</span> <span class='fl'>25000</span>,</span>
<span>    label <span class='op'>=</span> <span class='st'>"Better off"</span>, size<span class='op'>=</span><span class='fl'>3</span>, </span>
<span>    angle <span class='op'>=</span> <span class='fl'>180</span>,</span>
<span>    arrow <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/arrow.html'>arrow</a></span><span class='op'>(</span>length <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>0.05</span>, <span class='st'>"inches"</span><span class='op'>)</span>, type<span class='op'>=</span><span class='st'>"closed"</span>, </span>
<span>                  ends <span class='op'>=</span> <span class='st'>"first"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span> </span>
<span>  </span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>    <span class='st'>"textsegment"</span>,</span>
<span>    x <span class='op'>=</span> <span class='fl'>0.5</span>, xend <span class='op'>=</span> <span class='fl'>0.5</span>, y <span class='op'>=</span> <span class='va'>benefit_cut</span> <span class='op'>+</span> <span class='fl'>20000</span>, yend <span class='op'>=</span> <span class='fl'>480000</span>,</span>
<span>    label <span class='op'>=</span> <span class='st'>"Worse off"</span>, size<span class='op'>=</span><span class='fl'>3</span>, </span>
<span>    arrow <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/arrow.html'>arrow</a></span><span class='op'>(</span>length <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>0.05</span>, <span class='st'>"inches"</span><span class='op'>)</span>, type<span class='op'>=</span><span class='st'>"closed"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span></span>
<span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_log10</a></span><span class='op'>(</span>labels <span class='op'>=</span> <span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org/reference/label_number.html'>label_number</a></span><span class='op'>(</span>suffix<span class='op'>=</span><span class='st'>"k"</span>, scale <span class='op'>=</span> <span class='fl'>1e-3</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span></span></code></pre>
</div>
<p><img src="100535241_files/figure-html5/besswarm-1.png" width="624" style="display: block; margin: auto;" /></p>
</div>
<h3 id="additional-option---using-percentile-data">Additional option - using percentile data</h3>
<p>The primary purpose of this data is to show that most people are better off under the changes rather than worse off. The ideal plot to convey the message would be showing a ridge or density plot of each individual’s income level and have that compared to the benefit cutoff line. We cannot access data this granular. But using slightly different data, we can try to convey this message more clearly.</p>
<p>By incorporating slightly different tax data, we can view individual tax data by median taxable income, gender and percentile of income. This data is available in table 16B of the individual tax statistics, where our original data is from 15B.</p>
<p>First, we read in the new data table and do basic cleaning:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'>### read in table 16B first</span></span>
<span>    <span class='co'># url &lt;- "https://data.gov.au/data/dataset/07b51b39-254a-4177-8b4c-497f17eddb80/resource/d902104e-a9c1-4d14-8d21-f4538bda037a/download/ts21individual16percentiledistributionontaxableincomebysex.xlsx"</span></span>
<span>    <span class='co'># response &lt;- GET(url)</span></span>
<span>    <span class='co'># file_path &lt;- tempfile(fileext = ".xlsx")</span></span>
<span>    <span class='co'># writeBin(content(response, "raw"), file_path)</span></span>
<span>    <span class='co'># </span></span>
<span>    <span class='co'># data &lt;- read_excel(file_path,</span></span>
<span>    <span class='co'>#                    sheet="Table 16B",</span></span>
<span>    <span class='co'>#                    skip=1)</span></span>
<span>    <span class='co'># </span></span>
<span>    <span class='co'># percentile_counts &lt;- read_excel(file_path,</span></span>
<span>    <span class='co'>#            sheet="Table 16A",</span></span>
<span>    <span class='co'>#            skip=1)</span></span>
<span></span>
<span><span class='co'>#read from file:</span></span>
<span><span class='va'>data</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://readxl.tidyverse.org/reference/read_excel.html'>read_excel</a></span><span class='op'>(</span><span class='st'>"ts21individual16percentiledistributionontaxableincomebysex.xlsx"</span>,</span>
<span>                   sheet<span class='op'>=</span><span class='st'>"Table 16B"</span>,</span>
<span>                   skip<span class='op'>=</span><span class='fl'>1</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>percentile_counts</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://readxl.tidyverse.org/reference/read_excel.html'>read_excel</a></span><span class='op'>(</span><span class='st'>"ts21individual16percentiledistributionontaxableincomebysex.xlsx"</span>,</span>
<span>           sheet<span class='op'>=</span><span class='st'>"Table 16A"</span>,</span>
<span>           skip<span class='op'>=</span><span class='fl'>1</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>data</span> <span class='op'>&lt;-</span> <span class='va'>data</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Statistic3</span> <span class='op'>==</span> <span class='st'>"Median"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename</a></span><span class='op'>(</span><span class='st'>"Range"</span> <span class='op'>=</span> <span class='st'>"Ranged Taxable Income"</span>,</span>
<span>         <span class='st'>"Income"</span> <span class='op'>=</span> <span class='st'>"Taxable income or loss \r\n$"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>Percentile</span>, <span class='va'>Sex</span>, <span class='va'>Range</span>, <span class='va'>Income</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>percentile_counts</span> <span class='op'>&lt;-</span> <span class='va'>percentile_counts</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename</a></span><span class='op'>(</span><span class='st'>"Count"</span> <span class='op'>=</span> <span class='st'>"Individuals \r\nno."</span>,</span>
<span>         <span class='st'>"Range"</span> <span class='op'>=</span> <span class='st'>"Ranged Taxable Income"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>Percentile</span>, <span class='va'>Range</span>, <span class='va'>Sex</span>, <span class='va'>Count</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># join on the number of workers</span></span>
<span><span class='va'>data</span> <span class='op'>&lt;-</span> <span class='va'>data</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>percentile_counts</span>, by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Percentile"</span>, <span class='st'>"Range"</span>, <span class='st'>"Sex"</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>data</span><span class='op'>$</span><span class='va'>benefit</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>data</span><span class='op'>$</span><span class='va'>Income</span><span class='op'>&lt;</span><span class='va'>benefit_cut</span>, <span class='cn'>TRUE</span>, <span class='cn'>FALSE</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># create actual % value to show the distribution of male and female</span></span>
<span><span class='va'>data</span> <span class='op'>&lt;-</span> <span class='va'>data</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>Sex</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='va'>Percentile</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>prop_Sex <span class='op'>=</span> <span class='va'>Count</span><span class='op'>/</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>Count</span><span class='op'>)</span><span class='op'>*</span><span class='fl'>100</span>,</span>
<span>         cumul_count <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/cumsum.html'>cumsum</a></span><span class='op'>(</span><span class='va'>Count</span><span class='op'>)</span>,</span>
<span>         total <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>Count</span><span class='op'>)</span>,</span>
<span>         new_ntile <span class='op'>=</span> <span class='va'>cumul_count</span> <span class='op'>/</span> <span class='va'>total</span> <span class='op'>*</span> <span class='fl'>100</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>data</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code># A tibble: 6 × 10
# Groups:   Sex [2]
  Percentile Sex    Range    Income Count benefit prop_Sex cumul_count
       &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;lgl&gt;      &lt;dbl&gt;       &lt;dbl&gt;
1          1 Female $23,629…  22887 60650 TRUE       1.10        60650
2          1 Male   $23,629…  18164 56406 TRUE       0.911       56406
3          2 Female $23,630…  24089 65518 TRUE       1.19       126168
4          2 Male   $23,630…  24090 51508 TRUE       0.832      107914
5          3 Female $24,557…  25011 65241 TRUE       1.18       191409
6          3 Male   $24,557…  25012 51748 TRUE       0.836      159662
# ℹ 2 more variables: total &lt;dbl&gt;, new_ntile &lt;dbl&gt;</code></pre>
</div>
<p>We then create a graph of log income compared to the median income at each percentile</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>data</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>y<span class='op'>=</span><span class='va'>Income</span>, x<span class='op'>=</span><span class='va'>new_ntile</span>, colour <span class='op'>=</span> <span class='va'>Sex</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span><span class='st'>"rect"</span>, xmin <span class='op'>=</span> <span class='op'>-</span><span class='cn'>Inf</span>, xmax <span class='op'>=</span> <span class='cn'>Inf</span>, ymin <span class='op'>=</span> <span class='fl'>0</span>, ymax <span class='op'>=</span> <span class='va'>benefit_cut</span>,</span>
<span>         fill <span class='op'>=</span> <span class='st'>"grey"</span>, alpha <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span> <span class='op'>+</span>  <span class='co'># add a background box in for colouring the</span></span>
<span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span>size<span class='op'>=</span><span class='fl'>2</span>, show.legend <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Most people benefit from the income tax changes"</span>,</span>
<span>       caption <span class='op'>=</span> <span class='st'>"Note: Log scale used for income"</span>,</span>
<span>       y <span class='op'>=</span> <span class='st'>"Median income ($)"</span>,</span>
<span>       x <span class='op'>=</span> <span class='st'>"Proportion of workers (%)"</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  </span>
<span>  <span class='fu'><a href='https://wilkelab.org/cowplot/reference/theme_minimal_grid.html'>theme_minimal_grid</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>axis.ticks.x<span class='op'>=</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>      axis.ticks.y<span class='op'>=</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>      axis.title.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>12</span><span class='op'>)</span>, <span class='co'># reduce y and x axis label size </span></span>
<span>      axis.title.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>12</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> <span class='co'># Adjust y-axis label </span></span>
<span></span>
<span>  <span class='co'># create a log scale on the y-axis</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_log10</a></span><span class='op'>(</span>n.breaks <span class='op'>=</span><span class='fl'>5</span>, </span>
<span>                labels <span class='op'>=</span> <span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org/reference/label_number.html'>label_number</a></span><span class='op'>(</span>suffix<span class='op'>=</span><span class='st'>"k"</span>, scale <span class='op'>=</span> <span class='fl'>1e-3</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span>breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>50</span>,<span class='fl'>100</span><span class='op'>)</span>, </span>
<span>                     expand <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>0.5</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span> <span class='co'>#to avoid x-axis label cutoff</span></span>
<span>  </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_colour_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Female"</span> <span class='op'>=</span> <span class='va'>colour_fem</span>, <span class='st'>"Male"</span> <span class='op'>=</span> <span class='va'>colour_male</span><span class='op'>)</span>, name <span class='op'>=</span> <span class='st'>"Sex"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_hline</a></span><span class='op'>(</span>yintercept <span class='op'>=</span> <span class='va'>benefit_cut</span>, colour<span class='op'>=</span><span class='st'>"black"</span>, linetype<span class='op'>=</span><span class='st'>"dashed"</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'>## adding female labels with geom_curve and geom_label</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span><span class='st'>"segment"</span>, y <span class='op'>=</span> <span class='fl'>40000</span>, yend <span class='op'>=</span> <span class='va'>benefit_cut</span>,</span>
<span>           x <span class='op'>=</span> <span class='fl'>85</span>, xend <span class='op'>=</span> <span class='fl'>95</span>,</span>
<span>           colour <span class='op'>=</span> <span class='va'>colour_fem</span>, size<span class='op'>=</span><span class='fl'>0.75</span>, alpha<span class='op'>=</span><span class='fl'>1</span>,</span>
<span>           linetype <span class='op'>=</span> <span class='st'>"dotted"</span><span class='op'>)</span><span class='op'>+</span></span>
<span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_label</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fl'>80</span>, y <span class='op'>=</span> <span class='fl'>42000</span>, </span>
<span>                 label <span class='op'>=</span> <span class='st'>"Better for 95% \n of females"</span><span class='op'>)</span>, fill <span class='op'>=</span> <span class='st'>"lightyellow"</span>, </span>
<span>             color <span class='op'>=</span> <span class='va'>colour_fem</span>, size <span class='op'>=</span> <span class='fl'>3</span>, fontface <span class='op'>=</span> <span class='st'>"bold"</span><span class='op'>)</span><span class='op'>+</span></span>
<span></span>
<span>  </span>
<span>  <span class='co'>## adding male labels with annotate and geom_label</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span><span class='st'>"segment"</span>, y <span class='op'>=</span> <span class='fl'>300000</span>, yend <span class='op'>=</span> <span class='va'>benefit_cut</span>,</span>
<span>           x <span class='op'>=</span> <span class='fl'>75</span>, xend <span class='op'>=</span> <span class='fl'>88</span>,</span>
<span>           colour <span class='op'>=</span> <span class='va'>colour_male</span>, size<span class='op'>=</span><span class='fl'>0.75</span>, alpha<span class='op'>=</span><span class='fl'>1</span>,</span>
<span>           linetype <span class='op'>=</span> <span class='st'>"dotted"</span><span class='op'>)</span><span class='op'>+</span></span>
<span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_label</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fl'>70</span>, y <span class='op'>=</span> <span class='fl'>320000</span>, </span>
<span>                 label <span class='op'>=</span> <span class='st'>"Better for 88% \n of males"</span><span class='op'>)</span>, fill <span class='op'>=</span> <span class='st'>"lightyellow"</span>, </span>
<span>             color <span class='op'>=</span> <span class='va'>colour_male</span>, size <span class='op'>=</span> <span class='fl'>3</span>, fontface <span class='op'>=</span> <span class='st'>"bold"</span><span class='op'>)</span><span class='op'>+</span></span>
<span></span>
<span>  <span class='co'># create manual coloured text labels for clea</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span><span class='st'>"text"</span>,</span>
<span>           y<span class='op'>=</span><span class='fl'>75000</span>, x<span class='op'>=</span> <span class='fl'>40</span>,</span>
<span>           label <span class='op'>=</span> <span class='st'>"Male"</span>,</span>
<span>           color<span class='op'>=</span><span class='va'>colour_male</span>,</span>
<span>           face <span class='op'>=</span> <span class='st'>"sans"</span>, fontface <span class='op'>=</span> <span class='st'>"bold"</span>,</span>
<span>           size <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span><span class='st'>"text"</span>,</span>
<span>           y<span class='op'>=</span><span class='fl'>40000</span>, x<span class='op'>=</span> <span class='fl'>41</span>,</span>
<span>           label <span class='op'>=</span> <span class='st'>"Female"</span>,</span>
<span>           color<span class='op'>=</span><span class='va'>colour_fem</span>,</span>
<span>           face <span class='op'>=</span> <span class='st'>"sans"</span>, fontface <span class='op'>=</span> <span class='st'>"bold"</span>,</span>
<span>           size <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># create label for cutoff point and arrow </span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span><span class='st'>"text"</span>,</span>
<span>           y<span class='op'>=</span><span class='fl'>300000</span>, x<span class='op'>=</span> <span class='fl'>30</span>,</span>
<span>           label <span class='op'>=</span> <span class='st'>"Everyone earning under $146,486\n per year will be better off"</span>,</span>
<span>           color<span class='op'>=</span><span class='st'>"black"</span>,</span>
<span>           size <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span><span class='op'>+</span></span>
<span>   <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_segment.html'>geom_curve</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fl'>15</span>, y <span class='op'>=</span> <span class='fl'>270000</span>, xend <span class='op'>=</span> <span class='fl'>13</span>, yend <span class='op'>=</span> <span class='va'>benefit_cut</span><span class='op'>)</span>,</span>
<span>                  colour <span class='op'>=</span> <span class='st'>"black"</span>,</span>
<span>              arrow <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/arrow.html'>arrow</a></span><span class='op'>(</span>length <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>0.03</span>, <span class='st'>"npc"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
<p><img src="100535241_files/figure-html5/log-plot-ntile-1.png" width="624" style="display: block; margin: auto;" /></p>
</div>
<p>From this graph, a better estimate of the impacted population can be made. This proportion of people measure is more tangible than the count of occupations by size. I have included this as the final option as it is the one that allows the reader most quickly realise they are likely to benefit.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="reuse">Reuse</h3>
  <p>Text and figures are licensed under Creative Commons Attribution <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>. The figures that have been reused from other sources don't fall under this license and can be recognized by a note in their caption: "Figure from ...".</p>
  <h3 id="citation">Citation</h3>
  <p>For attribution, please cite this work as</p>
  <pre class="citation-appendix short">McKenzie (2025, Jan. 16). Data visualization | MSc CSS: Winners and losers of tax legislation changes. Retrieved from https://csslab.uc3m.es/dataviz/projects/2024/100535241/</pre>
  <p>BibTeX citation</p>
  <pre class="citation-appendix long">@misc{mckenzie2025winners,
  author = {McKenzie, Brad},
  title = {Data visualization | MSc CSS: Winners and losers of tax legislation changes},
  url = {https://csslab.uc3m.es/dataviz/projects/2024/100535241/},
  year = {2025}
}</pre>
</div>
<!--/radix_placeholder_appendices-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<!--radix_placeholder_navigation_after_body--><html><body>
<div class="distill-site-nav distill-site-footer">
<p><img src="../../../assets/acronimo_nombre1l_0.png" width="400"></p>
</div>
<!--/radix_placeholder_navigation_after_body-->
</body></html>


</body>

</html>
