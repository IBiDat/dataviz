---
title: "Fertility Rates 2024 World Map"
description: |
  A short description of the post.
author: Jos√© Manuel Eyzaguirre Venegas
date: 2025-12-23
output:
  distill::distill_article:
    self_contained: false
    toc: true
---

Distill is a publication format for scientific and technical writing, native to the web.

Learn more about using Distill at <https://rstudio.github.io/distill>.



## Original Map we want to replicate


```{r}
knitr::include_graphics("og_graph.webp")
```



## We load the libraries used for the project.


```{r}
## Load libraries
library(sf)
library(rnaturalearth)
library(rnaturalearthdata)
library(ggplot2)
library(tidyverse)
library(cowplot)
library(stringr)
library(showtext)
library(sysfonts)
library(ggchicklet)
library(ggtext)
```


## Data manipulation


```{r}

##Import the worldwide map with rnaturalearth package
world <- ne_countries(scale = "medium", returnclass = "sf")

geo_world <- world |>
  select(geounit, iso3 = iso_a3) |>
  mutate(
    iso3 = case_when(
      geounit == "Kosovo" ~ "XKX",
      geounit == "France" ~ "FRA",
      geounit == "Norway" ~ "NOR",
      TRUE ~ iso3
    )
  )

## We import the csv with the UN Ferlity Rates data for 2024
fertility_rate <- read_csv("data/un_fertility_rates.csv")

fertility_rate_2024 <- fertility_rate |>
  filter(Time == 2024) |>
  select(Location, iso3 = Iso3, Value)

## We melt both geospatial data with the UN data
db <- geo_world |>
  left_join(fertility_rate_2024, by ="iso3") |>
  select(country = geounit, iso3, value = Value, geometry) |>
  filter(iso3 != "ATA") |>
  mutate(value = round(value, 2))

## ISO codes for countries to be labeled on the map
iso_map_plot <- c(
  "AFG", "DZA", "AGO", "ARG", "AUS", "BOL", "BWA", "BRA", "CAN", "CAF", 
  "TCD", "CHL", "CHN", "COL", "CUB", "COD", "DNK", "ECU", "EGY", "FIN", 
  "FRA", "DEU", "IND", "IDN", "IRN", "IRL", "JPN", "KAZ", "KEN", "LBY", 
  "MDG", "MYS", "MLI", "MRT", "MEX", "MNG", "MAR", "MOZ", "MMR", "NAM", 
  "NZL", "NER", "NGA", "NOR", "PAK", "PNG", "PRY", "PER", "PHL", "PRT", 
  "RUS", "SAU", "SGP", "SOM", "ZAF", "KOR", "ESP", "LKA", "SDN", "SWE", 
  "TWN", "TZA", "THA", "UKR", "GBR", "USA", "URY", "VEN", "VNM", "YEM", 
  "ZWE"
)

## Final arrangements
db <- db |> 
  mutate(
    show_label = iso3 %in% iso_map_plot,
    .after = value
  ) |>
  mutate(
    country = case_when(
      country == "United States of America" ~ "USA",
      country == "Democratic Republic of the Congo" ~ "DR Congo",
      country == "Central African Republic" ~ "C.A.R",
      country == "United Kingdom" ~ "UK",
      TRUE ~ country
    )
  )
```

## Manual allocation of labels system


```{r}
## Manual label positions
manual_positions <- tibble::tribble(
  ~iso3,  ~lon,    ~lat,    ~label_size, ~label_color, ~value_color, ~label_offset,
  
  # America
  "MEX",  -110,    16,      7,           "black",      "black",      200000,
  "USA",  -100,    40,      7,           "black",      "black",      200000,
  "CAN",  -110,    60,      7,           "black",      "black",      200000,
  "CUB",  -68,     26,      7,           "black",      "black",      200000,
  "COL",  -88,     5,       7,           "black",      "black",      200000,
  "VEN",  -53,     12,      7,           "black",      "black",      200000,
  "ECU",  -87,     -5,      7,           "black",      "black",      200000,
  "PER",  -82,     -14,     7,           "black",      "black",      200000,
  "BRA",  -53,     -10,     7,           "black",      "black",      200000,
  "BOL",  -81,     -22,     7,           "black",      "black",      200000,
  "PRY",  -40,     -27,     7,           "black",      "black",      200000,
  "CHL",  -80,     -35,     7,           "black",      "black",      200000,
  "ARG",  -50,     -42,     7,           "black",      "black",      200000,
  "URY",  -44,     -34,     7,           "black",      "black",      200000,
  
  # Europe
  "IRL",  -30,     58,      7,           "black",      "black",      200000,
  "GBR",  -17,     58,      7,           "black",      "black",      200000,
  "PRT",  -28,     40,      7,           "black",      "black",      200000,
  "ESP",  -16,     40,      7,           "black",      "black",      200000,
  "FRA",  -12,     48,      7,           "black",      "black",      200000,
  "DEU",  -6,      66,      6,           "black",      "black",      175000,
  "DNK",  -4,      74,      6,           "black",      "black",      175000,
  "NOR",  3,       83,      6,           "black",      "black",      175000,
  "SWE",  34,      77,      6,           "black",      "black",      175000,
  "FIN",  40,      61,      5,           "black",      "black",      150000,
  "UKR",  42,      55,      5,           "black",      "black",      150000,
  "RUS",  100,     62,      7,           "black",      "black",      200000,
  
  # Africa
  "MAR",  -20,     32,      7,           "black",      "black",      200000,
  "DZA",  3,       28,      6,           "black",      "black",      175000,
  "LBY",  18,      27,      5,           "black",      "black",      150000,
  "EGY",  30,      27,      4,           "black",      "black",      125000,
  "MRT",  -24,     22,      7,           "black",      "black",      200000,
  "MLI",  -22,     10,      7,           "black",      "black",      200000,
  "NER",  -11,     1,       7,           "black",      "black",      200000,
  "TCD",  19,      14,      5,           "#FFFDF5",    "#FFFDF5",    150000,
  "SDN",  30,      16,      5,           "black",      "black",      150000,
  "NGA",  1,       -1,      7,           "black",      "black",      200000,
  "CAF",  20,      6,       4,           "#FFFDF5",    "#FFFDF5",    125000,
  "COD",  24,      -3,      4,           "#FFFDF5",    "#FFFDF5",    150000,
  "AGO",  5,       -12,     7,           "black",      "black",      200000,
  "TZA",  57,      -8,      6,           "black",      "black",      175000,
  "KEN",  51,      0,       6,           "black",      "black",      175000,
  "SOM",  58,      6,       6,           "black",      "black",      175000,
  "NAM",  6,       -22,     7,           "black",      "black",      200000,
  "BWA",  8,       -30,     7,           "black",      "black",      200000,
  "ZWE",  40,      -30,     6,           "black",      "black",      175000,
  "MOZ",  60,      -15,     6,           "black",      "black",      175000,
  "ZAF",  29,      -38,     7,           "black",      "black",      200000,
  "MDG",  58,      -26,     6,           "black",      "black",      175000,
  
  # Asia and Middle East
  "SAU",  44,      24,      5,           "black",      "black",      150000,
  "YEM",  56,      14,      5,           "black",      "black",      150000,
  "IRN",  54,      33,      5,           "black",      "black",      150000,
  "AFG",  66,      34,      4,           "black",      "black",      125000,
  "PAK",  66,      18,      5,           "black",      "black",      150000,
  "IND",  79,      22,      6,           "black",      "black",      175000,
  "LKA",  74,      2,       7,           "black",      "black",      200000,
  "KAZ",  67,      48,      5,           "black",      "black",      150000,
  "MNG",  104,     46,      5,           "black",      "black",      150000,
  "CHN",  104,     35,      7,           "black",      "black",      200000,
  "MMR",  105,     27,      5,           "black",      "black",      150000,
  "THA",  89,      8,       6,           "black",      "black",      175000,
  "VNM",  114,     14,      5,           "black",      "black",      150000,
  "MYS",  90,      -3,      7,           "black",      "black",      200000,
  "SGP",  94,      -12,     7,           "black",      "black",      200000,
  "IDN",  112,     -14,     7,           "black",      "black",      200000,
  "PHL",  135,     12,      7,           "black",      "black",      200000,
  "TWN",  135,     22,      7,           "black",      "black",      200000,
  "KOR",  146,     30,      7,           "black",      "black",      200000,
  "JPN",  155,     40,      7,           "black",      "black",      200000,
  
  # Oceania
  "AUS",  134,     -25,     7,           "black",      "black",      200000,
  "PNG",  142,     4,       7,           "black",      "black",      200000,
  "NZL",  155,     -50,     7,           "black",      "black",      200000
)

## Convert manual positions to Robinson projection
manual_positions_sf <- manual_positions |>
  st_as_sf(coords = c("lon", "lat"), crs = 4326) |>
  st_transform(crs = "+proj=robin") |>
  mutate(
    lon_robin = st_coordinates(geometry)[,1],
    lat_robin = st_coordinates(geometry)[,2]
  ) |>
  st_drop_geometry()

## Join manual positions to main dataset
final_db <- db |> 
  left_join(manual_positions_sf, by = "iso3")
```


## Color and main font settings


```{r}
## Color settings
color_palette <- c("#FCDCA7","#FCD0BA","#F9C8C2","#E58390","#CF4146","#C72729")

background_colour <- "#FEF0EF"
background_color <- "#FEF0EF"

## Load fonts
font_add_google(name = "Archivo Black", family = "archivoblack")
font_add_google(name = "Archivo", family = "archivo")
showtext_auto()

font_regular <- "archivo"
font_bold <- "archivoblack"
```


## Main Map Plot


```{r}
map_plot <- ggplot(final_db) +
  # Base map
  geom_sf(aes(fill = value), color = "black", size = 0.25) +
  
  # Country name
  geom_text(
    data = \(x) x |> filter(show_label == TRUE),
    aes(x = lon_robin, y = lat_robin + label_offset, label = country, size = label_size, color = label_color),
    fontface = "italic",
    family = font_regular
  ) +
  
  # Value
  geom_label(
    data = \(x) x |> filter(show_label == TRUE),
    aes(x = lon_robin, y = lat_robin - label_offset, label = value, size = label_size, color = value_color),
    fontface = "bold",
    family = font_bold,
    fill = NA,
    label.size = 0.15,
    label.padding = unit(c(0.1, 0.15, 0.1, 0.15), "lines")
  ) +
  
  # Scales
  scale_size_identity() +
  scale_color_identity() +
  scale_fill_gradientn(
    colours = color_palette,
    na.value = "grey90"
  ) +
  
  # Theme
  theme_minimal() +
  theme(
    plot.background = element_rect(fill = background_colour, color = NA),
    axis.text = element_blank(),
    axis.title = element_blank(),
    panel.grid = element_blank(),
    legend.position = "none"
  ) +
  coord_sf(crs = "+proj=robin")

```

## Horizontal Bars Plot


```{r}
## Bar plots

text_size <- 14.5
text_size2 <- 12.5

## First bar (Lowest / Highest)
bar_plot <- ggplot() +
  # Gradient rectangle using multiple segments
  geom_tile(
    data = data.frame(
      x = seq(0, 1, length.out = 100),
      y = 0.5,
      fill = seq(0, 1, length.out = 100)
    ),
    aes(x = x, y = y, fill = fill),
    height = 1,
    width = 0.0101
  ) +
  scale_fill_gradientn(colours = color_palette) +
  
  # Left text: "Lowest" in bold
  annotate("text", 
           x = 0.02,
           y = 0.5, 
           label = "Lowest", 
           family = font_bold, 
           fontface = "bold",
           color = "black", 
           hjust = 0, 
           size = text_size) +
  
  # Left text: "0.73 South Korea"
  annotate("text", 
           x = 0.12,
           y = 0.5, 
           label = "0.73 South Korea", 
           family = font_regular,
           color = "black", 
           hjust = 0, 
           size = text_size) +
  
  # Right text: "Highest" in bold white
  annotate("text", 
           x = 0.865,
           y = 0.5, 
           label = "Highest", 
           family = font_bold,
           fontface = "bold",
           color = "white",
           hjust = 1, 
           size = text_size) +
  
  # Right text: "6.03 Chad"
  annotate("text", 
           x = 0.98,
           y = 0.5, 
           label = "6.03 Chad", 
           family = font_regular,
           color = "white",
           hjust = 1, 
           size = text_size) +
  
  scale_x_continuous(expand = c(0, 0)) +
  scale_y_continuous(expand = c(0, 0)) +
  theme_void() +
  theme(
    legend.position = "none",
    plot.margin = margin(0, 0, 0, 0, "pt")
  )

## Second bar (Top 10 Highest / Lowest)
bar_plot2 <- ggplot() +
  geom_tile(
    data = data.frame(
      x = seq(0, 1, length.out = 100),
      y = 0.5,
      fill = seq(0, 1, length.out = 100)
    ),
    aes(x = x, y = y, fill = fill),
    height = 1,
    width = 0.0101
  ) +
  scale_fill_gradientn(colours = color_palette) +
  
  # Left text: "Top 10 Highest Total Fertility Rate (2024)"
  annotate("text", 
           x = 0.02,
           y = 0.5, 
           label = "Top 10 Highest Total Fertility Rate (2024)", 
           family = font_bold,
           color = "black", 
           hjust = 0, 
           size = text_size2) +
  
  # Right text: "Top 10 Lowest Total Fertility Rate (2024)"
  annotate("text", 
           x = 0.98,
           y = 0.5, 
           label = "Top 10 Lowest Total Fertility Rate (2024)", 
           family = font_bold,
           color = "white",
           hjust = 1, 
           size = text_size2) +
  
  scale_x_continuous(expand = c(0, 0)) +
  scale_y_continuous(expand = c(0, 0)) +
  theme_void() +
  theme(
    legend.position = "none",
    plot.margin = margin(0, 0, 0, 0, "pt")
  )
```


## Ranking Part Plot


```{r}
## Ranking plots

## Text sizes
ranking_label_size <- 9
ranking_axis_x_size <- 32
ranking_axis_y_size <- 22

## Data with factors for strict ordering
# Highest (left)
data_high <- data.frame(
  Country = c("Chad", "Somalia", "D.R Congo", "C.A.R", "Niger", 
              "Mali", "Angola", "Burundi", "Afghanistan", "Mozambique"),
  Value = c(6.03, 6.01, 5.98, 5.95, 5.94, 
            5.51, 5.05, 4.79, 4.76, 4.69)
)
data_high$Country <- factor(data_high$Country, levels = data_high$Country)

# Lowest (right)
data_low <- data.frame(
  Country = c("S. Korea", "Taiwan", "Singapore", "Ukraine", "China", 
              "Andorra", "Malta", "Chile", "San Marino", "Thailand"),
  Value = c(0.73, 0.86, 0.95, 0.99, 1.01, 
            1.09, 1.11, 1.14, 1.16, 1.20)
)
data_low$Country <- factor(data_low$Country, levels = data_low$Country)

## Bar colors
col_high_bar <- "#CE4143"
col_low_bar  <- "#FDDDA8"

## Highest fertility rate chart
p_high <- ggplot(data_high, aes(x = Country, y = Value)) +
  geom_chicklet(fill = col_high_bar, width = 0.85, radius = grid::unit(2, "pt"), color = NA) +
  geom_text(aes(label = sprintf("%.2f", Value)), 
            vjust = -0.5, size = ranking_label_size, fontface = "bold") +
  scale_y_continuous(limits = c(0, 7), expand = c(0, 0), breaks = seq(0, 7, 1)) +
  theme_minimal(base_family = "sans") +
  theme(
    plot.background = element_blank(),
    panel.background = element_blank(),
    axis.title = element_blank(),
    axis.text.x = element_text(color = "black", size = ranking_axis_x_size, face = "bold", angle = 45, hjust = 1),
    axis.text.y = element_text(color = "black", size = ranking_axis_y_size, face = "bold"),
    panel.grid.major.x = element_blank(),
    panel.grid.minor = element_blank(),
    panel.grid.major.y = element_line(color = "gray85", linewidth = 0.3)
  )

## Lowest fertility rate chart
p_low <- ggplot(data_low, aes(x = Country, y = Value)) +
  geom_chicklet(fill = col_low_bar, width = 0.85, radius = grid::unit(2, "pt"), color = NA) +
  geom_text(aes(label = sprintf("%.2f", Value)), 
            vjust = -0.5, size = ranking_label_size, fontface = "bold") +
  scale_y_continuous(limits = c(0, 1.4), expand = c(0, 0), breaks = seq(0, 1.2, 0.2)) +
  theme_minimal(base_family = "sans") +
  theme(
    plot.background = element_blank(),
    panel.background = element_blank(),
    axis.title = element_blank(),
    axis.text.x = element_text(color = "black", size = ranking_axis_x_size, face = "bold", angle = 45, hjust = 1),
    axis.text.y = element_text(color = "black", size = ranking_axis_y_size, face = "bold"),
    panel.grid.major.x = element_blank(),
    panel.grid.minor = element_blank(),
    panel.grid.major.y = element_line(color = "gray85", linewidth = 0.3)
  )


## Assemble ranking section
ranking_grid <- plot_grid(
  p_high, 
  NULL,
  p_low,
  ncol = 3,
  align = "h", 
  axis = "tb",
  rel_widths = c(1, 0.0, 1) 
)

ranking_plot <- ggdraw(ranking_grid) +
  theme(
    plot.background = element_rect(fill = background_colour, color = NA)
  )

```

## Header Plot


```{r}
## Header plot

## Load header fonts
font_add_google("Oswald", family = "title_bold_font")
font_add_google("Lora", family = "title_regular_font")
showtext_auto()

title_bold_font <- "title_bold_font"
title_regular_font <- "title_regular_font"

## Header text sizes
title_size <- 140
subtitle_size <- 55
desc_size <- 16

## Header text content
text_title <- "TOTAL FERTILITY RATES"
text_subtitle <- "BY COUNTRY"
text_desc <- "The total fertility rate is defined as the average number of children that would be born alive to a woman during her lifetime if she were to pass through her childbearing years conforming to the age-specific fertility rates of a given year. (UN)"
text_desc_wrapped <- str_wrap(text_desc, width = 105)

header_plot <- ggdraw() +
  theme(plot.background = element_rect(fill = "#FEF0EF", color = NA)) + 
  
  # Main title
  draw_label(
    text_title,
    x = 0.5, y = 0.75, 
    hjust = 0.5,  
    size = title_size, 
    fontface = "bold",    
    fontfamily = title_bold_font,
    color = "black" 
  ) +
  
  # Subtitle
  draw_label(
    text_subtitle,
    x = 0.40, 
    y = 0.35,     
    hjust = 1,    
    size = subtitle_size, 
    fontface = "bold",    
    fontfamily = title_bold_font,
    color = "black"
  ) +
  
  # Description text
  draw_label(
    text_desc_wrapped,
    x = 0.41, 
    y = 0.35,     
    hjust = 0,    
    size = desc_size, 
    fontface = "plain", 
    fontfamily = title_regular_font,
    color = "black",
    lineheight = 0.65 
  )

```

## Final Draw


```{r}
## Final plot assembly
final_plot <- ggdraw() +
  theme(plot.background = element_rect(fill = background_colour, color = NA)) +
  
  # Header
  draw_plot(header_plot, x = 0, y = 0.85, width = 1, height = 0.15) +
  
  # First bar
  draw_plot(bar_plot, x = 0, y = 0.82, width = 1, height = 0.045) +
  
  # Map
  draw_plot(map_plot, x = 0, y = 0.26, width = 0.88, height = 0.58, scale = 1.68) +
  
  # Second bar
  draw_plot(bar_plot2, x = 0, y = 0.25, width = 1, height = 0.045) +
  
  # Rankings
  draw_plot(ranking_plot, x = 0, y = 0, width = 1, height = 0.36, hjust = 0.01,vjust = 0.35)

```

## Exporting the final result


```{r}
## Save final infographic
ggsave("fertility_infographic.png", final_plot, 
       width = 8,    
       height = 11,
       dpi = 300)
```

## Final Plot Display


```{r}
knitr::include_graphics("fertility_infographic.png")
```

