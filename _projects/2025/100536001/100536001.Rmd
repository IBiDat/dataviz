---
title: "Consumer Inflation From 2020 to 2025"
description: |
categories: "2025"
author: Chih Hsuan Chang
date: "`r Sys.Date()`"
output:
  distill::distill_article:
    self_contained: false
    toc: true
---

## Consumer Inflation 2020 - 2025

```{r setup, include = FALSE}
knitr::opts_chunk$set(out.width="100%", fig.align="center", fig.showtext=TRUE)
```

I have choose the graph from Visual Capitalist, "Consumer Inflation from 2020 to 2025". The dataset is from Deutsche Bank, record consumer inflation from 2020 to June 2025.

![original graph](Consumer-Inflation_2020-2025.jpeg)

### Packages

```{r packages}
library(readr)
library(ggplot2)
library(tidyverse)
library(sf) # map structure
library(scales) # making the scale
library(rnaturalearth) # map info
library(showtext) # fonts
library(systemfonts)
library(cowplot) # composite maps together
```

### Data Cleaning

```{r data-cleaning}
# import data
inflation2025 <- read_csv("global inflation 2025_Deutsche Bank - Sheet1.csv")

# clean data
cum_inflation_2025 <- inflation2025 |> 
  select(-`cum change since 2012 (%)`,
         -`cum change since 2020 (%)`,
         -`Rank based on change from 2012 Economy`) |> 
  mutate(Economy = case_when(Economy == "United States" ~ "United States of America",
                             Economy == "Czech Republic" ~ "Czechia",
                             TRUE ~ Economy))

# sf data object
world_map <- ne_countries(scale = "medium", returnclass = "sf") |> 
  filter(admin != "Antarctica")
world_inflation <- world_map |> 
  left_join(cum_inflation_2025, by = c("name" = "Economy")) |>
  # change names that are shown/not shown on the map 
  mutate(name = case_when(name == "South Africa" ~ "S. Africa", 
                          name == "Turkey" ~ "Türkiye", 
                          name == "United Kingdom" ~ "UK",
                          name == "South Korea" ~ "S. Korea",
                          name == "United Arab Emirates" ~ "UAE",
                          name == "United States of America" ~ "U.S.",
                          name %in% c(
                            "Austria", "Netherlands", "Belgium", 
                            "Luxembourg", "Portugal", "Singapore", 
                            "Denmark", "Ireland") ~ "",
                          TRUE ~ name))
```

### Fonts

```{r}
#| include: false
knitr::opts_chunk$set(dev = "ragg_png")
```

```{r fonts}
font_add_google("Poppins", "poppins")
font_add(family = "Modak",
         regular = "/Users/karlazhong/Library/Fonts/Modak-Regular.ttf")
showtext_auto()
```

### The Gradient Scale on Top of the Map

```{r gradient-scale}
# bar legend
vc_palette <- c("#53a6e8", "#6b9bd1", "#7B95C5","#8a8eb8", "#9B88AC","#ab809f", "#B87993","#c87284", "#D86C7B","#e56569", "#B0022A")
limit_range <- c(0, 55)
legend_data <- data.frame(x = seq(limit_range[1], limit_range[2], length.out = 500))
legend_data$y_height <- 0.2 + (legend_data$x / 50) * 2

legend_plot <- ggplot(legend_data) +
  geom_segment(aes(x = x, xend = x, y = 0, yend = y_height, color = x), linewidth = 1) +
  scale_color_gradientn(
    colors = vc_palette,
    limits = limit_range,
    oob = scales::squish,
  ) +
  annotate("text", x = 1, y = -1, label = "0%", size = 2.5, fontface = "bold", color = "#333333") +
  annotate("text", x = 10, y = -1, label = "10%", size = 2.5, fontface = "bold", color = "#333333") +
  annotate("text", x = 20, y = -1, label = "20%", size = 2.5, fontface = "bold", color = "#333333") +
  annotate("text", x = 30, y = -1, label = "30%", size = 2.5, fontface = "bold", color = "#333333") +
  annotate("text", x = 40, y = -1, label = "40%", size = 2.5, fontface = "bold", color = "#333333") +
  annotate("text", x = 50, y = -1, label = "50%", size = 2.5, fontface = "bold", color = "#333333") +
  annotate("segment", x = 0, xend = 0, y = 0, yend = -0.3, color = "#333333") +
  annotate("segment", x = 5, xend = 5, y = 0, yend = -0.3, color = "#333333") +
  annotate("segment", x = 10, xend = 10, y = 0, yend = -0.3, color = "#333333") +
  annotate("segment", x = 15, xend = 15, y = 0, yend = -0.3, color = "#333333") +
  annotate("segment", x = 20, xend = 20, y = 0, yend = -0.3, color = "#333333") +
  annotate("segment", x = 25, xend = 25, y = 0, yend = -0.3, color = "#333333") +
  annotate("segment", x = 30, xend = 30, y = 0, yend = -0.3, color = "#333333") +
  annotate("segment", x = 35, xend = 35, y = 0, yend = -0.3, color = "#333333") +
  annotate("segment", x = 40, xend = 40, y = 0, yend = -0.3, color = "#333333") +
  annotate("segment", x = 45, xend = 45, y = 0, yend = -0.3, color = "#333333") +
  annotate("segment", x = 50, xend = 50, y = 0, yend = -0.3, color = "#333333") +
  ylim(-1, 4) + 
  xlim(10, 60) +
  scale_y_continuous(expand = c(0, 0), limits = c(-5, 4)) + 
  scale_x_continuous(expand = c(0, 0)) +
  theme_void() +
  theme(legend.position = "none")

scale_grob <- ggplotGrob(legend_plot)
```

### Numbers on Bubbles

```{r bubbles-number}
# inside the lens
bubble_list_eu <- tibble::tribble(
  ~name_label, ~value_label,
  "Hungary", "52%",
  "Czechia", "41%",
  "UK", "24%",
  "Italy", "18%",
  "Greece", "16%",
  "Switzerland", "6%")
bubble_list_sea <- tibble::tribble(
  ~name_label, ~value_label,
  "Philippines", "24%",
  "Indonesia", "14%",
  "Taiwan", "10%",
  "Malaysia", "9%",
  "Hong Kong", "8%",
  "Thailand", "8%")
bubble_geo_eu <- world_inflation |> 
  right_join(bubble_list_eu, by = c("name" = "name_label")) |> 
  st_point_on_surface()
bubble_geo_sea <- world_inflation |> 
  right_join(bubble_list_sea, by = c("name" = "name_label")) |> 
  st_point_on_surface()

# adjust bubble position
row_greece <- which(bubble_geo_eu$name_label == "Greece")
new_grc_coords <- st_point(c(21.65, 40.25))
bubble_geo_eu$geometry[row_greece] <- st_sfc(new_grc_coords) |>  
  st_set_crs(st_crs(bubble_geo_eu))
st_geometry(bubble_geo_eu)[bubble_geo_eu$name == "Czechia"] <- st_sfc(
  st_point(c(18.0, 50.0)), crs = st_crs(bubble_geo_eu))

# outside of the lens
bubble_list_rest <- tibble::tribble(
  ~name_label, ~value_label,
  "Chile", "34%",
  "New Zealand", "23%",
  "S. Korea", "15%",
  "Israel", "13%",
  "Qatar", "9%",
  "Japan", "8%",
  "UAE", "6%")
bubble_geo_rest <- world_inflation |> 
  right_join(bubble_list_rest, by = c("name" = "name_label")) |>
  st_point_on_surface()

# Argentina
bubble_arg <- tibble::tribble(
  ~ name_label, ~ value_label,
  "Argentina", "2,614%")
bubble_geo_arg <- world_inflation |> 
  right_join(bubble_arg, by = c("name" = "name_label")) |>
  st_point_on_surface()

# Türkiye
bubble_tur <- tibble::tribble(
  ~ name_label, ~ value_label,
  "Türkiye", "464%")
bubble_geo_tur <- world_inflation |> 
  right_join(bubble_tur, by = c("name" = "name_label")) |>
  st_point_on_surface()

# adjust the bubbles' position
st_geometry(bubble_geo_rest)[bubble_geo_rest$name == "Qatar"] <- st_sfc(
  st_point(c(51.2, 27.5)), crs = st_crs(bubble_geo_rest))
st_geometry(bubble_geo_rest)[bubble_geo_rest$name == "UAE"] <- st_sfc(
  st_point(c(54, 22)), crs = st_crs(bubble_geo_rest))
st_geometry(bubble_geo_tur)[bubble_geo_tur$name == "Türkiye"] <- st_sfc(
  st_point(c(44.0, 41.0)), crs = st_crs(bubble_geo_tur))
st_geometry(bubble_geo_rest)[bubble_geo_rest$name == "New Zealand"] <- st_sfc(
  st_point(c(160.0, -46.0)), crs = st_crs(bubble_geo_rest))
st_geometry(bubble_geo_rest)[bubble_geo_rest$name == "Chile"] <- st_sfc(
  st_point(c(-72.0, -23.0)), crs = st_crs(bubble_geo_rest))
st_geometry(bubble_geo_arg)[bubble_geo_arg$name == "Argentina"] <- st_sfc(
  st_point(c(-60.0, -39.0)), crs = st_crs(bubble_geo_arg))
st_geometry(bubble_geo_sea)[bubble_geo_sea$name == "Malaysia"] <- st_sfc(
  st_point(c(116.0, 5.0)), crs = st_crs(bubble_geo_sea))
st_geometry(bubble_geo_sea)[bubble_geo_sea$name == "Indonesia"] <- st_sfc(
  st_point(c(106.0, -6.6)), crs = st_crs(bubble_geo_sea))
st_geometry(bubble_geo_sea)[bubble_geo_sea$name == "Philippines"] <- st_sfc(
  st_point(c(120.0, 14.6)), crs = st_crs(bubble_geo_sea))
```

### Base Map + Scale + Base Countries' Bubbles - Plot1

```{r base-plot1}
plot1 <- ggplot(world_inflation) +
  # map Layer
  geom_sf(aes(fill = `5-yr cum\nchange (%)`), color = "grey70", size = 0.2) +
  # the Gradient Scale on the map
  scale_fill_gradientn(
    colors = vc_palette,
    limits = limit_range, 
    oob = scales::squish,
    na.value = "#fffce9",
  ) +
  # the Gradient Bar
  annotation_custom(
    grob = scale_grob, 
    xmin = -10500000, xmax = 10500000,
    ymin = 6500000, ymax = 16000000
  ) +
  # bubbles rest
  geom_point(
    data = bubble_geo_rest,
    stat = "sf_coordinates",
    aes(geometry = geometry,
        fill = `5-yr cum\nchange (%)`,
        ),
    size = 4.5,           # Adjust bubble size here
    color = "#fffce9",    # The border of the bubble
    shape = 21,         # Shape 21 allows both fill and color (border)
    stroke = 0.15,        # Thickness of the white border
  ) +
  # text inside bubbles rest
  geom_text(
    data = bubble_geo_rest,
    stat = "sf_coordinates",
    aes(geometry = geometry, label = value_label),
    color = "#fffce9",
    size = 1.7,
    fontface = "plain",
    family = "poppins"
  )+
  # bubble Argentina
  geom_point(
    data = bubble_geo_arg,
    stat = "sf_coordinates",
    aes(geometry = geometry,
        fill = `5-yr cum\nchange (%)`),
    size = 11,           # Adjust bubble size here
    color = "#fffce9",    # The border of the bubble
    shape = 21,         # Shape 21 allows both fill and color (border)
    stroke = 0.15,        # Thickness of the white border
  ) +
  # text inside bubble Argentina
  geom_text(
    data = bubble_geo_arg,
    stat = "sf_coordinates",
    aes(geometry = geometry, label = value_label),
    color = "#fffce9",
    size = 2.5,
    fontface = "plain",
    family = "poppins"
  )+
  # bubble Türkiye
  geom_point(
    data = bubble_geo_tur,
    stat = "sf_coordinates",
    aes(geometry = geometry,
        fill = `5-yr cum\nchange (%)`),
    size = 6,           # Adjust bubble size here
    color = "#fffce9",    # The border of the bubble
    shape = 21,         # Shape 21 allows both fill and color (border)
    stroke = 0.15,        # Thickness of the white border
  ) +
  # text inside bubble Türkiye
  geom_text(
    data = bubble_geo_tur,
    stat = "sf_coordinates",
    aes(geometry = geometry, label = value_label),
    color = "#fffce9",
    size = 1.7,
    fontface = "plain",
    family = "poppins"
  ) +
  # theme and projection
  coord_sf(crs = "+proj=robin") + # Robinson Projection
  theme_void() + # Removes axes and standard grid
  theme(
    # background Colors
    plot.background = element_rect(fill = "#fffce9", color = NA),
    panel.background = element_rect(fill = "#fffce9", color = NA),
    # legend Positioning
    legend.position = "none"
  ) +
  labs(title = "Consumer Inflation",
       subtitle = "2 0 2 0  -  2 0 2 5") +
  theme(
    plot.title = element_text(
      hjust = 0.5,
      face = "plain", 
      size = 30, 
      margin = margin(t = 10),
      family = "Modak"),
    plot.subtitle = element_text(
      hjust = 0.5,
      face = "bold", 
      size = 12, 
      margin = margin(t = 4, b = 70),
      family = "poppins",
      ))

print(plot1)
```

### Country Labels and Numbers

```{r country and other number labels}
country_label_base <- tibble::tribble(
  ~ name_label,
  "Argentina", "Türkiye", "Egypt", "Russia", "Colombia", "Chile", "Brazil",
  "India", "Mexico", "S. Africa", "New Zealand", "Australia", "Canada", "S. Korea", 
  "Saudi Arabia", "Israel", "Qatar", "Japan", "China", "UAE", "U.S.") 
country_label_geo_base <- world_inflation |> 
  right_join(country_label_base, by = c("name" = "name_label")) |> 
  st_point_on_surface()
# adjusting the position
st_geometry(country_label_geo_base)[country_label_geo_base$name == "Argentina"] <- st_sfc(
  st_point(c(-36.0, -39.0)), crs = st_crs(country_label_geo_base))
st_geometry(country_label_geo_base)[country_label_geo_base$name == "Türkiye"] <- st_sfc(
  st_point(c(60.0, 41.0)), crs = st_crs(country_label_geo_base))
st_geometry(country_label_geo_base)[country_label_geo_base$name == "Egypt"] <- st_sfc(
  st_point(c(17.0, 27.1)), crs = st_crs(country_label_geo_base))
st_geometry(country_label_geo_base)[country_label_geo_base$name == "Russia"] <- st_sfc(
  st_point(c(102.0, 62.0)), crs = st_crs(country_label_geo_base))
st_geometry(country_label_geo_base)[country_label_geo_base$name == "Colombia"] <- st_sfc(
  st_point(c(-90.5, 4.1)), crs = st_crs(country_label_geo_base))
st_geometry(country_label_geo_base)[country_label_geo_base$name == "Chile"] <- st_sfc(
  st_point(c(-83.0, -23.0)), crs = st_crs(country_label_geo_base))
st_geometry(country_label_geo_base)[country_label_geo_base$name == "Brazil"] <- st_sfc(
  st_point(c(-46.0, -8.4)), crs = st_crs(country_label_geo_base))
st_geometry(country_label_geo_base)[country_label_geo_base$name == "India"] <- st_sfc(
  st_point(c(92.0, 22.35)), crs = st_crs(country_label_geo_base))
st_geometry(country_label_geo_base)[country_label_geo_base$name == "Mexico"] <- st_sfc(
  st_point(c(-117.0, 23.5)), crs = st_crs(country_label_geo_base))
st_geometry(country_label_geo_base)[country_label_geo_base$name == "S. Africa"] <- st_sfc(
  st_point(c(41.0, -29.0)), crs = st_crs(country_label_geo_base))
st_geometry(country_label_geo_base)[country_label_geo_base$name == "New Zealand"] <- st_sfc(
  st_point(c(137.0, -47.0)), crs = st_crs(country_label_geo_base))
st_geometry(country_label_geo_base)[country_label_geo_base$name == "Australia"] <- st_sfc(
  st_point(c(138.0, -26.0)), crs = st_crs(country_label_geo_base))
st_geometry(country_label_geo_base)[country_label_geo_base$name == "Canada"] <- st_sfc(
  st_point(c(-100.5, 56.0)), crs = st_crs(country_label_geo_base))
st_geometry(country_label_geo_base)[country_label_geo_base$name == "S. Korea"] <- st_sfc(
  st_point(c(127.0, 31.0)), crs = st_crs(country_label_geo_base))
st_geometry(country_label_geo_base)[country_label_geo_base$name == "Saudi Arabia"] <- st_sfc(
  st_point(c(30.0, 19.0)), crs = st_crs(country_label_geo_base))
st_geometry(country_label_geo_base)[country_label_geo_base$name == "Israel"] <- st_sfc(
  st_point(c(25.0, 34.0)), crs = st_crs(country_label_geo_base))
st_geometry(country_label_geo_base)[country_label_geo_base$name == "Qatar"] <- st_sfc(
  st_point(c(62.4, 29.0)), crs = st_crs(country_label_geo_base))
st_geometry(country_label_geo_base)[country_label_geo_base$name == "China"] <- st_sfc(
  st_point(c(107.0, 35.0)), crs = st_crs(country_label_geo_base))
st_geometry(country_label_geo_base)[country_label_geo_base$name == "Japan"] <- st_sfc(
  st_point(c(155.0, 42.5)), crs = st_crs(country_label_geo_base))
st_geometry(country_label_geo_base)[country_label_geo_base$name == "UAE"] <- st_sfc(
  st_point(c(64.0, 21.0)), crs = st_crs(country_label_geo_base))
st_geometry(country_label_geo_base)[country_label_geo_base$name == "U.S."] <- st_sfc(
  st_point(c(-94.0, 40.0)), crs = st_crs(country_label_geo_base))

country_label_eu <- tibble::tribble(
  ~ name_label,
  "Spain", "France", "Finland", "Sweden", "Poland", "Germany", "Norway", "Hungary", "Czechia", "UK", "Italy", "Greece", "Switzerland") 
country_label_geo_eu <- world_inflation |> 
  right_join(country_label_eu, by = c("name" = "name_label")) |> 
  st_point_on_surface()
# adjusting the position
st_geometry(country_label_geo_eu)[country_label_geo_eu$name == "Spain"] <- st_sfc(
  st_point(c(3.0, 40.5)), crs = st_crs(country_label_geo_eu))
st_geometry(country_label_geo_eu)[country_label_geo_eu$name == "France"] <- st_sfc(
  st_point(c(-5.0, 46.2)), crs = st_crs(country_label_geo_eu))
st_geometry(country_label_geo_eu)[country_label_geo_eu$name == "Finland"] <- st_sfc(
  st_point(c(36.0, 61.0)), crs = st_crs(country_label_geo_eu))
st_geometry(country_label_geo_eu)[country_label_geo_eu$name == "Sweden"] <- st_sfc(
  st_point(c(17.0, 60.0)), crs = st_crs(country_label_geo_eu))
st_geometry(country_label_geo_eu)[country_label_geo_eu$name == "Norway"] <- st_sfc(
  st_point(c(6.0, 59.0)), crs = st_crs(country_label_geo_eu))
st_geometry(country_label_geo_eu)[country_label_geo_eu$name == "Poland"] <- st_sfc(
  st_point(c(26.5, 52.2)), crs = st_crs(country_label_geo_eu))
st_geometry(country_label_geo_eu)[country_label_geo_eu$name == "Germany"] <- st_sfc(
  st_point(c(9.5, 49.8)), crs = st_crs(country_label_geo_eu))
st_geometry(country_label_geo_eu)[country_label_geo_eu$name == "Hungary"] <- st_sfc(
  st_point(c(26.0, 46.0)), crs = st_crs(country_label_geo_eu))
st_geometry(country_label_geo_eu)[country_label_geo_eu$name == "Czechia"] <- st_sfc(
  st_point(c(25.5, 49.0)), crs = st_crs(country_label_geo_eu))
st_geometry(country_label_geo_eu)[country_label_geo_eu$name == "UK"] <- st_sfc(
  st_point(c(3.0, 54.7)), crs = st_crs(country_label_geo_eu))
st_geometry(country_label_geo_eu)[country_label_geo_eu$name == "Italy"] <- st_sfc(
  st_point(c(8.56, 41.87)), crs = st_crs(country_label_geo_eu))
st_geometry(country_label_geo_eu)[country_label_geo_eu$name == "Greece"] <- st_sfc(
  st_point(c(23.0, 41.0)), crs = st_crs(country_label_geo_eu))
st_geometry(country_label_geo_eu)[country_label_geo_eu$name == "Switzerland"] <- st_sfc(
  st_point(c(8.2, 45.0)), crs = st_crs(country_label_geo_eu))



country_label_sea <- tibble::tribble(
  ~ name_label,
  "Philippines", "Indonesia", "Taiwan", "Malaysia", "Hong Kong", "Thailand")
country_label_geo_sea <- world_inflation |> 
  right_join(country_label_sea, by = c("name" = "name_label")) |> 
  st_point_on_surface()
# adjusting the position
st_geometry(country_label_geo_sea)[country_label_geo_sea$name == "Taiwan"] <- st_sfc(
  st_point(c(130.0, 23.82)), crs = st_crs(country_label_geo_sea))
st_geometry(country_label_geo_sea)[country_label_geo_sea$name == "Philippines"] <- st_sfc(
  st_point(c(130.88, 14.0)), crs = st_crs(country_label_geo_sea))
st_geometry(country_label_geo_sea)[country_label_geo_sea$name == "Indonesia"] <- st_sfc(
  st_point(c(116.5, -6.48)), crs = st_crs(country_label_geo_sea))
st_geometry(country_label_geo_sea)[country_label_geo_sea$name == "Malaysia"] <- st_sfc(
  st_point(c(126.69, 5.0)), crs = st_crs(country_label_geo_sea))
st_geometry(country_label_geo_sea)[country_label_geo_sea$name == "Hong Kong"] <- st_sfc(
  st_point(c(114.18, 18.5)), crs = st_crs(country_label_geo_sea))
st_geometry(country_label_geo_sea)[country_label_geo_sea$name == "Thailand"] <- st_sfc(
  st_point(c(111.00, 13.5)), crs = st_crs(country_label_geo_sea))

number_label_base <- tibble::tribble(
  ~ name_label,
  "Egypt", "Russia", "Colombia", "Brazil", "India", "Mexico", "S. Africa",
  "U.S.", "Australia", "Canada", "Saudi Arabia", "China") 
number_label_geo_base <- world_inflation |> 
  right_join(number_label_base, by = c("name" = "name_label")) |> 
  mutate(`5-yr cum\nchange (%)` = paste0(`5-yr cum\nchange (%)`, "%")) |> 
  st_point_on_surface()
# adjust the position
st_geometry(number_label_geo_base)[number_label_geo_base$name == "Russia"] <- st_sfc(
  st_point(c(85.0, 62.0)), crs = st_crs(number_label_geo_base))
st_geometry(number_label_geo_base)[number_label_geo_base$name == "Brazil"] <- st_sfc(
  st_point(c(-57.0, -8.4)), crs = st_crs(number_label_geo_base))
st_geometry(number_label_geo_base)[number_label_geo_base$name == "China"] <- st_sfc(
  st_point(c(96.0, 35.0)), crs = st_crs(number_label_geo_base))
st_geometry(number_label_geo_base)[number_label_geo_base$name == "Saudi Arabia"] <- st_sfc(
  st_point(c(44.57, 23.0)), crs = st_crs(number_label_geo_base))
st_geometry(number_label_geo_base)[number_label_geo_base$name == "U.S."] <- st_sfc(
  st_point(c(-105.0, 40.0)), crs = st_crs(number_label_geo_base))
st_geometry(number_label_geo_base)[number_label_geo_base$name == "Canada"] <- st_sfc(
  st_point(c(-116.0, 56.0)), crs = st_crs(number_label_geo_base))
st_geometry(number_label_geo_base)[number_label_geo_base$name == "Australia"] <- st_sfc(
  st_point(c(123.0, -26.0)), crs = st_crs(number_label_geo_base))

number_label_eu <- tibble::tribble(
  ~ name_label,
  "Spain", "France", "Finland", "Sweden", "Poland", "Germany", "Norway") 
number_label_geo_eu <- world_inflation |> 
  right_join(number_label_eu, by = c("name" = "name_label")) |> 
  mutate(`5-yr cum\nchange (%)` = paste0(`5-yr cum\nchange (%)`, "%")) |> 
  st_point_on_surface()
# adjust the position
st_geometry(number_label_geo_eu)[number_label_geo_eu$name == "Gremany"] <- st_sfc(
  st_point(c(10.0, 60.0)), crs = st_crs(number_label_geo_eu))
st_geometry(number_label_geo_eu)[number_label_geo_eu$name == "Norway"] <- st_sfc(
  st_point(c(8.5, 61.0)), crs = st_crs(number_label_geo_eu))
st_geometry(number_label_geo_eu)[number_label_geo_eu$name == "Finland"] <- st_sfc(
  st_point(c(26.0, 62.0)), crs = st_crs(number_label_geo_eu))
st_geometry(number_label_geo_eu)[number_label_geo_eu$name == "Poland"] <- st_sfc(
  st_point(c(19.14, 53.0)), crs = st_crs(number_label_geo_eu))
```

### plot1(base plot) + Country Labels and Numbers - plot2

```{r labels-plot2}
plot2 <- plot1 +
  # country names
  geom_text(
    data = country_label_geo_base,
    stat = "sf_coordinates",
    aes(geometry = geometry, label = name),
    color = "#333333", 
    size = 2,        # Adjust text size
    fontface = "bold", # "plain", "bold", "italic"
    family = "roboto",
    inherit.aes = FALSE
  ) +
  # number labels
  geom_text(
    data = number_label_geo_base,
    stat = "sf_coordinates",
    aes(geometry = geometry, label = `5-yr cum\nchange (%)`),
    color = "#fffce9", 
    size = 1.6,        # Adjust text size
    fontface = "plain", # "plain", "bold", "italic"
    family = "poppins",
    inherit.aes = FALSE
  )
print(plot2)
```

### Magnified EU and SEA and the Bubbles in the Lenses

build the magnifying function and add the bubble + number + country name layer

```{r create-function}
sf_use_s2(FALSE)

create_lens_eu <- function(data, bubble_data, center_lon, center_lat, radius_km) {
  
  # A. PRE-CROP: Cut the map to a rough square box first.
  #    This prevents "global wrapping" errors that cause the solid purple circle.
  #    We create a bounding box +/- 25 degrees around the center.
  buff <- 25 
  bbox <- st_bbox(c(xmin = center_lon - buff, xmax = center_lon + buff, 
                    ymin = center_lat - buff, ymax = center_lat + buff), 
                  crs = st_crs(data))
  
  # Suppress warnings for the crop
  data_cropped <- suppressWarnings(st_crop(data, bbox))
  
  # define projection (Azimuthal Equidistant)
  lens_crs <- paste0("+proj=aeqd +lat_0=", center_lat, " +lon_0=", center_lon)
  
  # create circle
  center_pt <- st_sfc(st_point(c(center_lon, center_lat)), crs = 4326)
  center_pt_proj <- st_transform(center_pt, lens_crs)
  circle_border <- st_buffer(center_pt_proj, dist = radius_km * 1000)
  data_proj <- st_transform(data_cropped, lens_crs)
  data_proj <- st_make_valid(data_proj)
  lens_data <- st_intersection(data_proj, circle_border)
  lens_data <- st_collection_extract(lens_data, "POLYGON")
  
  # Process Bubble Data (Transform -> Clip)
  bubbles_proj_eu <- st_transform(bubble_geo_eu, lens_crs)
  lens_bubbles_eu <- st_intersection(bubbles_proj_eu, circle_border)
  
  # Create Plot
  ggplot() +
    # Background (Beige)
    geom_sf(data = circle_border, fill = "#fffce9", color = NA) +
    # Map Data : 
    geom_sf(data = lens_data, 
            aes(fill = `5-yr cum\nchange (%)`), 
            color = "grey70", size = 0.25) +
    # bubbles
    geom_point(
    data = bubble_geo_eu,
    stat = "sf_coordinates",
    aes(geometry = geometry,
        fill = `5-yr cum\nchange (%)`),
    size = 4.5,           # Adjust bubble size here
    color = "#fffce9",    # The border of the bubble
    shape = 21,         # Shape 21 allows both fill and color (border)
    stroke = 0.15        # Thickness of the white border
    ) +
    # numbers inside bubbles
  geom_text(
    data = bubble_geo_eu,
    stat = "sf_coordinates",
    aes(geometry = geometry, label = value_label),
    color = "#fffce9",
    size = 1.5,
    fontface = "plain",
    family = "poppins",
    ) +
    # country labels
    geom_text(
    data = country_label_geo_eu,
    stat = "sf_coordinates",
    aes(geometry = geometry, label = name),
    color = "#333333",
    size = 1.6,
    fontface = "bold",
    family = "poppins",
    ) +
    # number labels
    geom_text(
    data = number_label_geo_eu,
    stat = "sf_coordinates",
    aes(geometry = geometry, label = `5-yr cum\nchange (%)`),
    color = "#fffce9",
    size = 1.6,
    fontface = "plain",
    family = "poppins",
    ) +
    # Scale
    scale_fill_gradientn(
      colors = vc_palette,
      limits = limit_range, 
      oob = scales::squish,
      na.value = "#fffce9"
    ) +
    # Border
    geom_sf(data = circle_border, fill = NA, color = "grey50", linewidth = 0.1) +
    # Theme
    coord_sf(datum = NA) +
    theme_void() +
    theme(legend.position = "none"
    ) 
}

create_lens_sea <- function(data, bubble_data, center_lon, center_lat, radius_km) {
  
  # A. PRE-CROP: Cut the map to a rough square box first.
  #    This prevents "global wrapping" errors that cause the solid purple circle.
  #    We create a bounding box +/- 25 degrees around the center.
  buff <- 25 
  bbox <- st_bbox(c(xmin = center_lon - buff, xmax = center_lon + buff, 
                    ymin = center_lat - buff, ymax = center_lat + buff), 
                  crs = st_crs(data))
  
  # Suppress warnings for the crop
  data_cropped <- suppressWarnings(st_crop(data, bbox))
  
  # define projection (Azimuthal Equidistant)
  lens_crs <- paste0("+proj=aeqd +lat_0=", center_lat, " +lon_0=", center_lon)
  
  # create circle
  center_pt <- st_sfc(st_point(c(center_lon, center_lat)), crs = 4326)
  center_pt_proj <- st_transform(center_pt, lens_crs)
  circle_border <- st_buffer(center_pt_proj, dist = radius_km * 1000)
  data_proj <- st_transform(data_cropped, lens_crs)
  data_proj <- st_make_valid(data_proj)
  lens_data <- st_intersection(data_proj, circle_border)
  lens_data <- st_collection_extract(lens_data, "POLYGON")
  
  # Process Bubble Data (Transform -> Clip)
  bubbles_proj_sea <- st_transform(bubble_geo_sea, lens_crs)
  lens_bubbles_sea <- st_intersection(bubbles_proj_sea, circle_border)
  
  # Create Plot
  ggplot() +
    # Background (Beige)
    geom_sf(data = circle_border, fill = "#fffce9", color = NA) +
    # Map Data : 
    geom_sf(data = lens_data, 
            aes(fill = `5-yr cum\nchange (%)`), 
            color = "grey70", size = 0.25) +
    # bubbles
    geom_point(
    data = bubble_geo_sea,
    stat = "sf_coordinates",
    aes(geometry = geometry,
        fill = `5-yr cum\nchange (%)`),
    size = 4.5,           # Adjust bubble size here
    color = "#fffce9",    # The border of the bubble
    shape = 21,         # Shape 21 allows both fill and color (border)
    stroke = 0.15        # Thickness of the white border
    ) +
    # text inside bubbles
  geom_text(
    data = bubble_geo_sea,
    stat = "sf_coordinates",
    aes(geometry = geometry, label = value_label),
    color = "#fffce9",
    size = 1.5,
    fontface = "plain",
    family = "poppins"
    ) +
    # country labels
    geom_text(
    data = country_label_geo_sea,
    stat = "sf_coordinates",
    aes(geometry = geometry, label = name),
    color = "#333333",
    size = 1.6,
    fontface = "bold",
    family = "poppins"
    ) +
    # Scale
    scale_fill_gradientn(
      colors = vc_palette,
      limits = limit_range, 
      oob = scales::squish,
      na.value = "#fffce9"
    ) +
    # Border
    geom_sf(data = circle_border, fill = NA, color = "grey50", linewidth = 0.2) +
    # Theme
    coord_sf(datum = NA) +
    theme_void() +
    theme(legend.position = "none"
    ) 
}
```

```{r lenses-making}
p_lens_eu <- create_lens_eu(
  data = world_inflation, 
  bubble_data = bubble_geo_eu,
  center_lon = 7, # 7
  center_lat = 50, # 49
  radius_km = 2000
)
p_lens_sea <- create_lens_sea(
  data = world_inflation,
  bubble_data = bubble_geo_sea,
  center_lon = 113, 
  center_lat = 9, 
  radius_km = 2200
)
```

### plot2 + the Magnifying Lenses - plot3

```{r lenses-plot3}
plot_3 <- ggdraw(plot2) +
  draw_plot(p_lens_eu, x = -0.045, y = 0.375, width = 1, height = 0.3, scale = 1.25) +
  draw_plot(p_lens_sea, x = 0.27, y = 0.14, width = 1, height = 0.3, scale = 0.8)
print(plot_3)
```

### plot3 + the Texts and Arrows - final_plot

```{r text_arrows-final_plot}
texts <- tibble(label = c(
  "Consumer Inflation Cumulative\nChange, 2020-2025",
  "President Milei's fiscal\noverhaul has lowered\nArgentina's annualized\ninflation rate to 21%\nas of June 2025.",
  "Post-pandemic inflation\ndidn't hit Asia as hard\nas it hit Europe."),
  x = c(0.24, 0.43, 0.65), 
  y = c(0.797, 0.16, 0.16),
  hjust = c(0, 0, 0),
  size = c(2, 1.5, 1.3),
  font = "poppins",
  fontface = c("bold", "italic", "italic"),
  color = c("#333333", "#D86C7B", "#6b9bd1")
)

final_plot <- plot_3 +
  geom_text(
    data = texts,
    aes(x = x, y = y, label = label, hjust = hjust),
    color = texts$color,
    size = texts$size,
    fontface = texts$fontface,
    family = "poppins",
    lineheight = 0.9,
    inherit.aes = FALSE # Essential to ignore map data
  ) +
  geom_curve(
    aes(x = 0.425, y = 0.18, xend = 0.40, yend = 0.13),
    curvature = 0.3,       # Negative = Curves Right (concave down)
    color = "#D86C7B",
    size = 0.3,
    arrow = arrow(length = unit(0.01, "npc"), type = "closed"),
    inherit.aes = FALSE
  ) +
  geom_curve(
    aes(x = 0.69, y = 0.19, xend = 0.717, yend = 0.24),
    curvature = -0.3,       # Negative = Curves Right (looks best for this angle)
    color = "#6b9bd1",
    size = 0.3,
    arrow = arrow(length = unit(0.01, "npc"), type = "closed"),
    inherit.aes = FALSE
  )

print(final_plot)
```

## Improvement

### Packages

```{r alt-packages}
library(tidyverse)
library(ggplot2)
library(scales)
library(sysfonts)
library(showtext)
```

### Data Cleaning

```{r alt-data-cleaning}
inflation2025 <- read_csv("global inflation 2025_Deutsche Bank - improvement.csv")

layout_map <- tribble(
  ~Economy,        ~row, ~col,
  "Canada",        1,    2,
  "United States", 2,    2,
  "Mexico",        3,    2,
  "Colombia",      5,    3,
  "Brazil",        6,    4,
  "Chile",         8,    3,
  "Argentina",     8,    4,
  
  "Norway",        1,    6,
  "Sweden",        1,    7,
  "Finland",       1,    8,
  "Russia",        1,    11,
  
  "UK",            2,    5,
  "Ireland",       2,    4,
  "Denmark",       2,    6,
  "Netherlands",   2,    7, 
  
  "France",        3,    5,
  "Belgium",       3,    6, 
  "Germany",       2,    8, 
  "Luxembourg",    3,    7, 
  "Switzerland",   4,    6,
  "Austria",       4,    7,
  "Czechia",       3,    8,
  "Poland",        3,    9,
  
  "Spain",         5,    5,
  "Italy",         5,    6,
  "Hungary",       4,    8,
  "Greece",        6,    7,
  "Türkiye",       5,    8,
  
  "Egypt",         6,    6,
  "Israel",        6,    8,
  "Saudi Arabia",  7,    8,
  "Qatar",         7,    9,
  "UAE",           7,    10,
  "S. Africa",     10,   8,
  
  "China",         4,    12,
  "India",         6,    10,
  "Thailand",      6,    12,
  "Malaysia",      7,    12,
  "Singapore",     8,    12,
  "Indonesia",     8,    13,
  "Philippines",   7,    14,
  "Hong Kong",     5,    12,
  "Taiwan",        5,    13,
  "S. Korea",      4,    14,
  "Japan",         4,    15,
  
  "Australia",     10,   14,
  "New Zealand",   11,   15
)

map_data <- left_join(layout_map, inflation2025, by = "Economy") |> 
  mutate(Economy = case_when(Economy == "South Africa" ~ "S. Africa", 
                          Economy == "Turkey" ~ "Türkiye", 
                          Economy == "United Kingdom" ~ "UK",
                          Economy == "South Korea" ~ "S. Korea",
                          Economy == "United Arab Emirates" ~ "UAE",
                          Economy == "United States" ~ "U.S.",
                          TRUE ~ Economy))
```

### Make the Polygons

```{r ploygons}
make_hexagons <- function(data, size = 2) {
  width <- sqrt(3) * size
  height <- 2 * size
  
  data |> 
    mutate(
      x_center = (col + 0.5 * (row %% 2)) * width,
      y_center = -row * (height * 0.75)
    ) |> 
    rowwise() |> 
    do({
      # Generate 6 points for the hexagon
      tibble(
        Economy = .$Economy,
        Inflation = .$Inflation,
        x_center = .$x_center, # Keep center for labels
        y_center = .$y_center,
        angle = seq(pi/6, 2*pi+pi/6, length.out=7)[1:6],
        x = .$x_center + size * cos(seq(pi/6, 2*pi+pi/6, length.out=7)[1:6]),
        y = .$y_center + size * sin(seq(pi/6, 2*pi+pi/6, length.out=7)[1:6])
      )
    }) |> 
    ungroup()
}

hex_polygons <- make_hexagons(map_data, size = 20)

# centers for labels
labels_data <- hex_polygons |>  distinct(Economy, Inflation, x_center, y_center)
```

### Font

```{r alt_font}
font_add_google("Poppins", "poppins")
showtext_auto()
```

### plot

```{r plot}
plot <- ggplot() +
  geom_polygon(data = hex_polygons, aes(x = x, y = y, group = Economy, fill = Inflation), 
               color = "grey90", size = 0.3) +
  geom_text(data = labels_data, 
            aes(x = x_center, y = y_center + 4, label = str_wrap(Economy, width = 5)), 
            color = "#fffce9", fontface = "bold", size = 1.3, lineheight = 0.8) +
  geom_text(data = labels_data, 
            aes(x = x_center, y = y_center - 5, label = paste0(Inflation, "%")), 
            color = "#fffce9", size = 1.5) +
  scale_fill_gradientn(colors = c(
    "#53a6e8", "#6b9bd1", "#8a8eb8", "#ab809f", "#c87284", "#e56569", "darkred"),
    trans = "log10", name = "Cumulative Inflation 2020-2025 (log10)") +
  guides(fill = guide_colorbar(
    ticks = FALSE,
    title.position = "top", 
    title.hjust = 0.5,
    barwidth = unit(10, "cm"),
    barheight = unit(0.5, "cm")
  )) +
  coord_fixed(xlim = range(hex_polygons$x) + 1,
              ylim = range(hex_polygons$y) + 1,
              expand = FALSE
              ) +
  theme_void() +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold", size = 16, margin = margin(t = 15)),
    legend.position = "bottom",
    legend.justification = "center",
    legend.title = element_text(family = "poppins", face = "bold", size = 10), 
    legend.text  = element_text(family = "poppins", size = 9),
    legend.box.spacing = unit(0, "pt"), 
    legend.margin = margin(t = -10, b = 5, unit = "pt")
  ) +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold", size = 15, family = "poppins"),
    legend.position = "bottom", margins = margin(t = 20, b = 40)
  ) +
  labs(title = "Consumer Inflation 2020-2025")

print(plot)
```
