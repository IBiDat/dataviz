<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>


  <!--radix_placeholder_meta_tags-->
  <title>2023 Spanish National Election Map</title>

  <meta property="description" itemprop="description" content="This project focuses on the replication of a selected data visualization of&#10;the Spannish General Election 2023 in order to faithfully reproduce its&#10;structure, visual encodings, and underlying data transformations."/>


  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2026-01-15"/>
  <meta property="article:created" itemprop="dateCreated" content="2026-01-15"/>
  <meta name="article:author" content="David Valero-Regalón"/>

  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="2023 Spanish National Election Map"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="This project focuses on the replication of a selected data visualization of&#10;the Spannish General Election 2023 in order to faithfully reproduce its&#10;structure, visual encodings, and underlying data transformations."/>
  <meta property="og:locale" content="en_US"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="2023 Spanish National Election Map"/>
  <meta property="twitter:description" content="This project focuses on the replication of a selected data visualization of&#10;the Spannish General Election 2023 in order to faithfully reproduce its&#10;structure, visual encodings, and underlying data transformations."/>

  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","categories","author","date","output"]}},"value":[{"type":"character","attributes":{},"value":["2023 Spanish National Election Map"]},{"type":"character","attributes":{},"value":["This project focuses on the replication of a selected data visualization of\nthe Spannish General Election 2023 in order to faithfully reproduce its\nstructure, visual encodings, and underlying data transformations.\n"]},{"type":"character","attributes":{},"value":["2025"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["David Valero-Regalón"]}]}]},{"type":"character","attributes":{},"value":["2026-01-15"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]}]}]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["100561036_files/figure-html5/map-plot-1.png","2023_Spanish_general_election_map.svg.png","PROV_02_202307_1.xlsx"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
    font-size: 100%;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  hr.section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    margin: 0px;
  }


  d-byline {
    border-top: none;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
    border-top: none;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  /* tweak for Pandoc numbered line within distill */
  d-article pre.numberSource code > span {
      left: -2em;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }

  /* Citation hover box */

  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }

  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // separator
    var separator = '<hr class="section-separator" style="clear: both"/>';
    // prepend separator above appendix
    $('.d-byline').before(separator);
    $('.d-article').before(separator);

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme, except when numbering line
    // in code chunk
    $('pre:not(.numberLines) code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        var author_name = front_matter.authors[i].author
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', author_name ? 'ORCID ID for ' + author_name : 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // hoverable references
      $('span.citation[data-cites]').each(function() {
        const citeChild = $(this).children()[0]
        // Do not process if @xyz has been used without escaping and without bibliography activated
        // https://github.com/rstudio/distill/issues/466
        if (citeChild === undefined) return true

        if (citeChild.nodeName == "D-FOOTNOTE") {
          var fn = citeChild
          $(this).html(fn.shadowRoot.querySelector("sup"))
          $(this).id = fn.id
          fn.remove()
        }
        var refs = $(this).attr('data-cites').split(" ");
        var refHtml = refs.map(function(ref) {
          // Could use CSS.escape too here, we insure backward compatibility in navigator
          return "<p>" + $('div[id="ref-' + ref + '"]').html() + "</p>";
        }).join("\n");
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });

      // fix footnotes in tables (#411)
      // replacing broken distill.pub feature
      $('table d-footnote').each(function() {
        // we replace internal showAtNode methode which is triggered when hovering a footnote
        this.hoverBox.showAtNode = function(node) {
          // ported from https://github.com/distillpub/template/pull/105/files
          calcOffset = function(elem) {
              let x = elem.offsetLeft;
              let y = elem.offsetTop;
              // Traverse upwards until an `absolute` element is found or `elem`
              // becomes null.
              while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                  x += elem.offsetLeft;
                  y += elem.offsetTop;
              }

              return { left: x, top: y };
          }
          // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
          const bbox = node.getBoundingClientRect();
          const offset = calcOffset(node);
          this.show([offset.left + bbox.width, offset.top + bbox.height]);
        }
      })

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      // ignore leaflet img layers (#106)
      figures = figures.filter(':not(img[class*="leaflet"])')
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <!--/radix_placeholder_distill-->
  <script src="100561036_files/header-attrs-2.30/header-attrs.js"></script>
  <script src="100561036_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="100561036_files/popper-2.6.0/popper.min.js"></script>
  <link href="100561036_files/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="100561036_files/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="100561036_files/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="100561036_files/anchor-4.2.2/anchor.min.js"></script>
  <script src="100561036_files/bowser-1.9.3/bowser.min.js"></script>
  <script src="100561036_files/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="100561036_files/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"2023 Spanish National Election Map","description":"This project focuses on the replication of a selected data visualization of\nthe Spannish General Election 2023 in order to faithfully reproduce its\nstructure, visual encodings, and underlying data transformations.","authors":[{"author":"David Valero-Regalón","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2026-01-15T00:00:00.000+01:00","citationText":"Valero-Regalón, 2026"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>2023 Spanish National Election Map</h1>

<!--radix_placeholder_categories-->
<div class="dt-tags">
<div class="dt-tag">2025</div>
</div>
<!--/radix_placeholder_categories-->
<p><p>This project focuses on the replication of a selected data visualization of
the Spannish General Election 2023 in order to faithfully reproduce its
structure, visual encodings, and underlying data transformations.</p></p>
</div>

<div class="d-byline">
  
  David Valero-Regalón
  
<br/>2026-01-15
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#introduction-and-reference-visualization" id="toc-introduction-and-reference-visualization">Introduction and reference visualization</a></li>
<li><a href="#data-sources-and-preprocessing" id="toc-data-sources-and-preprocessing">Data sources and preprocessing</a></li>
<li><a href="#electoral-results-and-color-encoding" id="toc-electoral-results-and-color-encoding">Electoral results and color encoding</a></li>
<li><a href="#spatial-data-and-seat-layout" id="toc-spatial-data-and-seat-layout">Spatial data and seat layout</a></li>
<li><a href="#zoomed-insets-for-selected-provinces" id="toc-zoomed-insets-for-selected-provinces">Zoomed insets for selected provinces</a></li>
<li><a href="#national-level-summary-chart" id="toc-national-level-summary-chart">National-level summary chart</a></li>
<li><a href="#base-map-construction" id="toc-base-map-construction">Base map construction</a></li>
<li><a href="#custom-legends" id="toc-custom-legends">Custom legends</a></li>
<li><a href="#final-composition" id="toc-final-composition">Final composition</a></li>
</ul>
</nav>
</div>
<h2 id="introduction-and-reference-visualization">Introduction and reference visualization</h2>
<figure>
<img src="2023_Spanish_general_election_map.svg.png" alt="Original chart. Source: 2023_Spanish_general_election_map.svg.png" />
<figcaption aria-hidden="true">Original chart. Source: 2023_Spanish_general_election_map.svg.png</figcaption>
</figure>
<p>The original visualization, created by Gust Justice and published on Wikimedia Commons, depicts the results of the 2023 Spanish general election at the provincial level through a combination of territorial and symbolic encoding. The main purpose of the graphic is to provide, within a single image, a simultaneous reading of seat allocation, the territorial distribution of the vote, and the relationship between votes and parliamentary representation.</p>
<p>The map is based on Spain’s provinces, which are colored according to the party that obtained the highest number of votes in each one. Color serves not only to identify the winning party, but also to convey the strength of its victory through variations in intensity. Darker or lighter shades reflect higher or lower vote shares, making it possible to distinguish narrow wins from more decisive majorities. This dual encoding of party identity and level of support adds informational depth without the need for explicit numerical labels on the map itself.</p>
<p>Superimposed on each province is a set of circular dots representing the seats allocated in that constituency. Each dot corresponds to a single member of parliament and is colored according to party affiliation. This design choice allows the viewer to quickly assess whether representation is concentrated or fragmented. In provinces with a large number of seats, the dots are arranged in compact grid like structures, while in smaller constituencies the layout remains simpler, ensuring clarity and readability across different scales.</p>
<p>The visualization also includes specific zoomed in views for territories with particular geographic or representational characteristics, such as Madrid, Ceuta, and Melilla. These enlargements make it possible to examine seat distribution in areas where the scale of the main map would otherwise limit visual precision. In addition, the graphic features a national level summary in the form of a combined circular chart. The outer ring represents the nationwide share of the vote, while the inner circle shows the overall distribution of seats in the Congress of Deputies. This direct visual comparison highlights potential discrepancies between electoral support and parliamentary representation, a key feature of the Spanish electoral system, which is based on provincial constituencies and the D’Hondt allocation method.</p>
<p>From a political and electoral perspective, the 2023 general election was particularly significant for several reasons. First, it confirmed the persistence of a fragmented party system, moving further away from the classic two party dominance that characterized Spanish politics for decades. Although the Popular Party and the Spanish Socialist Workers’ Party captured a substantial share of the vote, parties operating at both the national and territorial levels continued to play a decisive role in shaping governability.</p>
<p>Second, the influence of nationalist and regional parties once again proved to be crucial. The visualization makes this evident both on the map, where several provinces are won by non statewide parties, and in the seat distribution, where formations such as Junts, EH Bildu, the Basque Nationalist Party, the Galician Nationalist Bloc, and the Canary Islands Coalition appear with a limited but strategically important number of deputies. This pattern underscores how the territorial dimension of voting in Spain strongly conditions the formation of parliamentary majorities and the dynamics of coalition building.</p>
<h2 id="data-sources-and-preprocessing">Data sources and preprocessing</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://r-spatial.github.io/sf/'>sf</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://ropenspain.github.io/mapSpain/'>mapSpain</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://readxl.tidyverse.org'>readxl</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://zoo.R-Forge.R-project.org/'>zoo</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://colorspace.R-Forge.R-project.org/'>colorspace</a></span><span class='op'>)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://wilkelab.org/cowplot/'>cowplot</a></span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>HEX_PP_OSCURO</span> <span class='op'>&lt;-</span> <span class='st'>"#014163"</span> </span>
<span><span class='va'>file_path</span> <span class='op'>&lt;-</span> <span class='st'>"PROV_02_202307_1.xlsx"</span></span>
<span></span>
<span><span class='va'>clean_text</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>  <span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/chartr.html'>tolower</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span></span>
<span>  <span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/iconv.html'>iconv</a></span><span class='op'>(</span><span class='va'>x</span>, from <span class='op'>=</span> <span class='st'>"UTF-8"</span>, to <span class='op'>=</span> <span class='st'>"ASCII//TRANSLIT"</span><span class='op'>)</span></span>
<span>  <span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_trim.html'>str_trim</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span></span>
<span>  <span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_replace.html'>str_replace_all</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='st'>"\\s+"</span>, <span class='st'>"_"</span><span class='op'>)</span></span>
<span>  <span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_replace.html'>str_replace_all</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='st'>"[^a-z0-9_]"</span>, <span class='st'>""</span><span class='op'>)</span></span>
<span>  <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span></span>
<span><span class='op'>}</span></span></code></pre>
</div>
</div>
<p>The data used in this project come from the official results of the 2023 Spanish general election published by the Spanish Ministry of the Interior and made available through the national open data portal datos.gob.es. The dataset offers detailed provincial level information, including vote totals and seat allocations by party, together with complementary variables such as electorate size and turnout. Relying on an official and publicly accessible source guarantees both data reliability and analytical reproducibility.</p>
<p>In its original form, however, the dataset is not directly suitable for analysis or visualization. It is designed for administrative reporting rather than analytical use, with multiple header rows, inconsistent variable naming, and a wide structure in which party specific information is dispersed across many columns. For this reason, an extensive preprocessing phase is required to convert the raw data into a coherent and analysis ready format.</p>
<p>The preprocessing process starts with the cleaning and standardization of variable names. Party labels and electoral metrics are extracted from complex headers, normalized into consistent lowercase identifiers, and harmonized to prevent ambiguities. This step is essential for ensuring clarity, reducing errors, and enabling systematic manipulation of party level variables, while maintaining clear distinctions between votes, percentages, and seats.</p>
<p>After the headers are standardized, the data are reshaped from a wide to a long format to support comparisons across parties within each province. Vote shares are then calculated as percentages of valid votes, making results comparable across constituencies of different sizes. Finally, the dataset is reorganized into a structured format in which all key electoral indicators are consistently aligned for each party and province.</p>
<h2 id="electoral-results-and-color-encoding">Electoral results and color encoding</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>raw_headers</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://readxl.tidyverse.org/reference/read_excel.html'>read_excel</a></span><span class='op'>(</span><span class='va'>file_path</span>, skip <span class='op'>=</span> <span class='fl'>4</span>, n_max <span class='op'>=</span> <span class='fl'>2</span>, col_names <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span></span>
<span><span class='va'>parties_raw</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='va'>raw_headers</span><span class='op'>[</span><span class='fl'>1</span>, <span class='op'>]</span><span class='op'>)</span></span>
<span><span class='va'>metrics_raw</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='va'>raw_headers</span><span class='op'>[</span><span class='fl'>2</span>, <span class='op'>]</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>parties_filled</span> <span class='op'>&lt;-</span> <span class='fu'>zoo</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/zoo/man/na.locf.html'>na.locf</a></span><span class='op'>(</span><span class='va'>parties_raw</span>, na.rm <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span></span>
<span><span class='va'>parties_clean</span> <span class='op'>&lt;-</span> <span class='fu'>clean_text</span><span class='op'>(</span><span class='va'>parties_filled</span><span class='op'>)</span></span>
<span><span class='va'>metrics_clean</span> <span class='op'>&lt;-</span> <span class='fu'>clean_text</span><span class='op'>(</span><span class='va'>metrics_raw</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>clean_names</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>metrics_clean</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"votos"</span>, <span class='st'>"diputados"</span><span class='op'>)</span>, </span>
<span>                      <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='va'>metrics_clean</span>, <span class='va'>parties_clean</span>, sep <span class='op'>=</span> <span class='st'>"_"</span><span class='op'>)</span>, </span>
<span>                      <span class='va'>metrics_clean</span><span class='op'>)</span></span>
<span><span class='va'>results_cleaned</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://readxl.tidyverse.org/reference/read_excel.html'>read_excel</a></span><span class='op'>(</span><span class='va'>file_path</span>, skip <span class='op'>=</span> <span class='fl'>6</span>, col_names <span class='op'>=</span> <span class='va'>clean_names</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>cols_metadata</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"nombre_de_comunidad"</span>, <span class='st'>"codigo_de_provincia"</span>, </span>
<span>                   <span class='st'>"nombre_de_provincia"</span>, <span class='st'>"poblacion"</span>, <span class='st'>"numero_de_mesas"</span>, </span>
<span>                   <span class='st'>"censo_electoral_sin_cera"</span>, <span class='st'>"censo_cera"</span>, </span>
<span>                   <span class='st'>"total_censo_electoral"</span>, <span class='st'>"total_votantes_cer"</span>, </span>
<span>                   <span class='st'>"total_votantes_cera"</span>, <span class='st'>"total_votantes"</span>, <span class='st'>"votos_validos"</span>, </span>
<span>                   <span class='st'>"votos_a_candidaturas"</span>, <span class='st'>"votos_en_blanco"</span>, <span class='st'>"votos_nulos"</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>results_long</span> <span class='op'>&lt;-</span> <span class='va'>results_cleaned</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_longer.html'>pivot_longer</a></span><span class='op'>(</span>cols <span class='op'>=</span> <span class='op'>!</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/all_of.html'>all_of</a></span><span class='op'>(</span><span class='va'>cols_metadata</span><span class='op'>)</span>, names_to <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>".value"</span>, <span class='st'>"partido"</span><span class='op'>)</span>, </span>
<span>               names_pattern <span class='op'>=</span> <span class='st'>"(votos|diputados)_(.*)"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>votos <span class='op'>=</span> <span class='fu'><a href='https://tidyr.tidyverse.org/reference/replace_na.html'>replace_na</a></span><span class='op'>(</span><span class='va'>votos</span>, <span class='fl'>0</span><span class='op'>)</span>, diputados <span class='op'>=</span> <span class='fu'><a href='https://tidyr.tidyverse.org/reference/replace_na.html'>replace_na</a></span><span class='op'>(</span><span class='va'>diputados</span>, <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>results_calculated</span> <span class='op'>&lt;-</span> <span class='va'>results_long</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/across.html'>across</a></span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/all_of.html'>all_of</a></span><span class='op'>(</span><span class='va'>cols_metadata</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>p_votos <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>votos_validos</span> <span class='op'>==</span> <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='op'>(</span><span class='va'>votos</span> <span class='op'>/</span> <span class='va'>votos_validos</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>100</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>ungroup</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>results_wide</span> <span class='op'>&lt;-</span> <span class='va'>results_calculated</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_wider.html'>pivot_wider</a></span><span class='op'>(</span>names_from <span class='op'>=</span> <span class='va'>partido</span>, values_from <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>votos</span>, <span class='va'>p_votos</span>, <span class='va'>diputados</span><span class='op'>)</span>, </span>
<span>              names_glue <span class='op'>=</span> <span class='st'>"{.value}_{partido}"</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>cols_todas</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>results_wide</span><span class='op'>)</span></span>
<span><span class='va'>cols_partidos</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>setdiff</a></span><span class='op'>(</span><span class='va'>cols_todas</span>, <span class='va'>cols_metadata</span><span class='op'>)</span></span>
<span><span class='va'>partidos_unicos</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/grep.html'>gsub</a></span><span class='op'>(</span><span class='st'>"^(votos|p_votos|diputados)_"</span>, <span class='st'>""</span>, <span class='va'>cols_partidos</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>orden_final</span> <span class='op'>&lt;-</span> <span class='va'>cols_metadata</span></span>
<span><span class='kw'>for</span> <span class='op'>(</span><span class='va'>p</span> <span class='kw'>in</span> <span class='va'>partidos_unicos</span><span class='op'>)</span> <span class='op'>{</span> <span class='va'>orden_final</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>orden_final</span>, <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"votos_"</span>, <span class='va'>p</span><span class='op'>)</span>, </span>
<span>                                              <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"p_votos_"</span>, <span class='va'>p</span><span class='op'>)</span>, </span>
<span>                                              <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"diputados_"</span>, <span class='va'>p</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>}</span></span>
<span><span class='va'>results_enriched</span> <span class='op'>&lt;-</span> <span class='va'>results_wide</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/all_of.html'>any_of</a></span><span class='op'>(</span><span class='va'>orden_final</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>party_base</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tribble.html'>tribble</a></span><span class='op'>(</span></span>
<span>  <span class='op'>~</span><span class='va'>party</span>,     <span class='op'>~</span><span class='va'>base_hex</span>,</span>
<span>  <span class='st'>"PP"</span>,       <span class='st'>"#15a6ef"</span>, <span class='st'>"PSOE"</span>,     <span class='st'>"#f11123"</span>, <span class='st'>"Vox"</span>,      <span class='st'>"#74cd30"</span>, </span>
<span>  <span class='st'>"Sumar"</span>,    <span class='st'>"#ef4a92"</span>, <span class='st'>"ERC"</span>,      <span class='st'>"#ffa503"</span>, <span class='st'>"Junts"</span>,    <span class='st'>"#00c8b0"</span>, </span>
<span>  <span class='st'>"EH Bildu"</span>, <span class='st'>"#00ae8f"</span>, <span class='st'>"PNV"</span>,      <span class='st'>"#48b049"</span>,</span>
<span>  <span class='st'>"BNG"</span>,      <span class='st'>"#aed0ef"</span>, <span class='st'>"CC"</span>,       <span class='st'>"#ffd800"</span>, <span class='st'>"UPN"</span>,      <span class='st'>"#00589c"</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>party_colours</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tribble.html'>tribble</a></span><span class='op'>(</span></span>
<span>  <span class='op'>~</span><span class='va'>party</span>,   <span class='op'>~</span><span class='va'>bin</span>,      <span class='op'>~</span><span class='va'>hex</span>,</span>
<span>  </span>
<span>  <span class='st'>"PP"</span>, <span class='st'>"0-25"</span>,    <span class='st'>"#b1e0f9"</span>,</span>
<span>  <span class='st'>"PP"</span>, <span class='st'>"25-30"</span>,   <span class='st'>"#7fcdf5"</span>,</span>
<span>  <span class='st'>"PP"</span>, <span class='st'>"30-35"</span>,   <span class='st'>"#4cb9f2"</span>,</span>
<span>  <span class='st'>"PP"</span>, <span class='st'>"35-40"</span>,   <span class='st'>"#15a6ef"</span>,</span>
<span>  <span class='st'>"PP"</span>, <span class='st'>"40-45"</span>,   <span class='st'>"#0687c7"</span>,</span>
<span>  <span class='st'>"PP"</span>, <span class='st'>"45-50"</span>,   <span class='st'>"#036596"</span>,</span>
<span>  <span class='st'>"PP"</span>, <span class='st'>"50plus"</span>,  <span class='st'>"#014163"</span>,</span>
<span></span>
<span>  <span class='st'>"PSOE"</span>, <span class='st'>"0-25"</span>,   <span class='st'>"#fbb0b5"</span>,</span>
<span>  <span class='st'>"PSOE"</span>, <span class='st'>"25-30"</span>,  <span class='st'>"#f87d87"</span>,</span>
<span>  <span class='st'>"PSOE"</span>, <span class='st'>"30-35"</span>,  <span class='st'>"#f44956"</span>,</span>
<span>  <span class='st'>"PSOE"</span>, <span class='st'>"35-40"</span>,  <span class='st'>"#f11123"</span>,</span>
<span>  <span class='st'>"PSOE"</span>, <span class='st'>"40-45"</span>,  <span class='st'>"#ca0413"</span>,</span>
<span>  <span class='st'>"PSOE"</span>, <span class='st'>"45-50"</span>,  <span class='st'>"#98020b"</span>,</span>
<span>  <span class='st'>"PSOE"</span>, <span class='st'>"50plus"</span>, <span class='st'>"#640106"</span>,</span>
<span></span>
<span>  <span class='st'>"EH Bildu"</span>, <span class='st'>"0-25"</span>,   <span class='st'>"#c0f8ef"</span>,</span>
<span>  <span class='st'>"EH Bildu"</span>, <span class='st'>"25-30"</span>,  <span class='st'>"#76f0db"</span>,</span>
<span>  <span class='st'>"EH Bildu"</span>, <span class='st'>"30-35"</span>,  <span class='st'>"#22e8c7"</span>,</span>
<span>  <span class='st'>"EH Bildu"</span>, <span class='st'>"35-40"</span>,  <span class='st'>"#00b999"</span>,</span>
<span>  <span class='st'>"EH Bildu"</span>, <span class='st'>"40-45"</span>,  <span class='st'>"#009076"</span>,</span>
<span>  <span class='st'>"EH Bildu"</span>, <span class='st'>"45-50"</span>,  <span class='st'>"#006653"</span>,</span>
<span>  <span class='st'>"EH Bildu"</span>, <span class='st'>"50plus"</span>, <span class='st'>"#003a2d"</span>,</span>
<span></span>
<span>  <span class='st'>"PNV"</span>, <span class='st'>"0-25"</span>,    <span class='st'>"#c3e8c3"</span>,</span>
<span>  <span class='st'>"PNV"</span>, <span class='st'>"25-30"</span>,   <span class='st'>"#9dd99d"</span>,</span>
<span>  <span class='st'>"PNV"</span>, <span class='st'>"30-35"</span>,   <span class='st'>"#77ca77"</span>,</span>
<span>  <span class='st'>"PNV"</span>, <span class='st'>"35-40"</span>,   <span class='st'>"#4fbb4f"</span>,</span>
<span>  <span class='st'>"PNV"</span>, <span class='st'>"40-45"</span>,   <span class='st'>"#399a39"</span>,</span>
<span>  <span class='st'>"PNV"</span>, <span class='st'>"45-50"</span>,   <span class='st'>"#297429"</span>,</span>
<span>  <span class='st'>"PNV"</span>, <span class='st'>"50plus"</span>,  <span class='st'>"#184c18"</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>results_final_mapa</span> <span class='op'>&lt;-</span> <span class='va'>results_enriched</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/bind_cols.html'>bind_cols</a></span><span class='op'>(</span></span>
<span>    <span class='va'>results_enriched</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>starts_with</a></span><span class='op'>(</span><span class='st'>"p_votos_"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>id_row <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/row_number.html'>row_number</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span> </span>
<span>      <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_longer.html'>pivot_longer</a></span><span class='op'>(</span>cols <span class='op'>=</span> <span class='op'>-</span><span class='va'>id_row</span>, names_to <span class='op'>=</span> <span class='st'>"partido_temp"</span>, values_to <span class='op'>=</span> <span class='st'>"pct_temp"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>      <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>id_row</span><span class='op'>)</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice_max</a></span><span class='op'>(</span><span class='va'>pct_temp</span>, n <span class='op'>=</span> <span class='fl'>1</span>, with_ties <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>ungroup</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>      <span class='fu'><a href='https://dplyr.tidyverse.org/reference/transmute.html'>transmute</a></span><span class='op'>(</span>ganador_raw <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>gsub</a></span><span class='op'>(</span><span class='st'>"p_votos_"</span>, <span class='st'>""</span>, <span class='va'>partido_temp</span><span class='op'>)</span>, ganador_pct <span class='op'>=</span> <span class='va'>pct_temp</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    ganador <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span></span>
<span>      <span class='va'>ganador_raw</span> <span class='op'>==</span> <span class='st'>"pp"</span> <span class='op'>~</span> <span class='st'>"PP"</span>, <span class='va'>ganador_raw</span> <span class='op'>==</span> <span class='st'>"psoe"</span> <span class='op'>~</span> <span class='st'>"PSOE"</span>, </span>
<span>      <span class='va'>ganador_raw</span> <span class='op'>==</span> <span class='st'>"vox"</span> <span class='op'>~</span> <span class='st'>"Vox"</span>,</span>
<span>      <span class='va'>ganador_raw</span> <span class='op'>==</span> <span class='st'>"sumar"</span> <span class='op'>~</span> <span class='st'>"Sumar"</span>, <span class='va'>ganador_raw</span> <span class='op'>==</span> <span class='st'>"jxcat__junts"</span> <span class='op'>~</span> <span class='st'>"Junts"</span>,</span>
<span>      <span class='va'>ganador_raw</span> <span class='op'>==</span> <span class='st'>"eh_bildu"</span> <span class='op'>~</span> <span class='st'>"EH Bildu"</span>, <span class='va'>ganador_raw</span> <span class='op'>==</span> <span class='st'>"eajpnv"</span> <span class='op'>~</span> <span class='st'>"PNV"</span>,</span>
<span>      <span class='va'>ganador_raw</span> <span class='op'>==</span> <span class='st'>"erc"</span> <span class='op'>~</span> <span class='st'>"ERC"</span>, <span class='va'>ganador_raw</span> <span class='op'>==</span> <span class='st'>"bng"</span> <span class='op'>~</span> <span class='st'>"BNG"</span>, </span>
<span>      <span class='va'>ganador_raw</span> <span class='op'>==</span> <span class='st'>"cca"</span> <span class='op'>~</span> <span class='st'>"CC"</span>,</span>
<span>      <span class='va'>ganador_raw</span> <span class='op'>==</span> <span class='st'>"upn"</span> <span class='op'>~</span> <span class='st'>"UPN"</span>, <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/base/chartr.html'>toupper</a></span><span class='op'>(</span><span class='va'>ganador_raw</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    ganador_bin <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/cut.html'>cut</a></span><span class='op'>(</span><span class='va'>ganador_pct</span>, breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>25</span>, <span class='fl'>30</span>, <span class='fl'>35</span>, <span class='fl'>40</span>, <span class='fl'>45</span>, <span class='fl'>50</span>, <span class='fl'>101</span><span class='op'>)</span>,</span>
<span>                      labels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"0-25"</span>, <span class='st'>"25-30"</span>, <span class='st'>"30-35"</span>, <span class='st'>"35-40"</span>, <span class='st'>"40-45"</span>,</span>
<span>                                 <span class='st'>"45-50"</span>, <span class='st'>"50plus"</span><span class='op'>)</span>,</span>
<span>                      include.lowest <span class='op'>=</span> <span class='cn'>TRUE</span>, right <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>party_colours</span>, by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"ganador"</span> <span class='op'>=</span> <span class='st'>"party"</span>, <span class='st'>"ganador_bin"</span> <span class='op'>=</span> <span class='st'>"bin"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>party_base</span>, by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"ganador"</span> <span class='op'>=</span> <span class='st'>"party"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>final_hex <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/coalesce.html'>coalesce</a></span><span class='op'>(</span><span class='va'>hex</span>, <span class='va'>base_hex</span>, <span class='st'>"#d3d3d3"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='op'>-</span><span class='va'>ganador_raw</span>, <span class='op'>-</span><span class='va'>hex</span>, <span class='op'>-</span><span class='va'>base_hex</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>This section codes the logic used to transform electoral results into visual encodings within the codebase. The goal is to map complex, multidimensional electoral data onto a reduced set of visual variables while preserving interpretability and analytical fidelity.</p>
<p>For each province, the winning party is identified as the one with the highest share of valid votes. This criterion mirrors the logic of the reference visualization and deliberately prioritizes voter support over seat allocation. Once the winning party is determined, a categorical color scheme is applied. Each party is assigned a fixed base color that is reused consistently across the map, the seat symbols, and the national summary components, ensuring coherence between all visual elements generated by the code.</p>
<p>Beyond party identification, the strength of electoral support is encoded through color intensity. Vote shares are discretized into a limited number of predefined intervals, ranging from narrow pluralities to strong majorities. These classes are mapped to variations in the saturation of the party’s base color. This binning strategy allows the visualization to convey relative strength without introducing numeric labels, which would complicate rendering and reduce legibility. The choice of discrete classes over a continuous scale further improves perceptual clarity and implementation robustness.</p>
<p>The resulting color assigned to each province therefore encodes two dimensions simultaneously: the identity of the winning party and the relative magnitude of its victory. When vote share data are missing or do not match any predefined interval, the code falls back to the party’s base color in order to preserve visual continuity and avoid undefined states.</p>
<h2 id="spatial-data-and-seat-layout">Spatial data and seat layout</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>mapa_provincias_raw</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://ropenspain.github.io/mapSpain/reference/esp_get_prov.html'>esp_get_prov</a></span><span class='op'>(</span>year <span class='op'>=</span> <span class='st'>"2021"</span>, epsg <span class='op'>=</span> <span class='fl'>3857</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>melilla_main</span> <span class='op'>&lt;-</span> <span class='va'>mapa_provincias_raw</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>cpro</span> <span class='op'>==</span> <span class='st'>"52"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_cast.html'>st_cast</a></span><span class='op'>(</span><span class='st'>"POLYGON"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>area <span class='op'>=</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/geos_measures.html'>st_area</a></span><span class='op'>(</span><span class='va'>geometry</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice_max</a></span><span class='op'>(</span><span class='va'>area</span>, n <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='op'>-</span><span class='va'>area</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>ceuta_main</span> <span class='op'>&lt;-</span> <span class='va'>mapa_provincias_raw</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>cpro</span> <span class='op'>==</span> <span class='st'>"51"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_cast.html'>st_cast</a></span><span class='op'>(</span><span class='st'>"POLYGON"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>area <span class='op'>=</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/geos_measures.html'>st_area</a></span><span class='op'>(</span><span class='va'>geometry</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice_max</a></span><span class='op'>(</span><span class='va'>area</span>, n <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='op'>-</span><span class='va'>area</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>mapa_provincias</span> <span class='op'>&lt;-</span> <span class='va'>mapa_provincias_raw</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='va'>cpro</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"51"</span>, <span class='st'>"52"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/bind_rows.html'>bind_rows</a></span><span class='op'>(</span><span class='va'>melilla_main</span>, <span class='va'>ceuta_main</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>data_mapa</span> <span class='op'>&lt;-</span> <span class='va'>results_final_mapa</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>cpro <span class='op'>=</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_pad.html'>str_pad</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='va'>codigo_de_provincia</span><span class='op'>)</span>, width <span class='op'>=</span> <span class='fl'>2</span>, pad <span class='op'>=</span> <span class='st'>"0"</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>mapa_completo</span> <span class='op'>&lt;-</span> <span class='va'>mapa_provincias</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>data_mapa</span>, by <span class='op'>=</span> <span class='st'>"cpro"</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>manual_offsets</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  cpro <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"08"</span>, <span class='st'>"48"</span>, <span class='st'>"20"</span><span class='op'>)</span>, </span>
<span>  move_x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>160000</span>, <span class='op'>-</span><span class='fl'>20000</span>, <span class='fl'>50000</span><span class='op'>)</span>, </span>
<span>  move_y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>120000</span>, <span class='fl'>80000</span>, <span class='fl'>80000</span><span class='op'>)</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>centroids_base</span> <span class='op'>&lt;-</span> <span class='va'>mapa_provincias</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://r-spatial.github.io/sf/reference/geos_unary.html'>st_centroid</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>cpro</span>, <span class='va'>ine.prov.name</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    real_x <span class='op'>=</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_coordinates.html'>st_coordinates</a></span><span class='op'>(</span><span class='va'>geometry</span><span class='op'>)</span><span class='op'>[</span>,<span class='fl'>1</span><span class='op'>]</span>,</span>
<span>    real_y <span class='op'>=</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_coordinates.html'>st_coordinates</a></span><span class='op'>(</span><span class='va'>geometry</span><span class='op'>)</span><span class='op'>[</span>,<span class='fl'>2</span><span class='op'>]</span></span>
<span>  <span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_geometry.html'>st_drop_geometry</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>centroids</span> <span class='op'>&lt;-</span> <span class='va'>centroids_base</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>manual_offsets</span>, by <span class='op'>=</span> <span class='st'>"cpro"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    cx <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>move_x</span><span class='op'>)</span>, <span class='va'>real_x</span> <span class='op'>+</span> <span class='va'>move_x</span>, <span class='va'>real_x</span><span class='op'>)</span>,</span>
<span>    cy <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>move_y</span><span class='op'>)</span>, <span class='va'>real_y</span> <span class='op'>+</span> <span class='va'>move_y</span>, <span class='va'>real_y</span><span class='op'>)</span>,</span>
<span>    is_displaced <span class='op'>=</span> <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>move_x</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>seats_data</span> <span class='op'>&lt;-</span> <span class='va'>results_enriched</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/distinct.html'>distinct</a></span><span class='op'>(</span><span class='va'>codigo_de_provincia</span>, .keep_all <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>codigo_de_provincia</span>, <span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>matches</a></span><span class='op'>(</span><span class='st'>"diputados_"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_longer.html'>pivot_longer</a></span><span class='op'>(</span></span>
<span>    cols <span class='op'>=</span> <span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>starts_with</a></span><span class='op'>(</span><span class='st'>"diputados_"</span><span class='op'>)</span>,</span>
<span>    names_to <span class='op'>=</span> <span class='st'>"party_raw"</span>,</span>
<span>    values_to <span class='op'>=</span> <span class='st'>"seats"</span></span>
<span>  <span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>seats</span> <span class='op'>&gt;</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    party_clean <span class='op'>=</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_remove.html'>str_remove</a></span><span class='op'>(</span><span class='va'>party_raw</span>, <span class='st'>"diputados_"</span><span class='op'>)</span>,</span>
<span>    party <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span></span>
<span>      <span class='va'>party_clean</span> <span class='op'>==</span> <span class='st'>"pp"</span> <span class='op'>~</span> <span class='st'>"PP"</span>,</span>
<span>      <span class='va'>party_clean</span> <span class='op'>==</span> <span class='st'>"psoe"</span> <span class='op'>~</span> <span class='st'>"PSOE"</span>,</span>
<span>      <span class='va'>party_clean</span> <span class='op'>==</span> <span class='st'>"vox"</span> <span class='op'>~</span> <span class='st'>"Vox"</span>,</span>
<span>      <span class='va'>party_clean</span> <span class='op'>==</span> <span class='st'>"sumar"</span> <span class='op'>~</span> <span class='st'>"Sumar"</span>,</span>
<span>      <span class='va'>party_clean</span> <span class='op'>==</span> <span class='st'>"erc"</span> <span class='op'>~</span> <span class='st'>"ERC"</span>,</span>
<span>      <span class='va'>party_clean</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"jxcat__junts"</span>, <span class='st'>"junts"</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"Junts"</span>,</span>
<span>      <span class='va'>party_clean</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"eh_bildu"</span>, <span class='st'>"bildu"</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"EH Bildu"</span>,</span>
<span>      <span class='va'>party_clean</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"eajpnv"</span>, <span class='st'>"pnv"</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"PNV"</span>,</span>
<span>      <span class='va'>party_clean</span> <span class='op'>==</span> <span class='st'>"bng"</span> <span class='op'>~</span> <span class='st'>"BNG"</span>,</span>
<span>      <span class='va'>party_clean</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"cca"</span>, <span class='st'>"cc"</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"CC"</span>,</span>
<span>      <span class='va'>party_clean</span> <span class='op'>==</span> <span class='st'>"upn"</span> <span class='op'>~</span> <span class='st'>"UPN"</span>,</span>
<span>      <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='st'>"Otros"</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    cpro <span class='op'>=</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_pad.html'>str_pad</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='va'>codigo_de_provincia</span><span class='op'>)</span>, width <span class='op'>=</span> <span class='fl'>2</span>, pad <span class='op'>=</span> <span class='st'>"0"</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>party_base</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>party</span>, <span class='va'>base_hex</span><span class='op'>)</span>, by <span class='op'>=</span> <span class='st'>"party"</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>province_stats</span> <span class='op'>&lt;-</span> <span class='va'>seats_data</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>cpro</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>total_seats <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>seats</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    cols_grid <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span></span>
<span>      <span class='va'>cpro</span> <span class='op'>==</span> <span class='st'>"08"</span> <span class='op'>~</span> <span class='fl'>10</span>,</span>
<span>      <span class='va'>cpro</span> <span class='op'>==</span> <span class='st'>"28"</span> <span class='op'>~</span> <span class='fl'>10</span>,</span>
<span>      <span class='va'>cpro</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"48"</span>, <span class='st'>"20"</span><span class='op'>)</span> <span class='op'>~</span> <span class='fl'>4</span>,</span>
<span>      <span class='va'>cpro</span> <span class='op'>==</span> <span class='st'>"46"</span> <span class='op'>~</span> <span class='fl'>6</span>,</span>
<span>      <span class='va'>cpro</span> <span class='op'>==</span> <span class='st'>"41"</span> <span class='op'>~</span> <span class='fl'>5</span>,</span>
<span>      <span class='va'>cpro</span> <span class='op'>==</span> <span class='st'>"03"</span> <span class='op'>~</span> <span class='fl'>5</span>,</span>
<span>      <span class='va'>cpro</span> <span class='op'>==</span> <span class='st'>"29"</span> <span class='op'>~</span> <span class='fl'>5</span>,</span>
<span>      <span class='va'>cpro</span> <span class='op'>==</span> <span class='st'>"11"</span> <span class='op'>~</span> <span class='fl'>4</span>,</span>
<span>      <span class='va'>cpro</span> <span class='op'>==</span> <span class='st'>"15"</span> <span class='op'>~</span> <span class='fl'>4</span>,</span>
<span>      <span class='va'>total_seats</span> <span class='op'>==</span> <span class='fl'>1</span> <span class='op'>~</span> <span class='fl'>1</span>,</span>
<span>      <span class='va'>total_seats</span> <span class='op'>==</span> <span class='fl'>2</span> <span class='op'>~</span> <span class='fl'>2</span>,</span>
<span>      <span class='va'>total_seats</span> <span class='op'>&lt;=</span> <span class='fl'>4</span> <span class='op'>~</span> <span class='fl'>2</span>,</span>
<span>      <span class='va'>total_seats</span> <span class='op'>&lt;=</span> <span class='fl'>6</span> <span class='op'>~</span> <span class='fl'>3</span>,</span>
<span>      <span class='va'>total_seats</span> <span class='op'>&lt;=</span> <span class='fl'>9</span> <span class='op'>~</span> <span class='fl'>3</span>,</span>
<span>      <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='fl'>4</span></span>
<span>    <span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>seats_expanded</span> <span class='op'>&lt;-</span> <span class='va'>seats_data</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>province_stats</span>, by <span class='op'>=</span> <span class='st'>"cpro"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='va'>cpro</span>, <span class='fu'><a href='https://dplyr.tidyverse.org/reference/desc.html'>desc</a></span><span class='op'>(</span><span class='va'>seats</span><span class='op'>)</span>, <span class='va'>party</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/uncount.html'>uncount</a></span><span class='op'>(</span><span class='va'>seats</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>cpro</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>seat_id <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/row_number.html'>row_number</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>ungroup</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>SPACING</span> <span class='op'>&lt;-</span> <span class='fl'>22000</span> </span>
<span></span>
<span><span class='va'>lines_data</span> <span class='op'>&lt;-</span> <span class='va'>centroids</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>is_displaced</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>province_stats</span>, by <span class='op'>=</span> <span class='st'>"cpro"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    total_rows <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>ceiling</a></span><span class='op'>(</span><span class='va'>total_seats</span> <span class='op'>/</span> <span class='va'>cols_grid</span><span class='op'>)</span>,</span>
<span>    approx_text_y <span class='op'>=</span> <span class='va'>cy</span> <span class='op'>+</span> <span class='op'>(</span><span class='op'>(</span><span class='va'>total_rows</span> <span class='op'>-</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>*</span> <span class='va'>SPACING</span> <span class='op'>/</span> <span class='fl'>2</span><span class='op'>)</span> <span class='op'>+</span> <span class='fl'>24000</span>,</span>
<span>    end_y <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span></span>
<span>      <span class='va'>cpro</span> <span class='op'>==</span> <span class='st'>"08"</span> <span class='op'>~</span> <span class='va'>approx_text_y</span> <span class='op'>+</span> <span class='fl'>5000</span>,</span>
<span>      <span class='va'>move_y</span> <span class='op'>&gt;</span> <span class='fl'>0</span> <span class='op'>~</span> <span class='va'>cy</span> <span class='op'>-</span> <span class='fl'>30000</span>,</span>
<span>      <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='va'>cy</span> <span class='op'>+</span> <span class='fl'>40000</span></span>
<span>    <span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>seats_coords</span> <span class='op'>&lt;-</span> <span class='va'>seats_expanded</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>centroids</span>, by <span class='op'>=</span> <span class='st'>"cpro"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    row_idx <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>floor</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>seat_id</span> <span class='op'>-</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>/</span> <span class='va'>cols_grid</span><span class='op'>)</span>,</span>
<span>    col_idx_internal <span class='op'>=</span> <span class='op'>(</span><span class='va'>seat_id</span> <span class='op'>-</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'><a href='https://rdrr.io/r/base/Arithmetic.html'>%%</a></span> <span class='va'>cols_grid</span></span>
<span>  <span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>cpro</span>, <span class='va'>row_idx</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>dots_in_this_row <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>n</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>ungroup</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    total_rows <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>ceiling</a></span><span class='op'>(</span><span class='va'>total_seats</span> <span class='op'>/</span> <span class='va'>cols_grid</span><span class='op'>)</span>,</span>
<span>    x_pos <span class='op'>=</span> <span class='va'>cx</span> <span class='op'>+</span> <span class='op'>(</span><span class='va'>col_idx_internal</span> <span class='op'>*</span> <span class='va'>SPACING</span><span class='op'>)</span> <span class='op'>-</span></span>
<span>      <span class='op'>(</span><span class='op'>(</span><span class='va'>dots_in_this_row</span> <span class='op'>-</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>*</span> <span class='va'>SPACING</span> <span class='op'>/</span> <span class='fl'>2</span><span class='op'>)</span>,</span>
<span>    y_pos <span class='op'>=</span> <span class='va'>cy</span> <span class='op'>-</span> <span class='op'>(</span><span class='va'>row_idx</span> <span class='op'>*</span> <span class='va'>SPACING</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>      <span class='op'>(</span><span class='op'>(</span><span class='va'>total_rows</span> <span class='op'>-</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>*</span> <span class='va'>SPACING</span> <span class='op'>/</span> <span class='fl'>2</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>label_data</span> <span class='op'>&lt;-</span> <span class='va'>province_stats</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>centroids</span>, by <span class='op'>=</span> <span class='st'>"cpro"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span></span>
<span>    <span class='va'>mapa_completo</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_geometry.html'>st_drop_geometry</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>cpro</span>, <span class='va'>final_hex</span><span class='op'>)</span>,</span>
<span>    by <span class='op'>=</span> <span class='st'>"cpro"</span></span>
<span>  <span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    total_rows <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>ceiling</a></span><span class='op'>(</span><span class='va'>total_seats</span> <span class='op'>/</span> <span class='va'>cols_grid</span><span class='op'>)</span>,</span>
<span>    y_label <span class='op'>=</span> <span class='va'>cy</span> <span class='op'>+</span> <span class='op'>(</span><span class='op'>(</span><span class='va'>total_rows</span> <span class='op'>-</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>*</span> <span class='va'>SPACING</span> <span class='op'>/</span> <span class='fl'>2</span><span class='op'>)</span> <span class='op'>+</span> <span class='fl'>24000</span>,</span>
<span>    provincia_limpia <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span></span>
<span>      <span class='va'>ine.prov.name</span> <span class='op'>==</span> <span class='st'>"Rioja, La"</span> <span class='op'>~</span> <span class='st'>"La Rioja"</span>,</span>
<span>      <span class='va'>ine.prov.name</span> <span class='op'>==</span> <span class='st'>"Coruña, A"</span> <span class='op'>~</span> <span class='st'>"A Coruña"</span>,</span>
<span>      <span class='va'>ine.prov.name</span> <span class='op'>==</span> <span class='st'>"Palmas, Las"</span> <span class='op'>~</span> <span class='st'>"Las Palmas"</span>,</span>
<span>      <span class='va'>ine.prov.name</span> <span class='op'>==</span> <span class='st'>"Balears, Illes"</span> <span class='op'>~</span> <span class='st'>"Illes Balears"</span>,</span>
<span>      <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_detect.html'>str_detect</a></span><span class='op'>(</span><span class='va'>ine.prov.name</span>, <span class='st'>"Alicante"</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"Alicante"</span>,</span>
<span>      <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_detect.html'>str_detect</a></span><span class='op'>(</span><span class='va'>ine.prov.name</span>, <span class='st'>"Valencia"</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"Valencia"</span>,</span>
<span>      <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_detect.html'>str_detect</a></span><span class='op'>(</span><span class='va'>ine.prov.name</span>, <span class='st'>"Castellón"</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"Castellón"</span>,</span>
<span>      <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_detect.html'>str_detect</a></span><span class='op'>(</span><span class='va'>ine.prov.name</span>, <span class='st'>"Araba"</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"Álava"</span>,</span>
<span>      <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_detect.html'>str_detect</a></span><span class='op'>(</span><span class='va'>ine.prov.name</span>, <span class='st'>"Bizkaia"</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"Bizkaia"</span>,</span>
<span>      <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_detect.html'>str_detect</a></span><span class='op'>(</span><span class='va'>ine.prov.name</span>, <span class='st'>"Gipuzkoa"</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"Gipuzkoa"</span>,</span>
<span>      <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='va'>ine.prov.name</span></span>
<span>    <span class='op'>)</span></span>
<span>  <span class='op'>)</span></span></code></pre>
</div>
</div>
<p>The spatial layer of the visualization is implemented using official provincial boundaries provided by the mapSpain package, which supplies harmonized administrative geometries for Spain. Provinces are selected as the core territorial unit because they coincide exactly with the electoral constituencies used for elections to the Congress of Deputies. Operating at this scale guarantees alignment between the geographic representation produced by the code and the institutional rules that govern seat distribution.</p>
<p>Several geometric adjustments are applied to ensure that the map can support a dense symbolic overlay. Small or fragmented geometries, such as those corresponding to Ceuta and Melilla, are simplified to their main polygon in order to reduce visual noise. In addition, specific provinces are manually displaced to prevent overlaps between symbols, labels, and adjacent territories. These transformations affect only the rendered geometry and do not modify the underlying electoral data, thereby improving legibility while preserving the relational structure encoded in the map.</p>
<p>Parliamentary representation is rendered through discrete symbolic elements, with each dot corresponding to a single seat in the Congress of Deputies. Within each province, dots are arranged into compact grid like layouts, where the number of columns adapts dynamically to the size of the constituency. This strategy allows the code to scale symbol placement consistently across provinces with very different seat counts while maintaining visual clarity.</p>
<h2 id="zoomed-insets-for-selected-provinces">Zoomed insets for selected provinces</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>codigos_zoom</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"28"</span>, <span class='st'>"51"</span>, <span class='st'>"52"</span><span class='op'>)</span> </span>
<span></span>
<span><span class='va'>crear_zoom</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>codigo_prov</span>, <span class='va'>nombre_prov</span>, <span class='va'>n_cols_grid</span>, <span class='va'>spacing_custom</span>, </span>
<span>                       <span class='va'>size_dots</span>, </span>
<span>                       <span class='va'>radio_vista</span> <span class='op'>=</span> <span class='cn'>NULL</span>, <span class='va'>draw_line_below</span> <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>  </span>
<span>  <span class='va'>prov_sf</span>    <span class='op'>&lt;-</span> <span class='va'>mapa_completo</span>  <span class='op'>|&gt;</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>cpro</span> <span class='op'>==</span> <span class='va'>codigo_prov</span><span class='op'>)</span></span>
<span>  <span class='va'>prov_seats</span> <span class='op'>&lt;-</span> <span class='va'>seats_expanded</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>cpro</span> <span class='op'>==</span> <span class='va'>codigo_prov</span><span class='op'>)</span></span>
<span>  </span>
<span>  <span class='va'>bbox</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_bbox.html'>st_bbox</a></span><span class='op'>(</span><span class='va'>prov_sf</span><span class='op'>)</span></span>
<span>  <span class='va'>alto_prov</span> <span class='op'>&lt;-</span> <span class='va'>bbox</span><span class='op'>$</span><span class='va'>ymax</span> <span class='op'>-</span> <span class='va'>bbox</span><span class='op'>$</span><span class='va'>ymin</span></span>
<span>  <span class='va'>centro</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/geos_unary.html'>st_centroid</a></span><span class='op'>(</span><span class='va'>prov_sf</span><span class='op'>)</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_coordinates.html'>st_coordinates</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span>  <span class='va'>cx_local</span> <span class='op'>&lt;-</span> <span class='va'>centro</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span></span>
<span>  <span class='va'>cy_local</span> <span class='op'>&lt;-</span> <span class='va'>centro</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span></span>
<span>  </span>
<span>  <span class='va'>offset_y_val</span> <span class='op'>&lt;-</span> <span class='fl'>0</span></span>
<span>  <span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NULL.html'>is.null</a></span><span class='op'>(</span><span class='va'>radio_vista</span><span class='op'>)</span> <span class='op'>&amp;&amp;</span> <span class='va'>codigo_prov</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"51"</span>, <span class='st'>"52"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>    <span class='va'>offset_y_val</span> <span class='op'>&lt;-</span> <span class='op'>-</span><span class='va'>radio_vista</span> <span class='op'>*</span> <span class='fl'>0.15</span></span>
<span>  <span class='op'>}</span></span>
<span>  </span>
<span>  <span class='va'>coords_calc</span> <span class='op'>&lt;-</span> <span class='va'>prov_seats</span> <span class='op'>|&gt;</span> </span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>      seat_id_local <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/row_number.html'>row_number</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>      row_idx <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>floor</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>seat_id_local</span> <span class='op'>-</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>/</span> <span class='va'>n_cols_grid</span><span class='op'>)</span>,</span>
<span>      col_idx <span class='op'>=</span> <span class='op'>(</span><span class='va'>seat_id_local</span> <span class='op'>-</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'><a href='https://rdrr.io/r/base/Arithmetic.html'>%%</a></span> <span class='va'>n_cols_grid</span></span>
<span>    <span class='op'>)</span> <span class='op'>|&gt;</span> </span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>row_idx</span><span class='op'>)</span> <span class='op'>|&gt;</span> </span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>dots_in_row <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>n</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span> </span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>ungroup</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>|&gt;</span> </span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>      total_rows <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>ceiling</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>n</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>/</span> <span class='va'>n_cols_grid</span><span class='op'>)</span>,</span>
<span>      x_pos <span class='op'>=</span> <span class='va'>cx_local</span> <span class='op'>+</span> <span class='op'>(</span><span class='va'>col_idx</span> <span class='op'>*</span> <span class='va'>spacing_custom</span><span class='op'>)</span> <span class='op'>-</span></span>
<span>        <span class='op'>(</span><span class='op'>(</span><span class='va'>dots_in_row</span> <span class='op'>-</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>*</span> <span class='va'>spacing_custom</span> <span class='op'>/</span> <span class='fl'>2</span><span class='op'>)</span>,</span>
<span>      y_pos <span class='op'>=</span> <span class='va'>cy_local</span> <span class='op'>-</span> <span class='op'>(</span><span class='va'>row_idx</span> <span class='op'>*</span> <span class='va'>spacing_custom</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>        <span class='op'>(</span><span class='op'>(</span><span class='va'>total_rows</span> <span class='op'>-</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>*</span> <span class='va'>spacing_custom</span> <span class='op'>/</span> <span class='fl'>2</span><span class='op'>)</span> <span class='op'>+</span> <span class='va'>offset_y_val</span></span>
<span>    <span class='op'>)</span></span>
<span>  </span>
<span>  <span class='va'>min_x_content</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>bbox</span><span class='op'>$</span><span class='va'>xmin</span>, <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>coords_calc</span><span class='op'>$</span><span class='va'>x_pos</span><span class='op'>)</span><span class='op'>)</span></span>
<span>  <span class='va'>max_x_content</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>bbox</span><span class='op'>$</span><span class='va'>xmax</span>, <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>coords_calc</span><span class='op'>$</span><span class='va'>x_pos</span><span class='op'>)</span><span class='op'>)</span></span>
<span>  </span>
<span>  <span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NULL.html'>is.null</a></span><span class='op'>(</span><span class='va'>radio_vista</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>    <span class='co'># CEUTA / MELILLA</span></span>
<span>    <span class='va'>x_line_start</span> <span class='op'>&lt;-</span> <span class='va'>cx_local</span> <span class='op'>-</span> <span class='op'>(</span><span class='va'>radio_vista</span> <span class='op'>*</span> <span class='fl'>0.9</span><span class='op'>)</span></span>
<span>    <span class='va'>x_line_end</span>   <span class='op'>&lt;-</span> <span class='va'>cx_local</span> <span class='op'>+</span> <span class='op'>(</span><span class='va'>radio_vista</span> <span class='op'>*</span> <span class='fl'>0.9</span><span class='op'>)</span></span>
<span>    <span class='va'>y_linea</span>      <span class='op'>&lt;-</span> <span class='va'>cy_local</span> <span class='op'>-</span> <span class='op'>(</span><span class='va'>radio_vista</span> <span class='op'>*</span> <span class='fl'>0.8</span><span class='op'>)</span></span>
<span>    <span class='va'>y_texto</span>      <span class='op'>&lt;-</span> <span class='va'>cy_local</span> <span class='op'>+</span> <span class='op'>(</span><span class='va'>radio_vista</span> <span class='op'>*</span> <span class='fl'>0.25</span><span class='op'>)</span></span>
<span>  <span class='op'>}</span> <span class='kw'>else</span> <span class='op'>{</span></span>
<span>    <span class='co'># MADRID</span></span>
<span>    <span class='va'>margen_x</span>      <span class='op'>&lt;-</span> <span class='va'>spacing_custom</span> <span class='op'>*</span> <span class='fl'>0.5</span></span>
<span>    <span class='va'>x_line_start</span> <span class='op'>&lt;-</span> <span class='va'>min_x_content</span> <span class='op'>-</span> <span class='va'>margen_x</span></span>
<span>    <span class='va'>x_line_end</span>   <span class='op'>&lt;-</span> <span class='va'>max_x_content</span> <span class='op'>+</span> <span class='va'>margen_x</span></span>
<span>    <span class='va'>y_linea</span>      <span class='op'>&lt;-</span> <span class='va'>bbox</span><span class='op'>$</span><span class='va'>ymin</span> <span class='op'>-</span> <span class='op'>(</span><span class='va'>alto_prov</span> <span class='op'>*</span> <span class='fl'>0.15</span><span class='op'>)</span></span>
<span>    <span class='va'>y_texto</span>      <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>coords_calc</span><span class='op'>$</span><span class='va'>y_pos</span><span class='op'>)</span> <span class='op'>+</span> <span class='op'>(</span><span class='va'>spacing_custom</span> <span class='op'>*</span> <span class='fl'>0.9</span><span class='op'>)</span></span>
<span>  <span class='op'>}</span></span>
<span>  </span>
<span>  <span class='va'>p</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span></span>
<span>      data <span class='op'>=</span> <span class='va'>prov_sf</span>,</span>
<span>      <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>final_hex</span><span class='op'>)</span>,</span>
<span>      color <span class='op'>=</span> <span class='st'>"transparent"</span>,</span>
<span>      size <span class='op'>=</span> <span class='fl'>0.2</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span></span>
<span>      data <span class='op'>=</span> <span class='va'>coords_calc</span>,</span>
<span>      <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x_pos</span>, y <span class='op'>=</span> <span class='va'>y_pos</span>, fill <span class='op'>=</span> <span class='va'>base_hex</span><span class='op'>)</span>,</span>
<span>      shape <span class='op'>=</span> <span class='fl'>21</span>,</span>
<span>      color <span class='op'>=</span> <span class='st'>"black"</span>,</span>
<span>      size <span class='op'>=</span> <span class='va'>size_dots</span>,</span>
<span>      stroke <span class='op'>=</span> <span class='fl'>0.3</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span></span>
<span>      <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>        x <span class='op'>=</span> <span class='va'>cx_local</span>,</span>
<span>        y <span class='op'>=</span> <span class='va'>y_texto</span>,</span>
<span>        label <span class='op'>=</span> <span class='va'>nombre_prov</span></span>
<span>      <span class='op'>)</span>,</span>
<span>      fontface <span class='op'>=</span> <span class='st'>"bold"</span>,</span>
<span>      size <span class='op'>=</span> <span class='fl'>3.5</span>,</span>
<span>      vjust <span class='op'>=</span> <span class='fl'>0</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_identity.html'>scale_fill_identity</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_void</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>plot.background <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span></span>
<span>  </span>
<span>  <span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/NULL.html'>is.null</a></span><span class='op'>(</span><span class='va'>radio_vista</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>    <span class='va'>p</span> <span class='op'>&lt;-</span> <span class='va'>p</span> <span class='op'>+</span></span>
<span>      <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/expand_limits.html'>expand_limits</a></span><span class='op'>(</span></span>
<span>        y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>y_linea</span> <span class='op'>-</span> <span class='fl'>500</span>, <span class='va'>y_texto</span> <span class='op'>+</span> <span class='fl'>500</span><span class='op'>)</span>,</span>
<span>        x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>x_line_start</span>, <span class='va'>x_line_end</span><span class='op'>)</span></span>
<span>      <span class='op'>)</span> <span class='op'>+</span></span>
<span>      <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>coord_sf</a></span><span class='op'>(</span>clip <span class='op'>=</span> <span class='st'>"off"</span><span class='op'>)</span></span>
<span>  <span class='op'>}</span> <span class='kw'>else</span> <span class='op'>{</span></span>
<span>    <span class='va'>p</span> <span class='op'>&lt;-</span> <span class='va'>p</span> <span class='op'>+</span></span>
<span>      <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>coord_sf</a></span><span class='op'>(</span></span>
<span>        xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>cx_local</span> <span class='op'>-</span> <span class='va'>radio_vista</span>, <span class='va'>cx_local</span> <span class='op'>+</span> <span class='va'>radio_vista</span><span class='op'>)</span>,</span>
<span>        ylim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>cy_local</span> <span class='op'>-</span> <span class='va'>radio_vista</span>, <span class='va'>cy_local</span> <span class='op'>+</span> <span class='va'>radio_vista</span><span class='op'>)</span>,</span>
<span>        expand <span class='op'>=</span> <span class='cn'>FALSE</span>,</span>
<span>        clip <span class='op'>=</span> <span class='st'>"off"</span></span>
<span>      <span class='op'>)</span></span>
<span>  <span class='op'>}</span></span>
<span>  </span>
<span>  <span class='kw'>if</span> <span class='op'>(</span><span class='va'>draw_line_below</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>    <span class='va'>p</span> <span class='op'>&lt;-</span> <span class='va'>p</span> <span class='op'>+</span></span>
<span>      <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_segment.html'>geom_segment</a></span><span class='op'>(</span></span>
<span>        <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>          x <span class='op'>=</span> <span class='va'>x_line_start</span>,</span>
<span>          xend <span class='op'>=</span> <span class='va'>x_line_end</span>,</span>
<span>          y <span class='op'>=</span> <span class='va'>y_linea</span>,</span>
<span>          yend <span class='op'>=</span> <span class='va'>y_linea</span></span>
<span>        <span class='op'>)</span>,</span>
<span>        color <span class='op'>=</span> <span class='st'>"black"</span>,</span>
<span>        linewidth <span class='op'>=</span> <span class='fl'>0.5</span></span>
<span>      <span class='op'>)</span></span>
<span>  <span class='op'>}</span></span>
<span>  </span>
<span>  <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>p</span><span class='op'>)</span></span>
<span><span class='op'>}</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>plot_madrid</span> <span class='op'>&lt;-</span> <span class='fu'>crear_zoom</span><span class='op'>(</span><span class='st'>"28"</span>, <span class='st'>"Madrid"</span>, n_cols_grid <span class='op'>=</span> <span class='fl'>10</span>, spacing_custom <span class='op'>=</span> <span class='fl'>15000</span>, </span>
<span>                          size_dots <span class='op'>=</span> <span class='fl'>4.8</span>, radio_vista <span class='op'>=</span> <span class='cn'>NULL</span>, draw_line_below <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span></span>
<span><span class='va'>plot_ceuta</span>  <span class='op'>&lt;-</span> <span class='fu'>crear_zoom</span><span class='op'>(</span><span class='st'>"51"</span>, <span class='st'>"Ceuta"</span>, n_cols_grid <span class='op'>=</span> <span class='fl'>1</span>, spacing_custom <span class='op'>=</span> <span class='fl'>5000</span>, </span>
<span>                          size_dots <span class='op'>=</span> <span class='fl'>4.8</span>, radio_vista <span class='op'>=</span> <span class='fl'>8000</span>, draw_line_below <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span></span>
<span><span class='va'>plot_melilla</span> <span class='op'>&lt;-</span> <span class='fu'>crear_zoom</span><span class='op'>(</span><span class='st'>"52"</span>, <span class='st'>"Melilla"</span>, n_cols_grid <span class='op'>=</span> <span class='fl'>1</span>, spacing_custom <span class='op'>=</span> <span class='fl'>3000</span>, </span>
<span>                           size_dots <span class='op'>=</span> <span class='fl'>4.8</span>, radio_vista <span class='op'>=</span> <span class='fl'>7500</span>, draw_line_below <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>Certain territories require specific handling in the code due to either high representational density or particular geographic constraints. For this reason, the visualization includes zoomed inset views for Madrid, Ceuta, and Melilla, which allow detailed inspection of their parliamentary representation without reducing the readability of the main map.</p>
<p>Madrid is processed separately for compositional and rendering reasons. As the province with the largest number of seats, it concentrates a high number of symbolic elements. Combined with its central position on the Iberian Peninsula, this density would introduce visual congestion in the main map and complicate symbol placement. The inset isolates Madrid and expands its spatial extent, allowing the seat distribution to remain legible while preserving overall visual balance.</p>
<p>Ceuta and Melilla, Spain’s two autonomous cities, present a different constraint. Their geographic area is extremely small, yet each constitutes an independent electoral constituency with representation in the Congress of Deputies. At the scale of the national map, their geometries are nearly imperceptible, making direct symbol placement unfeasible. The use of zoomed insets allows these territories to be rendered with an appropriate symbolic scale, accurately reflecting their representation without distorting the geographic proportions of the main map.</p>
<h2 id="national-level-summary-chart">National-level summary chart</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>df_espana</span> <span class='op'>&lt;-</span> <span class='va'>results_final_mapa</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>nombre_de_provincia</span> <span class='op'>==</span> <span class='st'>"España"</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>partidos_interes</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"pp"</span>, <span class='st'>"psoe"</span>, <span class='st'>"vox"</span>, <span class='st'>"sumar"</span>, <span class='st'>"erc"</span>,</span>
<span>  <span class='st'>"jxcat__junts"</span>, <span class='st'>"eh_bildu"</span>, <span class='st'>"eajpnv"</span>,</span>
<span>  <span class='st'>"bng"</span>, <span class='st'>"cca"</span>, <span class='st'>"upn"</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>df_seats_nac</span> <span class='op'>&lt;-</span> <span class='va'>df_espana</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>starts_with</a></span><span class='op'>(</span><span class='st'>"diputados_"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_longer.html'>pivot_longer</a></span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/everything.html'>everything</a></span><span class='op'>(</span><span class='op'>)</span>, names_to <span class='op'>=</span> <span class='st'>"partido"</span>, values_to <span class='op'>=</span> <span class='st'>"seats"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>partido <span class='op'>=</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_remove.html'>str_remove</a></span><span class='op'>(</span><span class='va'>partido</span>, <span class='st'>"^diputados_"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>partido</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='va'>partidos_interes</span>, <span class='va'>seats</span> <span class='op'>&gt;</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/desc.html'>desc</a></span><span class='op'>(</span><span class='va'>seats</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    pct_seats <span class='op'>=</span> <span class='va'>seats</span> <span class='op'>/</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>seats</span><span class='op'>)</span>,</span>
<span>    pct_shift <span class='op'>=</span> <span class='va'>pct_seats</span> <span class='op'>/</span> <span class='fl'>2</span>,</span>
<span>    x <span class='op'>=</span> <span class='fl'>1.0</span>,</span>
<span>    partido <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>partido</span>, levels <span class='op'>=</span> <span class='va'>partido</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>orden_partidos</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>df_seats_nac</span><span class='op'>$</span><span class='va'>partido</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>df_seats_nac</span> <span class='op'>&lt;-</span> <span class='va'>df_seats_nac</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>pct_seats <span class='op'>=</span> <span class='va'>pct_seats</span> <span class='op'>+</span> <span class='va'>pct_shift</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>df_votes_nac</span> <span class='op'>&lt;-</span> <span class='va'>df_espana</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>starts_with</a></span><span class='op'>(</span><span class='st'>"p_votos_"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_longer.html'>pivot_longer</a></span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/everything.html'>everything</a></span><span class='op'>(</span><span class='op'>)</span>, names_to <span class='op'>=</span> <span class='st'>"partido"</span>, values_to <span class='op'>=</span> <span class='st'>"pct_votes"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    partido <span class='op'>=</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_remove.html'>str_remove</a></span><span class='op'>(</span><span class='va'>partido</span>, <span class='st'>"^p_votos_"</span><span class='op'>)</span>,</span>
<span>    pct_votes <span class='op'>=</span> <span class='va'>pct_votes</span> <span class='op'>/</span> <span class='fl'>100</span></span>
<span>  <span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>partido</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='va'>orden_partidos</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    pct_votes <span class='op'>=</span> <span class='va'>pct_votes</span> <span class='op'>/</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>pct_votes</span><span class='op'>)</span>,</span>
<span>    pct_shift <span class='op'>=</span> <span class='va'>pct_votes</span> <span class='op'>/</span> <span class='fl'>2</span>,</span>
<span>    x <span class='op'>=</span> <span class='fl'>2.5</span>,</span>
<span>    partido <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>partido</span>, levels <span class='op'>=</span> <span class='va'>orden_partidos</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>df_votes_nac</span> <span class='op'>&lt;-</span> <span class='va'>df_votes_nac</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>pct_votes <span class='op'>=</span> <span class='va'>pct_votes</span> <span class='op'>+</span> <span class='va'>pct_shift</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>eps</span> <span class='op'>&lt;-</span> <span class='fl'>1e-6</span></span>
<span><span class='va'>df_seats_nac</span><span class='op'>$</span><span class='va'>pct_seats</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>df_seats_nac</span><span class='op'>$</span><span class='va'>pct_seats</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span> <span class='op'>+</span> <span class='va'>eps</span></span>
<span><span class='va'>df_votes_nac</span><span class='op'>$</span><span class='va'>pct_votes</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>df_votes_nac</span><span class='op'>$</span><span class='va'>pct_votes</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span> <span class='op'>+</span> <span class='va'>eps</span></span>
<span></span>
<span><span class='va'>colores_nacional</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>  pp <span class='op'>=</span> <span class='st'>"#15a6ef"</span>, psoe <span class='op'>=</span> <span class='st'>"#f11123"</span>, vox <span class='op'>=</span> <span class='st'>"#74cd30"</span>, sumar <span class='op'>=</span> <span class='st'>"#ef4a92"</span>,</span>
<span>  erc <span class='op'>=</span> <span class='st'>"#ffa503"</span>, jxcat__junts <span class='op'>=</span> <span class='st'>"#00c8b0"</span>, eh_bildu <span class='op'>=</span> <span class='st'>"#00ae8f"</span>,</span>
<span>  eajpnv <span class='op'>=</span> <span class='st'>"#48b049"</span>, bng <span class='op'>=</span> <span class='st'>"#aed0ef"</span>, cca <span class='op'>=</span> <span class='st'>"#ffd800"</span>, upn <span class='op'>=</span> <span class='st'>"#00589c"</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>plot_resumen_nacional</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_bar.html'>geom_col</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>df_seats_nac</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>pct_seats</span>, fill <span class='op'>=</span> <span class='va'>partido</span><span class='op'>)</span>,</span>
<span>    width <span class='op'>=</span> <span class='fl'>2</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='fl'>0</span>,</span>
<span>    color <span class='op'>=</span> <span class='cn'>NA</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_bar.html'>geom_col</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>df_votes_nac</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>pct_votes</span>, fill <span class='op'>=</span> <span class='va'>partido</span><span class='op'>)</span>,</span>
<span>    width <span class='op'>=</span> <span class='fl'>1</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='fl'>0</span>,</span>
<span>    color <span class='op'>=</span> <span class='cn'>NA</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span></span>
<span>    xintercept <span class='op'>=</span> <span class='fl'>2.0</span>,</span>
<span>    color <span class='op'>=</span> <span class='st'>"white"</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='fl'>1.5</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_fill_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='va'>colores_nacional</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span>limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_radial.html'>coord_polar</a></span><span class='op'>(</span>theta <span class='op'>=</span> <span class='st'>"y"</span>, start <span class='op'>=</span> <span class='va'>pi</span> <span class='op'>/</span> <span class='fl'>2</span>, direction <span class='op'>=</span> <span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fl'>1.0</span>, y <span class='op'>=</span> <span class='fl'>0.02</span><span class='op'>)</span>,</span>
<span>    label <span class='op'>=</span> <span class='st'>"Seats"</span>,</span>
<span>    color <span class='op'>=</span> <span class='st'>"black"</span>,</span>
<span>    size <span class='op'>=</span> <span class='fl'>3</span>,</span>
<span>    fontface <span class='op'>=</span> <span class='st'>"bold"</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fl'>2.9</span>, y <span class='op'>=</span> <span class='fl'>0.02</span><span class='op'>)</span>,</span>
<span>    label <span class='op'>=</span> <span class='st'>"Votes"</span>,</span>
<span>    color <span class='op'>=</span> <span class='st'>"black"</span>,</span>
<span>    size <span class='op'>=</span> <span class='fl'>3</span>,</span>
<span>    fontface <span class='op'>=</span> <span class='st'>"bold"</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_void</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    panel.background <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='st'>"transparent"</span>, color <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span>,</span>
<span>    plot.background  <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='st'>"transparent"</span>, color <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span>,</span>
<span>    legend.position  <span class='op'>=</span> <span class='st'>"none"</span></span>
<span>  <span class='op'>)</span></span></code></pre>
</div>
</div>
<p>The visualization is complemented by a national-level summary chart designed to condense the overall electoral outcome into a single, compact representation. This component combines two circular encodings to enable a direct comparison between nationwide vote shares and seat allocation.</p>
<p>The inner circle is constructed to represent the distribution of seats in the Congress of Deputies. Each segment corresponds to a political party and is sized proportionally to the number of seats obtained. This encoding reflects the effective balance of parliamentary power produced by the election and directly relates to coalition building and legislative dynamics.</p>
<p>Around this inner circle, the code generates an outer ring that displays the national share of valid votes for each party. Both encodings are aligned along the same angular dimension, allowing the visualization to juxtapose electoral support and parliamentary representation in a precise and interpretable way. Divergences between the two layers make visible the effects of the Spanish electoral system, particularly the role of provincial constituencies and the D’Hondt method in translating votes into seats.</p>
<h2 id="base-map-construction">Base map construction</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>OFFSET_CANARIAS</span> <span class='op'>&lt;-</span> <span class='op'>-</span><span class='fl'>200000</span> </span>
<span></span>
<span><span class='va'>codigos_zoom_data</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"28"</span>, <span class='st'>"51"</span>, <span class='st'>"52"</span><span class='op'>)</span></span>
<span><span class='va'>seats_coords_main</span> <span class='op'>&lt;-</span> <span class='va'>seats_coords</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='va'>cpro</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='va'>codigos_zoom_data</span><span class='op'>)</span></span>
<span><span class='va'>label_data_main</span>   <span class='op'>&lt;-</span> <span class='va'>label_data</span>   <span class='op'>|&gt;</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='va'>cpro</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='va'>codigos_zoom_data</span><span class='op'>)</span></span>
<span><span class='va'>lines_data_main</span>   <span class='op'>&lt;-</span> <span class='va'>lines_data</span>   <span class='op'>|&gt;</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='va'>cpro</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='va'>codigos_zoom_data</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>mapa_shift</span> <span class='op'>&lt;-</span> <span class='va'>mapa_completo</span></span>
<span><span class='va'>idx_can</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='va'>mapa_shift</span><span class='op'>$</span><span class='va'>cpro</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"35"</span>, <span class='st'>"38"</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_geometry.html'>st_geometry</a></span><span class='op'>(</span><span class='va'>mapa_shift</span><span class='op'>)</span><span class='op'>[</span><span class='va'>idx_can</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_geometry.html'>st_geometry</a></span><span class='op'>(</span><span class='va'>mapa_shift</span><span class='op'>)</span><span class='op'>[</span><span class='va'>idx_can</span><span class='op'>]</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='va'>OFFSET_CANARIAS</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_crs.html'>st_crs</a></span><span class='op'>(</span><span class='va'>mapa_shift</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_crs.html'>st_crs</a></span><span class='op'>(</span><span class='va'>mapa_completo</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>seats_shift</span> <span class='op'>&lt;-</span> <span class='va'>seats_coords_main</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>y_pos <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>cpro</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"35"</span>, <span class='st'>"38"</span><span class='op'>)</span>,</span>
<span>                         <span class='va'>y_pos</span> <span class='op'>+</span> <span class='va'>OFFSET_CANARIAS</span>,</span>
<span>                         <span class='va'>y_pos</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>labels_shift</span> <span class='op'>&lt;-</span> <span class='va'>label_data_main</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>y_label <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>cpro</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"35"</span>, <span class='st'>"38"</span><span class='op'>)</span>,</span>
<span>                           <span class='va'>y_label</span> <span class='op'>+</span> <span class='va'>OFFSET_CANARIAS</span>,</span>
<span>                           <span class='va'>y_label</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>sf_canarias_orig</span> <span class='op'>&lt;-</span> <span class='va'>mapa_completo</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>cpro</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"35"</span>, <span class='st'>"38"</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>bbox_can_orig</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_bbox.html'>st_bbox</a></span><span class='op'>(</span><span class='va'>sf_canarias_orig</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>rect_canarias</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  xmin <span class='op'>=</span> <span class='va'>bbox_can_orig</span><span class='op'>$</span><span class='va'>xmin</span> <span class='op'>-</span> <span class='fl'>40000</span>, </span>
<span>  xmax <span class='op'>=</span> <span class='va'>bbox_can_orig</span><span class='op'>$</span><span class='va'>xmax</span> <span class='op'>+</span> <span class='fl'>20000</span>, </span>
<span>  ymin <span class='op'>=</span> <span class='va'>bbox_can_orig</span><span class='op'>$</span><span class='va'>ymin</span> <span class='op'>-</span> <span class='fl'>20000</span> <span class='op'>+</span> <span class='va'>OFFSET_CANARIAS</span>, </span>
<span>  ymax <span class='op'>=</span> <span class='va'>bbox_can_orig</span><span class='op'>$</span><span class='va'>ymax</span> <span class='op'>+</span> <span class='fl'>80000</span> <span class='op'>+</span> <span class='va'>OFFSET_CANARIAS</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>bbox_38</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_bbox.html'>st_bbox</a></span><span class='op'>(</span><span class='va'>mapa_completo</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>cpro</span> <span class='op'>==</span> <span class='st'>"38"</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>bbox_35</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_bbox.html'>st_bbox</a></span><span class='op'>(</span><span class='va'>mapa_completo</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>cpro</span> <span class='op'>==</span> <span class='st'>"35"</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>mid_x_can</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='va'>bbox_38</span><span class='op'>$</span><span class='va'>xmax</span> <span class='op'>+</span> <span class='va'>bbox_35</span><span class='op'>$</span><span class='va'>xmin</span><span class='op'>)</span> <span class='op'>/</span> <span class='fl'>2</span></span>
<span></span>
<span><span class='va'>cy_can</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='va'>bbox_can_orig</span><span class='op'>$</span><span class='va'>ymin</span> <span class='op'>+</span> <span class='va'>bbox_can_orig</span><span class='op'>$</span><span class='va'>ymax</span><span class='op'>)</span> <span class='op'>/</span> <span class='fl'>2</span> <span class='op'>+</span> <span class='va'>OFFSET_CANARIAS</span></span>
<span></span>
<span><span class='va'>dx</span> <span class='op'>&lt;-</span> <span class='fl'>18000</span></span>
<span><span class='va'>dy</span> <span class='op'>&lt;-</span> <span class='fl'>49000</span></span>
<span><span class='va'>tx</span> <span class='op'>&lt;-</span> <span class='fl'>9000</span></span>
<span><span class='va'>ty</span> <span class='op'>&lt;-</span> <span class='fl'>23000</span></span>
<span></span>
<span><span class='va'>linea_diagonal</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  x    <span class='op'>=</span> <span class='va'>mid_x_can</span> <span class='op'>-</span> <span class='va'>dx</span> <span class='op'>+</span> <span class='va'>tx</span>,</span>
<span>  xend <span class='op'>=</span> <span class='va'>mid_x_can</span> <span class='op'>+</span> <span class='va'>dx</span> <span class='op'>+</span> <span class='va'>tx</span>,</span>
<span>  y    <span class='op'>=</span> <span class='va'>cy_can</span> <span class='op'>-</span> <span class='va'>dy</span> <span class='op'>-</span> <span class='va'>ty</span>,</span>
<span>  yend <span class='op'>=</span> <span class='va'>cy_can</span> <span class='op'>+</span> <span class='va'>dy</span> <span class='op'>-</span> <span class='va'>ty</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>centroids_zoom</span> <span class='op'>&lt;-</span> <span class='va'>mapa_provincias</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>cpro</span> <span class='op'>==</span> <span class='st'>"28"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://r-spatial.github.io/sf/reference/geos_unary.html'>st_centroid</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>cx <span class='op'>=</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_coordinates.html'>st_coordinates</a></span><span class='op'>(</span><span class='va'>geometry</span><span class='op'>)</span><span class='op'>[</span>,<span class='fl'>1</span><span class='op'>]</span>,</span>
<span>         cy <span class='op'>=</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_coordinates.html'>st_coordinates</a></span><span class='op'>(</span><span class='va'>geometry</span><span class='op'>)</span><span class='op'>[</span>,<span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>mapa_base</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>mapa_shift</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='va'>cpro</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"07"</span>, <span class='st'>"35"</span>, <span class='st'>"38"</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>final_hex</span><span class='op'>)</span>,</span>
<span>    color <span class='op'>=</span> <span class='st'>"white"</span>,</span>
<span>    size <span class='op'>=</span> <span class='fl'>0.2</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>mapa_shift</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>cpro</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"07"</span>, <span class='st'>"35"</span>, <span class='st'>"38"</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>final_hex</span><span class='op'>)</span>,</span>
<span>    color <span class='op'>=</span> <span class='st'>"transparent"</span>,</span>
<span>    size <span class='op'>=</span> <span class='fl'>0.2</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_segment.html'>geom_segment</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>rect_canarias</span>,</span>
<span>               <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>xmin</span>, xend <span class='op'>=</span> <span class='va'>xmax</span>, y <span class='op'>=</span> <span class='va'>ymax</span>, yend <span class='op'>=</span> <span class='va'>ymax</span><span class='op'>)</span>,</span>
<span>               color <span class='op'>=</span> <span class='st'>"black"</span>, linewidth <span class='op'>=</span> <span class='fl'>0.4</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_segment.html'>geom_segment</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>rect_canarias</span>,</span>
<span>               <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>xmax</span>, xend <span class='op'>=</span> <span class='va'>xmax</span>, y <span class='op'>=</span> <span class='va'>ymin</span>, yend <span class='op'>=</span> <span class='va'>ymax</span><span class='op'>)</span>,</span>
<span>               color <span class='op'>=</span> <span class='st'>"black"</span>, linewidth <span class='op'>=</span> <span class='fl'>0.4</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_segment.html'>geom_segment</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>linea_diagonal</span>,</span>
<span>               <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span>, xend <span class='op'>=</span> <span class='va'>xend</span>, yend <span class='op'>=</span> <span class='va'>yend</span><span class='op'>)</span>,</span>
<span>               color <span class='op'>=</span> <span class='st'>"black"</span>, linewidth <span class='op'>=</span> <span class='fl'>0.4</span><span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_segment.html'>geom_segment</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>lines_data_main</span>,</span>
<span>               <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>real_x</span>, y <span class='op'>=</span> <span class='va'>real_y</span>, xend <span class='op'>=</span> <span class='va'>cx</span>, yend <span class='op'>=</span> <span class='va'>end_y</span><span class='op'>)</span>,</span>
<span>               color <span class='op'>=</span> <span class='st'>"black"</span>, linewidth <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>centroids_zoom</span>,</span>
<span>            <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>cx</span>, y <span class='op'>=</span> <span class='va'>cy</span><span class='op'>)</span>,</span>
<span>            label <span class='op'>=</span> <span class='st'>"*"</span>, color <span class='op'>=</span> <span class='st'>"white"</span>,</span>
<span>            size <span class='op'>=</span> <span class='fl'>15</span>, fontface <span class='op'>=</span> <span class='st'>"bold"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>seats_shift</span>,</span>
<span>             <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x_pos</span>, y <span class='op'>=</span> <span class='va'>y_pos</span>, fill <span class='op'>=</span> <span class='va'>base_hex</span><span class='op'>)</span>,</span>
<span>             shape <span class='op'>=</span> <span class='fl'>21</span>, color <span class='op'>=</span> <span class='st'>"black"</span>,</span>
<span>             size <span class='op'>=</span> <span class='fl'>4.8</span>, stroke <span class='op'>=</span> <span class='fl'>0.3</span><span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>labels_shift</span>,</span>
<span>            <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>cx</span>, y <span class='op'>=</span> <span class='va'>y_label</span>, label <span class='op'>=</span> <span class='va'>provincia_limpia</span>,</span>
<span>                color <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>is_displaced</span>, <span class='st'>"black"</span>,</span>
<span>                                <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>final_hex</span> <span class='op'>==</span> <span class='va'>HEX_PP_OSCURO</span>,</span>
<span>                                        <span class='st'>"white"</span>, <span class='st'>"black"</span>,</span>
<span>                                        missing <span class='op'>=</span> <span class='st'>"black"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>            size <span class='op'>=</span> <span class='fl'>3.4</span>, fontface <span class='op'>=</span> <span class='st'>"bold"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_identity.html'>scale_fill_identity</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_identity.html'>scale_color_identity</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_void</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    panel.background <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='st'>"transparent"</span>, color <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span>,</span>
<span>    plot.background  <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='st'>"transparent"</span>, color <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span></span></code></pre>
</div>
</div>
<p>The construction of the base map represents the central structural component of the visualization code, as it brings together territorial geometry, electoral data, and symbolic encodings within a single coherent framework. The map is generated at the provincial level using official administrative boundaries and functions as the spatial foundation on which all other visual elements are layered.</p>
<p>To maintain legibility and visual balance, the code applies several geometric adjustments. The Canary Islands are displaced southward from their true geographic position, following a standard cartographic convention in Spanish electoral maps. This relocation preserves their relative scale and shape while avoiding large areas of unused space in the main canvas. A bounding box and a connecting diagonal line are added to explicitly signal the displacement and retain spatial coherence.</p>
<p>Additional adjustments are introduced for provinces whose centroids would otherwise lead to overlap or ambiguity. In selected cases, such as Barcelona and provinces in the Basque Country, manual offsets are applied to reposition seat grids and labels. These modifications are purely aesthetic and do not affect the underlying data. Their purpose is to preserve clarity in areas where multiple graphical elements coexist within a limited spatial extent.</p>
<p>Madrid receives special handling due to its high number of seats and its central position within the peninsula. Given the density of its representation, the standard encoding would produce visual congestion. The code therefore marks Madrid with an asterisk on the base map and renders its seat distribution in a separate zoomed inset. This approach prioritizes readability and ensures consistency with the treatment applied to other exceptional territories, such as Ceuta and Melilla.</p>
<p>Within each province, parliamentary representation is encoded as a grid of circular markers, with each dot corresponding to a single seat in the Congress of Deputies. The grid dimensions are dynamically adjusted according to the number of seats assigned to the province, while color is used to encode party affiliation. This design enables a rapid assessment of both fragmentation and dominance at the provincial level.</p>
<p>Finally, province labels are positioned in relation to the seat grids, with adaptive color selection to guarantee sufficient contrast against the background. When labels or grids are displaced, connecting lines are drawn to preserve the visual link between the symbol and its geographic referent, ensuring interpretability despite geometric adjustments.</p>
<h2 id="custom-legends">Custom legends</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>national_stats</span> <span class='op'>&lt;-</span> <span class='va'>results_enriched</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>nombre_de_provincia</span> <span class='op'>==</span> <span class='st'>"España"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>total_validos <span class='op'>=</span> <span class='va'>votos_validos</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>total_validos</span>, <span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>matches</a></span><span class='op'>(</span><span class='st'>"^(votos|diputados)_"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_longer.html'>pivot_longer</a></span><span class='op'>(</span></span>
<span>    cols <span class='op'>=</span> <span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>matches</a></span><span class='op'>(</span><span class='st'>"^(votos|diputados)_"</span><span class='op'>)</span>,</span>
<span>    names_to <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>".value"</span>, <span class='st'>"party_raw"</span><span class='op'>)</span>,</span>
<span>    names_pattern <span class='op'>=</span> <span class='st'>"(votos|diputados)_(.*)"</span></span>
<span>  <span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    pct_nacional <span class='op'>=</span> <span class='va'>votos</span> <span class='op'>/</span> <span class='va'>total_validos</span> <span class='op'>*</span> <span class='fl'>100</span>,</span>
<span>    party <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span></span>
<span>      <span class='va'>party_raw</span> <span class='op'>==</span> <span class='st'>"pp"</span> <span class='op'>~</span> <span class='st'>"PP"</span>, <span class='va'>party_raw</span> <span class='op'>==</span> <span class='st'>"psoe"</span> <span class='op'>~</span> <span class='st'>"PSOE"</span>, </span>
<span>      <span class='va'>party_raw</span> <span class='op'>==</span> <span class='st'>"vox"</span> <span class='op'>~</span> <span class='st'>"Vox"</span>, <span class='va'>party_raw</span> <span class='op'>==</span> <span class='st'>"sumar"</span> <span class='op'>~</span> <span class='st'>"Sumar"</span>, </span>
<span>      <span class='va'>party_raw</span> <span class='op'>==</span> <span class='st'>"erc"</span> <span class='op'>~</span> <span class='st'>"ERC"</span>, <span class='va'>party_raw</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"jxcat__junts"</span>, <span class='st'>"junts"</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"Junts"</span>, </span>
<span>      <span class='va'>party_raw</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"eh_bildu"</span>, <span class='st'>"bildu"</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"EH Bildu"</span>, </span>
<span>      <span class='va'>party_raw</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"eajpnv"</span>, <span class='st'>"pnv"</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"PNV"</span>, <span class='va'>party_raw</span> <span class='op'>==</span> <span class='st'>"bng"</span> <span class='op'>~</span> <span class='st'>"BNG"</span>,</span>
<span>      <span class='va'>party_raw</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"cca"</span>, <span class='st'>"cc"</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"CC"</span>, <span class='va'>party_raw</span> <span class='op'>==</span> <span class='st'>"upn"</span> <span class='op'>~</span> <span class='st'>"UPN"</span>,</span>
<span>      <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='cn'>NA_character_</span></span>
<span>    <span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>party</span><span class='op'>)</span><span class='op'>)</span></span>
<span> </span>
<span></span>
<span><span class='va'>layout_manual</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tribble.html'>tribble</a></span><span class='op'>(</span></span>
<span>  <span class='op'>~</span><span class='va'>party</span>,      <span class='op'>~</span><span class='va'>candidate</span>,              <span class='op'>~</span><span class='va'>col</span>, <span class='op'>~</span><span class='va'>row</span>,</span>
<span>  <span class='st'>"PP"</span>,        <span class='st'>"Alberto Núñez Feijóo"</span>,  <span class='fl'>1</span>,    <span class='fl'>1</span>,</span>
<span>  <span class='st'>"PSOE"</span>,      <span class='st'>"Pedro Sánchez"</span>,         <span class='fl'>1</span>,    <span class='fl'>2</span>,</span>
<span>  <span class='st'>"Vox"</span>,       <span class='st'>"Santiago Abascal"</span>,      <span class='fl'>1</span>,    <span class='fl'>3</span>,</span>
<span>  <span class='st'>"Sumar"</span>,     <span class='st'>"Yolanda Díaz"</span>,          <span class='fl'>1</span>,    <span class='fl'>4</span>,</span>
<span>  <span class='st'>"ERC"</span>,       <span class='st'>"Gabriel Rufián"</span>,        <span class='fl'>1</span>,    <span class='fl'>5</span>,</span>
<span>  <span class='st'>"Junts"</span>,     <span class='st'>"Miriam Nogueras"</span>,       <span class='fl'>2</span>,    <span class='fl'>1</span>,</span>
<span>  <span class='st'>"EH Bildu"</span>,  <span class='st'>"Mertxe Aizpurua"</span>,       <span class='fl'>2</span>,    <span class='fl'>2</span>,</span>
<span>  <span class='st'>"PNV"</span>,       <span class='st'>"Aitor Esteban"</span>,         <span class='fl'>2</span>,    <span class='fl'>3</span>,</span>
<span>  <span class='st'>"BNG"</span>,       <span class='st'>"Néstor Rego"</span>,           <span class='fl'>2</span>,    <span class='fl'>4</span>,</span>
<span>  <span class='st'>"CC"</span>,        <span class='st'>"Cristina Valido"</span>,       <span class='fl'>2</span>,    <span class='fl'>5</span>,</span>
<span>  <span class='st'>"UPN"</span>,       <span class='st'>"Alberto Catalán"</span>,       <span class='fl'>2</span>,    <span class='fl'>6</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>legend_data</span> <span class='op'>&lt;-</span> <span class='va'>layout_manual</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>national_stats</span>, by <span class='op'>=</span> <span class='st'>"party"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>party_base</span>, by <span class='op'>=</span> <span class='st'>"party"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    label_pct <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sprintf.html'>sprintf</a></span><span class='op'>(</span><span class='st'>"%.2f"</span>, <span class='va'>pct_nacional</span><span class='op'>)</span>,</span>
<span>    label_seats <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='va'>diputados</span><span class='op'>)</span>,</span>
<span>    base_hex <span class='op'>=</span> <span class='fu'><a href='https://tidyr.tidyverse.org/reference/replace_na.html'>replace_na</a></span><span class='op'>(</span><span class='va'>base_hex</span>, <span class='st'>"#999999"</span><span class='op'>)</span>,</span>
<span>    is_winner <span class='op'>=</span> <span class='va'>party</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"PP"</span>, <span class='st'>"PSOE"</span>, <span class='st'>"EH Bildu"</span>, <span class='st'>"PNV"</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>data_izq</span>  <span class='op'>&lt;-</span> <span class='va'>legend_data</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>col</span> <span class='op'>==</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='va'>row</span><span class='op'>)</span></span>
<span><span class='va'>data_dcha</span> <span class='op'>&lt;-</span> <span class='va'>legend_data</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>col</span> <span class='op'>==</span> <span class='fl'>2</span><span class='op'>)</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='va'>row</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>crear_bloque_leyenda</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>datos</span>, <span class='va'>mostrar_headers</span> <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>  </span>
<span>  <span class='va'>prep</span> <span class='op'>&lt;-</span> <span class='va'>datos</span> <span class='op'>|&gt;</span></span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>      y_base <span class='op'>=</span> <span class='op'>-</span><span class='op'>(</span><span class='va'>row</span> <span class='op'>-</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>1.5</span>, </span>
<span>      x_base <span class='op'>=</span> <span class='fl'>0</span> </span>
<span>    <span class='op'>)</span></span>
<span>  </span>
<span>  <span class='va'>tiles</span> <span class='op'>&lt;-</span> <span class='va'>prep</span> <span class='op'>|&gt;</span></span>
<span>    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>is_winner</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>    <span class='fu'><a href='https://purrr.tidyverse.org/reference/map_dfr.html'>pmap_dfr</a></span><span class='op'>(</span><span class='kw'>function</span><span class='op'>(</span><span class='va'>base_hex</span>, <span class='va'>x_base</span>, <span class='va'>y_base</span>, <span class='va'>...</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>      <span class='va'>colors</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/colorRamp.html'>colorRampPalette</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://colorspace.R-Forge.R-project.org/reference/lighten.html'>lighten</a></span><span class='op'>(</span><span class='va'>base_hex</span>, <span class='fl'>0.6</span><span class='op'>)</span>, <span class='va'>base_hex</span>, <span class='fu'><a href='https://colorspace.R-Forge.R-project.org/reference/lighten.html'>darken</a></span><span class='op'>(</span><span class='va'>base_hex</span>, <span class='fl'>0.2</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>(</span><span class='fl'>7</span><span class='op'>)</span></span>
<span>      <span class='co'># Tiles ajustados a la nueva altura</span></span>
<span>      <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span>x_base <span class='op'>=</span> <span class='va'>x_base</span>, tile_id <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>7</span>, fill <span class='op'>=</span> <span class='va'>colors</span>, </span>
<span>             ymin <span class='op'>=</span> <span class='va'>y_base</span> <span class='op'>+</span> <span class='fl'>0.8</span>, ymax <span class='op'>=</span> <span class='va'>y_base</span> <span class='op'>+</span> <span class='fl'>1.1</span><span class='op'>)</span> </span>
<span>      <span class='op'>}</span><span class='op'>)</span></span>
<span>  </span>
<span>  <span class='va'>min_y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>prep</span><span class='op'>$</span><span class='va'>y_base</span><span class='op'>)</span></span>
<span>  </span>
<span>  <span class='va'>p</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_tile.html'>geom_rect</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>tiles</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>xmin <span class='op'>=</span> <span class='va'>x_base</span> <span class='op'>+</span> <span class='va'>tile_id</span> <span class='op'>-</span> <span class='fl'>0.48</span>, xmax <span class='op'>=</span> <span class='va'>x_base</span> <span class='op'>+</span> <span class='va'>tile_id</span> <span class='op'>+</span> <span class='fl'>0.48</span>, </span>
<span>                                ymin <span class='op'>=</span> <span class='va'>ymin</span>, ymax <span class='op'>=</span> <span class='va'>ymax</span>, fill <span class='op'>=</span> <span class='va'>fill</span><span class='op'>)</span>, color <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    </span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_tile.html'>geom_rect</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>prep</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span></span>
<span>      xmin <span class='op'>=</span> <span class='fl'>0.5</span>, </span>
<span>      xmax <span class='op'>=</span> <span class='fl'>7.5</span>, </span>
<span></span>
<span>      ymin <span class='op'>=</span> <span class='va'>y_base</span> <span class='op'>-</span> <span class='fl'>0.1</span>,          </span>
<span>      ymax <span class='op'>=</span> <span class='va'>y_base</span> <span class='op'>+</span> <span class='fl'>0.75</span> <span class='op'>+</span> <span class='fl'>0.1</span>,   </span>
<span>      fill <span class='op'>=</span> <span class='va'>base_hex</span></span>
<span>    <span class='op'>)</span>, color <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>prep</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fl'>0.7</span>, y <span class='op'>=</span> <span class='va'>y_base</span> <span class='op'>+</span> <span class='fl'>0.375</span>, label <span class='op'>=</span> <span class='va'>party</span><span class='op'>)</span>, </span>
<span>              color <span class='op'>=</span> <span class='st'>"white"</span>, fontface <span class='op'>=</span> <span class='st'>"bold"</span>, hjust <span class='op'>=</span> <span class='fl'>0</span>, size <span class='op'>=</span> <span class='fl'>4.5</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>prep</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fl'>7.3</span>, y <span class='op'>=</span> <span class='va'>y_base</span> <span class='op'>+</span> <span class='fl'>0.375</span>, label <span class='op'>=</span> <span class='va'>candidate</span><span class='op'>)</span>, </span>
<span>              color <span class='op'>=</span> <span class='st'>"white"</span>, fontface <span class='op'>=</span> <span class='st'>"bold.italic"</span>, hjust <span class='op'>=</span> <span class='fl'>1</span>, size <span class='op'>=</span> <span class='fl'>3.5</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    </span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>prep</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fl'>8.5</span>, y <span class='op'>=</span> <span class='va'>y_base</span> <span class='op'>+</span> <span class='fl'>0.375</span>, label <span class='op'>=</span> <span class='va'>label_pct</span>, color <span class='op'>=</span> <span class='va'>base_hex</span><span class='op'>)</span>, </span>
<span>              fontface <span class='op'>=</span> <span class='st'>"bold"</span>, hjust <span class='op'>=</span> <span class='fl'>0.5</span>, size <span class='op'>=</span> <span class='fl'>4.5</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>prep</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fl'>10.5</span>, y <span class='op'>=</span> <span class='va'>y_base</span> <span class='op'>+</span> <span class='fl'>0.375</span>, label <span class='op'>=</span> <span class='va'>label_seats</span>, color <span class='op'>=</span> <span class='va'>base_hex</span><span class='op'>)</span>, </span>
<span>              fontface <span class='op'>=</span> <span class='st'>"bold"</span>, hjust <span class='op'>=</span> <span class='fl'>0.5</span>, size <span class='op'>=</span> <span class='fl'>4.5</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    </span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_identity.html'>scale_fill_identity</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_identity.html'>scale_color_identity</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_void</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>      panel.background <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='st'>"transparent"</span>, color <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span>,</span>
<span>      plot.background  <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='st'>"transparent"</span>, color <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/coord_fixed.html'>coord_fixed</a></span><span class='op'>(</span>ratio <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/lims.html'>xlim</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>11.5</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/lims.html'>ylim</a></span><span class='op'>(</span><span class='va'>min_y</span> <span class='op'>-</span> <span class='fl'>0.5</span>, <span class='fl'>2</span><span class='op'>)</span></span>
<span></span>
<span>  <span class='kw'>if</span><span class='op'>(</span><span class='va'>mostrar_headers</span><span class='op'>)</span> <span class='op'>{</span></span>
<span>    <span class='va'>headers</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>      label <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"-25%"</span>, <span class='st'>"25%"</span>, <span class='st'>"30%"</span>, <span class='st'>"35%"</span>, <span class='st'>"40%"</span>, <span class='st'>"45%"</span>, <span class='st'>"50%+"</span>, <span class='st'>"Vote %"</span>, <span class='st'>"Seats"</span><span class='op'>)</span>,</span>
<span>      x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>3</span>, <span class='fl'>4</span>, <span class='fl'>5</span>, <span class='fl'>6</span>, <span class='fl'>7</span>, <span class='fl'>8.5</span>, <span class='fl'>10.5</span><span class='op'>)</span>,</span>
<span>      y <span class='op'>=</span> <span class='fl'>1.6</span></span>
<span>    <span class='op'>)</span></span>
<span>    <span class='va'>p</span> <span class='op'>&lt;-</span> <span class='va'>p</span> <span class='op'>+</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>headers</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span>, label <span class='op'>=</span> <span class='va'>label</span><span class='op'>)</span>, </span>
<span>                       color <span class='op'>=</span> <span class='st'>"black"</span>, fontface <span class='op'>=</span> <span class='st'>"bold"</span>, size <span class='op'>=</span> <span class='fl'>3</span>, hjust <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span></span>
<span>  <span class='op'>}</span></span>
<span>  </span>
<span>  <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>p</span><span class='op'>)</span></span>
<span><span class='op'>}</span></span>
<span></span>
<span><span class='va'>plot_leyenda_izq</span>  <span class='op'>&lt;-</span> <span class='fu'>crear_bloque_leyenda</span><span class='op'>(</span><span class='va'>data_izq</span>, mostrar_headers <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span></span>
<span><span class='va'>plot_leyenda_dcha</span> <span class='op'>&lt;-</span> <span class='fu'>crear_bloque_leyenda</span><span class='op'>(</span><span class='va'>data_dcha</span>, mostrar_headers <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>The custom legends are implemented to condense national level electoral information into a compact and easily readable structure within the code. Instead of relying on a standard categorical legend, the visualization generates party specific blocks that integrate color, vote share, and seat counts into a single, cohesive element.</p>
<p>Each block displays the party identifier and leading candidate, followed by two key indicators: the nationwide percentage of valid votes and the total number of seats obtained in the Congress of Deputies. This layout supports immediate comparison between electoral support and parliamentary representation across parties without requiring cross reference to other components.</p>
<p>For parties that win at least one province, the legend includes a horizontal color scale representing vote share intervals. This scale mirrors the color encoding applied on the map, reinforcing consistency between the territorial visualization and the national summaries. To preserve visual balance and avoid excessive vertical compression, the legend blocks are arranged into two columns, a choice that improves readability while maintaining a compact overall footprint.</p>
<h2 id="final-composition">Final composition</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>mapa_final</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://wilkelab.org/cowplot/reference/ggdraw.html'>ggdraw</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='fu'><a href='https://wilkelab.org/cowplot/reference/draw_plot.html'>draw_plot</a></span><span class='op'>(</span></span>
<span>    <span class='va'>mapa_base</span>,</span>
<span>    x <span class='op'>=</span> <span class='fl'>0</span>, y <span class='op'>=</span> <span class='fl'>0</span>,</span>
<span>    width <span class='op'>=</span> <span class='fl'>1</span>, height <span class='op'>=</span> <span class='fl'>1</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span><span class='fu'><a href='https://wilkelab.org/cowplot/reference/draw_plot.html'>draw_plot</a></span><span class='op'>(</span></span>
<span>  <span class='va'>plot_madrid</span>,</span>
<span>  x <span class='op'>=</span> <span class='fl'>0.02</span>, y <span class='op'>=</span> <span class='fl'>0.60</span>,</span>
<span>  width <span class='op'>=</span> <span class='fl'>0.24</span>, height <span class='op'>=</span> <span class='fl'>0.23</span></span>
<span><span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span><span class='fu'><a href='https://wilkelab.org/cowplot/reference/draw_plot.html'>draw_plot</a></span><span class='op'>(</span></span>
<span>  <span class='va'>plot_ceuta</span>,</span>
<span>  x <span class='op'>=</span> <span class='fl'>0.02</span>, y <span class='op'>=</span> <span class='fl'>0.42</span>,</span>
<span>  width <span class='op'>=</span> <span class='fl'>0.22</span>, height <span class='op'>=</span> <span class='fl'>0.19</span></span>
<span><span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span><span class='fu'><a href='https://wilkelab.org/cowplot/reference/draw_plot.html'>draw_plot</a></span><span class='op'>(</span></span>
<span>  <span class='va'>plot_melilla</span>,</span>
<span>  x <span class='op'>=</span> <span class='fl'>0.02</span>, y <span class='op'>=</span> <span class='fl'>0.24</span>,</span>
<span>  width <span class='op'>=</span> <span class='fl'>0.22</span>, height <span class='op'>=</span> <span class='fl'>0.19</span></span>
<span><span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span>  <span class='fu'><a href='https://wilkelab.org/cowplot/reference/draw_plot.html'>draw_plot</a></span><span class='op'>(</span></span>
<span>    <span class='va'>plot_resumen_nacional</span>,</span>
<span>    x <span class='op'>=</span> <span class='fl'>0.06</span>, y <span class='op'>=</span> <span class='fl'>0.83</span>,</span>
<span>    width <span class='op'>=</span> <span class='fl'>0.18</span>, height <span class='op'>=</span> <span class='fl'>0.15</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='fu'><a href='https://wilkelab.org/cowplot/reference/draw_plot.html'>draw_plot</a></span><span class='op'>(</span></span>
<span>    <span class='va'>plot_leyenda_izq</span>,</span>
<span>    x <span class='op'>=</span> <span class='fl'>0.5</span>, y <span class='op'>=</span> <span class='fl'>0.085</span>,</span>
<span>    width <span class='op'>=</span> <span class='fl'>0.25</span>, height <span class='op'>=</span> <span class='fl'>0.30</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span> </span>
<span>  <span class='fu'><a href='https://wilkelab.org/cowplot/reference/draw_plot.html'>draw_plot</a></span><span class='op'>(</span></span>
<span>    <span class='va'>plot_leyenda_dcha</span>,</span>
<span>    x <span class='op'>=</span> <span class='fl'>0.73</span>, y <span class='op'>=</span> <span class='fl'>0.052</span>,</span>
<span>    width <span class='op'>=</span> <span class='fl'>0.25</span>, height <span class='op'>=</span> <span class='fl'>0.40</span></span>
<span>  <span class='op'>)</span></span></code></pre>
</div>
</div>
<p>The final composition integrates all previously defined elements into a single coherent visualization. The provincial map functions as the structural backbone, while the zoomed insets, national summary chart, and custom legends are positioned to complement the main spatial narrative without obscuring it.</p>
<p>The layout prioritizes visual hierarchy and balance. Insets are placed to the left to preserve the continuity of the territorial map, while the national level summaries and legends are grouped to the right, allowing the reader to move naturally from geographic detail to aggregate interpretation. Transparency and minimal framing are used throughout to avoid visual clutter and to maintain consistency with the original reference design.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>mapa_final</span></span></code></pre>
</div>
<p><img src="100561036_files/figure-html5/map-plot-1.png" alt="" width="100%" data-distill-preview=1 style="display: block; margin: auto;" /></p>
</div>
<div class="sourceCode" id="cb1"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
