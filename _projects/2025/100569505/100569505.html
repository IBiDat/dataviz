<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>


  <!--radix_placeholder_meta_tags-->
  <title>Calgary</title>

  <meta property="description" itemprop="description" content="A visualization of travel times by bike and transit in the city of Calgary."/>


  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2025-12-14"/>
  <meta property="article:created" itemprop="dateCreated" content="2025-12-14"/>
  <meta name="article:author" content="Miguel Agenjo"/>

  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Calgary"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="A visualization of travel times by bike and transit in the city of Calgary."/>
  <meta property="og:locale" content="en_US"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="Calgary"/>
  <meta property="twitter:description" content="A visualization of travel times by bike and transit in the city of Calgary."/>

  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","categories","author","date","output"]}},"value":[{"type":"character","attributes":{},"value":["Calgary"]},{"type":"character","attributes":{},"value":["A visualization of travel times by bike and transit in the city of Calgary.\n"]},{"type":"character","attributes":{},"value":["2025"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["Miguel Agenjo"]}]}]},{"type":"character","attributes":{},"value":["2025-12-14"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]}]}]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["100569505_files/anchor-4.2.2/anchor.min.js","100569505_files/bowser-1.9.3/bowser.min.js","100569505_files/distill-2.2.21/template.v2.js","100569505_files/figure-html5/black_isochr_fastest_street_legend-1.png","100569505_files/figure-html5/improved_black-1.png","100569505_files/figure-html5/improved_white-1.png","100569505_files/figure-html5/plot_alternative_final-1.png","100569505_files/figure-html5/plot_color_legend_text-1.png","100569505_files/figure-html5/plot_color_legend-1.png","100569505_files/figure-html5/plot_isochrones_legend-1.png","100569505_files/figure-html5/plot_legend_4-1.png","100569505_files/figure-html5/plot_legend1-1.png","100569505_files/figure-html5/plot_legend2-1.png","100569505_files/figure-html5/plot_legend3-1.png","100569505_files/figure-html5/plot_legend4_ugly-1.png","100569505_files/figure-html5/plot_legendless_map-1.png","100569505_files/figure-html5/plot_map_car-1.png","100569505_files/figure-html5/plot_north_arrow_alternative-1.png","100569505_files/figure-html5/plot_north_arrow-1.png","100569505_files/figure-html5/plot_paragraph-1.png","100569505_files/figure-html5/plot_question-1.png","100569505_files/figure-html5/plot_roads_water_isochrones-1.png","100569505_files/figure-html5/plot_roads_water-1.png","100569505_files/figure-html5/plot_scale_alternative-1.png","100569505_files/figure-html5/plot_scale-1.png","100569505_files/figure-html5/plot_street_arrows-1.png","100569505_files/figure-html5/plot_thin_vertical_squares-1.png","100569505_files/figure-html5/show_hexagon_grid_problem-1.png","100569505_files/figure-html5/st_remove_holes_documentation_example-1.png","100569505_files/figure-html5/unnamed-chunk-1-1.png","100569505_files/figure-html5/unnamed-chunk-10-1.png","100569505_files/figure-html5/unnamed-chunk-11-1.png","100569505_files/figure-html5/unnamed-chunk-2-1.png","100569505_files/figure-html5/unnamed-chunk-2-2.png","100569505_files/figure-html5/unnamed-chunk-2-3.png","100569505_files/figure-html5/unnamed-chunk-3-1.png","100569505_files/figure-html5/unnamed-chunk-3-2.png","100569505_files/figure-html5/unnamed-chunk-3-3.png","100569505_files/figure-html5/unnamed-chunk-3-4.png","100569505_files/figure-html5/unnamed-chunk-3-5.png","100569505_files/figure-html5/unnamed-chunk-4-1.png","100569505_files/figure-html5/unnamed-chunk-7-1.png","100569505_files/figure-html5/unnamed-chunk-9-1.png","100569505_files/header-attrs-2.30/header-attrs.js","100569505_files/jquery-3.6.0/jquery-3.6.0.js","100569505_files/jquery-3.6.0/jquery-3.6.0.min.js","100569505_files/jquery-3.6.0/jquery-3.6.0.min.map","100569505_files/popper-2.6.0/popper.min.js","100569505_files/tippy-6.2.7/tippy-bundle.umd.min.js","100569505_files/tippy-6.2.7/tippy-light-border.css","100569505_files/tippy-6.2.7/tippy.css","100569505_files/tippy-6.2.7/tippy.umd.min.js","100569505_files/webcomponents-2.0.0/webcomponents.js","oe_osm_data/bbbike_Calgary.gpkg","oe_osm_data/bbbike_Calgary.osm.pbf","oe_osm_data/bbbike_Calgary.osm.pbf.mapdb","oe_osm_data/bbbike_Calgary.osm.pbf.mapdb.p","oe_osm_data/network_settings.json","oe_osm_data/network.dat","oe_osm_data/r5r-log.log","original_calgary.png","original_data/all_roads_dissolved.geojson","original_data/hexagons.geojson","original_data/water.geojson"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
    font-size: 100%;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  hr.section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    margin: 0px;
  }


  d-byline {
    border-top: none;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
    border-top: none;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  /* tweak for Pandoc numbered line within distill */
  d-article pre.numberSource code > span {
      left: -2em;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }

  /* Citation hover box */

  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }

  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // separator
    var separator = '<hr class="section-separator" style="clear: both"/>';
    // prepend separator above appendix
    $('.d-byline').before(separator);
    $('.d-article').before(separator);

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme, except when numbering line
    // in code chunk
    $('pre:not(.numberLines) code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        var author_name = front_matter.authors[i].author
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', author_name ? 'ORCID ID for ' + author_name : 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // hoverable references
      $('span.citation[data-cites]').each(function() {
        const citeChild = $(this).children()[0]
        // Do not process if @xyz has been used without escaping and without bibliography activated
        // https://github.com/rstudio/distill/issues/466
        if (citeChild === undefined) return true

        if (citeChild.nodeName == "D-FOOTNOTE") {
          var fn = citeChild
          $(this).html(fn.shadowRoot.querySelector("sup"))
          $(this).id = fn.id
          fn.remove()
        }
        var refs = $(this).attr('data-cites').split(" ");
        var refHtml = refs.map(function(ref) {
          // Could use CSS.escape too here, we insure backward compatibility in navigator
          return "<p>" + $('div[id="ref-' + ref + '"]').html() + "</p>";
        }).join("\n");
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });

      // fix footnotes in tables (#411)
      // replacing broken distill.pub feature
      $('table d-footnote').each(function() {
        // we replace internal showAtNode methode which is triggered when hovering a footnote
        this.hoverBox.showAtNode = function(node) {
          // ported from https://github.com/distillpub/template/pull/105/files
          calcOffset = function(elem) {
              let x = elem.offsetLeft;
              let y = elem.offsetTop;
              // Traverse upwards until an `absolute` element is found or `elem`
              // becomes null.
              while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                  x += elem.offsetLeft;
                  y += elem.offsetTop;
              }

              return { left: x, top: y };
          }
          // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
          const bbox = node.getBoundingClientRect();
          const offset = calcOffset(node);
          this.show([offset.left + bbox.width, offset.top + bbox.height]);
        }
      })

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      // ignore leaflet img layers (#106)
      figures = figures.filter(':not(img[class*="leaflet"])')
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <!--/radix_placeholder_distill-->
  <script src="100569505_files/header-attrs-2.30/header-attrs.js"></script>
  <script src="100569505_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="100569505_files/popper-2.6.0/popper.min.js"></script>
  <link href="100569505_files/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="100569505_files/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="100569505_files/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="100569505_files/anchor-4.2.2/anchor.min.js"></script>
  <script src="100569505_files/bowser-1.9.3/bowser.min.js"></script>
  <script src="100569505_files/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="100569505_files/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Calgary","description":"A visualization of travel times by bike and transit in the city of Calgary.","authors":[{"author":"Miguel Agenjo","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2025-12-14T00:00:00.000+01:00","citationText":"Agenjo, 2025"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Calgary</h1>

<!--radix_placeholder_categories-->
<div class="dt-tags">
<div class="dt-tag">2025</div>
</div>
<!--/radix_placeholder_categories-->
<p><p>A visualization of travel times by bike and transit in the city of Calgary.</p></p>
</div>

<div class="d-byline">
  
  Miguel Agenjo
  
<br/>2025-12-14
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#original" id="toc-original">Original</a></li>
<li><a href="#libraries" id="toc-libraries">Libraries:</a></li>
<li><a href="#replica" id="toc-replica">Replica</a>
<ul>
<li><a href="#loading-the-data" id="toc-loading-the-data">Loading the data</a></li>
<li><a href="#data-transformation" id="toc-data-transformation">Data transformation</a></li>
<li><a href="#plotting" id="toc-plotting">Plotting</a></li>
</ul></li>
<li><a href="#alternative" id="toc-alternative">Alternative</a>
<ul>
<li><a href="#data-transformation-1" id="toc-data-transformation-1">Data transformation:</a></li>
<li><a href="#plotting-1" id="toc-plotting-1">Plotting</a></li>
</ul></li>
<li><a href="#dismissed-ideas" id="toc-dismissed-ideas">Dismissed ideas</a>
<ul>
<li><a href="#from-where-is-it-faster-by-car" id="toc-from-where-is-it-faster-by-car">From where is it faster by car</a></li>
<li><a href="#isochrones-by-bike-travel-time-iñakis-suggestion" id="toc-isochrones-by-bike-travel-time-iñakis-suggestion">Isochrones by bike travel time (Iñaki’s suggestion)</a></li>
</ul></li>
</ul>
</nav>
</div>
<h2 id="original">Original</h2>
<p>[Escribir una introducción mejor]</p>
<p>Here’s the map we are replicating. It was created by Willem Klumpenhouwer:</p>
<figure>
<img src="original_calgary.png" alt="Original map" />
<figcaption aria-hidden="true">Original map</figcaption>
</figure>
<h2 id="libraries">Libraries:</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span></span>
<span><span class='co'># library(osmdata) Didn't use in the end (got data from author)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/SymbolixAU/geojsonsf'>geojsonsf</a></span><span class='op'>)</span> <span class='co'># Used function geojson_sf to convert geojson into sf</span></span>
<span><span class='co'># library(glossa) # Used function invert_polygon (didn't use, idea didn't work)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://r-spatial.github.io/sf/'>sf</a></span><span class='op'>)</span> <span class='co'># Used function st_intersection</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://funkyheatmap.github.io/funkyheatmap/'>funkyheatmap</a></span><span class='op'>)</span> <span class='co'># Used function geom_rounded_rect</span></span>
<span><span class='co'># library(ggspatial) # Didn't use (no fitting arrows or scales)</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://eliocamp.github.io/ggnewscale/'>ggnewscale</a></span><span class='op'>)</span> <span class='co'># To reset scale colors</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>geosphere</span><span class='op'>)</span> <span class='co'># To calculate distance for the scale</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/ipeaGIT/r5r'>r5r</a></span><span class='op'>)</span> <span class='co'># To calculate travel times by car</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://docs.ropensci.org/osmextract/'>osmextract</a></span><span class='op'>)</span> <span class='co'># To download data necessary to use r5r</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://wilkelab.org/ggtext/'>ggtext</a></span><span class='op'>)</span> <span class='co'># To have more text options</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://michaeldorman.github.io/nngeo/'>nngeo</a></span><span class='op'>)</span> <span class='co'># To remove wholes in isochrones </span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://strimas.com/smoothr/'>smoothr</a></span><span class='op'>)</span> <span class='co'># To smoothen out the borders of the isochrones</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://scales.r-lib.org'>scales</a></span><span class='op'>)</span> <span class='co'># To be able to define alpha in certain arguments where it is</span></span>
<span>                <span class='co'># not possible by default</span></span>
<span><span class='co'># library(shadowtext) # To add shadows in the isochrone legend (didn't plot as a</span></span>
<span>                    <span class='co'># a line with shadow in the end, not using it).</span></span></code></pre>
</div>
</div>
<h2 id="replica">Replica</h2>
<h3 id="loading-the-data">Loading the data</h3>
<p>We reached Willem Klumpenhouwer, the author of the plot that we are replicating, and he kindly shared the data with which he built the original plot. This data consists of three .geojson files:</p>
<ul>
<li><p><strong><code>hexagons</code></strong> includes for variables: <code>geometry</code> (which contains polygons that form a hexagon grid of the map), <code>id</code> (an identification number for each hexagon), <code>b_travel_time</code> (travel time by bike from the centroid of each hexagon to Calgary Tower, in minutes), and <code>travel_time</code> (travel time by transit from the centroid of each hexagon to Calgary Tower, in minutes).</p></li>
<li><p><strong><code>all_roads_dissolved</code></strong> with a multilinestring that represents all roads in Calgary.</p></li>
</ul>
<p>– <strong><code>water</code></strong> which contains mulitpolygons with the geometry of the water bodies in Calgary.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>hexagons</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/geojsonsf/man/geojson_sf.html'>geojson_sf</a></span><span class='op'>(</span><span class='st'>"original_data/hexagons.geojson"</span><span class='op'>)</span></span>
<span><span class='va'>all_roads_dissolved</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/geojsonsf/man/geojson_sf.html'>geojson_sf</a></span><span class='op'>(</span><span class='st'>"original_data/all_roads_dissolved.geojson"</span><span class='op'>)</span></span>
<span><span class='va'>water</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/geojsonsf/man/geojson_sf.html'>geojson_sf</a></span><span class='op'>(</span><span class='st'>"original_data/water.geojson"</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<h3 id="data-transformation">Data transformation</h3>
<p>Given the structure of the provided data, we only need to do small transformations in order to be able able to plot the original map.</p>
<p>We start by creating a simple feature collection that combines the ids and travel time data from <code>hexagons</code> with the geometry of the roads that correspond with each hexagon. To do so, we calculate the intersection of <code>hexagons</code> and <code>all_roads_dissolved</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># hexroads_intersection &lt;- st_intersection(all_roads_dissolved, hexagons)</span></span>
<span></span>
<span><span class='co'># This line takes minutes to run, so we save the object to avoid running it</span></span>
<span><span class='co'># again. From now on, we can just load it.</span></span>
<span></span>
<span><span class='co'># save(hexroads_intersection, file = "hexroads_intersection.RData")</span></span>
<span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/load.html'>load</a></span><span class='op'>(</span><span class='st'>"hexroads_intersection.RData"</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>Then we add a new variable containing the difference in travel time by bike and by transit from each point. We also add a second variable with the differences binned in the ranges used in the original map.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># We are computing time_difference as time by bike minus time by transit. That means that:</span></span>
<span><span class='co'># - negative numbers = faster by bike</span></span>
<span><span class='co'># - positive numbers = faster by transit</span></span>
<span></span>
<span><span class='va'>hexroads_intersection</span> <span class='op'>&lt;-</span> <span class='va'>hexroads_intersection</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    <span class='st'>"time_difference"</span> <span class='op'>=</span> <span class='va'>b_travel_time</span> <span class='op'>-</span> <span class='va'>travel_time</span>,</span>
<span>    <span class='st'>"time_color"</span> <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span></span>
<span>      <span class='va'>time_difference</span> <span class='op'>&lt;=</span> <span class='op'>-</span><span class='fl'>30</span> <span class='op'>~</span> <span class='st'>"-2"</span>, <span class='co'># Bike 30 or more minutes faster</span></span>
<span>      <span class='va'>time_difference</span> <span class='op'>&lt;=</span> <span class='op'>-</span><span class='fl'>10</span> <span class='op'>~</span> <span class='st'>"-1"</span>, <span class='co'># Bike 10 or more minutes faster (&lt;30)</span></span>
<span>      <span class='va'>time_difference</span> <span class='op'>&lt;</span> <span class='fl'>10</span> <span class='op'>~</span> <span class='st'>"0"</span>, <span class='co'># Between -10 and 10 (both not included)</span></span>
<span>      <span class='va'>time_difference</span> <span class='op'>&lt;</span> <span class='fl'>30</span> <span class='op'>~</span> <span class='st'>"1"</span>, <span class='co'># Transit 10 or more minutes faster (&lt;30)</span></span>
<span>      <span class='va'>time_difference</span> <span class='op'>&gt;=</span> <span class='fl'>30</span> <span class='op'>~</span> <span class='st'>"2"</span><span class='op'>)</span>, <span class='co'># Transit 30 or more minutes faster </span></span>
<span>    <span class='st'>"time_color"</span> <span class='op'>=</span> <span class='fu'><a href='https://forcats.tidyverse.org/reference/fct.html'>fct</a></span><span class='op'>(</span> </span>
<span>                   <span class='va'>time_color</span>, levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"-2"</span>, <span class='st'>"-1"</span>, <span class='st'>"0"</span>, <span class='st'>"1"</span>, <span class='st'>"2"</span><span class='op'>)</span><span class='op'>)</span></span>
<span>    <span class='op'>)</span></span></code></pre>
</div>
</div>
<p>With our data ready, we can start plotting.</p>
<h3 id="plotting">Plotting</h3>
<h4 id="roads-and-water">Roads and water</h4>
<p>We start by plotting the map with roads adequately colored according to travel time differences. Notice that in the original map the water is plotted on top of the roads (we see there are no bridges over the rivers), we will do the same in our replica.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>calgary_replica</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># Roads</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span> </span>
<span>    data <span class='op'>=</span> <span class='va'>hexroads_intersection</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='va'>time_color</span><span class='op'>)</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='fl'>1.1</span>,</span>
<span>    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_color_manual</a></span><span class='op'>(</span></span>
<span>    values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>      <span class='st'>"-2"</span> <span class='op'>=</span> <span class='st'>"#aa5312"</span>, <span class='co'># bike &gt;30 min faster</span></span>
<span>      <span class='st'>"-1"</span> <span class='op'>=</span> <span class='st'>"#c88c47"</span>, <span class='co'># bike 10–30 min faster</span></span>
<span>      <span class='st'>"0"</span>  <span class='op'>=</span> <span class='st'>"#b7a6ac"</span>, <span class='co'># similar travel time</span></span>
<span>      <span class='st'>"1"</span>  <span class='op'>=</span> <span class='st'>"#a36f96"</span>, <span class='co'># transit 10–30 min faster</span></span>
<span>      <span class='st'>"2"</span>  <span class='op'>=</span> <span class='st'>"#6a4886"</span>  <span class='co'># transit &gt;30 min faster</span></span>
<span>    <span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># Water:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span> </span>
<span>    data <span class='op'>=</span> <span class='va'>water</span>,</span>
<span>    fill <span class='op'>=</span> <span class='st'>"#a6b0b9"</span>,</span>
<span>    color <span class='op'>=</span> <span class='st'>"#a6b0b9"</span>,</span>
<span>    linewidth <span class='op'>=</span><span class='fl'>1.1</span> </span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_void</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>calgary_replica</span> <span class='co'># To see it</span></span></code></pre>
</div>
<p><img src="100569505_files/figure-html5/plot_roads_water-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<p>After some time manually adjusting the values and comparing to the original plot, we have managed to plot roads and water with the same size as the original map.</p>
<h4 id="paragraph">Paragraph</h4>
<p>We will now add the paragraph that explains what the map represents, and identifies the blue point in the middle of the map as Calgary Tower.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># We add the font used in the original plot:</span></span>
<span><span class='fu'>sysfonts</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/sysfonts/man/font_add_google.html'>font_add_google</a></span><span class='op'>(</span><span class='st'>"Atkinson Hyperlegible"</span>, family <span class='op'>=</span> <span class='st'>"atkinson"</span><span class='op'>)</span></span>
<span><span class='fu'>showtext</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/showtext/man/showtext_auto.html'>showtext_auto</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># And then plot the paragraph:</span></span>
<span><span class='va'>calgary_replica</span> <span class='op'>&lt;-</span> <span class='va'>calgary_replica</span> <span class='op'>+</span> </span>
<span>  </span>
<span>  <span class='co'># The text:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>    <span class='st'>"text"</span>,</span>
<span>    x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>114.3100</span>, </span>
<span>    y <span class='op'>=</span> <span class='fl'>50.9790</span>,</span>
<span>    label <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='st'>"This map shows the difference"</span>,</span>
<span>                  <span class='st'>"in the time it takes to reach the"</span>,</span>
<span>                  <span class='st'>"Calgary Tower     by bike and by"</span>,</span>
<span>                  <span class='st'>"transit on a weekday morning."</span>,</span>
<span>                  sep<span class='op'>=</span><span class='st'>"\n"</span><span class='op'>)</span>,</span>
<span>    hjust <span class='op'>=</span> <span class='fl'>0</span>,</span>
<span>    family <span class='op'>=</span> <span class='st'>"atkinson"</span>,</span>
<span>    size <span class='op'>=</span> <span class='fl'>12.9</span>,</span>
<span>    lineheight <span class='op'>=</span> <span class='fl'>1.05</span>,</span>
<span>    color <span class='op'>=</span> <span class='st'>"#000000"</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span> </span>
<span>  </span>
<span>  <span class='co'># The blue point in the legend</span></span>
<span>   <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>    <span class='st'>"point"</span>,</span>
<span>    x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>114.2450</span>,</span>
<span>    y <span class='op'>=</span> <span class='fl'>50.97495</span>,  </span>
<span>    shape <span class='op'>=</span> <span class='fl'>21</span>,</span>
<span>    size <span class='op'>=</span> <span class='fl'>8.25</span>,</span>
<span>    color <span class='op'>=</span> <span class='st'>"#000000"</span>,</span>
<span>    stroke <span class='op'>=</span> <span class='fl'>4.75</span>,</span>
<span>    fill <span class='op'>=</span> <span class='st'>"#69eafe"</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># The blue point in the map (Calgary Tower)</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span>  </span>
<span>    <span class='st'>"point"</span>,</span>
<span>    x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>114.0631</span>,</span>
<span>    y <span class='op'>=</span> <span class='fl'>51.04465</span>,</span>
<span>    shape <span class='op'>=</span> <span class='fl'>21</span>,</span>
<span>    size <span class='op'>=</span> <span class='fl'>8.25</span>,</span>
<span>    color <span class='op'>=</span> <span class='st'>"#000000"</span>,</span>
<span>    stroke <span class='op'>=</span> <span class='fl'>4.75</span>,</span>
<span>    fill <span class='op'>=</span> <span class='st'>"#69eafe"</span></span>
<span>  <span class='op'>)</span></span>
<span>  </span>
<span><span class='va'>calgary_replica</span> <span class='co'># To see it</span></span></code></pre>
</div>
<p><img src="100569505_files/figure-html5/plot_paragraph-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<h4 id="color-legend">Color legend</h4>
<p>Now that we have the paragraph, we will plot the color legend underneath it. It is a non-standard legend which isn’t part of ggplot’s defaults. So we need to create the geometries and text manually.</p>
<p>Since there is a lot of elements here, and we need to manually adjust everything to fit the original plot, we will write the code in a way that will make it more convenient to use in this process of trial and error, by dividing it in three parts: a) <em>settings</em> where we will define the needed values, b) <em>calculations</em> of coordinate values according to the values defined in settings (this will allows us to avoid manually defining every single value needed), and c) the <em>plotting</em> according to the previous calculations.</p>
<p><strong>Note for Iñaki.</strong> When I did this, I had doubts on whether it is an adequate approach. It was REALLY helpful to do it like this while plotting because this way I didn’t have to navigate through the code to find the values i needed to slightly change, everything is together and clearly named at the top.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Settings:</span></span>
<span><span class='co'># =========</span></span>
<span></span>
<span><span class='co'># Rectangles:</span></span>
<span><span class='va'>rectangle_left</span> <span class='op'>&lt;-</span> <span class='op'>-</span><span class='fl'>114.3080</span></span>
<span><span class='va'>rectangle_top</span> <span class='op'>&lt;-</span> <span class='fl'>50.9490</span> </span>
<span><span class='va'>rectangle_width</span> <span class='op'>&lt;-</span> <span class='fl'>0.0250</span></span>
<span><span class='va'>rectangle_height</span> <span class='op'>&lt;-</span> <span class='fl'>0.0050</span></span>
<span><span class='va'>rectangle_space</span> <span class='op'>&lt;-</span> <span class='fl'>0.0005</span></span>
<span><span class='va'>rectangle_fill</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"#d26716"</span>, <span class='st'>"#f8ad58"</span>, <span class='st'>"#e3cdd5"</span>, <span class='st'>"#ca8aba"</span>, <span class='st'>"#8359a6"</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Minutes:</span></span>
<span><span class='va'>minute_separation</span> <span class='op'>&lt;-</span> <span class='fl'>1.66</span> <span class='co'># Relative to rectangle_height</span></span>
<span><span class='va'>minute_size</span> <span class='op'>&lt;-</span> <span class='fl'>9</span> <span class='co'># For geom_text(size =</span></span>
<span><span class='va'>minute_color</span> <span class='op'>&lt;-</span> <span class='st'>"#000000"</span></span>
<span><span class='va'>minute_font</span> <span class='op'>&lt;-</span> <span class='st'>"atkinson"</span></span>
<span></span>
<span><span class='co'># Faster by:</span></span>
<span><span class='va'>faster_separation</span> <span class='op'>&lt;-</span> <span class='fl'>0.7</span> <span class='co'># Relative to rectangle_height</span></span>
<span><span class='va'>faster_size</span> <span class='op'>&lt;-</span> <span class='fl'>11</span> <span class='co'># For geom_text(size = </span></span>
<span><span class='va'>faster_color</span> <span class='op'>&lt;-</span> <span class='st'>"#000000"</span></span>
<span><span class='va'>faster_font</span> <span class='op'>&lt;-</span> <span class='st'>"atkinson"</span></span>
<span></span>
<span></span>
<span><span class='co'># Calculations:</span></span>
<span><span class='co'>#=============</span></span>
<span></span>
<span><span class='co'># Tibble for legend rectangles:</span></span>
<span><span class='va'>legend_rectangles</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"xmin"</span> <span class='op'>=</span> <span class='va'>rectangle_left</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>0</span><span class='op'>:</span><span class='fl'>4</span><span class='op'>)</span> <span class='op'>*</span> <span class='op'>(</span><span class='va'>rectangle_width</span> <span class='op'>+</span> <span class='va'>rectangle_space</span><span class='op'>)</span>,</span>
<span>  <span class='st'>"xmax"</span> <span class='op'>=</span> <span class='va'>xmin</span> <span class='op'>+</span> <span class='va'>rectangle_width</span>,</span>
<span>  <span class='st'>"ymin"</span> <span class='op'>=</span> <span class='va'>rectangle_top</span> <span class='op'>-</span> <span class='va'>rectangle_height</span>,</span>
<span>  <span class='st'>"ymax"</span> <span class='op'>=</span> <span class='va'>rectangle_top</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Tibble for minutes (relative to rectangles):</span></span>
<span><span class='va'>legend_minutes</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"label"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"30"</span>, <span class='st'>"10"</span>, <span class='st'>"10"</span>, <span class='st'>"30"</span>, <span class='st'>"   minutes"</span><span class='op'>)</span>,</span>
<span>  <span class='st'>"x"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>    <span class='va'>rectangle_left</span> <span class='op'>+</span> <span class='op'>(</span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>4</span><span class='op'>)</span><span class='op'>*</span><span class='va'>rectangle_width</span><span class='op'>)</span> <span class='op'>+</span> <span class='op'>(</span><span class='op'>(</span><span class='fl'>0.5</span><span class='op'>:</span><span class='fl'>3.5</span><span class='op'>)</span> <span class='op'>*</span> <span class='va'>rectangle_space</span><span class='op'>)</span>,</span>
<span>    <span class='va'>rectangle_left</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>4</span><span class='op'>*</span><span class='va'>rectangle_width</span><span class='op'>)</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>3.5</span><span class='op'>*</span><span class='va'>rectangle_space</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>  <span class='st'>"y"</span> <span class='op'>=</span> <span class='va'>rectangle_top</span> <span class='op'>-</span> <span class='va'>rectangle_height</span> <span class='op'>*</span> <span class='va'>minute_separation</span>,</span>
<span>  <span class='st'>"hjust"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.5</span>, <span class='fl'>0.5</span>, <span class='fl'>0.5</span>, <span class='fl'>0.5</span>, <span class='fl'>0</span><span class='op'>)</span> <span class='co'># All justified center, "minutes" left</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Tibble for "faster by" (relative to rectangles):</span></span>
<span><span class='va'>legend_faster</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"label"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"faster by bike"</span>, <span class='st'>"|"</span>, <span class='st'>"faster by transit"</span><span class='op'>)</span>,</span>
<span>  <span class='st'>"x"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>    <span class='va'>rectangle_left</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>2</span><span class='op'>*</span><span class='va'>rectangle_width</span><span class='op'>)</span> <span class='op'>+</span> <span class='va'>rectangle_space</span>,</span>
<span>    <span class='va'>rectangle_left</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>2.5</span><span class='op'>*</span><span class='va'>rectangle_width</span><span class='op'>)</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>2.5</span><span class='op'>*</span><span class='va'>rectangle_space</span><span class='op'>)</span>,</span>
<span>    <span class='va'>rectangle_left</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>3</span><span class='op'>*</span><span class='va'>rectangle_width</span><span class='op'>)</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>3</span><span class='op'>*</span><span class='va'>rectangle_space</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>  <span class='st'>"y"</span> <span class='op'>=</span> <span class='va'>rectangle_top</span> <span class='op'>+</span> <span class='va'>rectangle_height</span> <span class='op'>*</span> <span class='va'>faster_separation</span>,</span>
<span>  <span class='st'>"hjust"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>0.5</span>, <span class='fl'>0</span><span class='op'>)</span> <span class='co'># Justified: right, center, left</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span></span>
<span><span class='co'># Plotting color legend:</span></span>
<span><span class='co'># ======================</span></span>
<span><span class='va'>calgary_replica</span> <span class='op'>&lt;-</span> <span class='va'>calgary_replica</span> <span class='op'>+</span></span>
<span></span>
<span>  <span class='co'># Rounded rectangles:</span></span>
<span>  <span class='fu'><a href='https://funkyheatmap.github.io/funkyheatmap/reference/geom_rounded_rect.html'>geom_rounded_rect</a></span><span class='op'>(</span> <span class='co'># From package: funkyheatmap</span></span>
<span>    data <span class='op'>=</span> <span class='va'>legend_rectangles</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>xmin <span class='op'>=</span> <span class='va'>xmin</span>, xmax <span class='op'>=</span> <span class='va'>xmax</span>,</span>
<span>        ymin <span class='op'>=</span> <span class='va'>ymin</span>, ymax <span class='op'>=</span> <span class='va'>ymax</span>, </span>
<span>        radius <span class='op'>=</span> <span class='fl'>0.3</span><span class='op'>)</span>,</span>
<span>    fill <span class='op'>=</span> <span class='va'>rectangle_fill</span>,</span>
<span>    color <span class='op'>=</span> <span class='cn'>NA</span>,  <span class='co'># No border</span></span>
<span>    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span>  <span class='co'># Minutes:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>legend_minutes</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span>, hjust <span class='op'>=</span> <span class='va'>hjust</span>, label <span class='op'>=</span> <span class='va'>label</span><span class='op'>)</span>,</span>
<span>    size <span class='op'>=</span> <span class='va'>minute_size</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>minute_color</span>, </span>
<span>    family <span class='op'>=</span> <span class='va'>minute_font</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># Faster by:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>legend_faster</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span>, hjust <span class='op'>=</span> <span class='va'>hjust</span>, label <span class='op'>=</span> <span class='va'>label</span><span class='op'>)</span>,</span>
<span>    size <span class='op'>=</span> <span class='va'>faster_size</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>faster_color</span>,</span>
<span>    family <span class='op'>=</span> <span class='va'>faster_font</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>calgary_replica</span></span></code></pre>
</div>
<p><img src="100569505_files/figure-html5/plot_color_legend-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<h4 id="north-arrow">North arrow</h4>
<p>Our map is only missing the spatial reference elements. We will start by plotting the arrow pointing North.</p>
<p>Once again, it is a non standard element. This means that default arrows do not work if we want a perfect replica. For example, the function <code>arrow()</code> inside <code>geom_segment(arrow = )</code> does not allow us to create an arrow that is at the same time as big as needed and as sharp (not rounded) as needed. There are packages like <code>ggspatial</code> that include functions to plot cardinal directions, but again, those don’t fit our needs. So we will need to create a custom arrow. An easy solution that will allow us to plot a big arrow with a sharp head and a rounded shaft is plotting a triangular polygon with a rounded rectangle on top.</p>
<p>Another thing that we should not is that there is a weird behaviour in geom_rounded_rectangle(): when line width increases, it plots undesired lines that don’t follow the rounded rectangle shape. Which means that we cannot use a single <code>geom_rounded_rectangle()</code> without fill but with a contour line to to plot the box around the arrow. To overcome this, we will plot a black <code>geom_rounded_rectangle()</code> with a smaller white one on top to get the desired effect.</p>
<p>Since, once again, there are lots of elements we need to build manually, and we will need lots of trial and error comparing to the original map until we get the exact replica, we will code using the same settings -&gt; calculations -&gt; plotting structure that we used before, which makes the trial-and error process much more comfortable. And we will often use relative values (relative to already existing shapes), which are easier to understand, read, and modify than absolute coordinate values with many decimals.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Settings:</span></span>
<span><span class='co'># =========</span></span>
<span></span>
<span><span class='va'>arrow_color</span> <span class='op'>&lt;-</span> <span class='st'>"#e3cdd5"</span></span>
<span></span>
<span><span class='co'># Arrow triangle:</span></span>
<span><span class='va'>triangle_mid_x</span> <span class='op'>&lt;-</span> <span class='op'>-</span><span class='fl'>114.2680</span> <span class='co'># This will be the reference for the rest of xs</span></span>
<span><span class='va'>triangle_bottom_y</span> <span class='op'>&lt;-</span> <span class='fl'>50.9067</span> <span class='co'># This will be the reference for the rest of ys</span></span>
<span></span>
<span><span class='va'>triangle_half_width</span> <span class='op'>&lt;-</span> <span class='fl'>0.0076</span></span>
<span><span class='va'>triangle_height</span> <span class='op'>&lt;-</span> <span class='fl'>0.0048</span></span>
<span></span>
<span><span class='co'># Arrow rectangle:</span></span>
<span><span class='va'>arrow_rectangle_width</span> <span class='op'>&lt;-</span> <span class='fl'>0.435</span> <span class='co'># Relative to triangle width</span></span>
<span><span class='va'>arrow_rectangle_height</span> <span class='op'>&lt;-</span> <span class='fl'>1.495</span> <span class='co'># Relative to triangle height</span></span>
<span><span class='va'>arrow_rectangle_radius</span> <span class='op'>&lt;-</span> <span class='fl'>0.24</span></span>
<span></span>
<span><span class='co'># North text:</span></span>
<span><span class='va'>north_space</span> <span class='op'>&lt;-</span> <span class='fl'>0.55</span> <span class='co'># Relative to triangle height, space 0 = arrow tip</span></span>
<span><span class='va'>north_size</span> <span class='op'>&lt;-</span> <span class='fl'>9</span></span>
<span><span class='va'>north_color</span> <span class='op'>&lt;-</span> <span class='st'>"black"</span></span>
<span></span>
<span><span class='co'># Outer box:</span></span>
<span><span class='va'>box_width</span> <span class='op'>&lt;-</span> <span class='fl'>2.22</span> <span class='co'># Relative to triangle width</span></span>
<span><span class='va'>box_height</span> <span class='op'>&lt;-</span> <span class='fl'>2.45</span> <span class='co'># Relative to triangle height</span></span>
<span><span class='va'>box_radius</span> <span class='op'>&lt;-</span> <span class='fl'>0.20</span></span>
<span><span class='va'>box_y_position</span> <span class='op'>&lt;-</span> <span class='fl'>0.255</span> <span class='co'># Relative to triangle tip (measured in triangle height)</span></span>
<span><span class='va'>box_color</span> <span class='op'>&lt;-</span> <span class='st'>"#575757"</span></span>
<span></span>
<span><span class='co'># Border thickness (changes the size of the inner box, altering border size):</span></span>
<span><span class='va'>border_thickness</span> <span class='op'>&lt;-</span> <span class='fl'>0.03</span> <span class='co'># Range 0-1 (0 = no border, 1 = full black box)</span></span>
<span><span class='va'>inner_box_color</span> <span class='op'>&lt;-</span> <span class='st'>"white"</span></span>
<span></span>
<span></span>
<span></span>
<span><span class='co'># Calculations:</span></span>
<span><span class='co'># =============</span></span>
<span></span>
<span><span class='co'># Tibble for arrow triangle (head):</span></span>
<span><span class='va'>triangle_polygon</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>    <span class='va'>triangle_mid_x</span>, <span class='co'># Tip x</span></span>
<span>    <span class='va'>triangle_mid_x</span> <span class='op'>-</span> <span class='va'>triangle_half_width</span>, <span class='co'># Left corner x</span></span>
<span>    <span class='va'>triangle_mid_x</span> <span class='op'>+</span> <span class='va'>triangle_half_width</span> <span class='co'># Right corner x</span></span>
<span>  <span class='op'>)</span>,</span>
<span>  y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>    <span class='va'>triangle_bottom_y</span> <span class='op'>+</span> <span class='va'>triangle_height</span>, <span class='co'># Tip y </span></span>
<span>    <span class='va'>triangle_bottom_y</span>, <span class='co'># Left corner y</span></span>
<span>    <span class='va'>triangle_bottom_y</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># Right corner y</span></span>
<span>  </span>
<span><span class='co'># Tibble for arrow rectangle (shaft):</span></span>
<span><span class='va'>arrow_rectangle</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  xmin <span class='op'>=</span> <span class='va'>triangle_mid_x</span> <span class='op'>-</span> <span class='op'>(</span><span class='va'>triangle_half_width</span><span class='op'>*</span><span class='va'>arrow_rectangle_width</span><span class='op'>)</span>, <span class='co'># Left</span></span>
<span>  xmax <span class='op'>=</span> <span class='va'>triangle_mid_x</span> <span class='op'>+</span> <span class='op'>(</span><span class='va'>triangle_half_width</span><span class='op'>*</span><span class='va'>arrow_rectangle_width</span><span class='op'>)</span>, <span class='co'># Right</span></span>
<span>  ymin <span class='op'>=</span> <span class='va'>triangle_bottom_y</span> <span class='op'>-</span> <span class='op'>(</span><span class='va'>triangle_height</span><span class='op'>*</span><span class='va'>arrow_rectangle_height</span><span class='op'>)</span>, <span class='co'># Bottom</span></span>
<span>  ymax <span class='op'>=</span> <span class='va'>triangle_bottom_y</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>0.25</span><span class='op'>*</span><span class='va'>triangle_height</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># Top.   </span></span>
<span>                                                     <span class='co'># We add 0.25 of the</span></span>
<span>                                                     <span class='co'># triangle height to</span></span>
<span>                                                     <span class='co'># hide rounded edge on</span></span>
<span>                                                     <span class='co'># the rectangle top.</span></span>
<span></span>
<span><span class='co'># Tibble for "north":</span></span>
<span><span class='va'>north</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  label <span class='op'>=</span> <span class='st'>"North"</span>,</span>
<span>  x <span class='op'>=</span> <span class='va'>triangle_mid_x</span>,</span>
<span>  y <span class='op'>=</span> <span class='va'>triangle_bottom_y</span> <span class='op'>+</span> <span class='va'>triangle_height</span> <span class='op'>+</span> <span class='va'>north_space</span><span class='op'>*</span><span class='va'>triangle_height</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Tibble for outer box:</span></span>
<span><span class='va'>arrow_box</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"xmin"</span> <span class='op'>=</span> <span class='va'>triangle_mid_x</span> <span class='op'>-</span> <span class='op'>(</span><span class='va'>triangle_half_width</span><span class='op'>*</span><span class='va'>box_width</span><span class='op'>)</span>, <span class='co'># Left</span></span>
<span>  <span class='st'>"xmax"</span> <span class='op'>=</span> <span class='va'>triangle_mid_x</span> <span class='op'>+</span> <span class='op'>(</span><span class='va'>triangle_half_width</span><span class='op'>*</span><span class='va'>box_width</span><span class='op'>)</span>, <span class='co'># Right</span></span>
<span>  <span class='st'>"ymin"</span> <span class='op'>=</span> <span class='va'>triangle_bottom_y</span> <span class='op'>-</span> <span class='op'>(</span><span class='va'>triangle_height</span><span class='op'>*</span><span class='va'>box_height</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='op'>(</span><span class='va'>triangle_height</span><span class='op'>*</span><span class='va'>box_y_position</span><span class='op'>)</span>, <span class='co'># Bottom</span></span>
<span>  <span class='st'>"ymax"</span> <span class='op'>=</span> <span class='va'>triangle_bottom_y</span> <span class='op'>+</span> <span class='op'>(</span><span class='va'>triangle_height</span><span class='op'>*</span><span class='va'>box_height</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='op'>(</span><span class='va'>triangle_height</span><span class='op'>*</span><span class='va'>box_y_position</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># Top</span></span>
<span></span>
<span><span class='co'># Tibble for inner box:</span></span>
<span><span class='co'># We  first create an auxiliary object which we will add/substract to outer box:</span></span>
<span><span class='va'>box_vertical_border</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='op'>(</span><span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>xmax</span> <span class='op'>-</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>xmin</span><span class='op'>)</span><span class='op'>*</span><span class='va'>border_thickness</span><span class='op'>)</span><span class='op'>/</span><span class='fl'>2</span> </span>
<span><span class='va'>box_horizontal_border</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='op'>(</span><span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>ymax</span> <span class='op'>-</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>ymin</span><span class='op'>)</span><span class='op'>*</span><span class='va'>border_thickness</span><span class='op'>)</span><span class='op'>/</span><span class='fl'>2</span></span>
<span><span class='co'># And then the tibble:</span></span>
<span><span class='va'>inner_box</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"xmin"</span> <span class='op'>=</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>xmin</span> <span class='op'>+</span> <span class='va'>box_vertical_border</span>,</span>
<span>  <span class='st'>"xmax"</span> <span class='op'>=</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>xmax</span> <span class='op'>-</span> <span class='va'>box_vertical_border</span>,</span>
<span>  <span class='st'>"ymin"</span> <span class='op'>=</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>ymin</span> <span class='op'>+</span> <span class='va'>box_horizontal_border</span>,</span>
<span>  <span class='st'>"ymax"</span> <span class='op'>=</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>ymax</span> <span class='op'>-</span> <span class='va'>box_horizontal_border</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class='co'># Plotting north arrow:</span></span>
<span><span class='co'># =====================</span></span>
<span></span>
<span><span class='va'>calgary_replica</span> <span class='op'>&lt;-</span> <span class='va'>calgary_replica</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># Outer box:</span></span>
<span>  <span class='fu'><a href='https://funkyheatmap.github.io/funkyheatmap/reference/geom_rounded_rect.html'>geom_rounded_rect</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>arrow_box</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>xmin <span class='op'>=</span> <span class='va'>xmin</span>, xmax <span class='op'>=</span> <span class='va'>xmax</span>,</span>
<span>        ymin <span class='op'>=</span> <span class='va'>ymin</span>, ymax <span class='op'>=</span> <span class='va'>ymax</span><span class='op'>)</span>,</span>
<span>    radius <span class='op'>=</span> <span class='va'>box_radius</span>,</span>
<span>    fill <span class='op'>=</span> <span class='va'>box_color</span>,</span>
<span>    color <span class='op'>=</span> <span class='cn'>NA</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># Inner box:</span></span>
<span>  <span class='fu'><a href='https://funkyheatmap.github.io/funkyheatmap/reference/geom_rounded_rect.html'>geom_rounded_rect</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>inner_box</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>xmin <span class='op'>=</span> <span class='va'>xmin</span>, xmax <span class='op'>=</span> <span class='va'>xmax</span>,</span>
<span>        ymin <span class='op'>=</span> <span class='va'>ymin</span>, ymax <span class='op'>=</span> <span class='va'>ymax</span><span class='op'>)</span>,</span>
<span>    radius <span class='op'>=</span> <span class='va'>box_radius</span>,</span>
<span>    fill <span class='op'>=</span> <span class='va'>inner_box_color</span>,</span>
<span>    color <span class='op'>=</span> <span class='cn'>NA</span></span>
<span>    <span class='op'>)</span><span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># Arrow head (triangle):</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_polygon.html'>geom_polygon</a></span><span class='op'>(</span> </span>
<span>    data <span class='op'>=</span> <span class='va'>triangle_polygon</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span>,</span>
<span>    fill <span class='op'>=</span> <span class='va'>arrow_color</span>,</span>
<span>    color <span class='op'>=</span> <span class='cn'>NA</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span> </span>
<span>  </span>
<span>  <span class='co'># Arrow shaft (rectangle):</span></span>
<span>  <span class='fu'><a href='https://funkyheatmap.github.io/funkyheatmap/reference/geom_rounded_rect.html'>geom_rounded_rect</a></span><span class='op'>(</span> </span>
<span>    data <span class='op'>=</span> <span class='va'>arrow_rectangle</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>xmin <span class='op'>=</span> <span class='va'>xmin</span>, xmax <span class='op'>=</span> <span class='va'>xmax</span>,</span>
<span>        ymin <span class='op'>=</span> <span class='va'>ymin</span>, ymax <span class='op'>=</span> <span class='va'>ymax</span><span class='op'>)</span>,</span>
<span>    radius <span class='op'>=</span> <span class='va'>arrow_rectangle_radius</span>,</span>
<span>    fill <span class='op'>=</span> <span class='va'>arrow_color</span>,</span>
<span>    color<span class='op'>=</span> <span class='cn'>NA</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span> </span>
<span>  </span>
<span>  <span class='co'># "North" text:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>north</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span>, label <span class='op'>=</span> <span class='va'>label</span><span class='op'>)</span>,</span>
<span>    size <span class='op'>=</span> <span class='va'>north_size</span>,</span>
<span>    fontface <span class='op'>=</span> <span class='st'>"bold"</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>north_color</span>, </span>
<span>    family <span class='op'>=</span> <span class='st'>"atkinson"</span></span>
<span>    <span class='op'>)</span></span>
<span></span>
<span><span class='va'>calgary_replica</span> <span class='co'># To see it</span></span></code></pre>
</div>
<p><img src="100569505_files/figure-html5/plot_north_arrow-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<h4 id="scale">Scale</h4>
<p>As was the case with the north-pointing arrow, the scale is non standard element, even packages like <code>ggspatial</code> do no include scales like the one we need. Once again, we will build it manually by trying different values until we get the exact replica as we did before.</p>
<p>The only difference now is that there is one value which we do not have to find by trial and error: the scale must represent 3 kilometers. To make sure we get the proper length, we will use <code>destPoint()</code> from package <code>geosphere</code>, which, as it documentation states: “given a start point, initial bearing (direction), and distance, this function computes the destination point travelling along a the shortest path on an ellipsoid (the geodesic)”.</p>
<p>Note that, even though it is an unusual choice, in the original map the ticks in the scale are plotted over the horizontal line. We will maintain that in our replica.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Settings:</span></span>
<span><span class='co'># =========</span></span>
<span></span>
<span><span class='co'># Horizontal line:</span></span>
<span><span class='va'>scale_length</span> <span class='op'>&lt;-</span> <span class='fl'>3100</span> <span class='co'># In meters (we set it a bit longer so that the ends</span></span>
<span>                     <span class='co'># extend over the ticks as in the original)</span></span>
<span><span class='va'>scale_space</span> <span class='op'>&lt;-</span> <span class='fl'>0.13</span> <span class='co'># Space between scale and box, proportion of box height</span></span>
<span><span class='va'>scale_thickness</span> <span class='op'>&lt;-</span> <span class='fl'>2</span> <span class='co'># For geom_segment(linewidth = )</span></span>
<span><span class='va'>scale_color</span> <span class='op'>&lt;-</span> <span class='st'>"#676767"</span></span>
<span>  </span>
<span><span class='co'># Ticks:</span></span>
<span><span class='va'>tick_distance</span> <span class='op'>&lt;-</span> <span class='fl'>3000</span> <span class='co'># In meters, distance between the ticks at each end </span></span>
<span><span class='va'>tick_length</span> <span class='op'>&lt;-</span> <span class='fl'>0.08</span> <span class='co'># Proportion of the box height</span></span>
<span><span class='va'>tick_thickness</span> <span class='op'>&lt;-</span> <span class='fl'>1.1</span> <span class='co'># For geom_segment(linewidth = )</span></span>
<span><span class='va'>tick_color</span> <span class='op'>&lt;-</span> <span class='st'>"#000000"</span></span>
<span></span>
<span><span class='co'># Kilometers:</span></span>
<span><span class='va'>km_space</span> <span class='op'>&lt;-</span> <span class='fl'>0.275</span> <span class='co'># Space between km and scale, proportion of box height</span></span>
<span><span class='va'>km_size</span> <span class='op'>&lt;-</span> <span class='fl'>9</span> <span class='co'># For geom_text(size = )</span></span>
<span><span class='va'>km_font</span> <span class='op'>&lt;-</span> <span class='st'>"atkinson"</span></span>
<span><span class='va'>km_color</span> <span class='op'>&lt;-</span> <span class='st'>"#000000"</span></span>
<span></span>
<span></span>
<span><span class='co'># Calculations:</span></span>
<span><span class='co'># =============</span></span>
<span></span>
<span><span class='co'># Auxiliary objects:</span></span>
<span><span class='va'>box_actual_width</span> <span class='op'>&lt;-</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>xmax</span> <span class='op'>-</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>xmin</span></span>
<span><span class='va'>box_actual_height</span> <span class='op'>&lt;-</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>ymax</span> <span class='op'>-</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>ymin</span></span>
<span><span class='va'>box_mid_x</span> <span class='op'>&lt;-</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>xmin</span> <span class='op'>+</span> <span class='op'>(</span><span class='va'>box_actual_width</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Calculate right end of the horizontal line:</span></span>
<span><span class='va'>scale_left</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/as_tibble.html'>as_tibble</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/geosphere/man/destPoint.html'>destPoint</a></span><span class='op'>(</span></span>
<span>  p <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span> </span>
<span>    <span class='va'>box_mid_x</span>, <span class='co'># Starting x</span></span>
<span>    <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>ymin</span> <span class='op'>-</span> <span class='va'>box_actual_height</span><span class='op'>*</span><span class='va'>scale_space</span><span class='op'>)</span>, <span class='co'># Starting y</span></span>
<span>  b <span class='op'>=</span> <span class='fl'>90</span>, <span class='co'># b = bearing in degrees</span></span>
<span>  d <span class='op'>=</span> <span class='op'>-</span><span class='va'>scale_length</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># d = distance in meters </span></span>
<span></span>
<span><span class='co'># Calculate left end of the horizontal line:</span></span>
<span><span class='va'>scale_right</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/as_tibble.html'>as_tibble</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/geosphere/man/destPoint.html'>destPoint</a></span><span class='op'>(</span></span>
<span>  p <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>box_mid_x</span>, <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>ymin</span> <span class='op'>-</span> <span class='va'>box_actual_height</span><span class='op'>*</span><span class='va'>scale_space</span><span class='op'>)</span>, </span>
<span>  b <span class='op'>=</span> <span class='fl'>90</span>,</span>
<span>  d <span class='op'>=</span> <span class='va'>scale_length</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Tibble for horizontal line:</span></span>
<span><span class='va'>scale_horizontal</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"x"</span> <span class='op'>=</span> <span class='va'>scale_left</span><span class='op'>$</span><span class='va'>lon</span>, <span class='st'>"xend"</span> <span class='op'>=</span> <span class='va'>scale_right</span><span class='op'>$</span><span class='va'>lon</span>,</span>
<span>  <span class='st'>"y"</span> <span class='op'>=</span> <span class='va'>scale_left</span><span class='op'>$</span><span class='va'>lat</span>, <span class='st'>"yend"</span> <span class='op'>=</span> <span class='va'>scale_left</span><span class='op'>$</span><span class='va'>lat</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Calculate left tick:</span></span>
<span><span class='va'>tick_left</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/as_tibble.html'>as_tibble</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/geosphere/man/destPoint.html'>destPoint</a></span><span class='op'>(</span></span>
<span>  p <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>box_mid_x</span>, <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>ymin</span> <span class='op'>-</span> <span class='va'>box_actual_height</span><span class='op'>*</span><span class='va'>scale_space</span><span class='op'>)</span>, </span>
<span>  b <span class='op'>=</span> <span class='fl'>90</span>,</span>
<span>  d <span class='op'>=</span> <span class='op'>-</span><span class='va'>tick_distance</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Calculate right tick:</span></span>
<span><span class='va'>tick_right</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/as_tibble.html'>as_tibble</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/geosphere/man/destPoint.html'>destPoint</a></span><span class='op'>(</span></span>
<span>  p <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>box_mid_x</span>, <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>ymin</span> <span class='op'>-</span> <span class='va'>box_actual_height</span><span class='op'>*</span><span class='va'>scale_space</span><span class='op'>)</span>, </span>
<span>  b <span class='op'>=</span> <span class='fl'>90</span>,</span>
<span>  d <span class='op'>=</span> <span class='va'>tick_distance</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Tibble for ticks:</span></span>
<span><span class='va'>tick</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"x"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>tick_left</span><span class='op'>$</span><span class='va'>lon</span>, <span class='va'>box_mid_x</span>, <span class='va'>tick_right</span><span class='op'>$</span><span class='va'>lon</span><span class='op'>)</span>,</span>
<span>  <span class='st'>"xend"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>tick_left</span><span class='op'>$</span><span class='va'>lon</span>, <span class='va'>box_mid_x</span>, <span class='va'>tick_right</span><span class='op'>$</span><span class='va'>lon</span><span class='op'>)</span>,</span>
<span>  <span class='st'>"y"</span> <span class='op'>=</span> <span class='va'>tick_left</span><span class='op'>$</span><span class='va'>lat</span> <span class='op'>-</span> <span class='op'>(</span><span class='op'>(</span><span class='va'>box_actual_height</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>*</span><span class='va'>tick_length</span><span class='op'>)</span>, </span>
<span>  <span class='st'>"yend"</span> <span class='op'>=</span> <span class='va'>tick_left</span><span class='op'>$</span><span class='va'>lat</span> <span class='op'>+</span> <span class='op'>(</span><span class='op'>(</span><span class='va'>box_actual_height</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>*</span><span class='va'>tick_length</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Tibble for kilometers:</span></span>
<span><span class='va'>km</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"label"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"0"</span>, <span class='st'>"1.5"</span>, <span class='st'>"3"</span>, <span class='st'>"  km"</span><span class='op'>)</span>,</span>
<span>  <span class='st'>"x"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>scale_left</span><span class='op'>$</span><span class='va'>lon</span>, <span class='va'>box_mid_x</span>, <span class='va'>scale_right</span><span class='op'>$</span><span class='va'>lon</span>, <span class='va'>scale_right</span><span class='op'>$</span><span class='va'>lon</span><span class='op'>)</span>,</span>
<span>  <span class='st'>"y"</span> <span class='op'>=</span> <span class='va'>scale_left</span><span class='op'>$</span><span class='va'>lat</span> <span class='op'>-</span> <span class='op'>(</span><span class='op'>(</span><span class='va'>box_actual_height</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>*</span><span class='va'>km_space</span><span class='op'>)</span>,</span>
<span>  <span class='st'>"hjust"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.5</span>, <span class='fl'>0.5</span>, <span class='fl'>0.5</span>, <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># All justified center, "kilometers" left</span></span>
<span></span>
<span></span>
<span></span>
<span><span class='co'># Plotting:</span></span>
<span><span class='co'># =========</span></span>
<span></span>
<span><span class='va'>calgary_replica</span> <span class='op'>&lt;-</span> <span class='va'>calgary_replica</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># Ticks:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_segment.html'>geom_segment</a></span><span class='op'>(</span> </span>
<span>    data <span class='op'>=</span> <span class='va'>tick</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, xend <span class='op'>=</span> <span class='va'>xend</span>, </span>
<span>        y <span class='op'>=</span> <span class='va'>y</span>, yend <span class='op'>=</span> <span class='va'>yend</span><span class='op'>)</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='va'>tick_thickness</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>tick_color</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># Horizontal line:  </span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_segment.html'>geom_segment</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>scale_horizontal</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, xend <span class='op'>=</span> <span class='va'>xend</span>, </span>
<span>        y <span class='op'>=</span> <span class='va'>y</span>, yend <span class='op'>=</span> <span class='va'>yend</span><span class='op'>)</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='va'>scale_thickness</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>scale_color</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># Kilometers:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>km</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span>, hjust <span class='op'>=</span> <span class='va'>hjust</span>, label <span class='op'>=</span> <span class='va'>label</span><span class='op'>)</span>,</span>
<span>    size <span class='op'>=</span> <span class='va'>km_size</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>km_color</span>, </span>
<span>    family <span class='op'>=</span> <span class='va'>km_font</span></span>
<span>    <span class='op'>)</span></span>
<span></span>
<span></span>
<span><span class='va'>calgary_replica</span> <span class='co'># To see it</span></span></code></pre>
</div>
<p><img src="100569505_files/figure-html5/plot_scale-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<h2 id="alternative">Alternative</h2>
<p>[Todavía tengo que redactar esto bien]</p>
<p>I believe the map is already pretty good (at least compared to some of the maps that my colleagues chose).</p>
<p>For the alternative version we will address two of the main issues with the original map:</p>
<pre><code>a) It doesn&#39;t include any informations on absolute travel times (which is an important piece of information for any possible users of the map: for example, it is unlikely that someone chooses to travel by bike just because it is ten minutes faster, they probably want information on how long they will have to cycle for to reach the destination). We will address this by adding isochrones that show the time it takes to get to Calgary Tower if the fastest travel mode is chosen.

b) The ---let&#39;s be honest, few--- people to whom I have shown the original map have struggled to quickly read it. That mainly has to do with the legend: although perfectly understandable, it is not very intuitive (you first need to read a long para). We will address this by changing the text that accompanies the legend (also making it shorter), the text in the legend (to aid quickly understanding it), and its disposition (we believe that representing the colors vertically can also help understand faster, since it is only vertically that we find the full scale of color until purple). On top of that, we will add small extra legend showing how to read an example point of the map.</code></pre>
<p>On top of these changes, we will carry out some minor ones:</p>
<pre><code>c) We will plot the roads on top of the water, to show where bridges are.

d) We will create a dark version of the map.

e) We will plot only one color for for the roads when bike is faster. The original map includes a dark orange that represents points from where bike is supposedly faster by more than 30 minutes. However, many of these don&#39;t make sense (for example, when they are inmediately next to points from which transit is faster; something that shouldn&#39;t be possible, especially when they are large areas [there should be a middle area where bike is faster by 10-30 minutes, the transition should be progressive]). Or are just tiny parts in motorway knots. We believe this is probably the result of flaws in r5py (which the author used to obtain the data)). We have decided to consider all areas where bike faster the same (under one single label indicating it is faster by 10-30&#39;). This is not a perfect solution, but we couldn&#39;t come up with one. How to discriminate which points are the result of flaws in r5py and which ones are legitimate? We don&#39;t have a way to answer that question with the available data. Plotting it as if it was faster by 10-30&#39; seems like a sensible solution because it is most likely true in the dark orange parts of the center of the map. It might be the case that some areas are actually dark orange, like the ones on the outer part of the map, but those are probably less populated (and transited) areas, so a mistake would affect less people.</code></pre>
<h3 id="data-transformation-1">Data transformation:</h3>
<p>The first step is to carry out some data transformation in order to be able to compute the isochrones. For that, we will add a new variable to <code>hexagons</code>, containing binned data (in 20 minutes bins) on what the travel time is if the fastest mode is chosen. Why did we choose 20 minute bins? Why not 15? Or 30? With 20 minutes bins we achieve a nice equilibrium between the (whole) map being informative, and not overloading the it whith isochrones.</p>
<p>We will create four areas: under 20’, under 40’, under 60’, and equal or more than 60’.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>hexagons2</span> <span class='op'>&lt;-</span> <span class='va'>hexagons</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span></span>
<span>    <span class='st'>"fastest_travel_time"</span> <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span></span>
<span>      <span class='va'>b_travel_time</span> <span class='op'>&gt;</span> <span class='va'>travel_time</span> <span class='op'>~</span> <span class='va'>travel_time</span>,</span>
<span>      <span class='va'>travel_time</span> <span class='op'>&gt;</span> <span class='va'>b_travel_time</span> <span class='op'>~</span> <span class='va'>b_travel_time</span><span class='op'>)</span>,</span>
<span>    <span class='st'>"isochrones"</span> <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span></span>
<span>      <span class='va'>fastest_travel_time</span> <span class='op'>&lt;</span> <span class='fl'>20</span> <span class='op'>~</span> <span class='fl'>4</span>,</span>
<span>      <span class='va'>fastest_travel_time</span> <span class='op'>&lt;</span> <span class='fl'>40</span> <span class='op'>~</span> <span class='fl'>3</span>,</span>
<span>      <span class='va'>fastest_travel_time</span> <span class='op'>&lt;</span> <span class='fl'>60</span> <span class='op'>~</span> <span class='fl'>2</span>,</span>
<span>      <span class='va'>fastest_travel_time</span> <span class='op'>&gt;=</span> <span class='fl'>60</span> <span class='op'>~</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>isochrones</span> <span class='op'>!=</span> <span class='fl'>1</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>We used the last filter in order not to get an area for the last “isochrone” (since it has an infinite maximum value, it would just represent the border of the map, which adds no information and would only create visual noise).</p>
<p>The reason we gave the isochrones a decreasing order is because (If we are not mistaken), the lowest values are being plotted first (at least, this seems to be the case visually when we tried different options). And, given the transformations we perform in the next chunk, the larger areas include they areas inside them (they are not doughnuts). Since we want to color in a gradient from cyan to gray, we need the smaller areas to have the biggest number to be plotted last (thus on top), and appear more more vivid (which they would not be the case if we plot a gray layer on top).</p>
<p>Having clarified these things, we can can continue with the data transformation. We have the areas for the isochrones, but there are a few problems we need to solve. First of all, the areas we have are sets of hexagons, which means they create a “hexagon grid” effect when we plot them:</p>
<div class="layout-chunk" data-layout="l-body">
<p><img src="100569505_files/figure-html5/show_hexagon_grid_problem-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<p>To avoid this hexagon_grid effect, we need to combine all the hexagons in each area. Using <code>group by</code> and <code>summarise</code> is an elegantly simple solution, <a href="https://stackoverflow.com/questions/49354393/r-how-do-i-merge-polygon-features-in-a-shapefile-with-many-polygons-reproducib">this is where I got the idea from</a></p>
<p><strong>Note for Iñaki.</strong> <em>I’m not sure whether I should include this kind of “reference” (the stackoverflow.com one). I’ve got many more of them written down for other parts of the code, I could include more if you think I should, or remove this one if you think I shouldn’t include them. The reason I decided to put this reference is because I thought this solution is particularly original (but maybe that’s just my inexperienced eyes).</em></p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>hexagons2</span> <span class='op'>&lt;-</span> <span class='va'>hexagons2</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>isochrones</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>We now have isochrones that we can plot without the “hexagon grid” effect. However, there are two other problems: first, there are lots of holes in our isochrones; second, the border of our isochrones follows straight lines with the shape of the hexagons, which would create visual noise when plotted on top of the roads. Let’s remove the wholes and smooth out the isochrones:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>hexagons2</span> <span class='op'>&lt;-</span> <span class='va'>hexagons2</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_cast.html'>st_cast</a></span><span class='op'>(</span><span class='st'>"POLYGON"</span><span class='op'>)</span> <span class='op'>|&gt;</span> <span class='co'># More on why we use st_cast() below </span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span><span class='st'>"area"</span> <span class='op'>=</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/geos_measures.html'>st_area</a></span><span class='op'>(</span><span class='va'>geometry</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span>  <span class='co'># We calculate area of each polygon</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span><span class='st'>"area"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>area</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span> <span class='co'># Make numeric to be able to filter</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>area</span> <span class='op'>&gt;</span> <span class='fl'>500000</span><span class='op'>)</span> <span class='op'>|&gt;</span>  <span class='co'># We keep only the polygons with a big area (m2)</span></span>
<span>  <span class='fu'><a href='https://michaeldorman.github.io/nngeo/reference/st_remove_holes.html'>st_remove_holes</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>|&gt;</span>  <span class='co'># Remove the holes</span></span>
<span>  <span class='fu'><a href='https://strimas.com/smoothr/reference/smooth.html'>smooth</a></span><span class='op'>(</span> <span class='co'># From package smoothr, to smooth the border of the isochrones</span></span>
<span>    method <span class='op'>=</span> <span class='st'>"ksmooth"</span>,</span>
<span>    smoothness <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>Why did we use st_cast? I initially tried <code>st_remove_holes()</code> from package <code>nngeo</code> directly. But it didn’t work (the code did run, but we didn’t get the desired effect). The reason is that the geometry in our object <code>isochrones</code> is multipolygon, and <code>st_remove_holes()</code> removes the holes inside each of the “polygons” that form a multipolygon. Looking at an example from the function’s documentation might help clarify what I am trying to convey:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>opar</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span><span class='op'>(</span>mfrow <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Example with 'sfg' - POLYGON</span></span>
<span><span class='va'>p1</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>rbind</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>0</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>0</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3</span>,<span class='fl'>2</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>,<span class='fl'>4</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>4</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>p2</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>rbind</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>1</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>2</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>,<span class='fl'>2</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>p3</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>rbind</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3</span>,<span class='fl'>0</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>4</span>,<span class='fl'>0</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>4</span>,<span class='fl'>1</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3</span>,<span class='fl'>1</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3</span>,<span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>p4</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>rbind</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3.3</span>,<span class='fl'>0.3</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3.8</span>,<span class='fl'>0.3</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3.8</span>,<span class='fl'>0.8</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3.3</span>,<span class='fl'>0.8</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3.3</span>,<span class='fl'>0.3</span><span class='op'>)</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>5</span><span class='op'>:</span><span class='fl'>1</span>,<span class='op'>]</span></span>
<span><span class='va'>p5</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>rbind</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3</span>,<span class='fl'>3</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>4</span>,<span class='fl'>2</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>4</span>,<span class='fl'>3</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3</span>,<span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>mpol</span> <span class='op'>=</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st.html'>st_multipolygon</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>p1</span>,<span class='va'>p2</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>p3</span>,<span class='va'>p4</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>p5</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>result</span> <span class='op'>=</span> <span class='fu'><a href='https://michaeldorman.github.io/nngeo/reference/st_remove_holes.html'>st_remove_holes</a></span><span class='op'>(</span><span class='va'>mpol</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>mpol</span>, col <span class='op'>=</span> <span class='st'>"#FF000033"</span>, main <span class='op'>=</span> <span class='st'>"Before"</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>result</span>, col <span class='op'>=</span> <span class='st'>"#FF000033"</span>, main <span class='op'>=</span> <span class='st'>"After"</span><span class='op'>)</span></span></code></pre>
</div>
<p><img src="100569505_files/figure-html5/st_remove_holes_documentation_example-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<p>However, this doesn’t fix all of the holes in our isochrones because… they are not actually holes! Even if they visually look like that, they are actually small “islands”, they are small “polygons” part of a multipolygon. When, for example, the small “islands” of isochrone 4 are plotted inside isochrone 3, they look like holes, but <code>st_remove_holes()</code> doesn’t fix that. That’s why we use <code>st_cast()</code>: it divides the multipolygons into the polygons (“islands”) that form them. And once we have done that, we can then filter by size (removing the small ones that look like holes). This way we fix both the holes and the small “island” that look like holes.</p>
<p>Ready to plot!</p>
<h3 id="plotting-1">Plotting</h3>
<h4 id="roads-water-and-isochrones">Roads, water, and isochrones</h4>
<p>We begin plotting the roads, water, and isochrones. We will first plot the isochrones’ areas, since they would alter the color of the roads if we plotted them on top of them. After that, the water, then the roads (unlike the original map, where water was on top of roads), and finally the isochrones’ border.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>alternative</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span><span class='co'># Isochrones' areas (no border yet)</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>hexagons2</span>, </span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>isochrones</span><span class='op'>)</span>,</span>
<span>    color <span class='op'>=</span> <span class='cn'>NA</span>,</span>
<span>    alpha <span class='op'>=</span> <span class='fl'>0.2</span>,</span>
<span>    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span> </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_gradient.html'>scale_fill_gradient</a></span><span class='op'>(</span>low <span class='op'>=</span> <span class='st'>"gray"</span>, <span class='co'># Outer isochrone</span></span>
<span>                      high <span class='op'>=</span> <span class='st'>"cyan"</span> <span class='co'># Inner isochrone</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span><span class='co'># Water:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span> <span class='co'>#</span></span>
<span>    data <span class='op'>=</span> <span class='va'>water</span>,</span>
<span>    fill <span class='op'>=</span> <span class='st'>"#a6b0b9"</span>,</span>
<span>    color <span class='op'>=</span> <span class='st'>"#a6b0b9"</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='fl'>1.1</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span><span class='co'># Roads:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>hexroads_intersection</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='va'>time_color</span><span class='op'>)</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='fl'>0.6</span>, <span class='co'># Thinner look better with  isochrones and black background</span></span>
<span>    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_color_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>    <span class='st'>"-2"</span> <span class='op'>=</span> <span class='st'>"#c88c47"</span>, <span class='co'># Color choice explained above</span></span>
<span>    <span class='st'>"-1"</span> <span class='op'>=</span> <span class='st'>"#c88c47"</span>, <span class='co'># bike 10–30 min faster</span></span>
<span>    <span class='st'>"0"</span>  <span class='op'>=</span> <span class='st'>"#b7a6ac"</span>, <span class='co'># similar travel time</span></span>
<span>    <span class='st'>"1"</span>  <span class='op'>=</span> <span class='st'>"#a36f96"</span>, <span class='co'># transit 10–30 min faster</span></span>
<span>    <span class='st'>"2"</span>  <span class='op'>=</span> <span class='st'>"#6a4886"</span><span class='op'>)</span> <span class='co'># transit &gt;30 min faster</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span><span class='co'># Isochrones's borders:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>hexagons2</span>, </span>
<span>    color <span class='op'>=</span> <span class='fu'><a href='https://scales.r-lib.org/reference/alpha.html'>alpha</a></span><span class='op'>(</span><span class='st'>"#e5fcff"</span>, <span class='fl'>0.7</span><span class='op'>)</span>,</span>
<span>    fill <span class='op'>=</span> <span class='cn'>NA</span>,</span>
<span>    alpha <span class='op'>=</span> <span class='fl'>0</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='fl'>1</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># Theming:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_void</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span> <span class='co'># To make the plot area and the whole image have black background</span></span>
<span>    plot.background <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='st'>"black"</span>, color <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span>,</span>
<span>    panel.background <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='st'>"black"</span>, color <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>alternative</span> <span class='co'># To see it</span></span></code></pre>
</div>
<p><img src="100569505_files/figure-html5/plot_roads_water_isochrones-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<h4 id="color-legend-lollipops-option-dismissed">Color legend (lollipops option) (dismissed?)</h4>
<p>For a while I thought I would go with this legend. I’m still not completely sure, I want to to wait until the presentation before removing it.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Settings:</span></span>
<span><span class='co'># =========</span></span>
<span></span>
<span><span class='co'># Lines settings:</span></span>
<span><span class='va'>lines_x_end</span> <span class='op'>&lt;-</span> <span class='op'>-</span><span class='fl'>114.18</span> <span class='co'># Same outside x for all lines</span></span>
<span><span class='va'>lines_width</span> <span class='op'>&lt;-</span> <span class='fl'>1</span> <span class='co'># Lines width</span></span>
<span></span>
<span><span class='va'>yellow_line_y_end</span> <span class='op'>&lt;-</span> <span class='fl'>50.980</span> <span class='co'># Yellow line line y end + text y + point y</span></span>
<span><span class='va'>gray_line_y_end</span> <span class='op'>&lt;-</span> <span class='fl'>50.965</span></span>
<span><span class='va'>light_purple_line_y_end</span> <span class='op'>&lt;-</span> <span class='fl'>50.950</span> <span class='co'># Light purple line y end + text y + point y</span></span>
<span><span class='va'>purple_line_y_end</span> <span class='op'>&lt;-</span> <span class='fl'>50.935</span> <span class='co'># Purple line y end + text y + point y</span></span>
<span></span>
<span><span class='va'>dot_size</span> <span class='op'>&lt;-</span> <span class='fl'>25</span> <span class='co'># Lollipop dot size</span></span>
<span><span class='va'>dot_stroke</span> <span class='op'>&lt;-</span> <span class='fl'>2</span></span>
<span><span class='va'>dot_stroke_color</span> <span class='op'>&lt;-</span> <span class='st'>"white"</span></span>
<span></span>
<span><span class='va'>text_color</span> <span class='op'>&lt;-</span> <span class='st'>"white"</span> <span class='co'># Text color</span></span>
<span><span class='va'>text_family</span> <span class='op'>&lt;-</span> <span class='st'>"atkinson"</span> <span class='co'># Typography</span></span>
<span><span class='va'>text_size</span> <span class='op'>&lt;-</span> <span class='fl'>10</span></span>
<span><span class='va'>text_h_just</span> <span class='op'>&lt;-</span> <span class='fl'>1</span> <span class='co'># 0 left, 0.5 center, 1 right</span></span>
<span><span class='va'>text_dot_space</span> <span class='op'>&lt;-</span> <span class='fl'>0.0125</span> <span class='co'># Space between the text and the dots</span></span>
<span></span>
<span></span>
<span><span class='op'>?</span><span class='va'>geom_shadowtext</span></span></code></pre>
</div>
<pre><code>No documentation for &#39;geom_shadowtext&#39; in specified packages and libraries:
you could try &#39;??geom_shadowtext&#39;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Plot the legend:</span></span>
<span><span class='co'>#=================</span></span>
<span></span>
<span><span class='co'># alternative &lt;- I don't save it because I think prefer option B.</span></span>
<span>  <span class='va'>alternative</span> <span class='op'>+</span> </span>
<span>    </span>
<span><span class='co'># Yellow streets</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span> <span class='co'># Yellow line</span></span>
<span>    <span class='st'>"segment"</span>,</span>
<span>    x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>114.105</span>,</span>
<span>    xend <span class='op'>=</span> <span class='va'>lines_x_end</span>,</span>
<span>    y <span class='op'>=</span> <span class='fl'>51.03</span>,</span>
<span>    yend <span class='op'>=</span> <span class='va'>yellow_line_y_end</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='va'>lines_width</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>dot_stroke_color</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span> <span class='co'># Yellow lollipop dot</span></span>
<span>    <span class='st'>"point"</span>,</span>
<span>    x <span class='op'>=</span> <span class='va'>lines_x_end</span>,</span>
<span>    y <span class='op'>=</span> <span class='va'>yellow_line_y_end</span>,</span>
<span>    size <span class='op'>=</span> <span class='va'>dot_size</span>,</span>
<span>    shape <span class='op'>=</span> <span class='fl'>21</span>,</span>
<span>    fill <span class='op'>=</span> <span class='st'>"#f8ad58"</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>dot_stroke_color</span>, <span class='co'># Border</span></span>
<span>    stroke <span class='op'>=</span> <span class='va'>dot_stroke</span> <span class='co'># Border stroke width</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span> <span class='co'># Yellow text</span></span>
<span>    <span class='st'>"text"</span>,</span>
<span>    label <span class='op'>=</span> <span class='st'>"10-30' faster by bike"</span>,</span>
<span>    x <span class='op'>=</span> <span class='va'>lines_x_end</span> <span class='op'>-</span> <span class='va'>text_dot_space</span>,</span>
<span>    y <span class='op'>=</span> <span class='va'>yellow_line_y_end</span>,</span>
<span>    hjust <span class='op'>=</span> <span class='va'>text_h_just</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>text_color</span>,</span>
<span>    family <span class='op'>=</span> <span class='va'>text_family</span>,</span>
<span>    size <span class='op'>=</span> <span class='va'>text_size</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span><span class='co'># Gray streets</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span> <span class='co'># Gray line</span></span>
<span>    <span class='st'>"segment"</span>,</span>
<span>    x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>114.125</span>,</span>
<span>    xend <span class='op'>=</span> <span class='va'>lines_x_end</span>,</span>
<span>    y <span class='op'>=</span> <span class='fl'>50.995</span>,</span>
<span>    yend <span class='op'>=</span> <span class='va'>gray_line_y_end</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='va'>lines_width</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>dot_stroke_color</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span> <span class='co'># Gray lollipop dot</span></span>
<span>    <span class='st'>"point"</span>,</span>
<span>    x <span class='op'>=</span> <span class='va'>lines_x_end</span>,</span>
<span>    y <span class='op'>=</span> <span class='va'>gray_line_y_end</span>,</span>
<span>    size <span class='op'>=</span> <span class='va'>dot_size</span>,</span>
<span>    shape <span class='op'>=</span> <span class='fl'>21</span>,</span>
<span>    fill <span class='op'>=</span> <span class='st'>"#e3cdd5"</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>dot_stroke_color</span>, </span>
<span>    stroke <span class='op'>=</span> <span class='va'>dot_stroke</span> </span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span> <span class='co'># Gray area text</span></span>
<span>    <span class='st'>"text"</span>,</span>
<span>    label <span class='op'>=</span> <span class='st'>"similar travel time"</span>, <span class='co'># Standard label for gray</span></span>
<span>    x <span class='op'>=</span> <span class='va'>lines_x_end</span> <span class='op'>-</span> <span class='va'>text_dot_space</span>,</span>
<span>    y <span class='op'>=</span> <span class='va'>gray_line_y_end</span>,</span>
<span>    hjust <span class='op'>=</span> <span class='va'>text_h_just</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>text_color</span>,</span>
<span>    family <span class='op'>=</span> <span class='va'>text_family</span>,</span>
<span>    size <span class='op'>=</span> <span class='va'>text_size</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span><span class='co'># Light purple streets</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span> <span class='co'># Light purple  line</span></span>
<span>    <span class='st'>"segment"</span>,</span>
<span>    x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>114.130</span>,</span>
<span>    xend <span class='op'>=</span> <span class='va'>lines_x_end</span>,</span>
<span>    y <span class='op'>=</span> <span class='fl'>50.94</span>,</span>
<span>    yend <span class='op'>=</span> <span class='va'>light_purple_line_y_end</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='va'>lines_width</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>dot_stroke_color</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span> <span class='co'># Light purple lollipop dot</span></span>
<span>    <span class='st'>"point"</span>,</span>
<span>    x <span class='op'>=</span> <span class='va'>lines_x_end</span>,</span>
<span>    y <span class='op'>=</span> <span class='va'>light_purple_line_y_end</span>,</span>
<span>    size <span class='op'>=</span> <span class='va'>dot_size</span>,</span>
<span>    shape <span class='op'>=</span> <span class='fl'>21</span>,</span>
<span>    fill <span class='op'>=</span> <span class='st'>"#ca8aba"</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>dot_stroke_color</span>, </span>
<span>    stroke <span class='op'>=</span> <span class='va'>dot_stroke</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span> <span class='co'># Light purple text</span></span>
<span>    <span class='st'>"text"</span>,</span>
<span>    label <span class='op'>=</span> <span class='st'>"10-30' faster by transit"</span>,</span>
<span>    x <span class='op'>=</span> <span class='va'>lines_x_end</span> <span class='op'>-</span> <span class='va'>text_dot_space</span>,</span>
<span>    y <span class='op'>=</span> <span class='va'>light_purple_line_y_end</span>,</span>
<span>    hjust <span class='op'>=</span> <span class='va'>text_h_just</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>text_color</span>,</span>
<span>    family <span class='op'>=</span> <span class='va'>text_family</span>,</span>
<span>    size <span class='op'>=</span> <span class='va'>text_size</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span><span class='co'># Purple streets</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span> <span class='co'># Purple line</span></span>
<span>    <span class='st'>"segment"</span>,</span>
<span>    x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>114.110</span>,</span>
<span>    xend <span class='op'>=</span> <span class='va'>lines_x_end</span>,</span>
<span>    y <span class='op'>=</span> <span class='fl'>50.910</span>,</span>
<span>    yend <span class='op'>=</span> <span class='va'>purple_line_y_end</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='va'>lines_width</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>dot_stroke_color</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span> <span class='co'># Purple lollipop dot</span></span>
<span>    <span class='st'>"point"</span>,</span>
<span>    x <span class='op'>=</span> <span class='va'>lines_x_end</span>,</span>
<span>    y <span class='op'>=</span> <span class='va'>purple_line_y_end</span>,</span>
<span>    size <span class='op'>=</span> <span class='va'>dot_size</span>,</span>
<span>    shape <span class='op'>=</span> <span class='fl'>21</span>,</span>
<span>    fill <span class='op'>=</span> <span class='st'>"#8359a6"</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>dot_stroke_color</span>, <span class='co'># Border</span></span>
<span>    stroke <span class='op'>=</span> <span class='va'>dot_stroke</span> <span class='co'># Border stroke width</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span> <span class='co'># Purple text</span></span>
<span>    <span class='st'>"text"</span>,</span>
<span>    label <span class='op'>=</span> <span class='st'>"+30' faster by transit"</span>,</span>
<span>    x <span class='op'>=</span> <span class='va'>lines_x_end</span> <span class='op'>-</span> <span class='va'>text_dot_space</span>,</span>
<span>    y <span class='op'>=</span> <span class='va'>purple_line_y_end</span>,</span>
<span>    hjust <span class='op'>=</span> <span class='va'>text_h_just</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>text_color</span>,</span>
<span>    family <span class='op'>=</span> <span class='va'>text_family</span>,</span>
<span>    size <span class='op'>=</span> <span class='va'>text_size</span></span>
<span>  <span class='op'>)</span></span></code></pre>
</div>
<p><img src="100569505_files/figure-html5/black_isochr_fastest_street_legend-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<h4 id="color-legend-streets-option-i-think-ill-choose-this-one">Color legend (streets option) (I think I’ll choose this one)</h4>
<p>[Debería redactar esto mejor].</p>
<p>As we discussed, one of the main issues with the original plot was that it was hard to understand the legend quickly.</p>
<p>One aspect of our alternative proposal is to plot thin vertical squares. The idea behind this decision is that they look like the roads they represent. On top of that, the colors in the legend appear in the same direction and order in which they appear in the map if you look to the right at the same height as the legend (middle to south, yellow to purple). Which we think helps quickly reading and understanding the map.</p>
<p>Since, once again, there’s lots of manual work to do until we find pleasing values, we will use the same “settings -&gt; calculations -&gt; plotting” approach we used above.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Settings:</span></span>
<span><span class='co'># =========</span></span>
<span><span class='va'>v_rectangle_top_y</span> <span class='op'>&lt;-</span> <span class='fl'>50.984</span></span>
<span><span class='va'>v_rectangle_mid_x</span> <span class='op'>&lt;-</span> <span class='op'>-</span><span class='fl'>114.17</span></span>
<span><span class='va'>v_rectangle_width</span> <span class='op'>&lt;-</span> <span class='fl'>0.002</span></span>
<span><span class='va'>v_rectangle_height</span> <span class='op'>&lt;-</span> <span class='fl'>0.0145</span></span>
<span><span class='va'>v_rectangle_space</span> <span class='op'>&lt;-</span> <span class='fl'>0.0005</span></span>
<span><span class='va'>v_rectangle_radius</span> <span class='op'>&lt;-</span> <span class='fl'>0.3</span></span>
<span><span class='va'>v_rectangle_fill</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"#c88c47"</span>, <span class='st'>"#b7a6ac"</span>, <span class='st'>"#a36f96"</span>, <span class='st'>"#6a4886"</span><span class='op'>)</span></span>
<span></span>
<span></span>
<span>  </span>
<span><span class='co'># We calculate the coordinates:</span></span>
<span><span class='co'># =============================</span></span>
<span><span class='va'>v_rectangles</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"xmin"</span> <span class='op'>=</span> <span class='va'>v_rectangle_mid_x</span> <span class='op'>-</span> <span class='op'>(</span><span class='va'>v_rectangle_width</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span>,</span>
<span>  <span class='st'>"xmax"</span> <span class='op'>=</span> <span class='va'>v_rectangle_mid_x</span> <span class='op'>+</span> <span class='op'>(</span><span class='va'>v_rectangle_width</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span>,</span>
<span>  <span class='st'>"ymin"</span> <span class='op'>=</span></span>
<span>    <span class='va'>v_rectangle_top_y</span> <span class='op'>-</span> <span class='op'>(</span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>4</span><span class='op'>)</span><span class='op'>*</span><span class='va'>v_rectangle_height</span><span class='op'>)</span> <span class='op'>-</span> <span class='op'>(</span><span class='op'>(</span><span class='fl'>0</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>)</span><span class='op'>*</span><span class='va'>v_rectangle_space</span><span class='op'>)</span>,</span>
<span>  <span class='st'>"ymax"</span> <span class='op'>=</span> <span class='va'>v_rectangle_top_y</span> <span class='op'>-</span> <span class='op'>(</span><span class='op'>(</span><span class='fl'>0</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>)</span><span class='op'>*</span><span class='op'>(</span><span class='va'>v_rectangle_height</span> <span class='op'>+</span> <span class='va'>v_rectangle_space</span><span class='op'>)</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class='co'># We plot the rectangles:</span></span>
<span><span class='co'>#========================</span></span>
<span><span class='va'>alternative</span> <span class='op'>&lt;-</span> <span class='va'>alternative</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://eliocamp.github.io/ggnewscale/reference/new_scale.html'>new_scale_fill</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span> <span class='co'># So that it doesn't affect the color of the isochrones</span></span>
<span>  <span class='fu'><a href='https://funkyheatmap.github.io/funkyheatmap/reference/geom_rounded_rect.html'>geom_rounded_rect</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>v_rectangles</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>xmin <span class='op'>=</span> <span class='va'>xmin</span>, xmax <span class='op'>=</span> <span class='va'>xmax</span>,</span>
<span>        ymin <span class='op'>=</span> <span class='va'>ymin</span>, ymax <span class='op'>=</span> <span class='va'>ymax</span><span class='op'>)</span>,</span>
<span>    fill <span class='op'>=</span> <span class='va'>v_rectangle_fill</span>,</span>
<span>    radius <span class='op'>=</span> <span class='va'>v_rectangle_radius</span>,</span>
<span>    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>alternative</span> <span class='co'># To see it</span></span></code></pre>
</div>
<p><img src="100569505_files/figure-html5/plot_thin_vertical_squares-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<p>Next, we add an extra detail: “street arrows” (an arrow made out of actual streets from our map). These “street arrows” come out of the thin rectangles (which act as “main streets”), and point towards the meaning of that color. This makes the legend more visible, helps identify what each color means, and we think it adds a nice aesthetic touch.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># I used this to find an adequate area:</span></span>
<span><span class='co'># OPTION A) </span></span>
<span><span class='co'># alternative + annotate(</span></span>
<span><span class='co'>#     "polygon",</span></span>
<span><span class='co'>#     x = c(c(-114.082, -114.082, -114.0633, -114.0633) # The sums allow me to</span></span>
<span><span class='co'>#           + (-0.150)),                                # move fast around the</span></span>
<span><span class='co'>#     y = c(c(51.044, 51.0465, 51.047, 51.0375)         # map looking for an</span></span>
<span><span class='co'>#           + (-0.0259)),                               # area that i like.</span></span>
<span><span class='co'>#     color = "green",</span></span>
<span><span class='co'>#     fill = NA,</span></span>
<span><span class='co'>#     linewidth = 1)</span></span>
<span></span>
<span><span class='co'># OPTION C) I'M USING THIS ONE</span></span>
<span><span class='co'># alternative + annotate(</span></span>
<span><span class='co'>#     "polygon",</span></span>
<span><span class='co'>#     x = c(c(-114.078, -114.078, -114.0631, -114.0631) # The sums allow me to</span></span>
<span><span class='co'>#           + (-0.054)),                                # move fast around the</span></span>
<span><span class='co'>#     y = c(c(51.0445, 51.0455, 51.051, 51.039)         # map looking for an</span></span>
<span><span class='co'>#           + (-0.08385)),                              # area that i like.</span></span>
<span><span class='co'>#     color = "green",</span></span>
<span><span class='co'>#     fill = NA,</span></span>
<span><span class='co'>#     linewidth = 0.4)</span></span>
<span></span>
<span><span class='co'># Now that we found the coordinates, we save them as a matrix, </span></span>
<span><span class='co'># because that's the object required by st_polygon:</span></span>
<span><span class='va'>selected_coordinates</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span><span class='op'>(</span></span>
<span>  <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>   <span class='st'>"x"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>114.078</span>, <span class='op'>-</span><span class='fl'>114.078</span>, <span class='op'>-</span><span class='fl'>114.0631</span>, <span class='op'>-</span><span class='fl'>114.0631</span><span class='op'>)</span> <span class='op'>+</span> <span class='op'>(</span><span class='op'>-</span><span class='fl'>0.054</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>   <span class='st'>"y"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>51.0445</span>, <span class='fl'>51.0455</span>, <span class='fl'>51.051</span>, <span class='fl'>51.039</span><span class='op'>)</span> <span class='op'>+</span> <span class='op'>(</span><span class='op'>-</span><span class='fl'>0.08385</span><span class='op'>)</span><span class='op'>)</span></span>
<span>   <span class='op'>)</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>4</span>, <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># We need to repeat the first row in fifth place to close the</span></span>
<span>                 <span class='co'># polygon</span></span>
<span></span>
<span> </span>
<span><span class='co'># We create a polygon with those coordinates:</span></span>
<span><span class='va'>selected_polygon</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st.html'>st_polygon</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>selected_coordinates</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Then select the corresponding area from 'hexagons by intersection'.</span></span>
<span><span class='co'># But before, we need to specify that our object uses the same coordinate</span></span>
<span><span class='co'># reference system (crs), otherwise st_intersection doesn't work.</span></span>
<span><span class='va'>selected_polygon</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/sfc.html'>st_sfc</a></span><span class='op'>(</span></span>
<span>  <span class='va'>selected_polygon</span>,</span>
<span>  crs <span class='op'>=</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_crs.html'>st_crs</a></span><span class='op'>(</span><span class='va'>all_roads_dissolved</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span></span>
<span><span class='co'># We can now get the intersection:</span></span>
<span><span class='va'>selected_street</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/geos_binary_ops.html'>st_intersection</a></span><span class='op'>(</span><span class='va'>all_roads_dissolved</span>, <span class='va'>selected_polygon</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># We create a new object with this sf object substracting from its</span></span>
<span><span class='co'># coordinates the coordinates of its centroid. This way, it will be easier to </span></span>
<span><span class='co'># move (plot) repeatedly (we can put it wherever we want just by summing the</span></span>
<span><span class='co'># coordinates that we want to make the centroid).</span></span>
<span><span class='va'>centroid</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/geos_unary.html'>st_centroid</a></span><span class='op'>(</span><span class='fu'><a href='https://r-spatial.github.io/sf/reference/geos_combine.html'>st_union</a></span><span class='op'>(</span><span class='va'>selected_street</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>street_arrow</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_geometry.html'>st_geometry</a></span><span class='op'>(</span><span class='va'>selected_street</span><span class='op'>)</span> <span class='op'>-</span> <span class='va'>centroid</span></span></code></pre>
</div>
</div>
<p>We now have our “street arrow” template, we just need to plot it next to the squares:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Settings:</span></span>
<span><span class='co'># =========</span></span>
<span><span class='va'>street_arrow_mid_x</span> <span class='op'>&lt;-</span> <span class='op'>-</span><span class='fl'>0.0055</span> <span class='co'># From v_rectangle_mid_x</span></span>
<span><span class='va'>street_arrow_yellow_y</span> <span class='op'>&lt;-</span> <span class='fl'>0</span> <span class='co'># From 1/2 height of the vertical rectangles</span></span>
<span><span class='va'>street_arrow_width</span> <span class='op'>&lt;-</span> <span class='fl'>0.6</span></span>
<span></span>
<span><span class='co'># We calculate the coordinates:</span></span>
<span><span class='co'># =============================</span></span>
<span></span>
<span><span class='co'># Yellow street arrow:</span></span>
<span><span class='va'>street_arrow_yellow</span> <span class='op'>&lt;-</span> <span class='va'>street_arrow</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>  <span class='va'>v_rectangle_mid_x</span> <span class='op'>+</span> <span class='va'>street_arrow_mid_x</span>,</span>
<span>  <span class='va'>v_rectangle_top_y</span> <span class='op'>-</span> <span class='op'>(</span><span class='fl'>0.5</span><span class='op'>*</span><span class='va'>v_rectangle_height</span><span class='op'>)</span> <span class='op'>+</span> <span class='va'>street_arrow_yellow_y</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Gray street arrow:</span></span>
<span><span class='va'>street_arrow_gray</span> <span class='op'>&lt;-</span> <span class='va'>street_arrow</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>  <span class='va'>v_rectangle_mid_x</span> <span class='op'>+</span> <span class='va'>street_arrow_mid_x</span>,</span>
<span>  <span class='va'>v_rectangle_top_y</span> <span class='op'>-</span> <span class='op'>(</span><span class='op'>(</span><span class='fl'>1.5</span><span class='op'>*</span><span class='va'>v_rectangle_height</span><span class='op'>)</span> <span class='op'>+</span> <span class='va'>v_rectangle_space</span><span class='op'>)</span> <span class='op'>+</span> <span class='va'>street_arrow_yellow_y</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Light purple street arrow:</span></span>
<span><span class='va'>street_arrow_light_purple</span> <span class='op'>&lt;-</span> <span class='va'>street_arrow</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>  <span class='va'>v_rectangle_mid_x</span> <span class='op'>+</span> <span class='va'>street_arrow_mid_x</span>,</span>
<span>  <span class='va'>v_rectangle_top_y</span> <span class='op'>-</span> <span class='op'>(</span><span class='op'>(</span><span class='fl'>2.5</span><span class='op'>*</span><span class='va'>v_rectangle_height</span><span class='op'>)</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>2</span><span class='op'>*</span><span class='va'>v_rectangle_space</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> <span class='va'>street_arrow_yellow_y</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Purple street arrow:</span></span>
<span><span class='va'>street_arrow_purple</span> <span class='op'>&lt;-</span> <span class='va'>street_arrow</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>  <span class='va'>v_rectangle_mid_x</span> <span class='op'>+</span> <span class='va'>street_arrow_mid_x</span>,</span>
<span>  <span class='va'>v_rectangle_top_y</span> <span class='op'>-</span> <span class='op'>(</span><span class='op'>(</span><span class='fl'>3.5</span><span class='op'>*</span><span class='va'>v_rectangle_height</span><span class='op'>)</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>3</span><span class='op'>*</span><span class='va'>v_rectangle_space</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> <span class='va'>street_arrow_yellow_y</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Assign crs to every arrow again:</span></span>
<span><span class='va'>street_arrow_yellow</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/sfc.html'>st_sfc</a></span><span class='op'>(</span><span class='va'>street_arrow_yellow</span>,</span>
<span>                              crs <span class='op'>=</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_crs.html'>st_crs</a></span><span class='op'>(</span><span class='va'>all_roads_dissolved</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>street_arrow_gray</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/sfc.html'>st_sfc</a></span><span class='op'>(</span><span class='va'>street_arrow_gray</span>,</span>
<span>                            crs <span class='op'>=</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_crs.html'>st_crs</a></span><span class='op'>(</span><span class='va'>all_roads_dissolved</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>street_arrow_light_purple</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/sfc.html'>st_sfc</a></span><span class='op'>(</span><span class='va'>street_arrow_light_purple</span>,</span>
<span>                                    crs <span class='op'>=</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_crs.html'>st_crs</a></span><span class='op'>(</span><span class='va'>all_roads_dissolved</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>street_arrow_purple</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/sfc.html'>st_sfc</a></span><span class='op'>(</span><span class='va'>street_arrow_purple</span>,</span>
<span>                              crs <span class='op'>=</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_crs.html'>st_crs</a></span><span class='op'>(</span><span class='va'>all_roads_dissolved</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># We plot the street arrows:</span></span>
<span><span class='co'>#===========================</span></span>
<span></span>
<span><span class='va'>alternative</span> <span class='op'>&lt;-</span> <span class='va'>alternative</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span> </span>
<span>    data <span class='op'>=</span> <span class='va'>street_arrow_yellow</span>,</span>
<span>    color <span class='op'>=</span> <span class='st'>"#c88c47"</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='va'>street_arrow_width</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>street_arrow_gray</span>,</span>
<span>    color <span class='op'>=</span> <span class='st'>"#b7a6ac"</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='va'>street_arrow_width</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>street_arrow_light_purple</span>,</span>
<span>    color <span class='op'>=</span> <span class='st'>"#a36f96"</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='va'>street_arrow_width</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='co'># 4. Purple Arrow</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>street_arrow_purple</span>,</span>
<span>    color <span class='op'>=</span> <span class='st'>"#6a4886"</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='va'>street_arrow_width</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>alternative</span> <span class='co'># To see it</span></span></code></pre>
</div>
<p><img src="100569505_files/figure-html5/plot_street_arrows-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<p>We just need to add the text to finish the color legend. Even if we use more words than the original, we believe this makes it faster to read (also, using more words here allows us to save words in formulating the paragraph from the original plot as a shorter question, as we will see).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Settings:</span></span>
<span><span class='co'># =========</span></span>
<span><span class='va'>v_rect_text_color</span> <span class='op'>&lt;-</span> <span class='st'>"white"</span></span>
<span><span class='va'>v_rect_text_size</span> <span class='op'>&lt;-</span> <span class='fl'>7.5</span></span>
<span><span class='va'>v_rect_text_family</span> <span class='op'>&lt;-</span> <span class='st'>"atkinson"</span></span>
<span></span>
<span><span class='va'>v_rect_h_just</span> <span class='op'>&lt;-</span> <span class='fl'>1</span> <span class='co'># Right</span></span>
<span><span class='va'>v_rect_text_h_space</span> <span class='op'>&lt;-</span> <span class='fl'>0.020</span></span>
<span><span class='va'>v_rect_text_text</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"10-30' faster by bike"</span>,</span>
<span>                      <span class='st'>"similar travel time"</span>,</span>
<span>                      <span class='st'>"10-30' faster by transit"</span>,</span>
<span>                      <span class='st'>"+30' faster by transit"</span><span class='op'>)</span></span>
<span>  </span>
<span><span class='co'># We calculate the coordinates:</span></span>
<span><span class='co'>#==============================</span></span>
<span><span class='va'>v_rect_text</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"x"</span> <span class='op'>=</span> <span class='va'>v_rectangle_mid_x</span> <span class='op'>-</span> <span class='va'>v_rect_text_h_space</span>,</span>
<span>  <span class='st'>"y"</span> <span class='op'>=</span> <span class='va'>v_rectangles</span><span class='op'>$</span><span class='va'>ymax</span> <span class='op'>-</span> <span class='op'>(</span><span class='va'>v_rectangle_height</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span>,</span>
<span>  <span class='st'>"label"</span> <span class='op'>=</span> <span class='va'>v_rect_text_text</span>,</span>
<span>  <span class='st'>"hjust"</span> <span class='op'>=</span> <span class='va'>v_rect_h_just</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># We plot the text:</span></span>
<span><span class='co'>#==================</span></span>
<span><span class='va'>alternative</span> <span class='op'>&lt;-</span> <span class='va'>alternative</span> <span class='op'>+</span> </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>v_rect_text</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span>, hjust <span class='op'>=</span> <span class='va'>hjust</span>, label <span class='op'>=</span> <span class='va'>label</span><span class='op'>)</span>,</span>
<span>    size <span class='op'>=</span> <span class='va'>v_rect_text_size</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>v_rect_text_color</span>,</span>
<span>    family <span class='op'>=</span> <span class='va'>v_rect_text_family</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>alternative</span> <span class='co'># To see it</span></span></code></pre>
</div>
<p><img src="100569505_files/figure-html5/plot_color_legend_text-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<p>Finally, we plot a short question that both acts as a title saying what the map represents, and gives us information on where Calgary Tower is.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Settings:</span></span>
<span><span class='co'># =========</span></span>
<span></span>
<span><span class='co'># Text:</span></span>
<span><span class='va'>question_text_x</span> <span class='op'>&lt;-</span> <span class='va'>v_rectangle_mid_x</span> <span class='op'>+</span> <span class='op'>(</span><span class='va'>v_rectangle_width</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span></span>
<span><span class='va'>question_text_y</span> <span class='op'>&lt;-</span> <span class='fl'>50.9960</span></span>
<span><span class='va'>question_text_h_space</span> <span class='op'>&lt;-</span> <span class='fl'>0</span> <span class='co'># Relative to vertical rectangles mid x</span></span>
<span></span>
<span><span class='va'>question_text_size</span> <span class='op'>&lt;-</span> <span class='fl'>10</span> </span>
<span><span class='va'>question_text_line_height</span> <span class='op'>&lt;-</span> <span class='fl'>1.1</span></span>
<span><span class='va'>question_text_color</span> <span class='op'>&lt;-</span> <span class='st'>"white"</span> </span>
<span><span class='va'>question_text_family</span> <span class='op'>&lt;-</span> <span class='st'>"atkinson"</span></span>
<span><span class='va'>question_text_h_just</span> <span class='op'>&lt;-</span> <span class='fl'>1</span> <span class='co'># Right alignment</span></span>
<span></span>
<span></span>
<span><span class='co'># Blue point:</span></span>
<span><span class='va'>legend_blue_point_x</span> <span class='op'>&lt;-</span> <span class='op'>-</span><span class='fl'>114.1886</span></span>
<span><span class='va'>legend_blue_point_y</span> <span class='op'>&lt;-</span> <span class='fl'>50.9957</span></span>
<span></span>
<span><span class='va'>blue_point_size</span> <span class='op'>&lt;-</span> <span class='fl'>4</span></span>
<span><span class='va'>blue_point_stroke</span> <span class='op'>&lt;-</span> <span class='fl'>4.5</span> </span>
<span><span class='va'>blue_point_fill</span> <span class='op'>&lt;-</span> <span class='st'>"#61d7ea"</span></span>
<span><span class='va'>blue_point_color</span> <span class='op'>&lt;-</span> <span class='st'>"white"</span></span>
<span></span>
<span></span>
<span></span>
<span><span class='co'># Plot the legend:</span></span>
<span><span class='co'>#=================</span></span>
<span></span>
<span><span class='va'>alternative</span> <span class='op'>&lt;-</span> <span class='va'>alternative</span> <span class='op'>+</span> </span>
<span>    </span>
<span><span class='co'># The question text:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>    <span class='st'>"text"</span>,</span>
<span>    x <span class='op'>=</span> <span class='va'>question_text_x</span>,</span>
<span>    y <span class='op'>=</span> <span class='va'>question_text_y</span>,</span>
<span>    label <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='st'>"What's the fastest way to get"</span>,</span>
<span>                  <span class='st'>"to Calgary Tower     on a"</span>,</span>
<span>                  <span class='st'>"weekday morning?"</span>,</span>
<span>                  sep <span class='op'>=</span> <span class='st'>"\n"</span><span class='op'>)</span>,</span>
<span>    hjust <span class='op'>=</span> <span class='va'>question_text_h_just</span>,</span>
<span>    family <span class='op'>=</span> <span class='va'>question_text_family</span>,</span>
<span>    size <span class='op'>=</span> <span class='va'>question_text_size</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>question_text_color</span>,</span>
<span>    lineheight <span class='op'>=</span> <span class='va'>question_text_line_height</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span><span class='co'># The blue point inside the question:</span></span>
<span>   <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span>  </span>
<span>    <span class='st'>"point"</span>,</span>
<span>    x <span class='op'>=</span> <span class='va'>legend_blue_point_x</span>, </span>
<span>    y <span class='op'>=</span> <span class='va'>legend_blue_point_y</span>,  </span>
<span>    shape <span class='op'>=</span> <span class='fl'>21</span>, </span>
<span>    size <span class='op'>=</span> <span class='va'>blue_point_size</span>,</span>
<span>    fill <span class='op'>=</span> <span class='va'>blue_point_fill</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>blue_point_color</span>,</span>
<span>    stroke <span class='op'>=</span> <span class='va'>blue_point_stroke</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span><span class='co'># The blue point in the map (Calgary Tower):  </span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>    <span class='st'>"point"</span>,</span>
<span>    x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>114.0631</span>, </span>
<span>    y <span class='op'>=</span> <span class='fl'>51.04465</span>,</span>
<span>    shape <span class='op'>=</span> <span class='fl'>21</span>, </span>
<span>    size <span class='op'>=</span> <span class='va'>blue_point_size</span>,</span>
<span>    fill <span class='op'>=</span> <span class='va'>blue_point_fill</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>blue_point_color</span>,</span>
<span>    stroke <span class='op'>=</span> <span class='va'>blue_point_stroke</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>alternative</span></span></code></pre>
</div>
<p><img src="100569505_files/figure-html5/plot_question-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<h4 id="isochrones-legend">Isochrones’ legend</h4>
<p>We still need a legend explaining what the transparent cyan areas are. Since isochrones are widely used, and most people already understand them without much explanation, we can be very concise, and use very few words. Our legend will include the minutes “within” the isochrone border (we achieve this effect by plotting a number inside a black point with a border of the same color as the isochrone border), and a small annotation explaining what the numbers are next to the outer isochrone minutes dot-</p>
<p>This last part (the small annotation) might even be unnecessary, we showed the map without the text explaining what the numbers are to a few people, and they correctly guessed what the numbers where. But we will keep so that there cannot be any doubts what the numbers “inside” the isochrones mean.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Settings</span></span>
<span><span class='co'># ========</span></span>
<span></span>
<span><span class='co'># Point</span></span>
<span><span class='va'>iso_point_size</span> <span class='op'>&lt;-</span> <span class='fl'>12.5</span></span>
<span><span class='va'>iso_point_fill</span> <span class='op'>&lt;-</span> <span class='st'>"black"</span></span>
<span><span class='va'>iso_point_stroke_width</span> <span class='op'>&lt;-</span> <span class='fl'>1.5</span></span>
<span><span class='va'>iso_point_stroke_color</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://scales.r-lib.org/reference/alpha.html'>alpha</a></span><span class='op'>(</span><span class='st'>"#e5fcff"</span>, <span class='fl'>0.7</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Text</span></span>
<span><span class='va'>iso_text_size</span> <span class='op'>&lt;-</span> <span class='fl'>6</span></span>
<span><span class='va'>iso_text_color</span> <span class='op'>&lt;-</span> <span class='st'>"white"</span></span>
<span></span>
<span></span>
<span><span class='co'># Point and text position</span></span>
<span><span class='va'>x_20</span> <span class='op'>&lt;-</span> <span class='op'>-</span><span class='fl'>114.045</span></span>
<span><span class='va'>y_20</span> <span class='op'>&lt;-</span> <span class='fl'>51.0632</span></span>
<span></span>
<span><span class='va'>x_40</span> <span class='op'>&lt;-</span> <span class='op'>-</span><span class='fl'>114.0263</span></span>
<span><span class='va'>y_40</span> <span class='op'>&lt;-</span> <span class='fl'>51.082</span></span>
<span></span>
<span><span class='va'>x_60</span> <span class='op'>&lt;-</span> <span class='op'>-</span><span class='fl'>114.0096</span></span>
<span><span class='va'>y_60</span> <span class='op'>&lt;-</span> <span class='fl'>51.099</span></span>
<span></span>
<span></span>
<span></span>
<span><span class='co'># Plotting:</span></span>
<span><span class='co'># =========</span></span>
<span></span>
<span><span class='va'>alternative</span> <span class='op'>&lt;-</span> <span class='va'>alternative</span> <span class='op'>+</span> </span>
<span>  </span>
<span>  <span class='co'># Small annotation:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span> <span class='co'># The curve</span></span>
<span>    <span class='st'>"curve"</span>,</span>
<span>    x <span class='op'>=</span> <span class='va'>x_60</span> <span class='op'>-</span> <span class='fl'>0.001</span>, </span>
<span>    y <span class='op'>=</span> <span class='va'>y_60</span> <span class='op'>+</span> <span class='fl'>0.001</span>,</span>
<span>    xend <span class='op'>=</span> <span class='va'>x_60</span> <span class='op'>+</span> <span class='fl'>0.0020</span>,</span>
<span>    yend <span class='op'>=</span> <span class='va'>y_60</span> <span class='op'>+</span> <span class='fl'>0.0065</span>,</span>
<span>    curvature <span class='op'>=</span> <span class='fl'>0.9</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='fl'>0.85</span>,</span>
<span>    color <span class='op'>=</span> <span class='st'>"white"</span>,</span>
<span>    arrow <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/arrow.html'>arrow</a></span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>30</span>,</span>
<span>                  length <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>0.1</span>, <span class='st'>"in"</span><span class='op'>)</span>,</span>
<span>                  ends <span class='op'>=</span> <span class='st'>"last"</span>,</span>
<span>                  type <span class='op'>=</span> <span class='st'>"closed"</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># Minutes by fastest mode:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>    <span class='st'>"text"</span>,</span>
<span>    x <span class='op'>=</span> <span class='va'>x_60</span> <span class='op'>-</span> <span class='fl'>0.006</span>,</span>
<span>    y <span class='op'>=</span> <span class='va'>y_60</span> <span class='op'>+</span> <span class='fl'>0.0091</span>,</span>
<span>    label <span class='op'>=</span> <span class='st'>"minutes\nby fastest\nmode"</span>,</span>
<span>    size <span class='op'>=</span> <span class='va'>iso_text_size</span>,</span>
<span>    lineheight <span class='op'>=</span> <span class='fl'>0.85</span>,</span>
<span>    vjust <span class='op'>=</span> <span class='fl'>0.5</span>,</span>
<span>    hjust <span class='op'>=</span> <span class='fl'>0.5</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>iso_text_color</span>,</span>
<span>    family <span class='op'>=</span> <span class='st'>"atkinson"</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># 20' point and text</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>   <span class='st'>"point"</span>,</span>
<span>   x <span class='op'>=</span> <span class='va'>x_20</span>,</span>
<span>   y <span class='op'>=</span> <span class='va'>y_20</span>,</span>
<span>   size <span class='op'>=</span> <span class='va'>iso_point_size</span>,</span>
<span>   shape <span class='op'>=</span> <span class='fl'>21</span>,</span>
<span>   fill <span class='op'>=</span> <span class='va'>iso_point_fill</span>,</span>
<span>   <span class='co'>#alpha = iso_point_alpha,</span></span>
<span>   stroke <span class='op'>=</span> <span class='va'>iso_point_stroke_width</span>,</span>
<span>   color <span class='op'>=</span> <span class='va'>iso_point_stroke_color</span></span>
<span> <span class='op'>)</span> <span class='op'>+</span></span>
<span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>   <span class='st'>"text"</span>,</span>
<span>   label <span class='op'>=</span> <span class='st'>"20"</span>,</span>
<span>   x <span class='op'>=</span> <span class='va'>x_20</span>,</span>
<span>   y <span class='op'>=</span> <span class='va'>y_20</span>,</span>
<span>   size <span class='op'>=</span> <span class='va'>iso_text_size</span>,</span>
<span>   family <span class='op'>=</span> <span class='st'>"atkinson"</span>,</span>
<span>   color <span class='op'>=</span> <span class='va'>iso_text_color</span></span>
<span> <span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span>  <span class='co'># 40' point and text    </span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>   <span class='st'>"point"</span>,</span>
<span>   x <span class='op'>=</span> <span class='va'>x_40</span>,</span>
<span>   y <span class='op'>=</span> <span class='va'>y_40</span>,</span>
<span>   size <span class='op'>=</span> <span class='va'>iso_point_size</span>,</span>
<span>   shape <span class='op'>=</span> <span class='fl'>21</span>,</span>
<span>   fill <span class='op'>=</span> <span class='va'>iso_point_fill</span>,</span>
<span>   stroke <span class='op'>=</span> <span class='va'>iso_point_stroke_width</span>,</span>
<span>   color <span class='op'>=</span> <span class='va'>iso_point_stroke_color</span></span>
<span> <span class='op'>)</span> <span class='op'>+</span></span>
<span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>   <span class='st'>"text"</span>,</span>
<span>   label <span class='op'>=</span> <span class='st'>"40"</span>,</span>
<span>   x <span class='op'>=</span> <span class='va'>x_40</span>,</span>
<span>   y <span class='op'>=</span> <span class='va'>y_40</span>,</span>
<span>   size <span class='op'>=</span> <span class='va'>iso_text_size</span>,</span>
<span>   family <span class='op'>=</span> <span class='st'>"atkinson"</span>,</span>
<span>   color <span class='op'>=</span> <span class='va'>iso_text_color</span></span>
<span> <span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span> <span class='co'># 60' point and text</span></span>
<span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>   <span class='st'>"point"</span>,</span>
<span>   x <span class='op'>=</span> <span class='va'>x_60</span>,</span>
<span>   y <span class='op'>=</span> <span class='va'>y_60</span>,</span>
<span>   size <span class='op'>=</span> <span class='va'>iso_point_size</span>,</span>
<span>   shape <span class='op'>=</span> <span class='fl'>21</span>,</span>
<span>   fill <span class='op'>=</span> <span class='va'>iso_point_fill</span>,</span>
<span>   <span class='co'>#alpha = iso_point_alpha,</span></span>
<span>   stroke <span class='op'>=</span> <span class='va'>iso_point_stroke_width</span>,</span>
<span>   color <span class='op'>=</span> <span class='va'>iso_point_stroke_color</span></span>
<span> <span class='op'>)</span> <span class='op'>+</span></span>
<span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>   <span class='st'>"text"</span>,</span>
<span>   label <span class='op'>=</span> <span class='st'>"60"</span>,</span>
<span>   x <span class='op'>=</span> <span class='va'>x_60</span>,</span>
<span>   y <span class='op'>=</span> <span class='va'>y_60</span>,</span>
<span>   size <span class='op'>=</span> <span class='va'>iso_text_size</span>,</span>
<span>   family <span class='op'>=</span> <span class='st'>"atkinson"</span>,</span>
<span>   color <span class='op'>=</span> <span class='va'>iso_text_color</span></span>
<span> <span class='op'>)</span></span>
<span>  </span>
<span><span class='va'>alternative</span> <span class='co'># To see it</span></span></code></pre>
</div>
<p><img src="100569505_files/figure-html5/plot_isochrones_legend-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<h4 id="example-point">Example point</h4>
<p>As mentioned earlier, we will include a point with an example of how to read the map. We will make use of the big black empty space between the streets northwest of Calgary Tower to integrate it organically.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>alternative</span> <span class='op'>&lt;-</span> <span class='va'>alternative</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># Text:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>    <span class='st'>"richtext"</span>,</span>
<span>    label <span class='op'>=</span> <span class='st'>"Bike is faster and&lt;br&gt;travel takes under 40'"</span>,</span>
<span>    x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>114.109</span>,</span>
<span>    y <span class='op'>=</span> <span class='fl'>51.106</span>,</span>
<span>    size <span class='op'>=</span> <span class='va'>iso_text_size</span>,</span>
<span>    vjust <span class='op'>=</span> <span class='fl'>0</span>,</span>
<span>    color <span class='op'>=</span> <span class='st'>"white"</span>,</span>
<span>    family <span class='op'>=</span> <span class='st'>"atkinson"</span>,</span>
<span>    fill <span class='op'>=</span> <span class='cn'>NA</span>,</span>
<span>    label.color <span class='op'>=</span> <span class='cn'>NA</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span><span class='co'>#?geom_curve</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span></span>
<span>    <span class='st'>"curve"</span>,</span>
<span>    x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>114.107</span>,</span>
<span>    y <span class='op'>=</span> <span class='fl'>51.106</span>,</span>
<span>    xend <span class='op'>=</span> <span class='op'>-</span><span class='fl'>114.085</span>,</span>
<span>    yend <span class='op'>=</span> <span class='fl'>51.0935</span>,</span>
<span>    curvature <span class='op'>=</span> <span class='fl'>0.5</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='fl'>0.7</span>,</span>
<span>    color <span class='op'>=</span> <span class='st'>"white"</span>,</span>
<span>    arrow <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/arrow.html'>arrow</a></span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>30</span>,</span>
<span>                  length <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>0.1</span>, <span class='st'>"in"</span><span class='op'>)</span>,</span>
<span>                  ends <span class='op'>=</span> <span class='st'>"first"</span>,</span>
<span>                  type <span class='op'>=</span> <span class='st'>"closed"</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># Map dot:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span> </span>
<span>    <span class='st'>"point"</span>,</span>
<span>    x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>114.085</span>,</span>
<span>    y <span class='op'>=</span> <span class='fl'>51.0935</span>,</span>
<span>    size <span class='op'>=</span> <span class='fl'>5</span>,</span>
<span>    shape <span class='op'>=</span> <span class='fl'>21</span>,        </span>
<span>    fill <span class='op'>=</span> <span class='st'>"#f8ad58"</span>,  </span>
<span>    color <span class='op'>=</span> <span class='st'>"white"</span>, </span>
<span>    stroke <span class='op'>=</span> <span class='fl'>2</span></span>
<span>  <span class='op'>)</span> </span>
<span></span>
<span><span class='va'>alternative</span></span></code></pre>
</div>
<p><img src="100569505_files/figure-html5/unnamed-chunk-1-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<h4 id="north-arrow-1">North arrow</h4>
<p>We believe that the north arrow maybe had a too prominent role in the original map. Users of the map probably can situate where the north is just because they are familiar with the city (and the river might be the most important visual reference for inhabitants of the city). Furthermore, cardinal directions are not too relevant to understand the map or use it for practical purposes (nobody moves around a city by bike or transit thinking of cardinal directions). That is why we decided to change its size, position, and color to be more discrete. We think that in the bottom right corner it organically fits the distribution of “visual weight” in the map (which kind of comes down from the top left corner to the bottom right), also, put it in here would make it the last thing we look to, since we are also used to read in that order (left to right, top to bottom). This way we achieve the secondary role we want the arrow to have.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Settings:</span></span>
<span><span class='co'># =========</span></span>
<span><span class='co'># Arrow:</span></span>
<span><span class='va'>arrow_color</span> <span class='op'>&lt;-</span> <span class='st'>"white"</span></span>
<span><span class='co'># Arrow triangle </span></span>
<span><span class='va'>triangle_mid_x</span> <span class='op'>&lt;-</span> <span class='op'>-</span><span class='fl'>113.8825</span> </span>
<span><span class='va'>triangle_half_width</span> <span class='op'>&lt;-</span> <span class='fl'>0.003325</span></span>
<span><span class='va'>triangle_bottom_y</span> <span class='op'>&lt;-</span> <span class='fl'>50.8600</span> <span class='co'>#Master</span></span>
<span><span class='va'>triangle_height</span> <span class='op'>&lt;-</span> <span class='fl'>0.0021</span> <span class='co'>### last:-1</span></span>
<span><span class='co'># Arrow rectangle:</span></span>
<span><span class='va'>arrow_rectangle_width</span> <span class='op'>&lt;-</span> <span class='fl'>0.455</span> <span class='co'># Relative to triangle width</span></span>
<span><span class='va'>arrow_rectangle_height</span> <span class='op'>&lt;-</span> <span class='fl'>1.495</span> <span class='co'># Relative to triangle height</span></span>
<span><span class='va'>arrow_rectangle_radius</span> <span class='op'>&lt;-</span> <span class='fl'>0.24</span> </span>
<span></span>
<span><span class='co'># North text:</span></span>
<span><span class='va'>north_space</span> <span class='op'>&lt;-</span> <span class='fl'>0.75</span> <span class='co'># Relative to triangle height</span></span>
<span><span class='va'>north_size</span> <span class='op'>&lt;-</span> <span class='fl'>6</span></span>
<span><span class='va'>north_color</span> <span class='op'>&lt;-</span> <span class='st'>"white"</span></span>
<span></span>
<span><span class='co'># Outer box:</span></span>
<span><span class='va'>box_width</span> <span class='op'>&lt;-</span> <span class='fl'>2.40</span> <span class='co'># Relative to triangle width</span></span>
<span><span class='va'>box_height</span> <span class='op'>&lt;-</span> <span class='fl'>2.75</span> <span class='co'># Relative to triangle height</span></span>
<span><span class='va'>box_radius</span> <span class='op'>&lt;-</span> <span class='fl'>0.20</span></span>
<span><span class='va'>box_y_position</span> <span class='op'>&lt;-</span> <span class='fl'>0.255</span> <span class='co'># Relative to triangle tip (measured in triangle height)</span></span>
<span><span class='va'>box_color</span> <span class='op'>&lt;-</span> <span class='st'>"white"</span></span>
<span></span>
<span><span class='co'># Border thickness (i will use this to change size of inner box):</span></span>
<span><span class='va'>border_thickness</span> <span class='op'>&lt;-</span> <span class='fl'>0.05</span> <span class='co'># Range 0-1 (no border, full black box).</span></span>
<span><span class='va'>inner_box_color</span> <span class='op'>&lt;-</span> <span class='st'>"black"</span></span>
<span></span>
<span></span>
<span></span>
<span><span class='co'># Calculations:</span></span>
<span><span class='co'># =============</span></span>
<span></span>
<span><span class='co'># Tibble for arrow triangle (head):</span></span>
<span><span class='va'>triangle_polygon</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>    <span class='va'>triangle_mid_x</span>, <span class='co'># Tip x</span></span>
<span>    <span class='va'>triangle_mid_x</span> <span class='op'>-</span> <span class='va'>triangle_half_width</span>, <span class='co'># Left corner x</span></span>
<span>    <span class='va'>triangle_mid_x</span> <span class='op'>+</span> <span class='va'>triangle_half_width</span> <span class='co'># Right corner x</span></span>
<span>  <span class='op'>)</span>,</span>
<span>  y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>    <span class='va'>triangle_bottom_y</span> <span class='op'>+</span> <span class='va'>triangle_height</span>, <span class='co'># Tip y </span></span>
<span>    <span class='va'>triangle_bottom_y</span>, <span class='co'># Left corner y</span></span>
<span>    <span class='va'>triangle_bottom_y</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># Right corner y</span></span>
<span>  </span>
<span><span class='co'># Tibble for arrow rectangle (shaft):</span></span>
<span><span class='va'>arrow_rectangle</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  xmin <span class='op'>=</span> <span class='va'>triangle_mid_x</span> <span class='op'>-</span> <span class='op'>(</span><span class='va'>triangle_half_width</span><span class='op'>*</span><span class='va'>arrow_rectangle_width</span><span class='op'>)</span>, <span class='co'># Left</span></span>
<span>  xmax <span class='op'>=</span> <span class='va'>triangle_mid_x</span> <span class='op'>+</span> <span class='op'>(</span><span class='va'>triangle_half_width</span><span class='op'>*</span><span class='va'>arrow_rectangle_width</span><span class='op'>)</span>, <span class='co'># Right</span></span>
<span>  ymin <span class='op'>=</span> <span class='va'>triangle_bottom_y</span> <span class='op'>-</span> <span class='op'>(</span><span class='va'>triangle_height</span><span class='op'>*</span><span class='va'>arrow_rectangle_height</span><span class='op'>)</span>, <span class='co'># Bottom</span></span>
<span>  ymax <span class='op'>=</span> <span class='va'>triangle_bottom_y</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>0.25</span><span class='op'>*</span><span class='va'>triangle_height</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># Top.   </span></span>
<span>                                                     <span class='co'># We add 0.25 of the</span></span>
<span>                                                     <span class='co'># triangle height to</span></span>
<span>                                                     <span class='co'># hide rounded edge on</span></span>
<span>                                                     <span class='co'># the rectangle top.</span></span>
<span>  </span>
<span><span class='co'># Tibble for "north":</span></span>
<span><span class='va'>north</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  label <span class='op'>=</span> <span class='st'>"North"</span>,</span>
<span>  x <span class='op'>=</span> <span class='va'>triangle_mid_x</span>,</span>
<span>  y <span class='op'>=</span> <span class='va'>triangle_bottom_y</span> <span class='op'>+</span> <span class='va'>triangle_height</span> <span class='op'>+</span> <span class='va'>north_space</span><span class='op'>*</span><span class='va'>triangle_height</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Tibble for outer box:</span></span>
<span><span class='va'>arrow_box</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"xmin"</span> <span class='op'>=</span> <span class='va'>triangle_mid_x</span> <span class='op'>-</span> <span class='op'>(</span><span class='va'>triangle_half_width</span><span class='op'>*</span><span class='va'>box_width</span><span class='op'>)</span>, <span class='co'># Left</span></span>
<span>  <span class='st'>"xmax"</span> <span class='op'>=</span> <span class='va'>triangle_mid_x</span> <span class='op'>+</span> <span class='op'>(</span><span class='va'>triangle_half_width</span><span class='op'>*</span><span class='va'>box_width</span><span class='op'>)</span>, <span class='co'># Right</span></span>
<span>  <span class='st'>"ymin"</span> <span class='op'>=</span> <span class='va'>triangle_bottom_y</span> <span class='op'>-</span> <span class='op'>(</span><span class='va'>triangle_height</span><span class='op'>*</span><span class='va'>box_height</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='op'>(</span><span class='va'>triangle_height</span><span class='op'>*</span><span class='va'>box_y_position</span><span class='op'>)</span>, <span class='co'># Bottom</span></span>
<span>  <span class='st'>"ymax"</span> <span class='op'>=</span> <span class='va'>triangle_bottom_y</span> <span class='op'>+</span> <span class='op'>(</span><span class='va'>triangle_height</span><span class='op'>*</span><span class='va'>box_height</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='op'>(</span><span class='va'>triangle_height</span><span class='op'>*</span><span class='va'>box_y_position</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># Top</span></span>
<span></span>
<span><span class='co'># Tibble for inner box:</span></span>
<span><span class='co'># We  first create an auxiliary object which we will add/substract to outer box:</span></span>
<span><span class='va'>box_vertical_border</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='op'>(</span><span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>xmax</span> <span class='op'>-</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>xmin</span><span class='op'>)</span><span class='op'>*</span><span class='va'>border_thickness</span><span class='op'>)</span><span class='op'>/</span><span class='fl'>2</span> </span>
<span><span class='va'>box_horizontal_border</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='op'>(</span><span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>ymax</span> <span class='op'>-</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>ymin</span><span class='op'>)</span><span class='op'>*</span><span class='va'>border_thickness</span><span class='op'>)</span><span class='op'>/</span><span class='fl'>2</span></span>
<span><span class='co'># And then the tibble:</span></span>
<span><span class='va'>inner_box</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"xmin"</span> <span class='op'>=</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>xmin</span> <span class='op'>+</span> <span class='va'>box_vertical_border</span>,</span>
<span>  <span class='st'>"xmax"</span> <span class='op'>=</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>xmax</span> <span class='op'>-</span> <span class='va'>box_vertical_border</span>,</span>
<span>  <span class='st'>"ymin"</span> <span class='op'>=</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>ymin</span> <span class='op'>+</span> <span class='va'>box_horizontal_border</span>,</span>
<span>  <span class='st'>"ymax"</span> <span class='op'>=</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>ymax</span> <span class='op'>-</span> <span class='va'>box_horizontal_border</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class='co'># Plotting:</span></span>
<span><span class='co'># =========</span></span>
<span><span class='va'>alternative</span> <span class='op'>&lt;-</span> <span class='va'>alternative</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://funkyheatmap.github.io/funkyheatmap/reference/geom_rounded_rect.html'>geom_rounded_rect</a></span><span class='op'>(</span> <span class='co'>#### Plot outer box (for border) ####</span></span>
<span>    data <span class='op'>=</span> <span class='va'>arrow_box</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>xmin <span class='op'>=</span> <span class='va'>xmin</span>, xmax <span class='op'>=</span> <span class='va'>xmax</span>,</span>
<span>        ymin <span class='op'>=</span> <span class='va'>ymin</span>, ymax <span class='op'>=</span> <span class='va'>ymax</span><span class='op'>)</span>,</span>
<span>    radius <span class='op'>=</span> <span class='va'>box_radius</span>,</span>
<span>    fill <span class='op'>=</span> <span class='va'>box_color</span>,</span>
<span>    color <span class='op'>=</span> <span class='cn'>NA</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://funkyheatmap.github.io/funkyheatmap/reference/geom_rounded_rect.html'>geom_rounded_rect</a></span><span class='op'>(</span> <span class='co'>####Plot inner box (for border)</span></span>
<span>    data <span class='op'>=</span> <span class='va'>inner_box</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>xmin <span class='op'>=</span> <span class='va'>xmin</span>, xmax <span class='op'>=</span> <span class='va'>xmax</span>,</span>
<span>        ymin <span class='op'>=</span> <span class='va'>ymin</span>, ymax <span class='op'>=</span> <span class='va'>ymax</span><span class='op'>)</span>,</span>
<span>    radius <span class='op'>=</span> <span class='va'>box_radius</span>,</span>
<span>    fill <span class='op'>=</span> <span class='va'>inner_box_color</span>,</span>
<span>    color <span class='op'>=</span> <span class='cn'>NA</span></span>
<span>    <span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_polygon.html'>geom_polygon</a></span><span class='op'>(</span> <span class='co'>#### Plot the arrow triangle ####</span></span>
<span>    data <span class='op'>=</span> <span class='va'>triangle_polygon</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span>,</span>
<span>    fill <span class='op'>=</span> <span class='va'>arrow_color</span>,</span>
<span>    color <span class='op'>=</span> <span class='cn'>NA</span> <span class='co'># No border</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span> </span>
<span>  <span class='fu'><a href='https://funkyheatmap.github.io/funkyheatmap/reference/geom_rounded_rect.html'>geom_rounded_rect</a></span><span class='op'>(</span> <span class='co'>#### Plot the arrow "body" ####</span></span>
<span>    data <span class='op'>=</span> <span class='va'>arrow_rectangle</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>xmin <span class='op'>=</span> <span class='va'>xmin</span>, xmax <span class='op'>=</span> <span class='va'>xmax</span>,</span>
<span>        ymin <span class='op'>=</span> <span class='va'>ymin</span>, ymax <span class='op'>=</span> <span class='va'>ymax</span><span class='op'>)</span>,</span>
<span>    radius <span class='op'>=</span> <span class='va'>arrow_rectangle_radius</span>,</span>
<span>    fill <span class='op'>=</span> <span class='va'>arrow_color</span>,</span>
<span>    color<span class='op'>=</span> <span class='cn'>NA</span> <span class='co'># No border</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span> </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span> <span class='co'>#### Plot "North" text ####</span></span>
<span>    data <span class='op'>=</span> <span class='va'>north</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span>, label <span class='op'>=</span> <span class='va'>label</span><span class='op'>)</span>,</span>
<span>    size <span class='op'>=</span> <span class='va'>north_size</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>north_color</span>, </span>
<span>    family <span class='op'>=</span> <span class='st'>"atkinson"</span>,</span>
<span>    fontface <span class='op'>=</span> <span class='st'>"bold"</span></span>
<span>    <span class='op'>)</span></span>
<span></span>
<span><span class='va'>alternative</span></span></code></pre>
</div>
<p><img src="100569505_files/figure-html5/plot_north_arrow_alternative-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<h4 id="scale-1">Scale</h4>
<p>Finally, we add the scale. Since we made the north arrow smaller, we should also make it smaller for it not to stand out. Since it is a scale, changing its size affects the information it provides, so we should also change the information it represents to a shorter distance.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Settings:</span></span>
<span><span class='co'># =========</span></span>
<span><span class='co'># Horizontal line:</span></span>
<span><span class='va'>scale_length</span> <span class='op'>&lt;-</span> <span class='fl'>2000</span> <span class='co'># In meters</span></span>
<span><span class='va'>scale_space</span> <span class='op'>&lt;-</span> <span class='fl'>0.25</span> <span class='co'># Space between line and box, proportion of box width</span></span>
<span><span class='va'>scale_color</span> <span class='op'>&lt;-</span> <span class='st'>"white"</span></span>
<span><span class='va'>scale_thickness</span> <span class='op'>&lt;-</span> <span class='fl'>1.3</span> <span class='co'># For geom_segment(linedwidth = )</span></span>
<span>  </span>
<span><span class='co'># Ticks:</span></span>
<span><span class='va'>tick_length</span> <span class='op'>&lt;-</span> <span class='fl'>0.15</span> <span class='co'># Proportion of the box height</span></span>
<span><span class='va'>tick_color</span> <span class='op'>&lt;-</span> <span class='st'>"white"</span></span>
<span><span class='va'>tick_thickness</span> <span class='op'>&lt;-</span> <span class='fl'>1.3</span> <span class='co'># For geom_segment(linewidth = )</span></span>
<span></span>
<span><span class='co'># Kilometers:</span></span>
<span><span class='va'>km_space</span> <span class='op'>&lt;-</span> <span class='fl'>0.6</span> <span class='co'># Space between km and scale, proportion of box height</span></span>
<span><span class='va'>km_size</span> <span class='op'>&lt;-</span> <span class='fl'>7</span> <span class='co'># For geom_text(size =)</span></span>
<span><span class='va'>km_color</span> <span class='op'>&lt;-</span> <span class='st'>"white"</span></span>
<span><span class='va'>km_font</span> <span class='op'>&lt;-</span> <span class='st'>"atkinson"</span></span>
<span></span>
<span></span>
<span></span>
<span><span class='co'># Calculations:</span></span>
<span><span class='co'># =============</span></span>
<span></span>
<span><span class='co'># Auxiliary objects:</span></span>
<span><span class='va'>box_actual_width</span> <span class='op'>&lt;-</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>xmax</span> <span class='op'>-</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>xmin</span> <span class='co'>#</span></span>
<span><span class='va'>box_actual_height</span> <span class='op'>&lt;-</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>ymax</span> <span class='op'>-</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>ymin</span></span>
<span><span class='va'>box_mid_x</span> <span class='op'>&lt;-</span> <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>xmin</span> <span class='op'>+</span> <span class='op'>(</span><span class='va'>box_actual_width</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Scale left end:</span></span>
<span><span class='va'>scale_left</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/as_tibble.html'>as_tibble</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/geosphere/man/destPoint.html'>destPoint</a></span><span class='op'>(</span></span>
<span>  p <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>box_mid_x</span>,  <span class='co'># Starting x </span></span>
<span>        <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>ymin</span> <span class='op'>-</span> <span class='va'>box_actual_height</span><span class='op'>*</span><span class='va'>scale_space</span><span class='op'>)</span>, <span class='co'># Starting y </span></span>
<span>  b <span class='op'>=</span> <span class='fl'>90</span>, <span class='co'># b = bearing in degrees</span></span>
<span>  d <span class='op'>=</span> <span class='op'>-</span><span class='va'>scale_length</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># d = distance in meters </span></span>
<span></span>
<span><span class='co'># Scale right end:</span></span>
<span><span class='va'>scale_right</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/as_tibble.html'>as_tibble</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/geosphere/man/destPoint.html'>destPoint</a></span><span class='op'>(</span></span>
<span>  p <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>box_mid_x</span>,  <span class='co'># Starting x </span></span>
<span>        <span class='va'>arrow_box</span><span class='op'>$</span><span class='va'>ymin</span> <span class='op'>-</span> <span class='va'>box_actual_height</span><span class='op'>*</span><span class='va'>scale_space</span><span class='op'>)</span>, <span class='co'># Starting y </span></span>
<span>  b <span class='op'>=</span> <span class='fl'>90</span>, <span class='co'># b = bearing in degrees</span></span>
<span>  d <span class='op'>=</span> <span class='va'>scale_length</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># d = distance in meters </span></span>
<span></span>
<span><span class='co'># Scale horizontal line:</span></span>
<span><span class='va'>scale_horizontal</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"x"</span> <span class='op'>=</span> <span class='va'>scale_left</span><span class='op'>$</span><span class='va'>lon</span>, <span class='st'>"xend"</span> <span class='op'>=</span> <span class='va'>scale_right</span><span class='op'>$</span><span class='va'>lon</span>,</span>
<span>  <span class='st'>"y"</span> <span class='op'>=</span> <span class='va'>scale_left</span><span class='op'>$</span><span class='va'>lat</span>, <span class='st'>"yend"</span> <span class='op'>=</span> <span class='va'>scale_left</span><span class='op'>$</span><span class='va'>lat</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Tibble for ticks:</span></span>
<span><span class='va'>tick</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"x"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>scale_left</span><span class='op'>$</span><span class='va'>lon</span>, <span class='va'>box_mid_x</span>, <span class='va'>scale_right</span><span class='op'>$</span><span class='va'>lon</span><span class='op'>)</span>,</span>
<span>  <span class='st'>"xend"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>scale_left</span><span class='op'>$</span><span class='va'>lon</span>, <span class='va'>box_mid_x</span>, <span class='va'>scale_right</span><span class='op'>$</span><span class='va'>lon</span><span class='op'>)</span>,</span>
<span>  <span class='st'>"y"</span> <span class='op'>=</span> <span class='va'>scale_left</span><span class='op'>$</span><span class='va'>lat</span> <span class='op'>-</span> <span class='op'>(</span><span class='op'>(</span><span class='va'>box_actual_height</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>*</span><span class='va'>tick_length</span><span class='op'>)</span>, </span>
<span>  <span class='st'>"yend"</span> <span class='op'>=</span> <span class='va'>scale_left</span><span class='op'>$</span><span class='va'>lat</span> <span class='op'>+</span> <span class='op'>(</span><span class='op'>(</span><span class='va'>box_actual_height</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>*</span><span class='va'>tick_length</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Tibble for kms:</span></span>
<span><span class='va'>km</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  <span class='st'>"label"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"0"</span>, <span class='st'>"1"</span>, <span class='st'>"2"</span>, <span class='st'>"  km"</span><span class='op'>)</span>,</span>
<span>  <span class='st'>"x"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>scale_left</span><span class='op'>$</span><span class='va'>lon</span>, <span class='va'>box_mid_x</span>, <span class='va'>scale_right</span><span class='op'>$</span><span class='va'>lon</span>, <span class='va'>scale_right</span><span class='op'>$</span><span class='va'>lon</span><span class='op'>)</span>,</span>
<span>  <span class='st'>"y"</span> <span class='op'>=</span> <span class='va'>scale_left</span><span class='op'>$</span><span class='va'>lat</span> <span class='op'>-</span> <span class='op'>(</span><span class='op'>(</span><span class='va'>box_actual_height</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>*</span><span class='va'>km_space</span><span class='op'>)</span>,</span>
<span>  <span class='st'>"hjust"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.5</span>, <span class='fl'>0.5</span>, <span class='fl'>0.5</span>, <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># All justified center, "kilometers" left</span></span>
<span></span>
<span></span>
<span></span>
<span><span class='co'># Plotting scale:</span></span>
<span><span class='co'># ===============</span></span>
<span></span>
<span><span class='va'>alternative</span> <span class='op'>&lt;-</span> <span class='va'>alternative</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># Horizontal line</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_segment.html'>geom_segment</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>scale_horizontal</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, xend <span class='op'>=</span> <span class='va'>xend</span>, </span>
<span>        y <span class='op'>=</span> <span class='va'>y</span>, yend <span class='op'>=</span> <span class='va'>yend</span><span class='op'>)</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='va'>scale_thickness</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>scale_color</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># Ticks:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_segment.html'>geom_segment</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>tick</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, xend <span class='op'>=</span> <span class='va'>xend</span>, </span>
<span>        y <span class='op'>=</span> <span class='va'>y</span>, yend <span class='op'>=</span> <span class='va'>yend</span><span class='op'>)</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='va'>tick_thickness</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>tick_color</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span>  <span class='co'># Kilometers:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>km</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span>, hjust <span class='op'>=</span> <span class='va'>hjust</span>, label <span class='op'>=</span> <span class='va'>label</span><span class='op'>)</span>,</span>
<span>    size <span class='op'>=</span> <span class='va'>km_size</span>,</span>
<span>    color <span class='op'>=</span> <span class='va'>km_color</span>, </span>
<span>    family <span class='op'>=</span> <span class='va'>km_font</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>alternative</span></span></code></pre>
</div>
<p><img src="100569505_files/figure-html5/plot_alternative_final-1.png" width="100%" data-distill-preview=1 style="display: block; margin: auto;" /></p>
</div>
<p>This is my alternative visualization proposal. What follows are dismissed ideas. Let’s be honest</p>
<h2 id="dismissed-ideas">Dismissed ideas</h2>
<h3 id="from-where-is-it-faster-by-car">From where is it faster by car</h3>
<p><a href="https://api.openrouteservice.org/">OpenRouteService API</a> allows me to calculate travel times by car from my hexagons, but the API Limit is 2000 routes per day, 40 per minute, which means it would take me 4 days to get data for all the hexagons in <code>intersection_hexagons</code> (which are the map hexagons that intersect with roads, thus the only one that i need data for). If I needed to recurrently update the plot with up-to-date data this would probably be the best option.</p>
<p>But since I don’t, I will use another option: <code>r5r</code> <a href="https://cran.r-project.org/web//packages/r5r/vignettes/r5r.html">(intro to r5r)</a></p>
<h4 id="collecting-car-data-with-r5r">Collecting car data with r5r</h4>
<p>In order to use r5r we need a network dataset from OSM in .pbf format. As the intro to r5r mentions, we can do this using the package <code>osmextract</code> <a href="https://docs.ropensci.org/osmextract/">(more about it here)</a>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://docs.ropensci.org/osmextract/reference/oe_match.html'>oe_match</a></span><span class='op'>(</span><span class='st'>"Calgary"</span><span class='op'>)</span> <span class='co'># There's a direct match</span></span></code></pre>
</div>
<pre><code>$url
[1] &quot;https://download.bbbike.org/osm/bbbike/Calgary/Calgary.osm.pbf&quot;

$file_size
[1] 28399425</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>calgary_oe</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://docs.ropensci.org/osmextract/reference/oe_get.html'>oe_get</a></span><span class='op'>(</span> <span class='co'># We extract the OSM data and get our .pbf file</span></span>
<span>  place <span class='op'>=</span> <span class='st'>"Calgary"</span>,</span>
<span>  download_directory <span class='op'>=</span> <span class='st'>"oe_osm_data/"</span><span class='op'>)</span> </span></code></pre>
</div>
<pre><code>Reading layer `lines&#39; from data source 
  `/home/odradek/css_master/1c_data_visualization_inaki_ucar_marques/viz_project/calgary_plot/dataviz/_projects/2025/100569505/oe_osm_data/bbbike_Calgary.gpkg&#39; 
  using driver `GPKG&#39;
Simple feature collection with 164848 features and 10 fields
Geometry type: LINESTRING
Dimension:     XY
Bounding box:  xmin: -114.7067 ymin: 50.71787 xmax: -113.3762 ymax: 52.0148
Geodetic CRS:  WGS 84</code></pre>
</div>
<p>Now that we have the .pbf file we can calculate car travel times with <code>r5r</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># We build the network that we will need to pass into travel_time_matrix() </span></span>
<span><span class='va'>r5r_network</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://ipeagit.github.io/r5r/reference/build_network.html'>build_network</a></span><span class='op'>(</span><span class='st'>"oe_osm_data/"</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># travel_time_matrix needs points with longitudes and latitudes in both</span></span>
<span><span class='co'># origins and destinations argument. But our hexagons are not points, so we</span></span>
<span><span class='co'># will compute the center of the hexagons and create a tibble. We can compute</span></span>
<span><span class='co'># only hexagons with roads to avoid unnecessary computation.</span></span>
<span><span class='va'>hexagons_center</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/as_tibble.html'>as_tibble</a></span><span class='op'>(</span></span>
<span>  <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_coordinates.html'>st_coordinates</a></span><span class='op'>(</span><span class='fu'><a href='https://r-spatial.github.io/sf/reference/geos_unary.html'>st_centroid</a></span><span class='op'>(</span><span class='va'>hexroads_intersection</span><span class='op'>$</span><span class='va'>geometry</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>origins_tibble</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  id <span class='op'>=</span> <span class='va'>hexroads_intersection</span><span class='op'>$</span><span class='va'>id</span>,</span>
<span>  lon <span class='op'>=</span> <span class='va'>hexagons_center</span><span class='op'>$</span><span class='va'>X</span>,</span>
<span>  lat <span class='op'>=</span> <span class='va'>hexagons_center</span><span class='op'>$</span><span class='va'>Y</span>,</span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># We get the coordinates for calgary tower on a data frame to be able to</span></span>
<span><span class='co'># pass it into travel_time_matrix:</span></span>
<span><span class='va'>calgary_tower</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span></span>
<span>  id <span class='op'>=</span> <span class='st'>"tower"</span>,</span>
<span>  lon <span class='op'>=</span> <span class='op'>-</span><span class='fl'>114.0631</span>,</span>
<span>  lat <span class='op'>=</span> <span class='fl'>51.04465</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># This takes long to compute (45') so I'll save the object so as to avoid</span></span>
<span><span class='co'># running it again.</span></span>
<span><span class='co'># ttm &lt;- travel_time_matrix(</span></span>
<span><span class='co'>#   r5r_network = r5r_network, # We pass the network we just created</span></span>
<span><span class='co'>#   origins = origins_tibble,</span></span>
<span><span class='co'>#   destination = calgary_tower,</span></span>
<span><span class='co'>#   mode = "CAR",</span></span>
<span><span class='co'>#   departure_datetime = as.POSIXct("2024-11-29 08:00:00"),</span></span>
<span><span class='co'># )</span></span>
<span><span class='co'># save(ttm, file = "ttm.RData")</span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/load.html'>load</a></span><span class='op'>(</span><span class='st'>"ttm.RData"</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>We now have the car travel times, now we can add them to to <code>hexroads_intersection</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Car faster by more than xx minutes:</span></span>
<span><span class='va'>cf</span> <span class='op'>&lt;-</span> <span class='fl'>15</span> <span class='co'># Minutes</span></span>
<span></span>
<span><span class='co'># Less than xx minutes by bike or transit shows bike or transit (and not car).</span></span>
<span><span class='va'>min</span> <span class='op'>&lt;-</span> <span class='fl'>30</span> <span class='co'># Minutes</span></span>
<span></span>
<span><span class='va'>hexroads_intersection2</span> <span class='op'>&lt;-</span> <span class='va'>hexroads_intersection</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span><span class='st'>"id"</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='va'>id</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>ttm</span>, by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"id"</span> <span class='op'>=</span> <span class='st'>"from_id"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span> <span class='co'># Join car travel times</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span> <span class='co'># Rename travel_time_p50 to car travel time (car_tt)</span></span>
<span>    <span class='st'>"car_tt"</span> <span class='op'>=</span>  <span class='va'>travel_time_p50</span>,</span>
<span>    <span class='st'>"time_color_car"</span> <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span> <span class='co'># When car more than 10 minutes faster: "9"</span></span>
<span>      <span class='va'>b_travel_time</span> <span class='op'>&lt;=</span> <span class='va'>min</span> <span class='op'>|</span> <span class='va'>travel_time</span> <span class='op'>&lt;=</span> <span class='va'>min</span> <span class='op'>~</span> <span class='va'>time_color</span>,</span>
<span>      <span class='va'>car_tt</span> <span class='op'>-</span> <span class='va'>b_travel_time</span> <span class='op'>&lt;</span> <span class='op'>-</span><span class='va'>cf</span> <span class='op'>&amp;</span> <span class='va'>car_tt</span> <span class='op'>-</span> <span class='va'>travel_time</span> <span class='op'>&lt;</span> <span class='op'>-</span><span class='va'>cf</span> <span class='op'>~</span> <span class='st'>"9"</span>,</span>
<span>      <span class='va'>car_tt</span> <span class='op'>-</span> <span class='va'>b_travel_time</span> <span class='op'>&gt;=</span> <span class='op'>-</span><span class='va'>cf</span> <span class='op'>|</span> <span class='va'>car_tt</span> <span class='op'>-</span> <span class='va'>travel_time</span> <span class='op'>&gt;=</span> <span class='op'>-</span><span class='va'>cf</span> <span class='op'>~</span> <span class='va'>time_color</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<h4 id="plotting-map-with-car-data">Plotting map with car data</h4>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>calgary_car</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span> <span class='co'># We plot the roads:</span></span>
<span>    data <span class='op'>=</span> <span class='va'>hexroads_intersection2</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='va'>time_color_car</span><span class='op'>)</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='fl'>1.1</span>,  <span class='co'># To make roads thicker</span></span>
<span>    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_color_manual</a></span><span class='op'>(</span></span>
<span>    values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>      <span class='st'>"-2"</span> <span class='op'>=</span> <span class='st'>"#aa5312"</span>,   <span class='co'># bike &gt;30 min faster</span></span>
<span>      <span class='st'>"-1"</span> <span class='op'>=</span> <span class='st'>"#c88c47"</span>,   <span class='co'># bike 10–30 min faster</span></span>
<span>      <span class='st'>"0"</span>  <span class='op'>=</span> <span class='st'>"#b7a6ac"</span>,   <span class='co'># similar travel time</span></span>
<span>      <span class='st'>"1"</span>  <span class='op'>=</span> <span class='st'>"#a36f96"</span>,   <span class='co'># transit 10–30 min faster</span></span>
<span>      <span class='st'>"2"</span>  <span class='op'>=</span> <span class='st'>"#6a4886"</span>,   <span class='co'># transit &gt;30 min faster</span></span>
<span>      <span class='st'>"9"</span> <span class='op'>=</span> <span class='st'>"#000000"</span>     <span class='co'># car more than 10 minutes faster than both</span></span>
<span>    <span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>calgary_car</span></span></code></pre>
</div>
<p><img src="100569505_files/figure-html5/plot_map_car-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<h3 id="isochrones-by-bike-travel-time-iñakis-suggestion">Isochrones by bike travel time (Iñaki’s suggestion)</h3>
<h4 id="calculating-bike-isochrones">Calculating bike isochrones</h4>
<ul>
<li>Mergin polygons idea from <a href="https://stackoverflow.com/questions/49354393/r-how-do-i-merge-polygon-features-in-a-shapefile-with-many-polygons-reproducib">here</a></li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># After quite some time of trial and error, 20' is the right balance between </span></span>
<span><span class='co'># making the map informative, and a total line mess.</span></span>
<span></span>
<span><span class='co'># Calculating hexagons under each isochrone:</span></span>
<span><span class='va'>hexagons2</span> <span class='op'>&lt;-</span> <span class='va'>hexagons</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span><span class='st'>"iso_b_travel_time"</span> <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span></span>
<span>      <span class='va'>b_travel_time</span> <span class='op'>&lt;</span> <span class='fl'>20</span> <span class='op'>~</span> <span class='fl'>1</span>,</span>
<span>      <span class='va'>b_travel_time</span> <span class='op'>&lt;</span> <span class='fl'>40</span> <span class='op'>~</span> <span class='fl'>2</span>,</span>
<span>      <span class='va'>b_travel_time</span> <span class='op'>&lt;</span> <span class='fl'>60</span> <span class='op'>~</span> <span class='fl'>3</span>,</span>
<span>      <span class='va'>b_travel_time</span> <span class='op'>&lt;</span> <span class='fl'>80</span> <span class='op'>~</span> <span class='fl'>4</span>,</span>
<span>      <span class='va'>b_travel_time</span> <span class='op'>&gt;=</span> <span class='fl'>80</span> <span class='op'>~</span> <span class='fl'>5</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>iso_b_travel_time</span> <span class='op'>!=</span> <span class='fl'>5</span><span class='op'>)</span> <span class='co'># So that we don't get an area for the </span></span>
<span>                                 <span class='co'># last isohrone (which is the bb limit)</span></span>
<span></span>
<span></span>
<span><span class='co'># To avoid "hexagon grid" effect, I need to merge adjacent hexagons where</span></span>
<span><span class='co'># travel time by bike is the same.</span></span>
<span><span class='va'>iso_bike</span> <span class='op'>&lt;-</span> <span class='va'>hexagons2</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>iso_b_travel_time</span><span class='op'>)</span> <span class='op'>|&gt;</span> <span class='co'># We group hexagons with the same travel time</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span><span class='op'>)</span> <span class='co'># We could use st_union, but this is simpler</span></span>
<span></span>
<span><span class='co'>##### A problem to fix: holes.</span></span>
<span><span class='co'># ============================</span></span>
<span><span class='co'># When plotting iso_bike small holes appear. I need to get those removed.</span></span>
<span></span>
<span><span class='co'># I initially tried function st_remove_holes()  from package nngeo directly,</span></span>
<span><span class='co'># like this:</span></span>
<span><span class='co'># hexzones &lt;- hexzones |&gt; </span></span>
<span><span class='co'>#   st_remove_holes()</span></span>
<span><span class='co'># But it doesn't work. I think the problem is that our geometry is a</span></span>
<span><span class='co'># multipolygon. Annd st_remove_holes remove the holes inside each "polygon"</span></span>
<span><span class='co'># of the multipolygon (see the documentation of the function for a more</span></span>
<span><span class='co'># visual explanation of what i mean).</span></span>
<span></span>
<span><span class='co'># So I tried a new approach: first splitting the multipolygons into single </span></span>
<span><span class='co'># polygons, selecting only the biggest ones (thus removing the small "holes"),</span></span>
<span><span class='co'># and then running st_remove_holes.</span></span>
<span><span class='va'>iso_bike</span> <span class='op'>&lt;-</span> <span class='va'>iso_bike</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_cast.html'>st_cast</a></span><span class='op'>(</span><span class='st'>"POLYGON"</span><span class='op'>)</span> <span class='op'>|&gt;</span>  <span class='co'># We separate multipolygons into polygons</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span><span class='st'>"area"</span> <span class='op'>=</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/geos_measures.html'>st_area</a></span><span class='op'>(</span><span class='va'>geometry</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span>  <span class='co'># We calculate area of each polygon</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>iso_b_travel_time</span><span class='op'>)</span> <span class='op'>|&gt;</span> <span class='co'># We group them by the same travel times</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/slice.html'>slice_max</a></span><span class='op'>(</span><span class='va'>area</span>, n <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>|&gt;</span>  <span class='co'># We keep only the polygons with the biggest area</span></span>
<span>  <span class='fu'><a href='https://michaeldorman.github.io/nngeo/reference/st_remove_holes.html'>st_remove_holes</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># We see some warnings. Documentation says "If information gets lost while type</span></span>
<span><span class='co'># casting, a warning is raised". I'm not sure what information is lost, but</span></span>
<span><span class='co'># everything seems to work fine, so it isn't a problem.</span></span>
<span></span>
<span></span>
<span></span>
<span><span class='co'>### Making area less sharp ("rounding" hexagons): </span></span>
<span><span class='co'>#================================================</span></span>
<span><span class='co'># I tried st_buffer (needed st_transform first for the function to work </span></span>
<span><span class='co'># properly, but it didn't look good).</span></span>
<span><span class='va'>iso_bike</span> <span class='op'>&lt;-</span> <span class='va'>iso_bike</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://strimas.com/smoothr/reference/smooth.html'>smooth</a></span><span class='op'>(</span>method <span class='op'>=</span> <span class='st'>"ksmooth"</span>, smoothness <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span> <span class='co'># smooth(method = chaikin) also</span></span>
<span>                                             <span class='co'># looks good (more detailed though)  </span></span></code></pre>
</div>
</div>
<h4 id="plotting-bike-isochrones">Plotting bike isochrones</h4>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'>## Plotting in white background:</span></span>
<span></span>
<span><span class='va'>white</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span><span class='co'># A) We first plot the isochrone's areas (no borders yet)</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>iso_bike</span>, </span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>iso_b_travel_time</span><span class='op'>)</span>, </span>
<span>    color <span class='op'>=</span> <span class='cn'>NA</span>, </span>
<span>    alpha <span class='op'>=</span> <span class='fl'>0.1</span>,</span>
<span>    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span> </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_gradient.html'>scale_fill_gradient</a></span><span class='op'>(</span></span>
<span>    low <span class='op'>=</span> <span class='st'>"black"</span>, <span class='co'># Central isochrone</span></span>
<span>    high <span class='op'>=</span> <span class='st'>"white"</span> <span class='co'># Outer isochrone</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span><span class='co'># We plot the water first (so that roads appear on top)</span></span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span> <span class='co'># We plot the water:</span></span>
<span>    data <span class='op'>=</span> <span class='va'>water</span>,</span>
<span>    fill <span class='op'>=</span> <span class='st'>"#a6b0b9"</span>,</span>
<span>    color <span class='op'>=</span> <span class='st'>"#a6b0b9"</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='fl'>1.1</span> <span class='co'># To make water thicker</span></span>
<span>    <span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span><span class='co'># Then we plot the roads:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>hexroads_intersection</span>,</span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='va'>time_color</span><span class='op'>)</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='fl'>1.1</span>,  <span class='co'># To make roads thicker</span></span>
<span>    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_color_manual</a></span><span class='op'>(</span></span>
<span>    values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>      <span class='st'>"-2"</span> <span class='op'>=</span> <span class='st'>"#aa5312"</span>,   <span class='co'># bike &gt;30 min faster</span></span>
<span>      <span class='st'>"-1"</span> <span class='op'>=</span> <span class='st'>"#c88c47"</span>,   <span class='co'># bike 10–30 min faster</span></span>
<span>      <span class='st'>"0"</span>  <span class='op'>=</span> <span class='st'>"#b7a6ac"</span>,   <span class='co'># similar travel time</span></span>
<span>      <span class='st'>"1"</span>  <span class='op'>=</span> <span class='st'>"#a36f96"</span>,   <span class='co'># transit 10–30 min faster</span></span>
<span>      <span class='st'>"2"</span>  <span class='op'>=</span> <span class='st'>"#6a4886"</span>   <span class='co'># transit &gt;30 min faster</span></span>
<span>    <span class='op'>)</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span><span class='co'># Anf finally the isochrone's borders (so that they appear on top of roads)</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsf.html'>geom_sf</a></span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>iso_bike</span>, </span>
<span>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span>,</span>
<span>    color <span class='op'>=</span> <span class='st'>"black"</span>, <span class='co'># I tried a gradient instead, but didn't look good.</span></span>
<span>    fill <span class='op'>=</span> <span class='cn'>NA</span>,</span>
<span>    alpha <span class='op'>=</span> <span class='fl'>1</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='fl'>0.6</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  </span>
<span><span class='co'># Finally, theming to make the background white:</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_void</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span></span>
<span>    plot.background <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='st'>"white"</span>, color <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span>,</span>
<span>    panel.background <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='st'>"white"</span>, color <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>white</span> <span class='co'># To see it</span></span></code></pre>
</div>
<p><img src="100569505_files/figure-html5/improved_white-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
