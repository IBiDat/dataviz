<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>


  <!--radix_placeholder_meta_tags-->
  <title>Energy Production between 2004 and 2014</title>

  <meta property="description" itemprop="description" content="This map fails to represent the  total electric energy production as of 2014, its sources and the variation between 2004 and 2014. In this tutorial, I will propose an improved version of it, staying away of the pie charts."/>


  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2025-12-15"/>
  <meta property="article:created" itemprop="dateCreated" content="2025-12-15"/>
  <meta name="article:author" content="Noah Emanuel Fürup"/>

  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Energy Production between 2004 and 2014"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="This map fails to represent the  total electric energy production as of 2014, its sources and the variation between 2004 and 2014. In this tutorial, I will propose an improved version of it, staying away of the pie charts."/>
  <meta property="og:locale" content="en_US"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="Energy Production between 2004 and 2014"/>
  <meta property="twitter:description" content="This map fails to represent the  total electric energy production as of 2014, its sources and the variation between 2004 and 2014. In this tutorial, I will propose an improved version of it, staying away of the pie charts."/>

  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","categories","author","date","output"]}},"value":[{"type":"character","attributes":{},"value":["Energy Production between 2004 and 2014"]},{"type":"character","attributes":{},"value":["This map fails to represent the  total electric energy production as of 2014, its sources and the variation between 2004 and 2014. In this tutorial, I will propose an improved version of it, staying away of the pie charts.\n"]},{"type":"character","attributes":{},"value":["2025"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["Noah Emanuel Fürup"]}]}]},{"type":"character","attributes":{},"value":["2025-12-15"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]}]}]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["100564888_files/anchor-4.2.2/anchor.min.js","100564888_files/bowser-1.9.3/bowser.min.js","100564888_files/distill-2.2.21/template.v2.js","100564888_files/figure-html5/add canary islands to the main map-1.png","100564888_files/figure-html5/add legend 1-1.png","100564888_files/figure-html5/canary islands map-1.png","100564888_files/figure-html5/canary islands pie charts-1.png","100564888_files/figure-html5/colours without legend-1.png","100564888_files/figure-html5/doughnut-1.png","100564888_files/figure-html5/first plot-1.png","100564888_files/figure-html5/legend-1.png","100564888_files/figure-html5/legend pie chart colors-1.png","100564888_files/figure-html5/legend pie charts-1.png","100564888_files/figure-html5/pie charts without right colours-1.png","100564888_files/figure-html5/unnamed-chunk-1-1.png","100564888_files/figure-html5/unnamed-chunk-2-1.png","100564888_files/header-attrs-2.30/header-attrs.js","100564888_files/jquery-3.6.0/jquery-3.6.0.js","100564888_files/jquery-3.6.0/jquery-3.6.0.min.js","100564888_files/jquery-3.6.0/jquery-3.6.0.min.map","100564888_files/popper-2.6.0/popper.min.js","100564888_files/tippy-6.2.7/tippy-bundle.umd.min.js","100564888_files/tippy-6.2.7/tippy-light-border.css","100564888_files/tippy-6.2.7/tippy.css","100564888_files/tippy-6.2.7/tippy.umd.min.js","100564888_files/webcomponents-2.0.0/webcomponents.js","original.pdf","produccion_electricidad.xls","se89_10_admin_prov_a_x_20140101.CPG","se89_10_admin_prov_a_x_20140101.dbf","se89_10_admin_prov_a_x_20140101.prj","se89_10_admin_prov_a_x_20140101.sbn","se89_10_admin_prov_a_x_20140101.sbx","se89_10_admin_prov_a_x_20140101.shp","se89_10_admin_prov_a_x_20140101.shp.xml","se89_10_admin_prov_a_x_20140101.shx","se89_10_admin_prov_a_y_20140101.CPG","se89_10_admin_prov_a_y_20140101.dbf","se89_10_admin_prov_a_y_20140101.prj","se89_10_admin_prov_a_y_20140101.sbn","se89_10_admin_prov_a_y_20140101.sbx","se89_10_admin_prov_a_y_20140101.shp","se89_10_admin_prov_a_y_20140101.shp.xml","se89_10_admin_prov_a_y_20140101.shx","weezerfont.ttf"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
    font-size: 100%;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  hr.section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    margin: 0px;
  }


  d-byline {
    border-top: none;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
    border-top: none;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  /* tweak for Pandoc numbered line within distill */
  d-article pre.numberSource code > span {
      left: -2em;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }

  /* Citation hover box */

  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }

  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // separator
    var separator = '<hr class="section-separator" style="clear: both"/>';
    // prepend separator above appendix
    $('.d-byline').before(separator);
    $('.d-article').before(separator);

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme, except when numbering line
    // in code chunk
    $('pre:not(.numberLines) code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        var author_name = front_matter.authors[i].author
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', author_name ? 'ORCID ID for ' + author_name : 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // hoverable references
      $('span.citation[data-cites]').each(function() {
        const citeChild = $(this).children()[0]
        // Do not process if @xyz has been used without escaping and without bibliography activated
        // https://github.com/rstudio/distill/issues/466
        if (citeChild === undefined) return true

        if (citeChild.nodeName == "D-FOOTNOTE") {
          var fn = citeChild
          $(this).html(fn.shadowRoot.querySelector("sup"))
          $(this).id = fn.id
          fn.remove()
        }
        var refs = $(this).attr('data-cites').split(" ");
        var refHtml = refs.map(function(ref) {
          // Could use CSS.escape too here, we insure backward compatibility in navigator
          return "<p>" + $('div[id="ref-' + ref + '"]').html() + "</p>";
        }).join("\n");
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });

      // fix footnotes in tables (#411)
      // replacing broken distill.pub feature
      $('table d-footnote').each(function() {
        // we replace internal showAtNode methode which is triggered when hovering a footnote
        this.hoverBox.showAtNode = function(node) {
          // ported from https://github.com/distillpub/template/pull/105/files
          calcOffset = function(elem) {
              let x = elem.offsetLeft;
              let y = elem.offsetTop;
              // Traverse upwards until an `absolute` element is found or `elem`
              // becomes null.
              while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                  x += elem.offsetLeft;
                  y += elem.offsetTop;
              }

              return { left: x, top: y };
          }
          // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
          const bbox = node.getBoundingClientRect();
          const offset = calcOffset(node);
          this.show([offset.left + bbox.width, offset.top + bbox.height]);
        }
      })

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      // ignore leaflet img layers (#106)
      figures = figures.filter(':not(img[class*="leaflet"])')
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <!--/radix_placeholder_distill-->
  <script src="100564888_files/header-attrs-2.30/header-attrs.js"></script>
  <script src="100564888_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="100564888_files/popper-2.6.0/popper.min.js"></script>
  <link href="100564888_files/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="100564888_files/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="100564888_files/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="100564888_files/anchor-4.2.2/anchor.min.js"></script>
  <script src="100564888_files/bowser-1.9.3/bowser.min.js"></script>
  <script src="100564888_files/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="100564888_files/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Energy Production between 2004 and 2014","description":"This map fails to represent the  total electric energy production as of 2014, its sources and the variation between 2004 and 2014. In this tutorial, I will propose an improved version of it, staying away of the pie charts.","authors":[{"author":"Noah Emanuel Fürup","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2025-12-15T00:00:00.000+01:00","citationText":"Fürup, 2025"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Energy Production between 2004 and 2014</h1>

<!--radix_placeholder_categories-->
<div class="dt-tags">
<div class="dt-tag">2025</div>
</div>
<!--/radix_placeholder_categories-->
<p><p>This map fails to represent the total electric energy production as of 2014, its sources and the variation between 2004 and 2014. In this tutorial, I will propose an improved version of it, staying away of the pie charts.</p></p>
</div>

<div class="d-byline">
  
  Noah Emanuel Fürup
  
<br/>2025-12-15
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#the-data." id="toc-the-data.">The Data.</a></li>
</ul>
</nav>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<p>There are three elements represented in this map. The colors within the provinces represent how much variation in terms of energy production there has been made in each province between 2004 and 2014. The pie charts represent both the amount of energy that is produced in each of the 52 provinces by the size of the pie chart and the source of this energy.</p>
<h1 id="the-data.">The Data.</h1>
<p>The data that is needed to produce this map is available in the following website: <a href="https://centrodedescargas.cnig.es/CentroDescargas/busquedaRedirigida.do?ruta=PUBLICACION_CNIG_DATOS_VARIOS/aneTematico/Espana_Produccion-de-energia-electrica_2004-2014_mapa_15612_spa.pdf" class="uri">https://centrodedescargas.cnig.es/CentroDescargas/busquedaRedirigida.do?ruta=PUBLICACION_CNIG_DATOS_VARIOS/aneTematico/Espana_Produccion-de-energia-electrica_2004-2014_mapa_15612_spa.pdf</a></p>
<p>The downloaded file will consist in a folder with a couple of things that will be necessary for the reproduction of our visualization. In the data folder, there are 3 main files, even though we get 17: an .xls file with all our data and two shapefiles, which is an older format that contains geometrical information of both the spanish peninsula, and its islands. The excel has 8 sheets in it, one of them gathering the data on the variation in energy production of each province of Spain from 2004 to 2014 and the other seven representing the energy production, being numbered by source. 9453 takes on hydropower, 9454 windpower, 9455 solar, 9456 renowable thermal, 9457 carbon, gas, cogeneration, among others related to gas, 9458 nuclear, 9459 is the energy total and 9560 is the variation between 2004 and 2014.</p>
<p>In order to put all the information in a tidy dataset, I’ll get each sheet in a separable sheet, selecting only the relevant variables, since there is explicatory metadata in each sheet, and adding a “Type” variable. Then, I’ll bind everything together, resulting in our tidy “electricity” dataset:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>electricity_excel</span>    <span class='op'>&lt;-</span> <span class='st'>"produccion_electricidad.xls"</span></span>
<span></span>
<span><span class='va'>hydro_2014</span>           <span class='op'>&lt;-</span> <span class='fu'>read_excel</span><span class='op'>(</span><span class='va'>electricity_excel</span>, sheet <span class='op'>=</span> <span class='st'>"Variable_9453"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>select</span><span class='op'>(</span><span class='st'>"Nombre unidad territorial"</span>, <span class='st'>"Valor del dato"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>rename</span><span class='op'>(</span>Province <span class='op'>=</span> <span class='st'>"Nombre unidad territorial"</span>, MWh <span class='op'>=</span> <span class='st'>"Valor del dato"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>mutate</span><span class='op'>(</span>Type <span class='op'>=</span> <span class='st'>"Hidráulica"</span><span class='op'>)</span></span>
<span>  </span>
<span><span class='va'>wind_power_2014</span>      <span class='op'>&lt;-</span> <span class='fu'>read_excel</span><span class='op'>(</span><span class='va'>electricity_excel</span>, sheet <span class='op'>=</span> <span class='st'>"Variable_9454"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>select</span><span class='op'>(</span><span class='st'>"Nombre unidad territorial"</span>, <span class='st'>"Valor del dato"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>rename</span><span class='op'>(</span>Province <span class='op'>=</span> <span class='st'>"Nombre unidad territorial"</span>, MWh <span class='op'>=</span> <span class='st'>"Valor del dato"</span><span class='op'>)</span>  <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>mutate</span><span class='op'>(</span>Type <span class='op'>=</span> <span class='st'>"Eólica"</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>solar_2014</span>           <span class='op'>&lt;-</span> <span class='fu'>read_excel</span><span class='op'>(</span><span class='va'>electricity_excel</span>, sheet <span class='op'>=</span> <span class='st'>"Variable_9455"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>select</span><span class='op'>(</span><span class='st'>"Nombre unidad territorial"</span>, <span class='st'>"Valor del dato"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>rename</span><span class='op'>(</span>Province <span class='op'>=</span> <span class='st'>"Nombre unidad territorial"</span>, MWh <span class='op'>=</span> <span class='st'>"Valor del dato"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>mutate</span><span class='op'>(</span>Type <span class='op'>=</span> <span class='st'>"Solar"</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>rw_thermal_2014</span>      <span class='op'>&lt;-</span> <span class='fu'>read_excel</span><span class='op'>(</span><span class='va'>electricity_excel</span>, sheet <span class='op'>=</span> <span class='st'>"Variable_9456"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>select</span><span class='op'>(</span><span class='st'>"Nombre unidad territorial"</span>, <span class='st'>"Valor del dato"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>rename</span><span class='op'>(</span>Province <span class='op'>=</span> <span class='st'>"Nombre unidad territorial"</span>, MWh <span class='op'>=</span> <span class='st'>"Valor del dato"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>mutate</span><span class='op'>(</span>Type <span class='op'>=</span> <span class='st'>"Térmica renovable y otras"</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>carbon_and_gas_2014</span>     <span class='op'>&lt;-</span> <span class='fu'>read_excel</span><span class='op'>(</span><span class='va'>electricity_excel</span>, sheet <span class='op'>=</span> <span class='st'>"Variable_9457"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>select</span><span class='op'>(</span><span class='st'>"Nombre unidad territorial"</span>, <span class='st'>"Valor del dato"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>rename</span><span class='op'>(</span>Province <span class='op'>=</span> <span class='st'>"Nombre unidad territorial"</span>, MWh <span class='op'>=</span> <span class='st'>"Valor del dato"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>mutate</span><span class='op'>(</span>Type <span class='op'>=</span> <span class='st'>"Carbón, fuelgas, ciclo combinado y cogeneración"</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>nuclear_2014</span>         <span class='op'>&lt;-</span> <span class='fu'>read_excel</span><span class='op'>(</span><span class='va'>electricity_excel</span>, sheet <span class='op'>=</span> <span class='st'>"Variable_9458"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>select</span><span class='op'>(</span><span class='st'>"Nombre unidad territorial"</span>, <span class='st'>"Valor del dato"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>rename</span><span class='op'>(</span>Province <span class='op'>=</span> <span class='st'>"Nombre unidad territorial"</span>, MWh <span class='op'>=</span> <span class='st'>"Valor del dato"</span><span class='op'>)</span>  <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>mutate</span><span class='op'>(</span>Type <span class='op'>=</span> <span class='st'>"Nuclear"</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>total_2014</span>           <span class='op'>&lt;-</span> <span class='fu'>read_excel</span><span class='op'>(</span><span class='va'>electricity_excel</span>, sheet <span class='op'>=</span> <span class='st'>"Variable_9459"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>select</span><span class='op'>(</span><span class='st'>"Nombre unidad territorial"</span>, <span class='st'>"Valor del dato"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>rename</span><span class='op'>(</span>Province <span class='op'>=</span> <span class='st'>"Nombre unidad territorial"</span>, MWh <span class='op'>=</span> <span class='st'>"Valor del dato"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>mutate</span><span class='op'>(</span>Type <span class='op'>=</span> <span class='st'>"Total"</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>variation_2004_2014</span>  <span class='op'>&lt;-</span> <span class='fu'>read_excel</span><span class='op'>(</span><span class='va'>electricity_excel</span>, sheet <span class='op'>=</span> <span class='st'>"Variable_9460"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>select</span><span class='op'>(</span><span class='st'>"Nombre unidad territorial"</span>, <span class='st'>"Valor del dato"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>rename</span><span class='op'>(</span>Province <span class='op'>=</span> <span class='st'>"Nombre unidad territorial"</span>, MWh <span class='op'>=</span> <span class='st'>"Valor del dato"</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>mutate</span><span class='op'>(</span>Type <span class='op'>=</span> <span class='st'>"Variación 2004 - 2014"</span><span class='op'>)</span></span>
<span></span>
<span></span>
<span><span class='va'>electricity_</span> <span class='op'>&lt;-</span> <span class='fu'>bind_rows</span><span class='op'>(</span></span>
<span>  <span class='va'>hydro_2014</span>, <span class='va'>wind_power_2014</span>, <span class='va'>solar_2014</span>, <span class='va'>rw_thermal_2014</span>, </span>
<span>  <span class='va'>carbon_and_gas_2014</span>, <span class='va'>nuclear_2014</span>, <span class='va'>total_2014</span>, <span class='va'>variation_2004_2014</span><span class='op'>)</span></span>
<span><span class='va'>electricity_</span></span></code></pre>
</div>
<pre><code># A tibble: 416 × 3
   Province              MWh Type      
   &lt;chr&gt;               &lt;dbl&gt; &lt;chr&gt;     
 1 Araba/Álava       151127. Hidráulica
 2 Albacete          313163. Hidráulica
 3 Alacant/Alicante    2631. Hidráulica
 4 Almería            48040. Hidráulica
 5 Ávila             158772. Hidráulica
 6 Badajoz           204660  Hidráulica
 7 Illes Balears          0  Hidráulica
 8 Barcelona         359347. Hidráulica
 9 Burgos            152779. Hidráulica
10 Cáceres          2912760. Hidráulica
# ℹ 406 more rows</code></pre>
</div>
<p>We can see that the variation is represented as a range in the provinces, therefore we have to add a categorical variable that corresponds to the brackets of the legend.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>category_variation</span> <span class='op'>&lt;-</span><span class='va'>electricity_</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Type</span> <span class='op'>==</span> <span class='st'>"Variación 2004 - 2014"</span><span class='op'>)</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'>mutate</span><span class='op'>(</span></span>
<span>    variation_category <span class='op'>=</span> <span class='fu'>case_when</span><span class='op'>(</span></span>
<span>      <span class='va'>MWh</span> <span class='op'>&lt;</span> <span class='fl'>50.1</span> <span class='op'>~</span> <span class='st'>"&lt;50,1"</span>,</span>
<span>      <span class='va'>MWh</span> <span class='op'>&gt;=</span> <span class='fl'>50.1</span> <span class='op'>&amp;</span> <span class='va'>MWh</span> <span class='op'>&lt;=</span> <span class='fl'>75.0</span> <span class='op'>~</span> <span class='st'>"50,1 - 75,0"</span>,</span>
<span>      <span class='va'>MWh</span> <span class='op'>&gt;</span> <span class='fl'>75.0</span> <span class='op'>&amp;</span> <span class='va'>MWh</span> <span class='op'>&lt;=</span> <span class='fl'>100.0</span> <span class='op'>~</span> <span class='st'>"75,1 - 100,0"</span>,</span>
<span>      <span class='va'>MWh</span> <span class='op'>&gt;</span> <span class='fl'>100.0</span> <span class='op'>&amp;</span> <span class='va'>MWh</span> <span class='op'>&lt;=</span> <span class='fl'>150.0</span> <span class='op'>~</span> <span class='st'>"100,1 - 150,0"</span>,</span>
<span>      <span class='va'>MWh</span> <span class='op'>&gt;</span> <span class='fl'>150.0</span> <span class='op'>&amp;</span> <span class='va'>MWh</span> <span class='op'>&lt;=</span> <span class='fl'>200.0</span> <span class='op'>~</span> <span class='st'>"150,1 - 200,0"</span>,</span>
<span>      <span class='va'>MWh</span> <span class='op'>&gt;</span> <span class='fl'>200.0</span> <span class='op'>&amp;</span> <span class='va'>MWh</span> <span class='op'>&lt;=</span> <span class='fl'>300.0</span> <span class='op'>~</span> <span class='st'>"200,1 - 300,0"</span>,</span>
<span>      <span class='va'>MWh</span> <span class='op'>&gt;</span> <span class='fl'>300.0</span> <span class='op'>&amp;</span> <span class='va'>MWh</span> <span class='op'>&lt;=</span> <span class='fl'>600.0</span> <span class='op'>~</span> <span class='st'>"300,1 - 600,0"</span>,</span>
<span>      <span class='va'>MWh</span> <span class='op'>&gt;</span> <span class='fl'>1000.0</span> <span class='op'>~</span> <span class='st'>"&gt;1.000,0"</span>,</span>
<span>      <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='cn'>NA_character_</span><span class='op'>)</span>,</span>
<span>    variation_category <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span></span>
<span>      <span class='va'>variation_category</span>, </span>
<span>      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"&lt;50,1"</span>, <span class='st'>"50,1 - 75,0"</span>, <span class='st'>"75,1 - 100,0"</span>,</span>
<span>                 <span class='st'>"100,1 - 150,0"</span>, <span class='st'>"150,1 - 200,0"</span>, </span>
<span>                 <span class='st'>"200,1 - 300,0"</span>, <span class='st'>"300,1 - 600,0"</span>, <span class='st'>"&gt;1.000,0"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'>select</span><span class='op'>(</span><span class='va'>Province</span>, <span class='va'>variation_category</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>electricity</span> <span class='op'>&lt;-</span> <span class='va'>category_variation</span> <span class='op'>|&gt;</span> <span class='fu'>left_join</span><span class='op'>(</span><span class='va'>electricity_</span>, by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Province"</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>electricity</span></span></code></pre>
</div>
<pre><code># A tibble: 416 × 4
   Province    variation_category      MWh Type                       
   &lt;chr&gt;       &lt;fct&gt;                 &lt;dbl&gt; &lt;chr&gt;                      
 1 Araba/Álava 100,1 - 150,0       151127. Hidráulica                 
 2 Araba/Álava 100,1 - 150,0       257584. Eólica                     
 3 Araba/Álava 100,1 - 150,0        17653. Solar                      
 4 Araba/Álava 100,1 - 150,0         7182. Térmica renovable y otras  
 5 Araba/Álava 100,1 - 150,0       359081  Carbón, fuelgas, ciclo com…
 6 Araba/Álava 100,1 - 150,0            0  Nuclear                    
 7 Araba/Álava 100,1 - 150,0       792627. Total                      
 8 Araba/Álava 100,1 - 150,0          114. Variación 2004 - 2014      
 9 Albacete    200,1 - 300,0       313163. Hidráulica                 
10 Albacete    200,1 - 300,0      4513126. Eólica                     
# ℹ 406 more rows</code></pre>
</div>
<p>To get the map of Spain, I will use both stringfiles that were attached in the folder. In order to move the Canary Islands map around to fit the visualization, we’ll be doing two joint datasets, one for each stringfile. I will first create the plot with one shapefile and then with the other, so that I can superpose them afterwards with the right frame.</p>
<p>To read the files, I will use the function st_read() from the “sf” package.</p>
<div class="layout-chunk" data-layout="l-body">
<pre><code>Reading layer `se89_10_admin_prov_a_x_20140101&#39; from data source 
  `C:\Users\NFuru\Desktop\MASTER\DATA VISUALIZATION\Final Ugly Electric Bull\dataviz\_projects\2025\100564888\se89_10_admin_prov_a_x_20140101.shp&#39; 
  using driver `ESRI Shapefile&#39;
Simple feature collection with 50 features and 18 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -9.298027 ymin: 35.25069 xmax: 4.314508 ymax: 43.77594
Geodetic CRS:  ETRS89</code></pre>
<pre><code>Reading layer `se89_10_admin_prov_a_y_20140101&#39; from data source 
  `C:\Users\NFuru\Desktop\MASTER\DATA VISUALIZATION\Final Ugly Electric Bull\dataviz\_projects\2025\100564888\se89_10_admin_prov_a_y_20140101.shp&#39; 
  using driver `ESRI Shapefile&#39;
Simple feature collection with 2 features and 18 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -18.16066 ymin: 27.638 xmax: -13.4192 ymax: 29.29093
Geodetic CRS:  ETRS89</code></pre>
</div>
<p>Now we can plot the background map, that features the variation in energy from 2004 to 2014. To do that, we have to use geom_sf, since it is a map, and the HEX value of the colors will be extracted with an online color picker. Then, each color will be mapped to a variation category. Lastly, I will add the neighbouring countries of Spain.</p>
<p>First, I will create the neighbouring countries data. Since the data for the shape of the borders comes from a different source, we need to make sure that both use the same CRS (Coordinate Reference System), so that there isn’t any offsets in the limits between the countries.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>neighbours</span> <span class='op'>&lt;-</span> <span class='fu'>gisco_get_countries</span><span class='op'>(</span></span>
<span>  country <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Portugal"</span>, <span class='st'>"France"</span>, <span class='st'>"Marocco"</span>, <span class='st'>"Algeria"</span>, <span class='st'>"Andorra"</span><span class='op'>)</span>,</span>
<span>  year <span class='op'>=</span> <span class='st'>"2013"</span>, resolution <span class='op'>=</span> <span class='st'>"10"</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>Now we can do our first plot of the background map, that features the variation in energy from 2004 to 2014. To do that, we have to use geom_sf, since it is a map. First, the neighbouring countries’ shape will be plotted and then the shape of Spain’s provinces. The HEX value of the legend will be extracted with an online color picker. Each color will be mapped to a variation category with scale_fill_manual().</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>fondo_izquierdo</span> <span class='op'>&lt;-</span> <span class='fu'>tibble</span><span class='op'>(</span></span>
<span>  x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>13</span>, <span class='op'>-</span><span class='fl'>16</span>, <span class='op'>-</span><span class='fl'>16</span>, <span class='op'>-</span><span class='fl'>13</span>, <span class='op'>-</span><span class='fl'>13</span><span class='op'>)</span>,</span>
<span>  y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>34.75</span>, <span class='fl'>34.75</span>, <span class='fl'>44.5</span>, <span class='fl'>44.5</span>, <span class='fl'>34.75</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>borde_completo</span> <span class='op'>&lt;-</span> <span class='fu'>tibble</span><span class='op'>(</span></span>
<span>  x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>13</span>, <span class='fl'>5.5</span>, <span class='fl'>5.5</span>, <span class='op'>-</span><span class='fl'>13</span>, <span class='op'>-</span><span class='fl'>13</span><span class='op'>)</span>,</span>
<span>  y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>34.75</span>, <span class='fl'>34.75</span>, <span class='fl'>44.5</span>, <span class='fl'>44.5</span>, <span class='fl'>34.75</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span></span>
<span><span class='va'>map_replica</span> <span class='op'>&lt;-</span>  <span class='fu'>ggplot</span><span class='op'>(</span><span class='va'>electricity_peninsula</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'>geom_polygon</span><span class='op'>(</span></span>
<span>  data <span class='op'>=</span> <span class='va'>fondo_izquierdo</span>,</span>
<span>  <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span>,</span>
<span>  fill <span class='op'>=</span> <span class='st'>"#feffff"</span>,</span>
<span>  colour <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span> <span class='op'>+</span>                        <span class='co'># This is our data, put directly in the ggplot() function</span></span>
<span>    <span class='fu'>geom_sf</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>neighbours</span>,                   <span class='co'># Here we have the shape of the neighbours of Spain</span></span>
<span>           fill <span class='op'>=</span> <span class='st'>"#e5e5e5"</span>,</span>
<span>           color <span class='op'>=</span> <span class='st'>"black"</span>,</span>
<span>           size <span class='op'>=</span> <span class='fl'>0.2</span>,<span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>theme</span><span class='op'>(</span>panel.background <span class='op'>=</span> <span class='fu'>element_blank</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>   <span class='fu'>geom_sf</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>variation_category</span><span class='op'>)</span>,      <span class='co'># Since we're plotting a Map, we use geom_sf() in both</span></span>
<span>            color <span class='op'>=</span> <span class='st'>"black"</span>, size <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span> <span class='op'>+</span> </span>
<span>  <span class='fu'>coord_sf</span><span class='op'>(</span></span>
<span>     xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>16</span>, <span class='fl'>5.5</span><span class='op'>)</span>, </span>
<span>    ylim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>34.75</span>, <span class='fl'>44.5</span><span class='op'>)</span>,</span>
<span>     expand <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>+</span> </span>
<span>                                                <span class='co'># a similar framing to the one of the original map</span></span>
<span>   <span class='fu'>theme_void</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>                               <span class='co'># theme_void() eliminates the x and y axis</span></span>
<span>   <span class='fu'>theme</span><span class='op'>(</span>panel.background <span class='op'>=</span> <span class='fu'>element_rect</span><span class='op'>(</span></span>
<span>   fill <span class='op'>=</span> <span class='st'>"#e6ffff"</span>, </span>
<span>   color <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>                        <span class='co'># panel.background changes the background color</span></span>
<span>  <span class='fu'>geom_path</span><span class='op'>(</span></span>
<span>  data <span class='op'>=</span> <span class='va'>borde_completo</span>,</span>
<span>  <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span>,</span>
<span>  colour <span class='op'>=</span> <span class='st'>"black"</span>,</span>
<span>  linewidth <span class='op'>=</span> <span class='fl'>0.3</span><span class='op'>)</span></span>
<span>  <span class='va'>map_replica</span></span></code></pre>
</div>
<p><img src="100564888_files/figure-html5/first%20plot-1.png" width="624" /></p>
</div>
<p>From the start, we get a pretty accurate plot from the background map. There are some minor adjustments to be made, due to small offsets in the borders…</p>
<p>The legend has to be moved as well and some other adjustments have to be made like centering the text. Also, the map is scaled each time you plot i</p>
<p>diversion map</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>variation_map</span> <span class='op'>&lt;-</span> <span class='va'>map_replica</span> <span class='op'>+</span></span>
<span><span class='fu'>scale_fill_manual</span><span class='op'>(</span>                    <span class='co'># This function is used to give your own color palette</span></span>
<span>    values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>      <span class='st'>"&lt;50,1"</span> <span class='op'>=</span>         <span class='st'>"#e34a32"</span>,</span>
<span>      <span class='st'>"50,1 - 75,0"</span> <span class='op'>=</span>   <span class='st'>"#fd8d58"</span>,</span>
<span>      <span class='st'>"75,1 - 100,0"</span> <span class='op'>=</span>  <span class='st'>"#fcba84"</span>,</span>
<span>      <span class='st'>"100,1 - 150,0"</span> <span class='op'>=</span> <span class='st'>"#d9d9ea"</span>,</span>
<span>      <span class='st'>"150,1 - 200,0"</span> <span class='op'>=</span> <span class='st'>"#bcbcdc"</span>,</span>
<span>      <span class='st'>"200,1 - 300,0"</span> <span class='op'>=</span> <span class='st'>"#9e9ac7"</span>,</span>
<span>      <span class='st'>"300,1 - 600,0"</span> <span class='op'>=</span> <span class='st'>"#746ab1"</span>,</span>
<span>      <span class='st'>"&gt;1.000,0"</span> <span class='op'>=</span>      <span class='st'>"#54268f"</span><span class='op'>)</span>,</span>
<span>      name <span class='op'>=</span> </span>
<span>      <span class='st'>"VARIACIÓN 2004-2014</span></span>
<span><span class='st'>    2004=100</span></span>
<span><span class='st'>    "</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>guides</span><span class='op'>(</span>fill <span class='op'>=</span> <span class='fu'>guide_legend</span><span class='op'>(</span></span>
<span>    direction <span class='op'>=</span> <span class='st'>"vertical"</span>,           <span class='co'># Vertical legend</span></span>
<span>    title.position <span class='op'>=</span> <span class='st'>"top"</span>,           <span class='co'># Title on top</span></span>
<span>    title.hjust <span class='op'>=</span> <span class='fl'>0.5</span>,                <span class='co'># Centered title</span></span>
<span>    label.position <span class='op'>=</span> <span class='st'>"right"</span>,         <span class='co'># Where each category is</span></span>
<span>    keywidth <span class='op'>=</span> <span class='fu'>unit</span><span class='op'>(</span><span class='fl'>0.4</span>, <span class='st'>"cm"</span><span class='op'>)</span>,         <span class='co'># This makes the legend wider</span></span>
<span>    keyheight <span class='op'>=</span> <span class='fu'>unit</span><span class='op'>(</span><span class='fl'>0.2</span>, <span class='st'>"cm"</span><span class='op'>)</span>,     <span class='co'># This makes the legend longer</span></span>
<span>  <span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>theme</span><span class='op'>(</span> </span>
<span>    legend.position <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.87</span>, <span class='fl'>0.27</span><span class='op'>)</span>,  <span class='co'># Position of the legend</span></span>
<span>    legend.background <span class='op'>=</span> <span class='fu'>element_rect</span><span class='op'>(</span> <span class='co'># Background of the legend</span></span>
<span>      fill <span class='op'>=</span> <span class='st'>"#FFFFFF"</span>, color <span class='op'>=</span> <span class='st'>"black"</span><span class='op'>)</span>,</span>
<span>    legend.text <span class='op'>=</span> <span class='fu'>element_text</span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>8</span>, hjust <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span>, <span class='co'># Text of the categories of the legends</span></span>
<span>    legend.title <span class='op'>=</span> <span class='fu'>element_text</span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>8</span>, lineheight <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span>,</span>
<span>    legend.margin <span class='op'>=</span> </span>
<span>      <span class='fu'>margin</span><span class='op'>(</span><span class='fl'>4</span>, <span class='fl'>4</span>, <span class='fl'>4</span>, <span class='fl'>4</span><span class='op'>)</span>,         <span class='co'># Margin of the legend</span></span>
<span>    legend.key <span class='op'>=</span> </span>
<span>      <span class='fu'>element_rect</span><span class='op'>(</span>color <span class='op'>=</span> <span class='cn'>NA</span>, fill <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span>,     </span>
<span>    legend.key.spacing.y <span class='op'>=</span> <span class='fu'>unit</span><span class='op'>(</span><span class='op'>-</span><span class='fl'>0.01</span>, <span class='st'>"cm"</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>variation_map</span></span></code></pre>
</div>
<p><img src="100564888_files/figure-html5/legend-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>variation_legend</span> <span class='op'>&lt;-</span> <span class='fu'>gtable_filter</span><span class='op'>(</span><span class='fu'>ggplot_gtable</span><span class='op'>(</span><span class='fu'>ggplot_build</span><span class='op'>(</span><span class='va'>variation_map</span><span class='op'>)</span><span class='op'>)</span>, <span class='st'>"guide-box"</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>real map without first legend.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>map_replica</span> <span class='op'>&lt;-</span> <span class='va'>map_replica</span> <span class='op'>+</span></span>
<span><span class='fu'>scale_fill_manual</span><span class='op'>(</span>                    </span>
<span>    values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>      <span class='st'>"&lt;50,1"</span> <span class='op'>=</span>         <span class='st'>"#e34a32"</span>,</span>
<span>      <span class='st'>"50,1 - 75,0"</span> <span class='op'>=</span>   <span class='st'>"#fd8d58"</span>,</span>
<span>      <span class='st'>"75,1 - 100,0"</span> <span class='op'>=</span>  <span class='st'>"#fcba84"</span>,</span>
<span>      <span class='st'>"100,1 - 150,0"</span> <span class='op'>=</span> <span class='st'>"#d9d9ea"</span>,</span>
<span>      <span class='st'>"150,1 - 200,0"</span> <span class='op'>=</span> <span class='st'>"#bcbcdc"</span>,</span>
<span>      <span class='st'>"200,1 - 300,0"</span> <span class='op'>=</span> <span class='st'>"#9e9ac7"</span>,</span>
<span>      <span class='st'>"300,1 - 600,0"</span> <span class='op'>=</span> <span class='st'>"#746ab1"</span>,</span>
<span>      <span class='st'>"&gt;1.000,0"</span> <span class='op'>=</span>      <span class='st'>"#54268f"</span><span class='op'>)</span>,</span>
<span>      name <span class='op'>=</span> </span>
<span>      <span class='st'>"VARIACIÓN 2004-2014</span></span>
<span><span class='st'>    2004=100</span></span>
<span><span class='st'>    "</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>guides</span><span class='op'>(</span>fill <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span> <span class='co'># with colors but without legend</span></span>
<span><span class='va'>map_replica</span></span></code></pre>
</div>
<p><img src="100564888_files/figure-html5/colours%20without%20legend-1.png" width="624" /></p>
</div>
<p>Pie charts. First, centroids.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>electricity_peninsula</span> <span class='op'>&lt;-</span> <span class='va'>electricity_peninsula</span> <span class='op'>|&gt;</span>     <span class='co'># First we calculate the centre of each</span></span>
<span>  <span class='fu'>mutate</span><span class='op'>(</span>centre <span class='op'>=</span> <span class='fu'>st_centroid</span><span class='op'>(</span><span class='va'>geometry</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span>           <span class='co'># province by using st_centroid()</span></span>
<span>  <span class='fu'>mutate</span><span class='op'>(</span>longitude <span class='op'>=</span> <span class='fu'>st_coordinates</span><span class='op'>(</span><span class='va'>centre</span><span class='op'>)</span><span class='op'>[</span>,<span class='fl'>1</span><span class='op'>]</span>,      <span class='co'># Now we separate longitude and latitude</span></span>
<span>         latitude  <span class='op'>=</span> <span class='fu'>st_coordinates</span><span class='op'>(</span><span class='va'>centre</span><span class='op'>)</span><span class='op'>[</span>,<span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span>      <span class='co'># IS THIS NECESSARY?</span></span>
<span></span>
<span><span class='va'>electricity_canary</span> <span class='op'>&lt;-</span> <span class='va'>electricity_canary</span> <span class='op'>|&gt;</span> </span>
<span>  <span class='fu'>mutate</span><span class='op'>(</span>centre <span class='op'>=</span> <span class='fu'>st_centroid</span><span class='op'>(</span><span class='va'>geometry</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>|&gt;</span>           <span class='co'># province by using st_centroid()</span></span>
<span>  <span class='fu'>mutate</span><span class='op'>(</span>longitude <span class='op'>=</span> <span class='fu'>st_coordinates</span><span class='op'>(</span><span class='va'>centre</span><span class='op'>)</span><span class='op'>[</span>,<span class='fl'>1</span><span class='op'>]</span>,      <span class='co'># Now we separate longitude and latitude</span></span>
<span>         latitude  <span class='op'>=</span> <span class='fu'>st_coordinates</span><span class='op'>(</span><span class='va'>centre</span><span class='op'>)</span><span class='op'>[</span>,<span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>In order to do the pie charts, we have to disregard the tidyverse principle of… We have to drop the geometry because there</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>untidy_peninsula</span> <span class='op'>&lt;-</span> <span class='va'>electricity_peninsula</span> <span class='op'>|&gt;</span>        </span>
<span>   <span class='fu'>st_drop_geometry</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>|&gt;</span>                              <span class='co'># I use st_drop_geometry to avoid issues in the pivot</span></span>
<span>   <span class='fu'>pivot_wider</span><span class='op'>(</span></span>
<span>     names_from <span class='op'>=</span> <span class='va'>Type</span>, </span>
<span>     values_from <span class='op'>=</span> <span class='va'>MWh</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>mutate</span><span class='op'>(</span></span>
<span>     radius <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='va'>Total</span> <span class='op'>/</span> <span class='va'>pi</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>0.00031</span><span class='op'>)</span>             <span class='co'># Changing the value of the coefficient until it fits</span></span>
<span></span>
<span><span class='va'>untidy_canary</span> <span class='op'>&lt;-</span> <span class='va'>electricity_canary</span> <span class='op'>|&gt;</span> </span>
<span>     <span class='fu'>st_drop_geometry</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>|&gt;</span>                            <span class='co'># I use st_drop_geometry to avoid issues in the pivot</span></span>
<span>   <span class='fu'>pivot_wider</span><span class='op'>(</span></span>
<span>     names_from <span class='op'>=</span> <span class='va'>Type</span>, </span>
<span>     values_from <span class='op'>=</span> <span class='va'>MWh</span><span class='op'>)</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>mutate</span><span class='op'>(</span></span>
<span>     radius <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='va'>Total</span> <span class='op'>/</span> <span class='va'>pi</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>0.00031</span><span class='op'>)</span> </span></code></pre>
</div>
</div>
<p>Moving the pie charts</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>untidy_peninsula</span> <span class='op'>&lt;-</span> <span class='va'>untidy_peninsula</span> <span class='op'>|&gt;</span></span>
<span>  <span class='fu'>mutate</span><span class='op'>(</span></span>
<span>    longitude_moved <span class='op'>=</span> <span class='fu'>case_when</span><span class='op'>(</span></span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"A Coruña"</span> <span class='op'>~</span> <span class='va'>longitude</span> <span class='op'>-</span> <span class='fl'>0.2</span>,</span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Asturias"</span> <span class='op'>~</span> <span class='va'>longitude</span> <span class='op'>+</span> <span class='fl'>0.1</span>,</span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Lleida"</span> <span class='op'>~</span> <span class='va'>longitude</span> <span class='op'>+</span> <span class='fl'>0.25</span>,         <span class='co'># Mover a la derecha (nota: puede ser "Lleida")</span></span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Barcelona"</span> <span class='op'>~</span> <span class='va'>longitude</span> <span class='op'>+</span> <span class='fl'>0.075</span>,      <span class='co'># Mover hacia el mar</span></span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Tarragona"</span> <span class='op'>~</span> <span class='va'>longitude</span> <span class='op'>+</span> <span class='fl'>0.15</span>,       <span class='co'># Mover hacia el mar</span></span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Valencia/València"</span> <span class='op'>~</span> <span class='va'>longitude</span> <span class='op'>+</span> <span class='fl'>0.6</span>,</span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Alacant/Alicante"</span> <span class='op'>~</span> <span class='va'>longitude</span> <span class='op'>-</span> <span class='fl'>0.2</span>,</span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Granada"</span> <span class='op'>~</span> <span class='va'>longitude</span> <span class='op'>-</span> <span class='fl'>0.1</span>,         <span class='co'># Mover hacia el oeste</span></span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Cádiz"</span> <span class='op'>~</span> <span class='va'>longitude</span> <span class='op'>-</span> <span class='fl'>0.1</span>,           <span class='co'># Mover hacia el océano</span></span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Ceuta"</span> <span class='op'>~</span> <span class='va'>longitude</span> <span class='op'>+</span> <span class='fl'>0.3</span>,           <span class='co'># Mover hacia el estrecho</span></span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Melilla"</span> <span class='op'>~</span> <span class='va'>longitude</span> <span class='op'>+</span> <span class='fl'>0.3</span>,         <span class='co'># Mover hacia el este</span></span>
<span>      <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='va'>longitude</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    latitude_moved <span class='op'>=</span> <span class='fu'>case_when</span><span class='op'>(</span></span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"A Coruña"</span> <span class='op'>~</span> <span class='va'>latitude</span> <span class='op'>+</span> <span class='fl'>0.4</span>,         <span class='co'># Mover hacia arriba</span></span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Asturias"</span> <span class='op'>~</span> <span class='va'>latitude</span> <span class='op'>+</span> <span class='fl'>0.3</span>,        <span class='co'># Mover hacia arriba</span></span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Bizkaia"</span> <span class='op'>~</span> <span class='va'>latitude</span> <span class='op'>+</span> <span class='fl'>0.3</span>,          <span class='co'># Mover hacia arriba</span></span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Guadalajara"</span> <span class='op'>~</span> <span class='va'>latitude</span> <span class='op'>-</span> <span class='fl'>0.075</span> ,      <span class='co'># Mover hacia abajo</span></span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Lleida"</span> <span class='op'>~</span> <span class='va'>latitude</span> <span class='op'>+</span> <span class='fl'>0.2</span>,           <span class='co'># Mover hacia arriba</span></span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Barcelona"</span> <span class='op'>~</span> <span class='va'>latitude</span> <span class='op'>-</span> <span class='fl'>0.3</span>,        <span class='co'># Mover hacia el mar</span></span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Tarragona"</span> <span class='op'>~</span> <span class='va'>latitude</span> <span class='op'>-</span> <span class='fl'>0.15</span>,        <span class='co'># Mover hacia abajo</span></span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Valencia/València"</span> <span class='op'>~</span> <span class='va'>latitude</span> <span class='op'>-</span> <span class='fl'>0.2</span>,</span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Alacant/Alicante"</span> <span class='op'>~</span> <span class='va'>latitude</span> <span class='op'>-</span> <span class='fl'>0.1</span>,<span class='co'># Mover hacia abajo</span></span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Murcia"</span> <span class='op'>~</span> <span class='va'>latitude</span> <span class='op'>-</span> <span class='fl'>0.1</span>,          <span class='co'># Mover hacia abajo</span></span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Granada"</span> <span class='op'>~</span> <span class='va'>latitude</span> <span class='op'>-</span> <span class='fl'>0.1</span>,          <span class='co'># Mover hacia el sur</span></span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Cádiz"</span> <span class='op'>~</span> <span class='va'>latitude</span> <span class='op'>-</span> <span class='fl'>0.1</span>,            <span class='co'># Mover hacia el sur</span></span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Melilla"</span> <span class='op'>~</span> <span class='va'>latitude</span> <span class='op'>+</span> <span class='fl'>0.05</span>,         <span class='co'># Ajustar ligeramente</span></span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Cáceres"</span> <span class='op'>~</span> <span class='va'>latitude</span> <span class='op'>-</span> <span class='fl'>0.05</span>, </span>
<span>      <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Badajoz"</span> <span class='op'>~</span> <span class='va'>latitude</span> <span class='op'>-</span> <span class='fl'>0.2</span>, <span class='co'># Mover hacia arriba</span></span>
<span>      <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='va'>latitude</span></span>
<span>    <span class='op'>)</span></span>
<span>  <span class='op'>)</span></span></code></pre>
</div>
</div>
<p>The doughnut pie is the first layer since other pie charts are superposed to it.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>map_replica</span> <span class='op'>&lt;-</span> <span class='va'>map_replica</span> <span class='op'>+</span></span>
<span>    <span class='fu'>new_scale_fill</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>    <span class='fu'>geom_scatterpie</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>untidy_peninsula</span> <span class='op'>|&gt;</span>      <span class='co'># This wil only apply to the doughnut pie</span></span>
<span>                      <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span></span>
<span>                        <span class='va'>Province</span> <span class='op'>==</span> <span class='st'>"Tarragona"</span><span class='op'>)</span>,   </span>
<span>                    <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>longitude_moved</span>, y <span class='op'>=</span> <span class='va'>latitude_moved</span>, r <span class='op'>=</span> <span class='va'>radius</span><span class='op'>)</span>,</span>
<span>                    cols <span class='op'>=</span> </span>
<span>                      <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Hidráulica"</span>, <span class='st'>"Solar"</span>, <span class='st'>"Eólica"</span>, <span class='co'># The order of the concatenate gives us the order</span></span>
<span>                      <span class='st'>"Térmica renovable y otras"</span>,       <span class='co'># of the colors clockwise </span></span>
<span>                      <span class='st'>"Nuclear"</span>,</span>
<span>                      <span class='st'>"Carbón, fuelgas, ciclo combinado y cogeneración"</span><span class='op'>)</span>,</span>
<span>                    donut_radius <span class='op'>=</span> <span class='fl'>0.42</span>,</span>
<span>                    color <span class='op'>=</span> <span class='st'>"black"</span>, linewidth <span class='op'>=</span> <span class='fl'>0.3</span><span class='op'>)</span>    <span class='co'># This controls for the lines in the pie itself</span></span>
<span>  </span>
<span><span class='va'>map_replica</span></span></code></pre>
</div>
<p><img src="100564888_files/figure-html5/doughnut-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>map_replica</span> <span class='op'>&lt;-</span> <span class='va'>map_replica</span> <span class='op'>+</span></span>
<span>    <span class='fu'>geom_scatterpie</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>untidy_peninsula</span> <span class='op'>|&gt;</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>Province</span> <span class='op'>!=</span> <span class='st'>"Tarragona"</span><span class='op'>)</span>, </span>
<span>                    <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>longitude_moved</span>, y <span class='op'>=</span> <span class='va'>latitude_moved</span>, r <span class='op'>=</span> <span class='va'>radius</span><span class='op'>)</span>,</span>
<span>                    cols <span class='op'>=</span> </span>
<span>                      <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Hidráulica"</span>, <span class='st'>"Solar"</span>, <span class='st'>"Eólica"</span>, <span class='co'># The order gives us the order of the pie charts</span></span>
<span>                      <span class='st'>"Térmica renovable y otras"</span>,       <span class='co'># It is set clockwise, starting from 12  </span></span>
<span>                      <span class='st'>"Nuclear"</span>,</span>
<span>                      <span class='st'>"Carbón, fuelgas, ciclo combinado y cogeneración"</span><span class='op'>)</span>,</span>
<span>                    color <span class='op'>=</span> <span class='st'>"black"</span>, linewidth <span class='op'>=</span> <span class='fl'>0.3</span><span class='op'>)</span>    <span class='co'># This controls for the lines in the pie itself</span></span>
<span><span class='va'>map_replica</span></span></code></pre>
</div>
<p><img src="100564888_files/figure-html5/pie%20charts%20without%20right%20colours-1.png" width="624" /></p>
</div>
<p>legend 2</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'>font_add</span><span class='op'>(</span><span class='st'>"weezer"</span>, regular <span class='op'>=</span> <span class='st'>"weezerfont.ttf"</span><span class='op'>)</span> <span class='co'># needed font for the graph</span></span>
<span><span class='fu'>showtext_auto</span><span class='op'>(</span><span class='op'>)</span> </span>
<span></span>
<span><span class='va'>map_replica</span> <span class='op'>&lt;-</span> <span class='va'>map_replica</span> <span class='op'>+</span> </span>
<span>  <span class='fu'>scale_fill_manual</span><span class='op'>(</span></span>
<span>    values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>      <span class='st'>"Hidráulica"</span> <span class='op'>=</span> <span class='st'>"#a6d0e4"</span>,</span>
<span>      <span class='st'>"Solar"</span> <span class='op'>=</span> <span class='st'>"#ffd92e"</span>,</span>
<span>      <span class='st'>"Eólica"</span> <span class='op'>=</span> <span class='st'>"#4caf4a"</span>,</span>
<span>      <span class='st'>"Térmica renovable y otras"</span> <span class='op'>=</span> <span class='st'>"#fcb461"</span>,</span>
<span>      <span class='st'>"Nuclear"</span> <span class='op'>=</span> <span class='st'>"#fb8172"</span>,</span>
<span>      <span class='st'>"Carbón, fuelgas, ciclo combinado y cogeneración"</span> <span class='op'>=</span> <span class='st'>"#d4c0a0"</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    labels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>      <span class='st'>"Carbón, fuelgas, ciclo combinado y cogeneración"</span> <span class='op'>=</span> <span class='st'>"Carbón, fuelgas, ciclo\ncombinado y cogeneración"</span> </span>
<span>    <span class='op'>)</span>,</span>
<span>    name <span class='op'>=</span> <span class='cn'>NULL</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>guides</span><span class='op'>(</span>fill <span class='op'>=</span> <span class='fu'>guide_legend</span><span class='op'>(</span></span>
<span>    direction <span class='op'>=</span> <span class='st'>"vertical"</span>,           <span class='co'># Vertical legend</span></span>
<span>     label.position <span class='op'>=</span> <span class='st'>"right"</span>,         <span class='co'># Where each category is</span></span>
<span>    keywidth <span class='op'>=</span> <span class='fu'>unit</span><span class='op'>(</span><span class='fl'>0.3</span>, <span class='st'>"cm"</span><span class='op'>)</span>,         <span class='co'># This makes the legend wider</span></span>
<span>    keyheight <span class='op'>=</span> <span class='fu'>unit</span><span class='op'>(</span><span class='fl'>0.5</span>, <span class='st'>"cm"</span><span class='op'>)</span>,     <span class='co'># This makes the legend longer</span></span>
<span>  <span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>theme</span><span class='op'>(</span> </span>
<span>    legend.position <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.25</span>, <span class='fl'>0.395</span><span class='op'>)</span>,  <span class='co'># Position of the legend</span></span>
<span>    legend.background <span class='op'>=</span> <span class='fu'>element_blank</span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    legend.text <span class='op'>=</span> <span class='fu'>element_text</span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>10</span>,</span>
<span>                               family <span class='op'>=</span> <span class='st'>"weezer"</span><span class='op'>)</span>, <span class='co'># Text of the categories of the legends</span></span>
<span>    legend.key <span class='op'>=</span> </span>
<span>      <span class='fu'>element_rect</span><span class='op'>(</span>color <span class='op'>=</span> <span class='cn'>NA</span>, fill <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span>,     </span>
<span>    legend.key.spacing.y <span class='op'>=</span> <span class='fu'>unit</span><span class='op'>(</span><span class='fl'>0.1</span>, <span class='st'>"cm"</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>map_replica</span></span></code></pre>
</div>
<p><img src="100564888_files/figure-html5/legend%20pie%20chart%20colors-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>radios</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>    <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span>  <span class='fl'>209944.0</span> <span class='op'>/</span> <span class='va'>pi</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>0.00031</span>,</span>
<span>    <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span> <span class='fl'>1504064.7</span> <span class='op'>/</span> <span class='va'>pi</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>0.00031</span>,</span>
<span>    <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span> <span class='fl'>5135063.7</span> <span class='op'>/</span> <span class='va'>pi</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>0.00031</span>,</span>
<span>    <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='fl'>13223198.9</span> <span class='op'>/</span> <span class='va'>pi</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>0.00031</span>,</span>
<span>    <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='fl'>19186882.5</span> <span class='op'>/</span> <span class='va'>pi</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>0.00031</span>,</span>
<span>    <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='fl'>28178775.6</span> <span class='op'>/</span> <span class='va'>pi</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>0.00031</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>y_centers</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>40</span>, <span class='fl'>40.145</span>, <span class='fl'>40.32</span>, <span class='fl'>40.558</span>, <span class='fl'>40.7</span>, <span class='fl'>40.85</span><span class='op'>)</span> <span class='op'>+</span> <span class='fl'>0.5</span></span>
<span></span>
<span><span class='co'># Calcular donde está la parte de ARRIBA de cada círculo</span></span>
<span><span class='va'>y_tops</span> <span class='op'>&lt;-</span> <span class='va'>y_centers</span> <span class='op'>+</span> <span class='va'>radios</span></span>
<span></span>
<span><span class='co'># TODOS en la MISMA X, Y va subiendo</span></span>
<span></span>
<span><span class='co'># Datos para la leyenda</span></span>
<span><span class='va'>legend_data</span> <span class='op'>&lt;-</span> <span class='fu'>tibble</span><span class='op'>(</span></span>
<span>  MWh <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>210</span>, <span class='fl'>1.500</span>, <span class='fl'>5.000</span>, <span class='fl'>10.000</span>, <span class='fl'>20.000</span>, <span class='fl'>28.179</span><span class='op'>)</span>,</span>
<span>  radius <span class='op'>=</span> <span class='va'>radios</span>,</span>
<span>  x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>11.5</span>,  <span class='co'># ← TODOS la misma X</span></span>
<span>  y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>40</span>, <span class='fl'>40.145</span>, <span class='fl'>40.32</span>, <span class='fl'>40.558</span>, <span class='fl'>40.7</span>, <span class='fl'>40.85</span><span class='op'>)</span> <span class='op'>+</span> <span class='fl'>0.5</span>   <span class='co'># ← Valores fijos espaciados por 1 grado</span></span>
<span><span class='op'>)</span><span class='op'>|&gt;</span></span>
<span>  <span class='fu'>mutate</span><span class='op'>(</span></span>
<span>    <span class='co'># Punto en el borde derecho del círculo (donde Y = centro del círculo)</span></span>
<span>    x_start <span class='op'>=</span> <span class='va'>x</span> <span class='op'>+</span> <span class='va'>radius</span>,  <span class='co'># Borde derecho</span></span>
<span>    y_start <span class='op'>=</span> <span class='va'>y</span>            <span class='co'># Misma altura que el centro</span></span>
<span>  <span class='op'>)</span></span>
<span></span>
<span><span class='va'>map_replica</span> <span class='op'>&lt;-</span> </span>
<span>  <span class='va'>map_replica</span> <span class='op'>+</span> </span>
<span>  <span class='co'># Círculos (SIN línea vertical)</span></span>
<span>  <span class='fu'>geom_circle</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>legend_data</span>,</span>
<span>               <span class='fu'>aes</span><span class='op'>(</span>x0 <span class='op'>=</span> <span class='va'>x</span>, y0 <span class='op'>=</span> <span class='va'>y</span>, r <span class='op'>=</span> <span class='va'>radius</span><span class='op'>)</span>,</span>
<span>               color <span class='op'>=</span> <span class='st'>"#151d1c"</span>, fill <span class='op'>=</span> <span class='cn'>NA</span>, linewidth <span class='op'>=</span> <span class='fl'>0.3</span><span class='op'>)</span> <span class='op'>+</span></span>
<span><span class='fu'>geom_segment</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>legend_data</span>,</span>
<span>               <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, xend <span class='op'>=</span> <span class='op'>-</span><span class='fl'>11</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>radios</span><span class='op'>)</span> <span class='op'>+</span> <span class='fl'>0.3</span>,  <span class='co'># ← Mismo xend para todas</span></span>
<span>                   y <span class='op'>=</span> <span class='va'>y_tops</span>, yend <span class='op'>=</span> <span class='va'>y_tops</span><span class='op'>)</span>,                <span class='co'># ← yend = y (HORIZONTAL)</span></span>
<span>               linetype <span class='op'>=</span> <span class='st'>"dotted"</span>, linewidth <span class='op'>=</span> <span class='fl'>0.3</span>, color <span class='op'>=</span> <span class='st'>"#151d1c"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span><span class='fu'>geom_text</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>legend_data</span>,</span>
<span>          <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>radius</span><span class='op'>)</span> <span class='op'>+</span> <span class='fl'>0.4</span>, y <span class='op'>=</span> <span class='va'>y_tops</span>,</span>
<span>              label <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/format.html'>format</a></span><span class='op'>(</span><span class='va'>MWh</span>, big.mark <span class='op'>=</span> <span class='st'>"."</span>, decimal.mark <span class='op'>=</span> <span class='st'>","</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>          hjust <span class='op'>=</span> <span class='fl'>0</span>, size <span class='op'>=</span> <span class='fl'>4</span>, family <span class='op'>=</span> <span class='st'>"weezer"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span><span class='fu'>annotate</span><span class='op'>(</span><span class='st'>"text"</span>, x <span class='op'>=</span> <span class='op'>-</span><span class='fl'>11.05</span>, y <span class='op'>=</span> <span class='fl'>42.99</span>,</span>
<span>         label <span class='op'>=</span> <span class='st'>"PRODUCCIÓN DE ENERGÍA\nELÉCTRICA\n2014\n(en miles de MWh)"</span>,</span>
<span>         size <span class='op'>=</span> <span class='fl'>3.5</span>, hjust <span class='op'>=</span> <span class='fl'>0.5</span>, lineheight <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span></span>
<span><span class='va'>map_replica</span></span></code></pre>
</div>
<p><img src="100564888_files/figure-html5/legend%20pie%20charts-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>canary_islands</span> <span class='op'>&lt;-</span> <span class='fu'>ggplot</span><span class='op'>(</span><span class='va'>electricity_canary</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>geom_sf</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>variation_category</span><span class='op'>)</span>,</span>
<span>          color <span class='op'>=</span> <span class='st'>"black"</span>, size <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>theme_void</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>theme</span><span class='op'>(</span></span>
<span>    <span class='co'># plot.background = element_rect(fill = "#e6ffff", color = NA),</span></span>
<span>    plot.background <span class='op'>=</span> <span class='fu'>element_blank</span><span class='op'>(</span><span class='op'>)</span>,</span>
<span>    plot.margin <span class='op'>=</span> <span class='fu'>margin</span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span><span class='fu'>scale_fill_manual</span><span class='op'>(</span>                    </span>
<span>    values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>      <span class='st'>"&lt;50,1"</span> <span class='op'>=</span>         <span class='st'>"#e34a32"</span>,</span>
<span>      <span class='st'>"50,1 - 75,0"</span> <span class='op'>=</span>   <span class='st'>"#fd8d58"</span>,</span>
<span>      <span class='st'>"75,1 - 100,0"</span> <span class='op'>=</span>  <span class='st'>"#fcba84"</span>,</span>
<span>      <span class='st'>"100,1 - 150,0"</span> <span class='op'>=</span> <span class='st'>"#d9d9ea"</span>,</span>
<span>      <span class='st'>"150,1 - 200,0"</span> <span class='op'>=</span> <span class='st'>"#bcbcdc"</span>,</span>
<span>      <span class='st'>"200,1 - 300,0"</span> <span class='op'>=</span> <span class='st'>"#9e9ac7"</span>,</span>
<span>      <span class='st'>"300,1 - 600,0"</span> <span class='op'>=</span> <span class='st'>"#746ab1"</span>,</span>
<span>      <span class='st'>"&gt;1.000,0"</span> <span class='op'>=</span>      <span class='st'>"#54268f"</span><span class='op'>)</span>,</span>
<span>      name <span class='op'>=</span> </span>
<span>      <span class='st'>"VARIACIÓN 2004-2014</span></span>
<span><span class='st'>    2004=100</span></span>
<span><span class='st'>    "</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>guides</span><span class='op'>(</span>fill <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span></span>
<span>  </span>
<span><span class='va'>canary_islands</span></span></code></pre>
</div>
<p><img src="100564888_files/figure-html5/canary%20islands%20map-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>d</span> <span class='op'>&lt;-</span> <span class='fl'>0.15</span></span>
<span></span>
<span><span class='co'># Banda definida como un único polígono cerrado, trazando todo el perímetro</span></span>
<span><span class='va'>canary_band</span> <span class='op'>&lt;-</span> <span class='fu'>tibble</span><span class='op'>(</span></span>
<span>  x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='co'># Exterior (empezando arriba derecha, sentido antihorario)</span></span>
<span>        <span class='op'>-</span><span class='fl'>13.75</span>, <span class='op'>-</span><span class='fl'>14</span>, <span class='op'>-</span><span class='fl'>18.5</span>, <span class='op'>-</span><span class='fl'>18.5</span>, <span class='op'>-</span><span class='fl'>13.2</span>, <span class='op'>-</span><span class='fl'>13.2</span>, <span class='op'>-</span><span class='fl'>13.75</span>,</span>
<span>        <span class='co'># Esquina para cerrar y conectar con interior</span></span>
<span>        <span class='op'>-</span><span class='fl'>13.75</span>,</span>
<span>        <span class='co'># Interior (sentido horario)</span></span>
<span>        <span class='op'>-</span><span class='fl'>13.2</span> <span class='op'>-</span> <span class='va'>d</span>, <span class='op'>-</span><span class='fl'>13.2</span> <span class='op'>-</span> <span class='va'>d</span>, <span class='op'>-</span><span class='fl'>18.5</span> <span class='op'>+</span> <span class='va'>d</span>, <span class='op'>-</span><span class='fl'>18.5</span> <span class='op'>+</span> <span class='va'>d</span>, <span class='op'>-</span><span class='fl'>14</span>, <span class='op'>-</span><span class='fl'>13.75</span><span class='op'>)</span>,</span>
<span>  y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='co'># Exterior</span></span>
<span>        <span class='fl'>29.35</span>, <span class='fl'>29</span>, <span class='fl'>29</span>, <span class='fl'>27.5</span>, <span class='fl'>27.5</span>, <span class='fl'>29.35</span>, <span class='fl'>29.35</span>,</span>
<span>        <span class='co'># Conexión</span></span>
<span>        <span class='fl'>29.35</span> <span class='op'>+</span> <span class='va'>d</span>,</span>
<span>        <span class='co'># Interior</span></span>
<span>        <span class='fl'>29.35</span> <span class='op'>+</span> <span class='va'>d</span>, <span class='fl'>27.5</span> <span class='op'>+</span> <span class='va'>d</span>, <span class='fl'>27.5</span> <span class='op'>+</span> <span class='va'>d</span>, <span class='fl'>29</span> <span class='op'>+</span> <span class='va'>d</span>, <span class='fl'>29</span> <span class='op'>+</span> <span class='va'>d</span>, <span class='fl'>29.35</span> <span class='op'>+</span> <span class='va'>d</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>canary_box_outer</span> <span class='op'>&lt;-</span> <span class='fu'>tibble</span><span class='op'>(</span></span>
<span>  x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>13.75</span>, <span class='op'>-</span><span class='fl'>13.2</span>, <span class='op'>-</span><span class='fl'>13.2</span>, <span class='op'>-</span><span class='fl'>18.5</span>, <span class='op'>-</span><span class='fl'>18.5</span>, <span class='op'>-</span><span class='fl'>14</span>, <span class='op'>-</span><span class='fl'>13.75</span><span class='op'>)</span>,  </span>
<span>  y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>29.35</span>, <span class='fl'>29.35</span>, <span class='fl'>27.5</span>, <span class='fl'>27.5</span>, <span class='fl'>29</span>, <span class='fl'>29</span>, <span class='fl'>29.35</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>canary_box_inner</span> <span class='op'>&lt;-</span> <span class='fu'>tibble</span><span class='op'>(</span></span>
<span>  x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>13.75</span>, <span class='op'>-</span><span class='fl'>13.2</span> <span class='op'>-</span> <span class='va'>d</span>, <span class='op'>-</span><span class='fl'>13.2</span> <span class='op'>-</span> <span class='va'>d</span>, <span class='op'>-</span><span class='fl'>18.5</span> <span class='op'>+</span> <span class='va'>d</span>, <span class='op'>-</span><span class='fl'>18.5</span> <span class='op'>+</span> <span class='va'>d</span>, <span class='op'>-</span><span class='fl'>14</span>, <span class='op'>-</span><span class='fl'>13.75</span><span class='op'>)</span>,  </span>
<span>  y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>29.35</span> <span class='op'>+</span> <span class='va'>d</span>, <span class='fl'>29.35</span> <span class='op'>+</span> <span class='va'>d</span>, <span class='fl'>27.5</span> <span class='op'>+</span> <span class='va'>d</span>, <span class='fl'>27.5</span> <span class='op'>+</span> <span class='va'>d</span>, <span class='fl'>29</span> <span class='op'>+</span> <span class='va'>d</span>, <span class='fl'>29</span> <span class='op'>+</span> <span class='va'>d</span>, <span class='fl'>29.35</span> <span class='op'>+</span> <span class='va'>d</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>canary_islands</span> <span class='op'>&lt;-</span> <span class='va'>canary_islands</span> <span class='op'>+</span> </span>
<span>  <span class='fu'>geom_polygon</span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>canary_band</span>,</span>
<span>    <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span>,</span>
<span>    fill <span class='op'>=</span> <span class='st'>"#fffeff"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>geom_path</span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>canary_box_outer</span>,</span>
<span>    <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span>,</span>
<span>    colour <span class='op'>=</span> <span class='st'>"black"</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='fl'>0.3</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>geom_path</span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>canary_box_inner</span>,</span>
<span>    <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span>,</span>
<span>    colour <span class='op'>=</span> <span class='st'>"black"</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='fl'>0.3</span><span class='op'>)</span></span>
<span><span class='va'>canary_islands</span></span></code></pre>
</div>
<p><img src="100564888_files/figure-html5/unnamed-chunk-1-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>canary_islands</span> <span class='op'>&lt;-</span> <span class='va'>canary_islands</span> <span class='op'>+</span> </span>
<span>  <span class='fu'>new_scale_fill</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>geom_scatterpie</span><span class='op'>(</span></span>
<span>    data <span class='op'>=</span> <span class='va'>untidy_canary</span>, </span>
<span>    <span class='fu'>aes</span><span class='op'>(</span></span>
<span>      x <span class='op'>=</span> <span class='va'>longitude</span>,</span>
<span>      y <span class='op'>=</span> <span class='va'>latitude</span>,</span>
<span>      r <span class='op'>=</span> <span class='va'>radius</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    cols <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>      <span class='st'>"Hidráulica"</span>,</span>
<span>      <span class='st'>"Solar"</span>,</span>
<span>      <span class='st'>"Eólica"</span>,</span>
<span>      <span class='st'>"Térmica renovable y otras"</span>,</span>
<span>      <span class='st'>"Nuclear"</span>,</span>
<span>      <span class='st'>"Carbón, fuelgas, ciclo combinado y cogeneración"</span></span>
<span>    <span class='op'>)</span>,</span>
<span>    color <span class='op'>=</span> <span class='st'>"black"</span>,</span>
<span>    linewidth <span class='op'>=</span> <span class='fl'>0.3</span></span>
<span>  <span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>scale_fill_manual</span><span class='op'>(</span></span>
<span>    values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>      <span class='st'>"Hidráulica"</span> <span class='op'>=</span> <span class='st'>"#a6d0e4"</span>,</span>
<span>      <span class='st'>"Solar"</span> <span class='op'>=</span> <span class='st'>"#ffd92e"</span>,</span>
<span>      <span class='st'>"Eólica"</span> <span class='op'>=</span> <span class='st'>"#4caf4a"</span>,</span>
<span>      <span class='st'>"Térmica renovable y otras"</span> <span class='op'>=</span> <span class='st'>"#fcb461"</span>,</span>
<span>      <span class='st'>"Nuclear"</span> <span class='op'>=</span> <span class='st'>"#fb8172"</span>,</span>
<span>      <span class='st'>"Carbón, fuelgas, ciclo combinado y cogeneración"</span> <span class='op'>=</span> <span class='st'>"#d4c0a0"</span></span>
<span>    <span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'>guides</span><span class='op'>(</span>fill <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>canary_islands</span></span></code></pre>
</div>
<img src="100564888_files/figure-html5/canary%20islands%20pie%20charts-1.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>canary_islands</span> <span class='op'>&lt;-</span> <span class='fu'>ggplotGrob</span><span class='op'>(</span><span class='va'>canary_islands</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>map_replica</span> <span class='op'>&lt;-</span> <span class='va'>map_replica</span> <span class='op'>+</span></span>
<span>  <span class='fu'>annotation_custom</span><span class='op'>(</span><span class='va'>canary_islands</span>,</span>
<span>    xmin <span class='op'>=</span> <span class='op'>-</span><span class='fl'>13.45</span>,   </span>
<span>    xmax <span class='op'>=</span> <span class='op'>-</span><span class='fl'>6.63</span>,    </span>
<span>    ymin <span class='op'>=</span> <span class='fl'>34.65</span>,    </span>
<span>    ymax <span class='op'>=</span> <span class='fl'>36.8</span> <span class='op'>)</span></span>
<span><span class='va'>map_replica</span></span></code></pre>
</div>
<p><img src="100564888_files/figure-html5/add%20canary%20islands%20to%20the%20main%20map-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>map_replica</span> <span class='op'>&lt;-</span> <span class='va'>map_replica</span> <span class='op'>+</span> </span>
<span>  <span class='fu'>annotation_custom</span><span class='op'>(</span><span class='va'>variation_legend</span><span class='op'>)</span></span>
<span><span class='va'>map_replica</span></span></code></pre>
</div>
<p><img src="100564888_files/figure-html5/add%20legend%201-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># map_replica &lt;- </span></span>
<span><span class='va'>map_replica</span> <span class='op'>+</span></span>
<span><span class='fu'>annotate</span><span class='op'>(</span></span>
<span>  <span class='st'>"text"</span>,</span>
<span>  x <span class='op'>=</span> <span class='fl'>4.88</span>, y <span class='op'>=</span> <span class='fl'>44</span>,</span>
<span>  label <span class='op'>=</span> <span class='st'>"PRODUCCIÓN DE ENERGÍA ELÉCTRICA"</span>,</span>
<span>  size <span class='op'>=</span> <span class='fl'>6</span>, fontface <span class='op'>=</span> <span class='st'>"bold"</span>, hjust <span class='op'>=</span> <span class='fl'>1</span>, family <span class='op'>=</span> <span class='st'>"sans"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span><span class='fu'>annotate</span><span class='op'>(</span></span>
<span>  <span class='st'>"text"</span>,</span>
<span>  x <span class='op'>=</span> <span class='fl'>5.3</span>, y <span class='op'>=</span> <span class='fl'>35.3</span>,</span>
<span>  label <span class='op'>=</span> <span class='st'>"Fuente: Estadísticas Eléctricas Anuales. MINETAD"</span>,</span>
<span>  size <span class='op'>=</span> <span class='fl'>2.5</span>, hjust <span class='op'>=</span> <span class='fl'>1</span>, family <span class='op'>=</span> <span class='st'>"weezer"</span><span class='op'>)</span> <span class='op'>+</span></span>
<span></span>
<span><span class='fu'>annotate</span><span class='op'>(</span></span>
<span>  <span class='st'>"text"</span>,</span>
<span>  x <span class='op'>=</span> <span class='fl'>5.3</span>, y <span class='op'>=</span> <span class='fl'>34.95</span>,</span>
<span>  label <span class='op'>=</span> <span class='st'>"Elaborado por: Instituto Geográfico Nacional. Atlas Nacional de España"</span>,</span>
<span>  size <span class='op'>=</span> <span class='fl'>2.5</span>, hjust <span class='op'>=</span> <span class='fl'>1</span>, fontface <span class='op'>=</span> <span class='st'>"italic"</span>, family <span class='op'>=</span> <span class='st'>"weezer"</span><span class='op'>)</span></span></code></pre>
</div>
<img src="100564888_files/figure-html5/unnamed-chunk-2-1.png" width="624" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># map_replica</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://paleolimbot.github.io/ggspatial/'>ggspatial</a></span><span class='op'>)</span></span></code></pre>
</div>
</div>
Data preparation
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>spain_provinces_grid</span> <span class='op'>&lt;-</span> <span class='fu'>tibble</span><span class='op'>(</span></span>
<span>  name <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>    <span class='co'># row 1 </span></span>
<span>    <span class='st'>"A Coruña"</span>, <span class='st'>"Lugo"</span>, <span class='st'>"Asturias"</span>, <span class='st'>"Cantabria"</span>, <span class='st'>"Vizcaya"</span>, <span class='st'>"Álava"</span>, <span class='st'>"Guipúzcoa"</span>, <span class='st'>"Navarra"</span>, <span class='st'>"Huesca"</span>, <span class='st'>"Lleida"</span>, <span class='st'>"Girona"</span>,</span>
<span>    <span class='co'># row 2</span></span>
<span>    <span class='st'>"Pontevedra"</span>, <span class='st'>"Ourense"</span>, <span class='st'>"León"</span>, <span class='st'>"Palencia"</span>, <span class='st'>"Burgos"</span>, <span class='st'>"La Rioja"</span>, <span class='st'>"Zaragoza"</span>, <span class='st'>"Tarragona"</span>, <span class='st'>"Barcelona"</span>,</span>
<span>    <span class='co'># row 3 </span></span>
<span>    <span class='st'>"Zamora"</span>, <span class='st'>"Valladolid"</span>, <span class='st'>"Segovia"</span>, <span class='st'>"Soria"</span>, <span class='st'>"Teruel"</span>, <span class='st'>"Castellón"</span>,</span>
<span>    <span class='co'># row 4 </span></span>
<span>    <span class='st'>"Salamanca"</span>, <span class='st'>"Ávila"</span>, <span class='st'>"Madrid"</span>, <span class='st'>"Guadalajara"</span>, <span class='st'>"Cuenca"</span>, <span class='st'>"Valencia"</span>, <span class='st'>"Baleares"</span>,</span>
<span>    <span class='co'># row 5 </span></span>
<span>    <span class='st'>"Cáceres"</span>, <span class='st'>"Badajoz"</span>, <span class='st'>"Toledo"</span>, <span class='st'>"Ciudad Real"</span>, <span class='st'>"Albacete"</span>, <span class='st'>"Alicante"</span>,</span>
<span>    <span class='co'># row 6 </span></span>
<span>    <span class='st'>"Huelva"</span>, <span class='st'>"Sevilla"</span>, <span class='st'>"Córdoba"</span>, <span class='st'>"Jaén"</span>, <span class='st'>"Murcia"</span>,</span>
<span>    <span class='co'># row 7</span></span>
<span>    <span class='st'>"Cádiz"</span>, <span class='st'>"Málaga"</span>, <span class='st'>"Granada"</span>, <span class='st'>"Almería"</span>,</span>
<span>    <span class='co'># row 8</span></span>
<span>    <span class='st'>"Ceuta"</span>, <span class='st'>"Melilla"</span>, <span class='st'>"Las Palmas"</span>, <span class='st'>"Santa Cruz de Tenerife"</span><span class='op'>)</span>,</span>
<span>  code <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>    <span class='co'># row 1</span></span>
<span>    <span class='st'>"ACR"</span>, <span class='st'>"LUG"</span>, <span class='st'>"AST"</span>, <span class='st'>"CNT"</span>, <span class='st'>"VZC"</span>, <span class='st'>"ALA"</span>, <span class='st'>"GUI"</span>, <span class='st'>"NAV"</span>, <span class='st'>"HSC"</span>, <span class='st'>"LLE"</span>, <span class='st'>"GIR"</span>,</span>
<span>    <span class='co'># row 2</span></span>
<span>           <span class='st'>"PNT"</span>, <span class='st'>"OUR"</span>, <span class='st'>"LEO"</span>, <span class='st'>"PAL"</span>, <span class='st'>"BUR"</span>, <span class='st'>"RIO"</span>, <span class='st'>"ZAR"</span>, <span class='st'>"TAR"</span>, <span class='st'>"BAR"</span>,</span>
<span>    <span class='co'># row 3</span></span>
<span>                  <span class='st'>"ZAM"</span>, <span class='st'>"VLD"</span>, <span class='st'>"SEG"</span>, <span class='st'>"SOR"</span>, <span class='st'>"TER"</span>, <span class='st'>"CST"</span>,</span>
<span>    <span class='co'># row 4</span></span>
<span>                  <span class='st'>"SLM"</span>, <span class='st'>"AVL"</span>, <span class='st'>"MAD"</span>, <span class='st'>"GUA"</span>, <span class='st'>"CNC"</span>, <span class='st'>"VAL"</span>,               <span class='st'>"BAL"</span>,</span>
<span>    <span class='co'># row 5</span></span>
<span>                  <span class='st'>"CCR"</span>, <span class='st'>"BDJ"</span>, <span class='st'>"TOL"</span>, <span class='st'>"CRE"</span>, <span class='st'>"ALB"</span>, <span class='st'>"ALI"</span>,</span>
<span>    <span class='co'># row 6</span></span>
<span>                  <span class='st'>"HUE"</span>, <span class='st'>"SEV"</span>, <span class='st'>"COR"</span>, <span class='st'>"JAE"</span>, <span class='st'>"MUR"</span>,</span>
<span>    <span class='co'># row 7</span></span>
<span>                        <span class='st'>"CAD"</span>, <span class='st'>"MAL"</span>, <span class='st'>"GRA"</span>, <span class='st'>"ALM"</span>,</span>
<span>    <span class='co'># row 8</span></span>
<span>                        <span class='st'>"CEU"</span>, <span class='st'>"MEL"</span>,</span>
<span>    </span>
<span>                  </span>
<span>    <span class='st'>"LPA"</span>, <span class='st'>"TFE"</span>  </span>
<span>                  </span>
<span>  <span class='op'>)</span>,</span>
<span>  row <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>    <span class='co'># row 1</span></span>
<span>    <span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>1</span>, <span class='co'># 11 cols</span></span>
<span>    <span class='co'># row 2</span></span>
<span>    <span class='fl'>2</span>, <span class='fl'>2</span>, <span class='fl'>2</span>, <span class='fl'>2</span>, <span class='fl'>2</span>, <span class='fl'>2</span>, <span class='fl'>2</span>, <span class='fl'>2</span>, <span class='fl'>2</span>, <span class='co'># 9 cols</span></span>
<span>    <span class='co'># row 3</span></span>
<span>    <span class='fl'>3</span>, <span class='fl'>3</span>, <span class='fl'>3</span>, <span class='fl'>3</span>, <span class='fl'>3</span>, <span class='fl'>3</span>, <span class='co'># 6 cols</span></span>
<span>    <span class='co'># row 4</span></span>
<span>    <span class='fl'>4</span>, <span class='fl'>4</span>, <span class='fl'>4</span>, <span class='fl'>4</span>, <span class='fl'>4</span>, <span class='fl'>4</span>, <span class='fl'>4</span>, <span class='co'># 7 cols</span></span>
<span>    <span class='co'># row 5</span></span>
<span>    <span class='fl'>5</span>, <span class='fl'>5</span>, <span class='fl'>5</span>, <span class='fl'>5</span>, <span class='fl'>5</span>, <span class='fl'>5</span>, <span class='co'># 6 cols</span></span>
<span>    <span class='co'># row 6</span></span>
<span>    <span class='fl'>6</span>, <span class='fl'>6</span>, <span class='fl'>6</span>, <span class='fl'>6</span>, <span class='fl'>6</span>, <span class='co'># 5 cols</span></span>
<span>    <span class='co'># row 7</span></span>
<span>    <span class='fl'>7</span>, <span class='fl'>7</span>, <span class='fl'>7</span>, <span class='fl'>7</span>,  <span class='co'># 4 cols</span></span>
<span>    <span class='co'># row 9 </span></span>
<span>    <span class='fl'>9</span>, <span class='fl'>9</span>, <span class='fl'>9</span>, <span class='fl'>9</span> <span class='co'># 4 cols</span></span>
<span>  <span class='op'>)</span>,</span>
<span>  col <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span></span>
<span>    <span class='co'># row 1</span></span>
<span>    <span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>3</span>, <span class='fl'>4</span>, <span class='fl'>5</span>, <span class='fl'>6</span>, <span class='fl'>7</span>, <span class='fl'>8</span>, <span class='fl'>9</span>, <span class='fl'>10</span>, <span class='fl'>11</span>,</span>
<span>    <span class='co'># row 2</span></span>
<span>    <span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>3</span>, <span class='fl'>4</span>, <span class='fl'>5</span>, <span class='fl'>6</span>, <span class='fl'>7</span>, <span class='fl'>8</span>, <span class='fl'>9</span>,</span>
<span>    <span class='co'># row 3</span></span>
<span>    <span class='fl'>3</span>, <span class='fl'>4</span>, <span class='fl'>5</span>, <span class='fl'>6</span>, <span class='fl'>7</span>, <span class='fl'>8</span>,</span>
<span>    <span class='co'># row 4</span></span>
<span>    <span class='fl'>3</span>, <span class='fl'>4</span>, <span class='fl'>5</span>, <span class='fl'>6</span>, <span class='fl'>7</span>, <span class='fl'>8</span>, <span class='fl'>11</span>,</span>
<span>    <span class='co'># row 5</span></span>
<span>    <span class='fl'>3</span>, <span class='fl'>4</span>, <span class='fl'>5</span>, <span class='fl'>6</span>, <span class='fl'>7</span>, <span class='fl'>8</span>,</span>
<span>    <span class='co'># row 6</span></span>
<span>    <span class='fl'>3</span>, <span class='fl'>4</span>, <span class='fl'>5</span>, <span class='fl'>6</span>, <span class='fl'>7.5</span>,</span>
<span>    <span class='co'># row 7</span></span>
<span>    <span class='fl'>4</span>, <span class='fl'>5</span>, <span class='fl'>6</span>, <span class='fl'>7</span>,</span>
<span>    <span class='co'># row 8</span></span>
<span>    <span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>4</span>, <span class='fl'>6.5</span><span class='op'>)</span>,</span>
<span>  stringsAsFactors <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
