---
title: "China Dissent"
description: |
  We are going to represent The Economist's graph related to social dissent in China.
categories: "2022"
author: Gabriel Rodr√≠guez Molina
date: "`r Sys.Date()`"
output:
  distill::distill_article:
    self_contained: false
    toc: true
---


```{r}
library (distill)
library (tidyverse)
library (sf)
library(ggplot2)
library(ggtext)

chinacsv <- read_delim ("dissent.csv", delim=",", skip=0) 

chinadissent <- chinacsv %>% 
                  mutate (
                    code = case_when(
                      province %in%  c("Anhui") ~ "0" ,
                      province %in%  c("Fujian") ~ "1" ,
                      province %in%  c("Gansu") ~ "2" ,
                      province %in%  c("Guangdong") ~ "3" ,
                      province %in%  c("Guangxi") ~ "4" ,
                      province %in%  c("Guizhou") ~ "5" ,
                      province %in%  c("Hainan") ~ "6" ,
                      province %in%  c("Hebei") ~ "7" ,
                      province %in%  c("Heilongjiang") ~ "8" ,
                      province %in%  c("Henan") ~ "9" ,
                      province %in%  c("Hubei") ~ "10" ,
                      province %in%  c("Hunan") ~ "11" ,
                      province %in%  c("Inner Mongolia") ~ "12" ,
                      province %in%  c("Jiangsu") ~ "13" ,
                      province %in%  c("Jiangxi") ~ "14" ,
                      province %in%  c("Jilin") ~ "15" ,
                      province %in%  c("Liaoning") ~ "16" ,
                      province %in%  c("Shaanxi") ~ "17",
                      province %in%  c("Shandong") ~ "18",
                      province %in%  c("Shanxi") ~ "19",
                      province %in%  c("Sichuan") ~ "20",
                      province %in%  c("Tibet") ~ "21",
                      province %in%  c("Yunnan") ~ "22",
                      province %in%  c("Zhejiang") ~ "23",
                      province %in% c("Qinghai") ~ "24",
                      province %in% c("Xinjiang") ~ "25",
                      province %in% c("Ningxia") ~ "26"
                      )
                  )  %>% 
                  select(code) %>% 
                  mutate(across(c(code), as.numeric)) %>% 
                  count(code) %>% 
                  drop_na() 

china_map <- st_read("province.shp")

china_map1 <- china_map  %>% mutate (
                  code= case_when( 
                            NAME_PINGY %in% c("Anhui Sheng") ~ "0",
                            NAME_PINGY %in% c("Fujian Sheng") ~ "1",
                            NAME_PINGY %in% c("Gansu Sheng") ~ "2",
                            NAME_PINGY %in% c("Guangdong Sheng") ~ "3",
                            NAME_PINGY %in% c("Guangxizhuangzu Zizhiqu") ~ "4",
                            NAME_PINGY %in% c("Guizhou Sheng") ~ "5",
                            NAME_PINGY %in% c("Hainan Sheng") ~ "6",
                            NAME_PINGY %in% c("Hebei Sheng") ~ "7",
                            NAME_PINGY %in% c("Heilongjiang Sheng") ~ "8",
                            NAME_PINGY %in% c("Henan Sheng") ~ "9",
                            NAME_PINGY %in% c("Hubei Sheng") ~ "10",
                            NAME_PINGY %in% c("Hunan Sheng") ~ "11",
                            NAME_PINGY %in% c("Neimenggu Zizhiqu") ~ "12",
                            NAME_PINGY %in% c("Jiangsu Sheng") ~ "13",
                            NAME_PINGY %in% c("Jiangxi Sheng") ~ "14",
                            NAME_PINGY %in% c("Jilin Sheng") ~ "15",
                            NAME_PINGY %in% c("Liaoning Sheng") ~ "16",
                            NAME_PINGY %in% c("Shaanxi Sheng") ~ "17",
                            NAME_PINGY %in% c("Shandong Sheng") ~ "18",
                            NAME_PINGY %in% c("Shanxi Sheng") ~ "19",
                            NAME_PINGY %in% c("Sichuan Sheng") ~ "20",
                            NAME_PINGY %in% c("Xizang Zizhiqu") ~ "21",
                            NAME_PINGY %in% c("Yunnan Sheng") ~ "22",
                            NAME_PINGY %in% c("Zhejiang Sheng") ~ "23",
                            NAME_PINGY %in% c("Xinjiangweiwu'erzu Zizhiqu") ~ "25",
                            NAME_PINGY %in% c("Qinghai Sheng") ~ "24",
                            NAME_PINGY %in% c("Ningxiahuizu Zizhiqu") ~ "26"
                       ))   %>%
                      mutate(across(c(code), as.numeric)) %>% 
                            filter(NAME_PINGY != "Taiwan Sheng")
                            
join_map_data <-  china_map1 %>% left_join(chinadissent, by="code") 

join_map_data %>% ggplot() +
  geom_sf(aes(fill=n), color="white",lwd=0.2, )  + 
  coord_sf(ylim=c(-1.7e+06, 2e+06), xlim=(c(-2.45e+06, 2e+06)))+
labs(
    fill=quote(bold("By province")),
    title = quote(bold("Do you hear the people sing?")),
    subtitle =("<span style='font-size: 12pt; font-family:Calibri;'>China, number of protests</font><br>
                <span style='font-size: 10pt; font-family:Helvetica;'>May 18th-Oct 18th 2022</font><br><br><br><br>")
    ) + 
  theme(plot.title = element_text(size = rel(1.2), family="Calibri"),
        plot.subtitle = element_markdown(lineheight=1.5),
        plot.title.position = "plot",
        panel.background = element_blank(),
        panel.grid.major = element_blank(),
        legend.direction = "horizontal",
        legend.text = element_text(size=9, family="Helvetica"),
        legend.key.height = unit(0.2, 'cm'),
        legend.key.size = unit(0.9, 'cm'),
        legend.position = c(0.25,1.1),
        legend.title = element_text(size=11, family="Calibri"),
        axis.text = element_blank(),
        axis.ticks = element_blank()
        ) +
  guides(fill = guide_colorbar(title.position = "top"), colour = guide_legend(title.position= "right"))+
  scale_fill_binned(breaks = c(10, 20, 30, 40, 50),
                    low = "#C7E6FD", high = "#15346F", 
                    na.value="#d6d6d6",
                    limits=c(0, 60)
            )


```

##Second Plot
```{r}

china_data <- read_delim ("dissent.csv", delim=",", skip=0)


x <- c("Others", "Corruption", "State violence", "Fund withdrawal freeze", "Land rights", "Building disputes", "School disputes",
       "Fraud", "Pay and benefits",  "COVID-19 pandemic policies", "Delayed housing project")

china_data1 <- china_data %>% 
                transmute (
                  Issue=issue,
                  reason_dissent = case_when( 
                    issue %in% c("delayed housing project", "delayed housing project, building quality",
                              "delayed housing project, fraud","delayed housing project, project plan violation",
                              "delayed housing project, school district disputes") ~ "Delayed housing project",
                    issue %in% c("pay and benefits") ~ "Pay and benefits",
                    issue %in% c("fraud", "fraud, building quality", "fraud, contract breach", "fraud, corruption",
                              "fraud, investment disputes", "fraud, land rights", "fraud, land rights, corruption",
                              "fraud, property management disputes", "fraud, school district disputes",
                              "fraud, state violence", "fraud, state violence, corruption") ~ "Fraud",
                    issue %in% c("COVID-19 pandemic policies", "COVID-19 pandemic policies, censorship", 
                              "COVID-19 pandemic policies, pay and benefits",
                              "COVID-19 pandemic policies, political change",
                              "COVID-19 pandemic policies, state violence",
                              "COVID-19 pandemic policies, censorship, political change") ~ "COVID-19 pandemic policies",
                    issue %in% c("building quality", "building quality, illegal property handover",
                              "building quality, property pricing") ~ "Building disputes",
                    issue %in% c("school bullying", "school district disputes",
                              "school district disputes, building quality", 
                              "school district disputes, building quality, service and management Issues",
                              "school policy") ~ "School disputes",
                    issue %in% c("land rights", "land rights, corruption", "land rights, project plan violation") ~ "Land rights",
                    issue %in% c("fund withdrawal freeze", "fund withdrawal freeze, corruption") ~ "Fund withdrawal freeze",
                    issue %in% c("corruption", "corruption, abusing authority") ~ "Corruption",
                    issue %in% c("state violence", "state violence, land rights, corruption", 
                                 "state violence, verdict disputes") ~ "State violence",
                    issue %in% c("abusing authority", "agricultural rights","confiscation of assets",
                              "debt disputes", "drug safety", "environmental pollution or damage", 
                              "family policies", "missing persons","food safety", "forced eviction", "freedom of belief", 
                              "illegal property handover", "interior finish disputes", "occupational injury", 
                              "occupational safety", "personal safety", "petition rights", "political change", "poverty",
                              "project plan violation", "property management disputes", 
                              "property management disputes, environmental pollution or damage", 
                              "property pricing", "utility issues","verdict disputes", "video games", "censorship",
                              "investment disputes", "medical disputes", "contract breach", "family policies, missing persons",
                               "verdict disputes") ~ "Others"
                              )
                            ) %>% 
                    group_by(reason_dissent) %>%
                    count() %>%  
                    transmute(
                          reason_dissent = factor (reason_dissent, levels = x),
                          n_cases= n) %>%
                    arrange(reason_dissent) %>% 
                    drop_na()


  


final_plot <- ggplot(china_data1) +
  aes(n_cases, reason_dissent, aes(x = longitude*0.1)) +
  geom_col(fill="#15387A", width = 0.45)+
  labs(
    x=NULL,
    y=NULL,
    title=quote(bold("By reason for dissent")),
    caption = ("Source: Freedom's House China Dissent Monitor")
    )+
  scale_x_continuous(position = "top") +
  theme(plot.title = element_text(size = (8.5)),
        panel.background = element_blank(),
        panel.grid.major.x = element_line(color= "grey"),
        plot.title.position = "plot",
        axis.ticks= element_blank(),
        axis.text.y = element_text(hjust=0, size=7.7),
        aspect.ratio = 2.5,
        plot.caption = element_text(hjust = 2.45, size=7, color="grey"))


final_plot
```








