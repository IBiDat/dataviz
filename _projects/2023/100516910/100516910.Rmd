---
title: "Club Convergence Graphs"
description: |
  Visual representation of Convergence Clubs for European countries in terms of R&D spending following KMeans and Phillips&Sul methodologies.
categories: "2023"
author: Bernard Banyuls
date: "`r Sys.Date()`"
output:
  distill::distill_article:
    self_contained: false
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(out.width="100%", fig.align="center")
```

## Introduction

These project is divided in two parts following the idea of convergence clubs, the first part focuses on applying KMeans algorithm following the data that formal Beta-convergence uses, and the second part will be regarding the methodology proposed by Phillips and Sul to study the existence of Convergence Clubs.

The project does not focuses on how KMeans and ClubConvergence methodologies work but rather how we could replicate the graphs that different libraries show the results and its respective improvement or alternative representation.

## Data

The data used comes from the Eurostat database, and is the Research and Development spending per capita of European countries from 2005-200. In which for the KMeans representation we have the base value of 2005, and the growth in percentage terms in that range. For the case of club convergence we get the annual values of each country.

```{r}

library(ggplot2)
library(tidyverse)
kmeans <- data.frame(
  RD2005 = c(6.275703, 2.624669, 4.833102, 6.847262, 6.518114, 4.338597, 6.201928, 4.655863, 5.461711, 6.358016, 4.283587, 5.596568, 3.475067, 3.845883, 6.930886, 4.417635, 4.213608, 6.395762, 6.600143, 3.591818, 4.739701, 2.727853, 5.331268, 3.589059, 6.952059, 7.070979),
  Growth = c(0.92375108, 1.69681154, 1.16036030, 0.52391288, 0.63775027, 1.55277085, 0.62851413, 0.79388677, 0.34673183, 0.31490307, 0.75596008, 0.44273349, 1.21811383, 1.46337410, 0.09846755, 0.99757606, 0.90737537, 0.57252347, 0.62278834, 1.66619833, 1.01064686, 1.24432410, 0.84397491, 1.44594353, 0.18259257, 0.32154540),
  Classes = c(1, 0, 2, 1, 1, 2, 1, 2, 2, 1, 2, 2, 0, 0, 1, 2, 2, 1, 1, 0, 2, 0, 2, 0, 1, 1)
)

kmeans$Classes <- factor(kmeans$Classes)
```


## Methodology

### KMeans

[Simple explanation of KMeans algorithm]

### Club Convergence

[Simple explanation of ClubConvergence algorithm]

### Replication

## KMeans

### Original graph

![R&D spending per capita - Clustering. Source: Own elaboration.](kmeans.png){width="100%"}


### Replication 

```{r, fig.height=5, fig.width=12}
violet <- data.frame(x = c(2.1, 2.1, 3.2, 4.3), y = c(2, -1, -1, 2))
yellow <- data.frame(x = c(3.2, 4.3, 6.3, 5.5, 3.5), y = c(-1, 2, 2, -1, -1))
blue  <- data.frame(x = c(6.1, 5.3, 8, 8), y = c(2, -1, -1, 2))


ggplot(kmeans) +
  scale_y_continuous(breaks = c(0.2, 0.4, 0.6, 0.8, 1.0, 1.2, 1.4, 1.6), minor_breaks = NULL) +
  scale_x_continuous(breaks = c(3, 4, 5, 6, 7), minor_breaks = NULL)   + theme(axis.title = element_text(face ="italic", size=15))  + theme(
    legend.position = c(.95, .95),
    legend.justification = c("right", "top"),
    legend.box.just = "right",
    legend.margin = margin(6, 6, 6, 6)
    ) + theme(
  legend.position = c(0.99, 0.99),
  legend.justification = c("right", "top"),
  legend.box.just = "right",
  legend.margin = margin(11, 5, 5,11),
  legend.spacing.x = unit(0.8, "cm"), 
  legend.text = element_text(size = 16),
  legend.title = element_text(size = 15),
  legend.background = element_rect(fill = "#f0f6f7", size = 0.3, color ="gray")
) +   guides(color = guide_legend(override.aes = list(size = 8))) + 
  ggtitle("k-means with 3 cluster(s)") +
  theme(plot.title = element_text(hjust = 0.5, size=17)) + theme(legend.spacing.x = unit(0.5, 'cm')) + theme(legend.text.align = 0.5) +  theme(
  axis.line = element_blank(),      
  axis.text = element_blank(),     
  axis.ticks = element_blank(),      
  panel.grid.major = element_blank(),  
  panel.grid.minor = element_blank()   
) +  theme(axis.title = element_text(face ="italic", size=14, color = "black")) + labs(y = "RDGROWTH", x="RD2005") +
  coord_cartesian(xlim = c(min(kmeans$RD2005), max(kmeans$RD2005)), ylim = c(min(kmeans$Growth), max(kmeans$Growth))) +
  geom_polygon(aes(x = x, y = y), data = violet, fill = "#c1b0cb") +
  geom_polygon(aes(x = x, y = y), data = yellow, fill = "#eee9bf") +
  geom_polygon(aes(x = x, y = y), data = blue, fill = "#b8d3d8") + geom_point(aes(x = RD2005, y = Growth), color = "white", size = 7, shape = 16) +
  geom_point(aes(x = RD2005, y = Growth, color = Classes), size = 6, shape = 16) +
  geom_point(x = 3.3, y = 1.5, size = 18, color = "white", shape = 16) +
  geom_point(x = 3.3, y = 1.5, size = 10, color = "#440154", shape = 16) +
  geom_point(x = 4.8, y = 0.9, size = 18, color = "white", shape = 16) +
  geom_point(x = 4.8, y = 0.9, size = 10, color = "#fde725", shape = 16) +
  geom_point(x = 6.6, y = 0.52, size = 18, color = "white", shape = 16) +
  geom_point(x = 6.6, y = 0.52, size = 10, color = "#21918c", shape = 16) +
  scale_color_manual(values = c(
    "0" = "#440154",
    "1" = "#21918c", 
    "2" = "#fde725"))
```

### Alternative

```{r, fig.height=6, fig.width=12}
hacky_df <- data.frame(
  Classes = c(0,1,2),
  var_color = c("Class 0", "Class 1", "Class 2"))

ggplot(kmeans) + 
  geom_rect(
    data = hacky_df,
    aes(
      xmin = -Inf, xmax = Inf,
      ymin = 2.1, ymax = 2.6,     
      fill = var_color, alpha = 0.4
    )
  ) +     
  coord_cartesian(clip = "off", ylim = c(0, 2))  + 
  geom_point(aes(x = RD2005, y = Growth, color = factor(Classes)), size = 5) +  
  scale_color_manual(values = c(
    "0" = "#440154",
    "1" = "#21918c", 
    "2" = "#fde725"
  )) + 
  facet_wrap(~ factor(Classes, labels = c("Class 0", "Class 1", "Class 2")), ncol = 1 ) +
  scale_fill_manual(values = c("Class 0" = "#440154", "Class 1" = "#21918c", "Class 2" = "#fde725")) +
  theme_bw() +
  theme(
    strip.background = element_rect(fill = NA),
    strip.text = element_text(size = 12, face = "bold"),
    legend.position = "none",
    axis.text.x = element_text(color = "black", size = 12),
    axis.text.y = element_text(color = "black", size = 12),
    axis.title.x = element_text(color = "black", size = 14),
    axis.title.y = element_text(color = "black", size = 14),
    axis.ticks = element_line(color = "black")
  ) +   
  labs(
    title = "Kmeans with 3 cluster(s)",
    x = "RD2005",
    y = "Growth",
    subtitle = "European clusters in terms of R&D spending",
    caption = "Kmeans algorithm has been applied to EU countries in terms of the log of the R&D spending per capita and its respective growth from 2005-2020."
  ) 
```

