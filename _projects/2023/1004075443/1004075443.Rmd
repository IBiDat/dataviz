---
title: "The Demography of the World Population from 1950 to 2100"
description: |
  A short description of the post.
author: Daniel Pérez Gutiérrez
date: 2023-12-18
output:
  distill::distill_article:
    self_contained: false
    toc: true
---

```{r}
library(tidyverse)
library(tibble)
library(dplyr)
library(streamgraph)
library(ggplot2)
library(dplyr)
library(gganimate)
library(readxl)
#devtools::install_github("hrbrmstr/streamgraph")
#library(streamgraph)
library(ggstream)
library(cowplot)
library(extrafont)
#font_import()
#loadfonts()
#############################################################################################
########################################################################################################
#DATOS PREPARADOS
#data <- read_excel("datos_data_viz.xlsx")
# Construir la ruta al archivo Excel
ruta_excel <- "C:/Users/Daniel/Desktop/MUCSS/Data viz/PROJECT/datos_data_viz.xlsx"

# Leer el archivo Excel
data <- readxl::read_excel(ruta_excel)

#Pivot longer para pasar las columnas a una única variable Age
data2 <- data |> 
  pivot_longer(cols = c(2:102),
               names_to = "Age",
               values_to = "population")

data2 <- data2 |> 
  mutate(population = floor(as.numeric(population))) |> 
  mutate(Age =as.numeric(as.character(Age))) 


data2$Year <- as.factor(data2$Year)

data_male <- data2 |> 
  filter(sex == "Male")

data_female <- data2 |> 
  filter(sex == "Female")
#para ver si hay na
if (any(!complete.cases(data_female))) {
  print("Hay NA en el dataframe.")
} else {
  print("No hay NA en el dataframe.")
}
str(data2)
selected_years <- c(1950, 1960, 1970, 1980, 1990, 2018, 2050, 2075, 2100)
#############################################################################################
#############################################################################################

#GRAFICO
#############################################################################################
#############################################################################################
color_paleta <- c(
  "#3E5189",                  # 1 vez el primer término
  rep("#3371B7", times = 10),  # 10 veces el segundo término
  rep("#3B86B7", times = 10),  # 10 veces el tercer término
  rep("#48A0AA", times = 10),  # 10 veces el cuarto término
  rep("#52B6A3", times = 10),  # 10 veces el quinto término
  rep("#57C09F", times = 28),  # 28 veces el sexto término
  rep("#E6F07C", times = 32),  # 32 veces el séptimo término
  rep("#E2DB56", times = 25),  # 25 veces el octavo término
  rep("#EFDD56", times = 25)   # 25 veces el noveno término
)
color_paleta_invertido <- rev(color_paleta)

#PLOT MUJERES
plot_female <- ggplot(data_female, aes(x = Age, y = population, fill = forcats::fct_rev(Year))) +
  geom_area(position = "identity", alpha = 0.7) +
  geom_line(aes(color = "NotSelected", linetype = "NotSelected"),
            alpha = 0.1, size = 0.1) +
  geom_line(data = subset(data_female, Year %in% c(1950, 1960, 1970, 1980, 1990, 2018)),
            aes(color = "Selected", linetype = "Selected"),
            alpha = 1, size = 0.3, linetype = "solid") +
  geom_line(data = subset(data_female, Year %in% c(2050, 2075, 2100)),
            aes(color = "AdditionalSelected", linetype = "AdditionalSelected"),
            alpha = 1, size = 0.3, linetype = "dashed") +
  coord_flip() +
  theme_minimal(base_size = 14) +
  theme(legend.position = "none", plot.title = element_text(hjust = 0.5, size = 19, face = "bold"),
        axis.text.y = element_blank(), axis.title.y = element_blank(), axis.text.x = element_blank()) +
  scale_x_continuous(breaks = seq(0, 100, by = 10), limits = c(0, 102)) +
  scale_fill_manual(values = color_paleta_invertido) +
  scale_color_manual(values = c("NotSelected" = "#686351", "Selected" = "#686351", "AdditionalSelected" ="#686351")) +
  scale_linetype_manual(values = c("NotSelected" = "solid", "Selected" = "solid", "AdditionalSelected" = "dashed")) +
  geom_text(data = data.frame(x = 9.94307173536714, y = 28511.2785548616, label = "1950"),
            mapping = aes(x = x, y = y, label = label),
            size = 4.2, angle = -14L, hjust = 0.3, vjust = 1L,color = "#686351", inherit.aes = FALSE)+
  geom_text(data = data.frame(x = 18.0412115460575, y = 26490.5928372464, label = "1960"),
            mapping = aes(x = x, y = y, label = label),
            size = 4.2, angle = -14L, color = "#686351", inherit.aes = FALSE) +
  geom_text(data = data.frame(x = 29.1943328380169, y = 25480.2499784388 , label = "1970"),
            mapping = aes(x = x, y = y, label = label),
            size = 4.2, angle = -14L, hjust = 0.4, vjust = 1L, color = "#686351",inherit.aes = FALSE) +
  geom_text(data = data.frame(x = 39.238472992214, y = 25143.4690255029, label = "1980"),
            mapping = aes(x = x, y = y, label = label), 
            size = 4.2, angle = -14L, vjust = 1L,color = "#686351", inherit.aes = FALSE) +
  geom_text(data = data.frame(x = 49.6413296030791, y = 23571.8245784689, label = "1990"),
            mapping = aes(x = x, y = y, label = label),
            size = 4.2, angle = -14L, hjust = 0.35, vjust = 1L, color = "#686351", inherit.aes = FALSE)+
  geom_text(data = data.frame(x = 57.6527237837525, y = 40000, label = "2018"),
            mapping = aes(x = x, y = y, label = label),
            size = 4.2,angle = -14L, hjust = 1L, vjust = 0.35, color = "#686351", inherit.aes = FALSE) +
  geom_text(data = data.frame(x = 75.5416978407678, y = 37941.145237066, label = "2050"),
            mapping = aes(x = x, y = y, label = label),
            size = 4.2, angle = -12L, hjust = 0.45, vjust = 0.65, color = "#686351", inherit.aes = FALSE) +
  geom_text(data = data.frame(x = 82.5215256568887, y = 38165.6658723566, label = "2075"),
            mapping = aes(x = x, y = y, label = label),
            size = 4.2, angle = -13L, hjust = 0.25, vjust = 0.8,color = "#686351", inherit.aes = FALSE)+
  geom_text(data = data.frame(x = 87.3963251911341, y = 39400.5293664547, label = "2100"),
            mapping = aes(x = x, y = y, label = label),
            size = 4.2, angle = -14L, vjust = 1L,color = "#686351", inherit.aes = FALSE) +
  geom_text(data = data.frame(x = 0, y = 40000, label = "1950"),
            mapping = aes(x = x, y = y, label = label),
             size = 2.2, angle = -90L, hjust = 0, vjust = 0.8, color = "#3E5189", inherit.aes = FALSE) +
  geom_text(data = data.frame(x = 0, y =45500, label = "1960"),
            mapping = aes(x = 0, y = y, label = label),
            size = 2.2, angle = -90L, hjust = 0, vjust = 0.8, color = "#3371B7", inherit.aes = FALSE) +
  geom_text(data = data.frame(x = 0, y = 57567.0830381612, label = "1980"),
            mapping = aes(x = x, y = y, label = label),
            size = 2.2, angle = -90L, hjust = 0, vjust = 0.8, color = "#48A0AA",inherit.aes = FALSE)+
  geom_text(data = data.frame(x = 0, y = 55560.22486, label = "1970"),
            mapping = aes(x = x, y = y, label = label),
            size = 2.2, angle = -90L, hjust = 0, vjust = 0.8, color = "#3B86B7", inherit.aes = FALSE) +
  geom_text(data = data.frame(x = 0, y = 65296.5630636051, label = "1990"),
            mapping = aes(x = x, y = y, label = label),
            size = 2.2, angle = -90L, hjust = 0, vjust = 0.8, color = "#52B6A3", inherit.aes = FALSE) +
  geom_text(data = data.frame(x = 0, y = 65900.4237224363, label = "2050"),
            mapping = aes(x = x, y = y, label = label),
            size = 2.2, angle = -90L, hjust = 0, vjust = 0.8, color = "#E6F07C", inherit.aes = FALSE) +
  geom_text(data = data.frame(x = 0, y = 61007, label = "2075"),
            mapping = aes(x = x, y = y, label = label),
            size = 2.2, angle = -90L, hjust = 0, vjust = 0.8, color = "#E2DB56", inherit.aes = FALSE) +
  geom_text(data = data.frame(x = 0, y = 54350.0899600451, label = "2100"),
            mapping = aes(x = x, y = y, label = label),
            size = 2.2, angle = -90L, hjust = 0, vjust = 0.8, color = "#EFDD56", inherit.aes = FALSE) +
  geom_text(data = data.frame(x = 0, y = 66861.9360283455, label = "2018"),
            mapping = aes(x = x, y = y, label = label),
            size = 2.2, angle = -90L, hjust = 0, vjust = 0.8, color = "#57C09F", inherit.aes = FALSE) +
  geom_text(data = data.frame(x =0 , y = 29857.4288547544, label = "Women"),
            mapping = aes(x = x, y = y, label = label),
            size = 6, hjust =1L, vjust = 1L, color = "#4B4B4B", inherit.aes = FALSE) +
  geom_text(data = data.frame(x = 25 , y = 65700, label = "Median Age in 1950:"),
            mapping = aes(x = x, y = y, label = label),
            size = 1.6, hjust = 0L, vjust = 0.75, color = "#A3A3A3", inherit.aes = FALSE) +
 geom_text(data = data.frame(x = 23.6 , y = 65700, label = "23.6 years"),
          mapping = aes(x = x, y = y, label = label),
          size = 1.6, hjust = 0L, vjust = 0.75, color = "#A3A3A3", inherit.aes = FALSE) +
  geom_text(data = data.frame(x = 31.4  , y = 65700, label = "Median Age in 2018:"),
            mapping = aes(x = x, y = y, label = label),
            size = 1.6, hjust = 0L, vjust = 0.75, color = "#A3A3A3", inherit.aes = FALSE) +
  geom_text(data = data.frame(x = 30 , y = 65700, label = "30 years"),
            mapping = aes(x = x, y = y, label = label),
            size = 1.6, hjust = 0L, vjust = 0.75, color = "#A3A3A3", inherit.aes = FALSE) +
  geom_text(data = data.frame(x = 37.5  , y = 65700, label = "Median Age in 2050:"),
            mapping = aes(x = x, y = y, label = label),
            size = 1.6, hjust = 0L, vjust = 0.75, color = "#A3A3A3", inherit.aes = FALSE) +
  geom_text(data = data.frame(x = 36.1 , y = 65700, label = "36.1 years"),
            mapping = aes(x = x, y = y, label = label),
            size = 1.6, hjust = 0L, vjust = 0.75, color = "#A3A3A3", inherit.aes = FALSE) +
  geom_text(data = data.frame(x = 40.4  , y = 65700, label = "Median Age in 2075:"),
            mapping = aes(x = x, y = y, label = label),
            size = 1.6, hjust = 0L, vjust = 0.75, color = "#A3A3A3", inherit.aes = FALSE) +
  geom_text(data = data.frame(x = 39 , y = 65700, label = "39 years"),
            mapping = aes(x = x, y = y, label = label),
            size = 1.6, hjust = 0L, vjust = 0.75, color = "#A3A3A3", inherit.aes = FALSE) +
  geom_text(data = data.frame(x = 44.4  , y = 65700, label = "Median Age in 2100:"),
            mapping = aes(x = x, y = y, label = label),
            size = 1.6, hjust = 0L, vjust = 0.75, color = "#A3A3A3", inherit.aes = FALSE) +
  geom_text(data = data.frame(x = 43 , y = 65700, label = "41.6 years"),
            mapping = aes(x = x, y = y, label = label),
            size = 1.6, hjust = 0L, vjust = 0.75, color = "#A3A3A3", inherit.aes = FALSE) +
  geom_text(data = data.frame(x = 102, y = 10000, label = "10 Million"),
            mapping = aes(x = x, y = y, label = label),
            size = 3.4, color = "#949494", inherit.aes = FALSE)+
  geom_text(data = data.frame(x = 102, y = 20000, label = "20 Million"),
            mapping = aes(x = x, y = y, label = label),
            size = 3.4, color = "#949494", inherit.aes = FALSE)+
  geom_text(data = data.frame(x = 102, y = 30000, label = "30 Million"),
            mapping = aes(x = x, y = y, label = label),
            size = 3.4, color = "#949494", inherit.aes = FALSE)+
  geom_text(data = data.frame(x = 102, y = 40000, label = "40 Million"),
            mapping = aes(x = x, y = y, label = label),
            size = 3.4, color = "#949494", inherit.aes = FALSE)+
  geom_text(data = data.frame(x = 102, y = 50000, label = "50 Million"),
            mapping = aes(x = x, y = y, label = label),
            size = 3.4, color = "#949494", inherit.aes = FALSE)+
  geom_text(data = data.frame(x = 102, y = 60000, label = "60 Million"),
            mapping = aes(x = x, y = y, label = label),
            size = 3.4, color = "#949494", inherit.aes = FALSE)+
  geom_text(data = data.frame(x = 102, y = 70000, label = "70 Million"),
            mapping = aes(x = x, y = y, label = label),
            size = 3.4, color = "#949494", inherit.aes = FALSE)+

  labs(title = "", x = "", y = "", fill = "Año", color = "Línea destacada", linetype = "Discontinuity")

print(plot_female)

#PLOT HOMBRES
plot_male <- ggplot(data_male, aes(x = Age, y = -population, fill = forcats::fct_rev(Year))) +
  geom_area(position = "identity", alpha = 0.7) +
  geom_line(aes(color = "NotSelected", linetype = "NotSelected"),
            alpha = 0.1, size = 0.1) +
  geom_line(data = subset(data_male, Year %in% c(1950, 1960, 1970, 1980, 1990, 2018)),
            aes(color = "Selected", linetype = "Selected"),
            alpha = 1, size = 0.3, linetype = "solid") +
  geom_line(data = subset(data_male, Year %in% c(2050, 2075, 2100)),
            aes(color = "AdditionalSelected", linetype = "AdditionalSelected"),
            alpha = 1, size = 0.3, linetype = "dashed") +
  coord_flip() +
  theme_minimal(base_size = 14) +
  theme(legend.position = "none", plot.title = element_text(hjust = 0.5, size = 19, face = "bold"),
        axis.text.y = element_blank(), axis.title.y = element_blank(), axis.text.x = element_blank()) +
  scale_x_continuous(breaks = seq(0, 100, by = 10), limits = c(0, 102)) +
  scale_fill_manual(values = color_paleta_invertido) +
  scale_color_manual(values = c("NotSelected" = "#686351", "Selected" = "#686351", "AdditionalSelected" = "#686351")) +
  scale_linetype_manual(values = c("NotSelected" = "solid", "Selected" = "solid", "AdditionalSelected" = "dashed")) +
  geom_text(data = data.frame(x = 6.18998544147173, y = -30320.5198591813, label = "1950"),
            mapping = aes(x = x, y = y, label = label),
            size = 4.2, angle = 24L, hjust = 0.55, vjust = 0.6, color = "#686351", inherit.aes = FALSE) +
  geom_text(data = data.frame(x = 14.2745633982306, y = -31880.6425658543, label = "1960"),
            mapping = aes(x = x, y = y, label = label),
            size = 4.2, angle = 24L, hjust = 0.2, vjust = 0.45, color = "#686351", inherit.aes = FALSE) +
  geom_text(data = data.frame(x = 23.7762261259231, y = -31368.3552619391, label = "1970"),
            mapping = aes(x = x, y = y, label = label),
            size = 4.2,angle = 24L, hjust = 0.4,color = "#686351", inherit.aes = FALSE) +
  geom_text(data = data.frame(x = 33.7651553067948, y = -31496.4270879179, label = "1980"),
            mapping = aes(x = x, y = y, label = label),
            size =4.2, angle = 24L, vjust = 0.8,color = "#686351", inherit.aes = FALSE) +
  geom_text(data = data.frame(x = 41.8050242512531, y = -31624.4989138967, label = "1990"),
            mapping = aes(x = x, y = y, label = label),
            size = 4.2, angle = 24L, hjust = 0.40, vjust = 0.35, color = "#686351", inherit.aes = FALSE) +
  geom_text(data = data.frame(x = 58.8592950465282, y = -35210.5100413027, label = "2018"),
            mapping = aes(x = x, y = y, label = label),
            size= 4.2, angle = 27L, hjust = 0.5, vjust = 0.6, color = "#686351",inherit.aes = FALSE) +
  geom_text(data = data.frame(x = 72.8681580025912, y = -36107.0128231542, label = "2050"),
            mapping = aes(x = x, y = y, label = label),
            size = 4.2, angle = 25L, hjust = 0.35, vjust = 0.15, color = "#686351", inherit.aes = FALSE) +
  geom_text(data = data.frame(x = 80.7862113793117, y = -35978.9409971755, label = "2075"),
            mapping = aes(x = x, y = y, label = label),
            size = 4.2, angle = 18L, color = "#686351", inherit.aes = FALSE) +
  geom_text(data = data.frame(x = 85.6268864011455, y = -36812.4166584925, label = "2100"),
            mapping = aes(x = x, y = y, label = label),
            size = 4.2, angle = 20L, hjust = 0.4, vjust = 0.9, color = "#686351", inherit.aes = FALSE)+
  geom_text(data = data.frame(x = 0.0540647418287934, y = -41737.516021589, label = "1950"),
            mapping = aes(x = x, y = y, label = label),
            size = 2.2, angle = 90L, hjust = 1L,color = "#3E5189", inherit.aes = FALSE) +

  geom_text(data = data.frame(x = 0, y =-47403, label = "1960"),
            mapping = aes(x = 0, y = y, label = label),
            size = 2.2, angle = 90L, hjust = 1L, color = "#3371B7", inherit.aes = FALSE) +
  geom_text(data = data.frame(x = 0, y = -60601, label = "1980"),
            mapping = aes(x = x, y = y, label = label),
            size = 2.2, angle = 90L, hjust = 1L, color = "#48A0AA", inherit.aes = FALSE)+
  geom_text(data = data.frame(x = 0, y = -58589, label = "1970"),
            mapping = aes(x = x, y = y, label = label),
            size = 2.2, angle = 90L, hjust = 1L,color = "#3B86B7", inherit.aes = FALSE) +
  geom_text(data = data.frame(x = 0, y = -69485, label = "1990"),
            mapping = aes(x = x, y = y, label = label),
            size = 2.2, angle = 90L, hjust = 1L,color = "#52B6A3", inherit.aes = FALSE) +
  geom_text(data = data.frame(x = 0, y = -68360, label = "2050"),
            mapping = aes(x = x, y = y, label = label),
            size = 2.2, angle = 90L, hjust = 1L,color = "#E6F07C", inherit.aes = FALSE) +
  geom_text(data = data.frame(x = 0, y = -63507, label = "2075"),
            mapping = aes(x = x, y = y, label = label),
            size = 2.2, angle = 90L, hjust = 1L, color = "#E2DB56", inherit.aes = FALSE) +
  geom_text(data = data.frame(x = 0, y = -56524, label = "2100"),
            mapping = aes(x = x, y = y, label = label),
            size = 2.2, angle = 90L, hjust = 1L, color = "#EFDD56", inherit.aes = FALSE) +
  geom_text(data = data.frame(x = 0, y = -70891, label = "2018"),
            mapping = aes(x = x, y = y, label = label),
            size = 2.2, angle = 90L, hjust = 1L,color = "#57C09F", inherit.aes = FALSE) +
  geom_text(data = data.frame(x =0 , y = -29857.4288547544, label = "Men"),
            mapping = aes(x = x, y = y, label = label),
            size = 6, hjust =1L, vjust = 1L, color = "#4B4B4B", inherit.aes = FALSE) +
  geom_text(data = data.frame(x = 102, y = -10000, label = "10 Million"),
            mapping = aes(x = x, y = y, label = label),
            size = 3.4, color = "#949494", inherit.aes = FALSE)+
  geom_text(data = data.frame(x = 102, y = -20000, label = "20 Million"),
            mapping = aes(x = x, y = y, label = label),
            size = 3.4, color = "#949494", inherit.aes = FALSE)+
  geom_text(data = data.frame(x = 102, y = -30000, label = "30 Million"),
            mapping = aes(x = x, y = y, label = label),
            size = 3.4, color = "#949494", inherit.aes = FALSE)+
  geom_text(data = data.frame(x = 102, y = -40000, label = "40 Million"),
            mapping = aes(x = x, y = y, label = label),
            size = 3.4, color = "#949494", inherit.aes = FALSE)+
  geom_text(data = data.frame(x = 102, y = -50000, label = "50 Million"),
            mapping = aes(x = x, y = y, label = label),
            size = 3.4, color = "#949494", inherit.aes = FALSE)+
  geom_text(data = data.frame(x = 102, y = -60000, label = "60 Million"),
            mapping = aes(x = x, y = y, label = label),
            size = 3.4, color = "#949494", inherit.aes = FALSE)+
  geom_text(data = data.frame(x = 102, y = -70000, label = "70 Million"),
            mapping = aes(x = x, y = y, label = label),
            size = 3.4, color = "#949494", inherit.aes = FALSE)+
  geom_text(data = data.frame(x = 10, y = -73400, label = "10 years"),
            mapping = aes(x = x, y = y, label = label),
            size = 2.8, color = "#949494", inherit.aes = FALSE) +
  geom_text(data = data.frame(x = 20, y = -73400, label = "20 years"),
            mapping = aes(x = x, y = y, label = label),
            size = 2.8, color = "#949494", inherit.aes = FALSE)+
  geom_text(data = data.frame(x = 30, y = -73400, label = "30 years"),
            mapping = aes(x = x, y = y, label = label),
            size = 2.8, color = "#949494", inherit.aes = FALSE) +
  geom_text(data = data.frame(x = 40, y = -73400, label = "40 years"),
            mapping = aes(x = x, y = y, label = label),
            size = 2.8, color = "#949494", inherit.aes = FALSE)+
  geom_text(data = data.frame(x = 50, y = -73400, label = "50 years"),
            mapping = aes(x = x, y = y, label = label),
            size = 2.8, color = "#949494", inherit.aes = FALSE)+
  geom_text(data = data.frame(x = 60, y = -73400, label = "60 years"),
            mapping = aes(x = x, y = y, label = label),
            size = 2.8, color = "#949494", inherit.aes = FALSE)+
  geom_text(data = data.frame(x = 70, y = -73400, label = "70 years"),
            mapping = aes(x = x, y = y, label = label),
            size = 2.8, color = "#949494", inherit.aes = FALSE)+
  geom_text(data = data.frame(x = 80, y = -73400, label = "80 years"),
            mapping = aes(x = x, y = y, label = label),
            size = 2.8, color = "#949494", inherit.aes = FALSE)+
  geom_text(data = data.frame(x = 90, y = -73400, label = "90 years"),
            mapping = aes(x = x, y = y, label = label),
            size = 2.8, color = "#949494", inherit.aes = FALSE)+
  # Add other geom_text calls for data points as needed
  labs(title = "", x = "", y = "", fill = "Año", color = "Línea destacada", linetype = "Discontinuity")


combined_plot <- ggdraw() +
  draw_plot(plot_male + theme(panel.grid = element_blank()) +
              geom_hline(yintercept = 0, color = "black", size = 0.2, linetype = "solid", alpha = 0.2),
            x = 0.03, y = 0, width = 0.5, height = 1) +
  draw_plot(plot_female + theme(axis.text.y = element_blank(),
                                panel.grid = element_blank()) +
              geom_hline(yintercept = 0, color = "black", size = 0.2, linetype = "solid", alpha = 0.2),
            x = 0.47, y = 0, width = 0.5, height = 1)+
  draw_text("The Demography of the World Population from 1950 to 2100", x = 0.5, y = 0.96, size = 24, vjust = 0, hjust = 0.5, color = "#474747", family = "Times New Roman")+#, fontface = "italic") +
  draw_text("Shown is the age distribution of the world population - by sex - from 1950 to 2018 and the UN Population Division's projection until 2100.", x = 0.5, y = 0.93, size = 10, vjust = 0, hjust = 0.5, color = "#585858", fontface = "italic")+
  draw_text(
"Data source: United Nations Population, Division - World Population Prospects 2017; Medium Variant.
       The data visualization is available at OurWorldinData.org. where you find more research on how the world is changing and why.", x = 0.3, y = 0.02, size = 8, vjust = 0, hjust = 0.5, color = "#C9C9C9")
print(combined_plot)


###########################################################################################################
#ALTERNATIVE GRAPH
#DATA
data_mejora <- data |> 
  pivot_longer(cols = c(2:102),
               names_to = "Age",
               values_to = "population")

data_mejora <- data_mejora |> 
  filter(Year %in% c("1950", "1980", "2018", "2050", "2075", "2100"))

data_mejora <- data_mejora |> 
  mutate(Age = as.numeric(Age))
#PLOT
alternative_plot <- ggplot(data_mejora, aes(x = Age, y = population, color = sex)) +
  geom_line(size = 0.8) +
  facet_wrap(~Year, scales = "free_y", ncol = 2) +  
  labs(title = "Time series evolution",
       x = "Age",
       y = "Population",
       color = "Sex") +
  theme_minimal() +
  theme(legend.position = "top",      # Mover la leyenda arriba
        legend.title = element_blank(),  # Eliminar el título de la leyenda
        plot.title = element_text(hjust = 0.5, size = 18, face = "bold"),  # Centrar y ajustar el tamaño del título
        axis.title = element_text(size = 14),  # Ajustar el tamaño del título del eje
        axis.text = element_text(size = 12),   # Ajustar el tamaño del texto del eje
        strip.text = element_text(size = 12),  # Ajustar el tamaño del texto de las etiquetas de facetas
        panel.grid.major = element_line(color = "gray", linetype = "dashed"),  
        panel.grid.minor = element_blank(),  # Eliminar las líneas de cuadrícula secundarias
        aspect.ratio = 0.4,# Relación de aspecto cuadrada
        strip.background = element_rect(fill = "lightgray", color = "gray"),
        strip.text.x = element_text(face = "bold"))
print(alternative_plot)

```





