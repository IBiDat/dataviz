---
title: "With whom do we spend our time in 2020?"
description: |
  A short description of the post.
categories: "2023"
author: Eric Hausken-Brates
date: "`r Sys.Date()`" 
output:
  distill::distill_article:
    self_contained: false
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(out.width="100%", fig.align="center")
```

```{r load-libraries}
library(tidyverse)
```

## Original chart

I found this chart in an article called ["Who We Spend Time with as We Get Older"](https://flowingdata.com/2022/04/22/changing-who-we-spend-time-with-as-we-get-older/){.uri} by Nathan Yau. This article includes data from the American Time Use Survey from 2011 to 2019. Yau did not include 2020 data because they did not include a couple months due to the COVID-19 pandemic. 

The chart in **Figure 1** stood out because it had a lot of information broken down in static small multiples. The X-axis measures the age, from 15 to 80 years old, of the survey respondents. The Y-axis measures the percentage of respondents for each age group who spent time with the person titled in each bar chart. While the X-axis is fixed, the Y-axis is free so you cannot compare one chart to another. 

The point of overall chart, therefore, is to compare the distributions by age. The facets are sorted by peak age from youngest to oldest, meaning that "Parent" has a peak at minimum age. Meanwhile, the peak for "Neighbors or Acquaintances" is at the maximum age of 80, which is why its bar chart is positioned at the bottom right corner. 

Comparing the different charts, I noticed that the work-related facets, including co-workers, clients, managers, and customers

```{r echo=FALSE, fig.cap="Source: FlowingData", layout = 'l-body-outset', fig.align='center', out.extra="class=external"}
knitr::include_graphics("Screenshot.png")
```

## Replication

```{r load-data}
data <- read_csv("data.csv")

data$whofct <- forcats::fct_reorder(
  .f = data$who, data$Y, min
  ) 

glimpse(data)
```

### Color theme of the plot

To obtain the colors for the plot, I uploaded the screenshot of the plot to an online color generator. These are the codes for the four colors in the original article.

```{r color-theme}
colors <- c("#CCCCCC", "#A8A0D6", "#C4BA81", "#7AB486" )
```

```{r echo=FALSE, fig.cap="Color Theme", out.width = '50%', fig.align='center'}
color_table <- tibble(
  x = 1:4,
  y = c(1, 1, 1, 1),
  c = colors
)

color_theme <- color_table |> 
  ggplot(aes(rev(x), y, fill = factor(x), label = colors )) +
  geom_col() +
  geom_text(aes(y = .5), size = 7, family = "Menlo") +
  scale_fill_manual(values = colors, guide = "none") +
  theme_void() +
  coord_flip()

ggsave(filename = "Color_theme.png", 
       plot = color_theme, 
       width = unit(5, "in"), 
       height = unit(5, "in") 
)

knitr::include_graphics("Color_theme.png")
```

## Annotations

I created a table for the annotations.

```{r annotatations, echo=FALSE}
annotations <- tribble(~x, ~y, ~whofct, ~label, ~category, ~hj,
                       20, .11, "Alone", "Most people get some alone\ntime during a day.", "Alone", 0,
                       20, .017, "Grandchild", "Grandkids\n\tenter the\n\t\tpicture.", "Family", 0,
                       50, .2, "Own household child", "Kids enter\n\tthe picture.", "Family", 0,
                       85, .015, "Co-Worker", "Gotta pay\nthe bills.", "Work", 1,
                       85, .1, "Parent", "While young, we commonly\nspend time with\nimmediate family.", "Family", 1,
                       85, .03, "Friends", "Time with friends\nis also most common\nat a younger age.", "Friend", 1
)

annotations$whofct <- factor(annotations$whofct)
```

```{r replication-plot}
plt <- data |> 
  ggplot(aes(x = TEAGE, y = p, fill = category)) +
  geom_col(
    width = .8, 
  ) +
  geom_hline(yintercept = 0, linewidth = .4) +
  
  # geom text 
  geom_text(data = annotations, 
            aes(x = x, y = y, label = label), 
            color = "gray10",
            size = 3,
            family = "Publico Text",
            fontface = "italic",
            hjust = annotations$hj, 
            vjust = 1
  ) +
  
  # facet wrap
  facet_wrap(
    ~ whofct , scales = "free", ncol = 5, 
  ) +
  
  theme_void() +
  labs(
    
    # TITLES 
    title = "WHO WE SPEND TIME WITH, BY AGE",
    subtitle = "Sorted by peak age from youngest to oldest.",
    caption = "Created by Eric Hausken | Data source: American Time Use Survey 2020\n
    Chart inspired by: FlowingData",
    x = "YEARS OLD"
    ) +
  
  theme(
    
    # axis settings
    axis.text = element_text(
      family = "Menlo", size = 6, color = "gray30"
      ),
    axis.ticks = element_line(
      color = "gray30"
      ),
    axis.ticks.length = unit(-1.0, "mm"),
    
    # spacing
    panel.spacing.x = unit(4, "mm"),
    plot.margin = margin(4, 4, 4, 4, "mm"), 
    panel.spacing.y = unit(1, "mm"),
    
    # strip/facet placement and text
    strip.text = element_text(
      family = "Menlo", hjust = 0.3, vjust = -.2,  
      size = 10, face = "bold"),
    strip.clip = "off", 
    
    #  colors 
    plot.background = element_rect(fill = "white"), 
    legend.position = "none",
    
    
    # plot titles 
    plot.title = element_text(
      family = "Optima", size = 18, 
      hjust = 0.5, margin = margin(4,4,1,4, "mm")
    ), 
    plot.title.position = "plot", 
    plot.subtitle = element_text(
      size = 12, margin = margin(1,4,4,4, "mm"), 
      family = "Publico Text", hjust = 0.5),
    plot.caption = element_text(
      family = "Menlo", color = "gray30", 
      size = 6, margin = margin(8,0,0,0, unit = "mm"))
    
  ) +
  scale_y_continuous(
    label = scales::label_percent(accuracy = .1)
  ) +
  scale_fill_manual(
    values = colors 
  )
```

```{r save-replication}
ggsave(filename = "Replication_plot.png", 
       plot = plt, 
       width = unit(11, "in"), 
       height = unit(8, "in") 
)
```

```{r echo=FALSE, fig.cap="Replication", layout = 'l-body-outset', preview =TRUE, fig.align='center'}

knitr::include_graphics("Replication_plot.png")
```

## Enhanced version

```{r enhanced-plot}
plt_2 <- data |> 
  ggplot(
      aes(x = TEAGE, y = p, fill = p)) +
  geom_col(width = .8) +
  geom_hline(yintercept = 0, linewidth = .4) +
  
  # facet wrap
  facet_wrap(
    ~ whofct , scales = "free", ncol = 5, 
  ) +
  
  theme_void() +
  labs(
    
    # TITLES 
    title = "WHO WE SPEND TIME WITH, BY AGE",
    subtitle = "Sorted by peak age from youngest to oldest.
    Color coded by percentage.",
    caption = "Created by Eric Hausken | Data source: American Time Use Survey 2020\n
    Chart inspired by: FlowingData") +
  
  theme(
    
    # axis settings
    axis.text = element_text(
      family = "Menlo", size = 6, color = "gray30"),
    axis.ticks = element_line(color = "gray30"),
    axis.ticks.length = unit(-1.0, "mm"),
    
    # spacing
    panel.spacing.x = unit(4, "mm"),
    plot.margin = margin(4, 4, 4, 4, "mm"), 
    panel.spacing.y = unit(1, "mm"),
    
    # strip/facet placement and text
    strip.text = element_text(
      family = "Menlo", hjust = 0.3, vjust = -.2,  
      size = 10, face = "bold"),
    strip.clip = "off", 
    
    #  colors 
    plot.background = element_rect(fill = "white"), 
    
    # legend 
    legend.position = c(.95, 0.08),
    legend.justification = 1,
    legend.direction = "vertical",
    legend.title = element_text(size = 8, family = "Menlo"),
    legend.text = element_text(size = 6, family = "Menlo" ),
    legend.title.align = 1,
    legend.key.height = unit(.15, "in"),
    
    # plot titles 
    plot.title = element_text(
      family = "Optima", size = 18, 
      hjust = 0.5, margin = margin(4,4,1,4, "mm")
    ), 
    plot.title.position = "plot", 
    plot.subtitle = element_text(
      size = 12, margin = margin(1,4,4,4, "mm"), 
      family = "Publico Text", hjust = 0.5),
    plot.caption = element_text(
      family = "Menlo", color = "gray30", size = 6, 
      margin = margin(8,0,0,0, unit = "mm"))
    
  ) +
  scale_y_continuous(
    label = scales::label_percent(accuracy = .1),
  ) +
  scale_fill_gradient2(
    low = colors[2], mid = colors[3], high = colors[4], 
    midpoint = .1,
    guide = guide_colorbar(
    title.position = "left",
    title = "Percentage\nPoints"),
    labels = c("0.0%", "20.0%", "40.0%", "60.0%"),
    breaks = c(0, .2, .4, .6)
  ) 
  
ggsave(filename = "Enhanced_version_plot.png", 
       plot = plt_2, 
       width = unit(11, "in"), 
       height = unit(8, "in") )
```

```{r echo=FALSE, fig.cap="Enhanced version", layout = 'l-body-outset', fig.align='center'}

knitr::include_graphics("Enhanced_version_plot.png")

```

> R code inspired by: Henrick Lindberg
