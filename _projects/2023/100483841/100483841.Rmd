---
title: "Population Perspectives"
description: |
  "A graph about population in 2017 and 2100 will be replicated and an alternative way of visualizing this graph will be presented"
author: Victoria Costas Salamanca
date = date: "`r Sys.Date()`"
output:
  distill::distill_article:
    self_contained: false
    toc: true
---
```{r}
#Libraries needed
library(tidyverse)
library(ggalluvial)
library(ggplot2)
library(ggrepel)
library(extrafont)
library(showtext)
library(ggtext)
library(htmlwidgets)
library(ggbump)
```

## Dataframe


```{r}
#Create my database:

#To use with the population
B = 10^9 #Billion
M = 10^6 #Million

year <- rep(c(2017, 2100), 15)
population <- c(1.4 * B, 732 * M, 1.38 * B, 1.09 * B, 325 * M, 336 * M, 258 * M,
                229 * M, 214 * M, 248 * M, 212 * M, 165 * M, 206 * M, 791 * M, 
                157 * M, 81 * M, 146 * M, 106 * M, 128 * M, 60 * M, 112*M, 170*M, 103 * M,
                223 * M, 96 * M, 199 * M, 81 * M, 246 * M, 54 * M, 186 * M)
country <- c("China", "China","India", "India", "U.S", "U.S",
             "Indonesia", "Indonesia", "Pakistan", "Pakistan",
             "Brazil", "Brazil", "Nigeria", "Nigeria", "Bangladesh", 
             "Bangladesh", "Russia", "Russia", "Japan", "Japan", "VIRTUAL", "VIRTUAL",
             "Ethiopia", "Ethiopia", "Egypt", "Egypt", "DRC", "DRC",
             "Tanzania", "Tanzania")
group_colors <- c(China = "#009ee5", India = "#0973cb", U.S = "#384aae",
                Indonesia = "#603c9c", Pakistan = "#893e9b", Brazil ="#be388f", 
                Nigeria = "#e75c93", Bangladesh = "#e53e48", Russia = "#f96439",
                Japan = "#f78c24", VIRTUAL = "#FFFFFF", Ethiopia = "#f5b314", Egypt = "#98b245", 
                DRC ="#40b87b", Tanzania = "#25a99b")
ranking <- c( 15, 13, 14, 15, 13, 12, 12, 9, 11, 11, 10, 4, 9, 14, 8, 2, 7, 3, 6, 1,
              5, 5, 4, 8, 3, 7, 2, 10, 1, 6)

#Create dataframe
df <- data.frame(x = year,
                 y = population,
                 group = country)
x <- df$x
y<- df$y


```


## Annotations, text and labels


```{r}
#Needed to use "Constantia" Font
windowsFonts("Constantia" = windowsFont("Constantia"))

#Schema of the graph, data and geoms
ggplot(df) +
  aes(x=x, y=population, alluvium=group, fill=group) +
  geom_alluvium(decreasing=FALSE, alpha=1, width=30, show.legend = FALSE) +
  scale_fill_manual(values = group_colors) +
  theme(legend.position = "none")+
  xlim(min(x) - 130, max(x) + 130) + 
  ylim(min(y) - 0.1e9, max(y) + 3.7e9) +
  theme_void()


```

## Alternative graph: daframe creation


```{r}
#Create the dataset
ranking <- c( 1, 2,3,4,5,6,7,8,9,10,3,13,14,18,24,1,4,7, 5, 13, 2,25, 19, 
              38, 8, 9, 6,10)

group_colors <- c(China = "#009ee5", India = "#0973cb", U.S = "#384aae", Indonesia = "#603c9c", Pakistan = "#893e9b", Brazil ="#be388f",
                  Nigeria = "#e75c93", Bangladesh = "#e53e48", Russia = "#f96439", Japan = "#f78c24", Ethiopia = "#f5b314",
                  Egypt = "#98b245", DRC ="#40b87b", Tanzania = "#25a99b", China = "#009ee5", India = "#0973cb", U.S = "#384aae",  Indonesia = "#603c9c",  Pakistan = "#893e9b",  
                  Brazil ="#be388f",  Nigeria = "#e75c93", Bangladesh = "#e53e48", Russia = "#f96439",
                  Japan = "#f78c24", Ethiopia = "#f5b314", Egypt = "#98b245", DRC ="#40b87b", Tanzania = "#25a99b")

variation <- c(-47.1, -21.01, 3.38, -11.24, 15.89, -22.17, 293.98,
               -48.41, -27.4, -53.13, 116.5, 107.29, 203.7, 244.44) #From the data on top

country1 <- c("China","India", "U.S", "Indonesia","Pakistan",
             "Brazil", "Nigeria", "Bangladesh", "Russia", "Japan",
             "Ethiopia", "Egypt","DRC", "Tanzania")


# Create a data frame with the country names, variation values, and group colors
df <- data.frame(country1, variation, group_colors, ranking)

# Reorder the rows of the data frame based on the variation values and establish categories
df <- df[order(df$variation), ]
df$pos_neg <- ifelse(df$variation < 0, "negative", "positive")

#Plotting completely the graph
ggplot(df) +
  aes(x=x, y=population, alluvium=group, fill=group) +
  #geom_alluvium in order to stack the lines
  geom_alluvium(decreasing=FALSE, alpha=1, width=30, show.legend = FALSE) +
  scale_fill_manual(values = group_colors) +
  theme(legend.position = "none")+
  #establish limits
  xlim(min(x) - 130, max(x) + 130) + 
  ylim(min(y) - 0.1e9, max(y) + 3.7e9) +
  theme_void() +
  geom_curve(x = 2003, y = 0.40e9, xend = 2114, yend = 0.5e9, linetype="dashed", color = "black", size = 0.5, angle = 20, curvature = 0) +
  #adding labels and text
  labs(title = "Here's how IHME projects the most populous \n countries will change by 2100.",
      subtitle = "Top 10 Countries \n by Population") +
  theme(text = element_text(family = "Constantia"),
        plot.subtitle = element_text(hjust = 0.5, size = 35, face = "bold"),  # Center subtitle
        plot.title = element_text(hjust = 0.5, size = 16)) +
    annotate("text", x=2025, y = max(y) + 3.65e9, label = "2017", size = 4) +
    annotate("text", x=2090, y = max(y) + 3.65e9, label = "2100", size = 4) +
  annotate("richtext", x=1988, y = 4.10e9, label = "<span style='color: #009ee5; '>#1</span> China <span style='font-size: 20px '><b>1.4B</b></span>", 
           fill = NA, label.color = NA)+
  annotate("richtext", x=1988, y = 2.75e9, label = "<span style='color: #0973cb; '>#2</span> India <span style='font-size: 20px '><b>1.38B</b></span>", 
           fill = NA, label.color = NA)+
  annotate("richtext", x=1992, y = 1.90e9, label = "<span style='color: #384aae;font-size: 10px '>#3</span> <span style='font-size: 10px '> U.S.<b>325M</b></span>", 
           fill = NA, label.color = NA) +
  annotate("richtext", x=1989, y = 1.65e9, label = "<span style='color: #603c9c;font-size: 10px '>#4</span> <span style='font-size: 10px '> Indonesia <b>258M</b></span>", 
           fill = NA, label.color = NA) +
  annotate("richtext", x=1989, y = 1.40e9, label = "<span style='color: #893e9b;font-size: 10px '>#5</span> <span style='font-size: 10px '> Pakistan <b>214M</b></span>", 
           fill = NA, label.color = NA) +
  annotate("richtext", x=1991, y = 1.20e9, label = "<span style='color: #be388f;font-size: 10px '>#6</span> <span style='font-size: 10px '> Brazil <b>212M</b></span>", 
           fill = NA, label.color = NA) +
  annotate("richtext", x=1991, y = 1e9, label = "<span style='color: #e75c93;font-size: 10px '>#7</span> <span style='font-size: 10px '> Nigeria <b>206M</b></span>", 
           fill = NA, label.color = NA) +
  annotate("richtext", x=1988, y = 0.80e9, label = "<span style='color: #e53e48;font-size: 10px '>#8</span> <span style='font-size: 10px '> Bangladesh <b>157M</b></span>", 
           fill = NA, label.color = NA) +
  annotate("richtext", x=1990, y = 0.65e9, label = "<span style='color: #f96439;font-size: 10px '>#9</span> <span style='font-size: 10px '> Russia <b>146M</b></span>", 
           fill = NA, label.color = NA) +
  annotate("richtext", x=1989, y = 0.50e9, label = "<span style='color: #f78c24;font-size: 10px '>#10</span> <span style='font-size: 10px '> Japan <b>128M</b></span>", 
           fill = NA, label.color = NA) +
  annotate("richtext", x=1989, y = 0.30e9, label = "<span style='color: #f5b314;font-size: 10px '>#13</span> <span style='font-size: 10px '> Ethiopia <b>103M</b></span>", 
           fill = NA, label.color = NA) +
  annotate("richtext", x=1991, y = 0.20e9, label = "<span style='color: #98b245;font-size: 10px '>#14</span> <span style='font-size: 10px '> Egypt <b>96M</b> </span>", 
           fill = NA, label.color = NA) +
  annotate("richtext", x=1991, y = 0.10e9, label = "<span style='color: #40b87b;font-size: 10px '>#18</span> <span style='font-size: 10px '> DRC <b>81M</b></span>", 
           fill = NA, label.color = NA) +
  annotate("richtext", x=1989, y = 0, label = "<span style='color: #25a99b;font-size: 10px '>#24</span> <span style='font-size: 10px '> Tanzania <b>54M</b></span>", 
           fill = NA, label.color = NA) +
  
  annotate("richtext", x=2122, y = 45e8, label = "<span style='font-size: 14px'><b>1.09B</b></span>", fill = NA, label.color = NA) +
  annotate("richtext", x=2133, y = 42e8, label = "<span style='text-align: left; font-size: 10px'><span style='color: #009ee5;'>#1 </span><b>India</b> emerges at the top<br>of the leaderboard, despite<br>an overall decline in numbers.</span>", 
           fill = NA, label.color = NA) +
  annotate("richtext", x=2121, y = 36.5e8, label = "<span style='font-size: 14px'><b>791M</b></span>", 
           fill = NA, label.color = NA) +
  annotate("richtext", x=2133.5, y = 33e8, label = "<span style='text-align: left; font-size: 10px'><span style='color: #e75c93;'>#2 </span><b>Nigeria</b> leads Sub-Saharan<br>Africa as the only region that<br>will continue to see population<br>growth in 2100.</span>", 
           fill = NA, label.color = NA) +
  annotate("richtext", x=2121, y = 28e8, label = "<span style='font-size: 14px'><b>732M</b></span>", 
           fill = NA, label.color = NA) +
  annotate("richtext", x=2132, y = 25e8, label = "<span style='text-align: left; font-size: 10px'><span style='color: #384aae;'>#3 </span><b>China's</b> total population<br>will contract by almost<br>half by 2100.</span>", 
           fill = NA, label.color = NA) +
  annotate("richtext", x=2124.5, y = 20.7e8, label = "<span style='font-size: 10px '><span><b>336M</b></span> U.S. <span style='color: #384aae;'>#4</span></span>", 
           fill = NA, label.color = NA) +
  annotate("richtext", x=2127, y = 18.2e8, label = "<span style='font-size: 10px '><span><b>248M</b></span> Pakistan <span style='color: #893e9b;'>#5</span></span>", 
           fill = NA, label.color = NA) +
  annotate("richtext", x=2124, y = 15.7e8, label = "<span style='font-size: 10px '><span><b>246M</b></span> DRC <span style='color: #40b87b;'>#6</span></span>", 
           fill = NA, label.color = NA) +
  annotate("richtext", x=2127, y = 13.2e8, label = "<span style='font-size: 10px '><span><b>229M</b></span> Indonesia <span style='color: #603c9c;'>#7</span></span>", 
           fill = NA, label.color = NA) +
  annotate("richtext", x=2126.5, y = 11e8, label = "<span style='font-size: 10px '><span><b>223M</b></span> Ethiopia <span style='color: #f5b314;'>#8</span></span>", 
           fill = NA, label.color = NA) +
  annotate("richtext", x=2125, y = 8.8e8, label = "<span style='font-size: 10px '><span><b>199M</b></span> Egypt <span style='color: #98b245;'>#9</span></span>", 
           fill = NA, label.color = NA) +
  annotate("richtext", x=2127.5, y = 6.8e8, label = "<span style='font-size: 10px '><span><b>186M</b></span> Tanzania <span style='color: #25a99b;'>#10</span></span>", 
           fill = NA, label.color = NA) +
  annotate("richtext", x=2125.5, y = 3.6e8, label = "<span style='font-size: 10px '><span><b>165M</b></span> Brazil <span style='color: #be388f;'>#13</span></span>", 
           fill = NA, label.color = NA) +
  annotate("richtext", x=2126, y = 2.28e8, label = "<span style='font-size: 10px '><span><b>106M</b></span> Russia <span style='color: #f96439;'>#19</span></span>", 
           fill = NA, label.color = NA) +
  annotate("richtext", x=2128, y = 10e7, label = "<span style='font-size: 10px '><span><b>81M</b></span> Bangladesh <span style='color: #e53e48;'>#25</span></span>", 
           fill = NA, label.color = NA) +
  annotate("richtext", x=2124.5, y = 5e4, label = "<span style='font-size: 10px '><span><b>60M</b></span> Japan <span style='color: #f78c24;'>#38</span></span>", 
           fill = NA, label.color = NA)

```


## Alternative graph: plotting the graph

The alternative graph is a diverging lollipop chart showing the percentage change in the population of the countries shown between 2017 and 2100. It clearly shows the difference in population from one year to the next and, moreover, how the general trend is one of population decline. 


```{r}
#Create the plot

ggplot(df, aes(x = country1, y = variation, color = group_colors)) + #basic plot
  geom_hline(yintercept = 0, color = "red", linetype = "solid", size = 2) + #to remark the 0
  geom_segment(aes(x = country1, xend = country1, y = 0, yend = variation, color = pos_neg), size = 1) + 
  geom_point(size = 8.25, shape = 21, aes(fill = pos_neg, color = pos_neg)) +
  geom_text(aes(label = variation), color = "black", hjust = 0.5, vjust = 0.5, size= 2, fontface = "bold.italic")+
  coord_flip() + #to change axis position
  theme(legend.position = "none",
        plot.background = element_blank(),
        panel.background = element_blank()) +
  #Adding labels and text
  labs(x= "Country") +
  labs(y = "Variation (%)") +
  labs(title = "Percentage Change in Population between 2017 and 2100", size = 20) +
  labs(subtitle = "Top 10 Countries by Population in 2017 and 2100 respectively.", size = 10) +
  annotate("text", x = 9, y = 246, label = "Ranking 2017 vs. 2100", fontface = "bold.italic") +
  annotate("text", x = 8, y = 246, label = "1. China 1.4B       1. India 1.09B", size = 3, fontface ="italic") +
  annotate("text", x = 7.25, y = 246, label = "2. India 1.38B       2. Nigeria 791M", size = 3, fontface ="italic") +
  annotate("text", x = 6.5, y = 250, label = "3. U.S. 325M        3. China 732M ", size = 3, fontface ="italic") +
  annotate("text", x = 6.15, y = 250, label = "- - - - - - - - - - - - - - -") +
  annotate("text", x = 5.7, y = 250, label = "8. Bangladesh 157M         8. Ethiopia 223M", size = 3, fontface = "italic") +
  annotate("text", x = 4.95, y = 248, label = "9. Russia 146M            9. Egypt 199M", size = 3, fontface ="italic") +
  annotate("text", x = 4.20, y = 250, label = "10. Japan 128M         10. Tanzania 186M", size = 3, fontface ="italic")

```




