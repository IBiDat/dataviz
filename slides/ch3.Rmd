---
title: Data Visualization
subtitle: Chapter 3. Data Visualization in R
author: Iñaki Úcar
institute: Department of Statistics | uc3m-Santander Big Data Institute
date: |
  <br>Master in Computational Social Science<br>Last generated: `r Sys.Date()`
output:
  xaringan::moon_reader:
    chakra: assets/remark-latest.min.js
    lib_dir: assets
    css: [default, metropolis, metropolis-fonts, assets/theme.css, assets/colors.css]
    nature:
      beforeInit: assets/macros.js
      highlightStyle: vs
      highlightLines: true
      countIncrementalSlides: false
---
class: toc, base24, middle, clear

```{r setup, include=FALSE}
options(htmltools.dir.version=FALSE)
knitr::opts_chunk$set(message=FALSE, warning=FALSE, fig.align="center", dpi=150)
knitr::opts_chunk$set(cache=TRUE)

library(ggplot2)
theme_set(theme_gray(base_size=16))
library(dplyr)
library(tidyr)
set.seed(42)
```

```{r xaringanExtra, echo=FALSE, cache=FALSE}
xaringanExtra::use_share_again()
xaringanExtra::style_share_again(share_buttons="none")
xaringanExtra::use_scribble()
xaringanExtra::use_panelset(in_xaringan=TRUE)
```

---
class: intoc, inverse, center, middle

# Directory of Visualizations
## Based on [The R Graph Gallery](https://r-graph-gallery.com/)

---
class: base24

# Contents

.pull-left[
- .distribution[[Distribution](#5)].icons[
  ![:scale 10%](assets/img/section/Violin150.png)
  ![:scale 10%](assets/img/section/Density150.png)
  ![:scale 10%](assets/img/section/Histogram150.png)
  ![:scale 10%](assets/img/section/Box1150.png)
  ![:scale 10%](assets/img/section/Joyplot150.png)
  ]

- .correlation[[Correlation](#32)].icons[
  ![:scale 10%](assets/img/section/ScatterPlot150.png)
  ![:scale 10%](assets/img/section/Heatmap150.png)
  ![:scale 10%](assets/img/section/Correlogram150.png)
  ![:scale 10%](assets/img/section/BubblePlot150.png)
  ![:scale 10%](assets/img/section/ScatterConnected150.png)
  ![:scale 10%](assets/img/section/2dDensity150.png)
  ]

- .ranking[[Ranking](#55)].icons[
  ![:scale 10%](assets/img/section/Bar150.png)
  ![:scale 10%](assets/img/section/Spider150.png)
  ![:scale 10%](assets/img/section/Wordcloud150.png)
  ![:scale 10%](assets/img/section/Parallel1150.png)
  ![:scale 10%](assets/img/section/Lollipop150.png)
  ![:scale 10%](assets/img/section/CircularBarplot150.png)
  ]

- .part[[Part of a Whole](#66)].icons[
  ![:scale 10%](assets/img/section/GroupedRed150.png)
  ![:scale 10%](assets/img/section/Tree150.png)
  ![:scale 10%](assets/img/section/Doughnut150.png)
  ![:scale 10%](assets/img/section/Pie150.png)
  ![:scale 10%](assets/img/section/Dendrogram150.png)
  ![:scale 10%](assets/img/section/CircularPacking150.png)
  ]
]
.pull-right[
- .evolution[[Evolution](#85)].icons[
  ![:scale 10%](assets/img/section/Line150.png)
  ![:scale 10%](assets/img/section/Area150.png)
  ![:scale 10%](assets/img/section/StackedArea150.png)
  ![:scale 10%](assets/img/section/Stream150.png)
  ![:scale 10%](assets/img/section/Time150.gif)
  ]

- .map[[Map](#96)].icons[
  ![:scale 10%](assets/img/section/Map150.png)
  ![:scale 10%](assets/img/section/Choropleth150.png)
  ![:scale 10%](assets/img/section/MapHexbin150.png)
  ![:scale 10%](assets/img/section/Cartogram150.png)
  ![:scale 10%](assets/img/section/ConnectedMap150.png)
  ![:scale 10%](assets/img/section/BubbleMap150.png)
  ]

- .flow[[Flow](#108)].icons[
  ![:scale 10%](assets/img/section/Chord150.png)
  ![:scale 10%](assets/img/section/Network150.png)
  ![:scale 10%](assets/img/section/Sankey150.png)
  ![:scale 10%](assets/img/section/Arc150.png)
  ![:scale 10%](assets/img/section/Bundle150.png)
  ]

- .other[[Other resources](#130)].icons[
  ![:scale 10%](assets/img/section/anim150.gif)
  ![:scale 10%](assets/img/section/Interactive150.png)
  ![:scale 10%](assets/img/section/Bad150.png)
  ![:scale 10%](assets/img/section/DataArt1150.png)
  ]
]

---
class: distribution

# Distribution
.footnote[[< Contents](#4)]

[![:scale 15%](assets/img/section/Violin150.png)](https://r-graph-gallery.com/violin.html)
[![:scale 15%](assets/img/section/Density150.png)](https://r-graph-gallery.com/density-plot.html)
[![:scale 15%](assets/img/section/Histogram150.png)](https://r-graph-gallery.com/histogram.html)
[![:scale 15%](assets/img/section/Box1150.png)](https://r-graph-gallery.com/boxplot.html)
[![:scale 15%](assets/img/section/Joyplot150.png)](https://r-graph-gallery.com/ridgeline-plot.html)

.bottom[Violin]
.bottom[Density]
.bottom[Histogram]
.bottom[Boxplot]
.bottom[Ridgeline]

<br>

.black.font120[
- Visualization of one or multiple **univariate distributions**
- Stacked versions are difficult to interpret and should be avoided
- Some require fine-tuning of the parameters to avoid being misleading
]

---
class: distribution

# Distribution ![:scale 6%](assets/img/section/Histogram150.png) Histogram
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r histogram, eval=FALSE}
ggplot(mpg) +
  aes(hwy) +
  geom_histogram() #<<
```
]
.pull-right-mod[
```{r histogram, echo=FALSE, fig.asp=1.25}
```
]

---
class: distribution

# Distribution ![:scale 6%](assets/img/section/Histogram150.png) Histogram
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r histogram-density, eval=FALSE}
ggplot(mpg) +
  aes(hwy, after_stat(density)) + #<<
  geom_histogram()
```
]
.pull-right-mod[
```{r histogram-density, echo=FALSE, fig.asp=1.25}
```
]

---
class: distribution

# Distribution ![:scale 6%](assets/img/section/Histogram150.png) Histogram
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r histogram-fill, eval=FALSE}
ggplot(mpg) +
  aes(hwy, fill=class) + #<<
  geom_histogram() +
  theme(legend.position=c(1, 1),
        legend.justification=c(1, 1))
```
]
.pull-right-mod[
```{r histogram-fill, echo=FALSE, fig.asp=1.25}
```
]

---
class: distribution

# Distribution ![:scale 6%](assets/img/section/Histogram150.png) Histogram
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r histogram-facet, eval=FALSE}
ggplot(mpg) +
  aes(hwy) +
  geom_histogram() +
  facet_grid(class ~ .) #<<
```
]
.pull-right-mod[
```{r histogram-facet, echo=FALSE, fig.asp=1.25}
```
]

---
class: distribution

# Distribution ![:scale 6%](assets/img/section/Histogram150.png) Histogram
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r histogram-reorder, eval=FALSE}
ggplot(mpg) +
  aes(hwy) +
  geom_histogram() +
  facet_grid(
    reorder(class, -hwy, median) ~ .) #<<
```
]
.pull-right-mod[
```{r histogram-reorder, echo=FALSE, fig.asp=1.25}
```
]

---
class: distribution

# Distribution ![:scale 6%](assets/img/section/Density150.png) Density
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r density, eval=FALSE}
ggplot(mpg) +
  aes(hwy) +
  geom_density() #<<
```
]
.pull-right-mod[
```{r density, echo=FALSE, fig.asp=1.25}
```
]

---
class: distribution

# Distribution ![:scale 6%](assets/img/section/Density150.png) Density
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r density-histogram, eval=FALSE}
ggplot(mpg) +
  aes(hwy, after_stat(density)) + #<<
  geom_histogram(fill="gray") + #<<
  geom_density()
```
]
.pull-right-mod[
```{r density-histogram, echo=FALSE, fig.asp=1.25}
```
]

---
class: distribution

# Distribution ![:scale 6%](assets/img/section/Density150.png) Density
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r density-adjust, eval=FALSE}
ggplot(mpg) +
  aes(hwy, after_stat(density)) +
  geom_histogram(fill="gray") +
  geom_density(adjust=0.2) #<<
```
]
.pull-right-mod[
```{r density-adjust, echo=FALSE, fig.asp=1.25}
```
]

---
class: distribution

# Distribution ![:scale 6%](assets/img/section/Density150.png) Density
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r density-bins, eval=FALSE}
ggplot(mpg) +
  aes(hwy, after_stat(density)) +
  geom_histogram(fill=NA) +
  geom_histogram(fill="gray", bins=10) + #<<
  geom_density()
```
]
.pull-right-mod[
```{r density-bins, echo=FALSE, fig.asp=1.25}
```
]

---
class: distribution

# Distribution ![:scale 6%](assets/img/section/Box1150.png) Boxplot
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r boxplot, eval=FALSE}
ggplot(mpg) +
  aes(hwy, class) +
  geom_boxplot() + #<<
  labs(y=NULL)
```
]
.pull-right-mod[
```{r boxplot, echo=FALSE, fig.asp=1.25}
```
]

---
class: distribution

# Distribution ![:scale 6%](assets/img/section/Box1150.png) Boxplot
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r boxplot-reorder, eval=FALSE}
ggplot(mpg) +
  aes(hwy, reorder(class, hwy, median)) + #<<
  geom_boxplot() +
  labs(y=NULL)
```
]
.pull-right-mod[
```{r boxplot-reorder, echo=FALSE, fig.asp=1.25}
```
]

---
class: distribution

# Distribution ![:scale 6%](assets/img/section/Box1150.png) Boxplot
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r boxplot-outlier, eval=FALSE}
ggplot(mpg) +
  aes(hwy, reorder(class, hwy, median)) +
  geom_boxplot(outlier.color="red") + #<<
  labs(y=NULL)
```
]
.pull-right-mod[
```{r boxplot-outlier, echo=FALSE, fig.asp=1.25}
```
]

---
class: distribution

# Distribution ![:scale 6%](assets/img/section/Box1150.png) Boxplot
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r boxplot-jitter, eval=FALSE}
ggplot(mpg) +
  aes(hwy, reorder(class, hwy, median)) +
  geom_boxplot(outlier.color="red") +
  geom_jitter(height=0.2, alpha=0.5) + #<<
  labs(y=NULL)
```
]
.pull-right-mod[
```{r boxplot-jitter, echo=FALSE, fig.asp=1.25}
```
]

---
class: distribution

# Distribution ![:scale 6%](assets/img/section/Box1150.png) Boxplot
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r boxplot-varwidth, eval=FALSE}
ggplot(mpg) +
  aes(hwy, reorder(class, hwy, median)) +
  geom_boxplot(outlier.color="red",
               varwidth=TRUE) + #<<
  geom_jitter(height=0.2, alpha=0.5) +
  labs(y=NULL)
```
]
.pull-right-mod[
```{r boxplot-varwidth, echo=FALSE, fig.asp=1.25}
```
]

---
class: distribution

# Distribution ![:scale 6%](assets/img/section/Box1150.png) Boxplot
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r boxplot-color, eval=FALSE}
ggplot(mpg) +
  aes(hwy, reorder(class, hwy, median)) +
  geom_boxplot(aes(color=drv)) + #<<
  labs(y=NULL) +
  theme(legend.position=c(1, 0),
        legend.justification=c(1, 0))
```
]
.pull-right-mod[
```{r boxplot-color, echo=FALSE, fig.asp=1.25}
```
]

---
class: distribution

# Distribution ![:scale 6%](assets/img/section/Box1150.png) Boxplot
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r boxplot-fill, eval=FALSE}
ggplot(mpg) +
  aes(hwy, reorder(class, hwy, median)) +
  geom_boxplot(aes(fill=drv)) + #<<
  labs(y=NULL) +
  theme(legend.position=c(1, 0),
        legend.justification=c(1, 0))
```
]
.pull-right-mod[
```{r boxplot-fill, echo=FALSE, fig.asp=1.25}
```
]

---
class: distribution

# Distribution ![:scale 6%](assets/img/section/Box1150.png) Boxplot
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r boxplot-fill-varwidth, eval=FALSE}
ggplot(mpg) +
  aes(hwy, reorder(class, hwy, median)) +
  geom_boxplot(aes(fill=drv),
               varwidth=TRUE) + #<<
  labs(y=NULL) +
  theme(legend.position=c(1, 0),
        legend.justification=c(1, 0))
```
]
.pull-right-mod[
```{r boxplot-fill-varwidth, echo=FALSE, fig.asp=1.25}
```
]

---
class: distribution

# Distribution ![:scale 6%](assets/img/section/Violin150.png) Violin
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r violin, eval=FALSE}
ggplot(mpg) +
  aes(hwy, reorder(class, hwy, median)) +
  geom_violin() + #<<
  labs(y=NULL)
```
]
.pull-right-mod[
```{r violin, echo=FALSE, fig.asp=1.25}
```
]

---
class: distribution

# Distribution ![:scale 6%](assets/img/section/Violin150.png) Violin
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r violin-fill, eval=FALSE}
ggplot(mpg) +
  aes(hwy, reorder(class, hwy, median)) +
  geom_violin(aes(fill=class)) + #<<
  labs(y=NULL) +
  theme(legend.position="none")
```
]
.pull-right-mod[
```{r violin-fill, echo=FALSE, fig.asp=1.25}
```
]

---
class: distribution

# Distribution ![:scale 6%](assets/img/section/Violin150.png) Violin
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r violin-viridis, eval=FALSE}
ggplot(mpg) +
  aes(hwy, reorder(class, hwy, median)) +
  geom_violin(aes(fill=class)) +
  scale_fill_viridis_d() + #<<
  labs(y=NULL) +
  theme(legend.position="none")
```
]
.pull-right-mod[
```{r violin-viridis, echo=FALSE, fig.asp=1.25}
```
]

---
class: distribution

# Distribution ![:scale 6%](assets/img/section/Violin150.png) Violin
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r violin-reorder, eval=FALSE}
mpg |> mutate(
  class=reorder(class, hwy, median)) |> #<<
ggplot() +
  aes(hwy, class) + #<<
  geom_violin(aes(fill=class)) +
  scale_fill_viridis_d() +
  labs(y=NULL) +
  theme(legend.position="none")
```
]
.pull-right-mod[
```{r violin-reorder, echo=FALSE, fig.asp=1.25}
```
]

---
class: distribution

# Distribution ![:scale 6%](assets/img/section/Joyplot150.png) Ridgeline
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r ridgeline, eval=FALSE}
mpg |> mutate(
  class=reorder(class, hwy, median)) |>
ggplot() +
  aes(hwy, class, fill=class) +
  ggridges::geom_density_ridges() + #<<
  scale_fill_viridis_d() +
  labs(y=NULL) +
  theme(legend.position="none")
```
]
.pull-right-mod[
```{r ridgeline, echo=FALSE, fig.asp=1.25}
```
]

---
class: distribution

# Distribution ![:scale 6%](assets/img/section/Joyplot150.png) Ridgeline
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r ridgeline-gradient, eval=FALSE}
mpg |> mutate(
  class=reorder(class, hwy, median)) |>
ggplot() +
  aes(hwy, class, fill=after_stat(x)) + #<<
  ggridges::geom_density_ridges_gradient() + #<<
  scale_fill_viridis_c() + #<<
  labs(y=NULL) +
  theme(legend.position="none")
```
]
.pull-right-mod[
```{r ridgeline-gradient, echo=FALSE, fig.asp=1.25}
```
]

---
class: distribution

# Distribution ![:scale 6%](assets/img/section/Joyplot150.png) Ridgeline
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r ridgeline-scale, eval=FALSE}
mpg |> mutate(
  class=reorder(class, hwy, median)) |>
ggplot() +
  aes(hwy, class, fill=after_stat(x)) +
  ggridges::geom_density_ridges_gradient(
    scale=1) + #<<
  scale_fill_viridis_c() +
  labs(y=NULL) +
  theme(legend.position="none")
```
]
.pull-right-mod[
```{r ridgeline-scale, echo=FALSE, fig.asp=1.25}
```
]

---
class: distribution

# Distribution ![:scale 6%](assets/img/section/Joyplot150.png) Ridgeline
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r ridgeline-quantile, eval=FALSE}
mpg |> mutate(
  class=reorder(class, hwy, median)) |>
ggplot() +
  aes(hwy, class, fill=after_stat(x)) +
  ggridges::geom_density_ridges_gradient(
    scale=1, quantile_lines=TRUE) + #<<
  scale_fill_viridis_c() +
  labs(y=NULL) +
  theme(legend.position="none")
```
]
.pull-right-mod[
```{r ridgeline-quantile, echo=FALSE, fig.asp=1.25}
```
]

---
class: distribution

# Distribution ![:scale 6%](assets/img/section/Joyplot150.png) Ridgeline
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r ridgeline-tailprob, eval=FALSE}
mpg |> mutate(
  class=reorder(class, hwy, median)) |>
ggplot() +
  aes(hwy, class, fill=0.5 - abs( #<<
    0.5 - after_stat(ecdf))) + #<<
  ggridges::geom_density_ridges_gradient(
    scale=1, calc_ecdf=TRUE) + #<<
  scale_fill_viridis_c("Tail prob.") +
  labs(y=NULL) +
  theme(legend.position=c(1, 0),
        legend.justification=c(1, 0))
```
]
.pull-right-mod[
```{r ridgeline-tailprob, echo=FALSE, fig.asp=1.25}
```
]

---
class: correlation

# Correlation
.footnote[[< Contents](#4)]

[![:scale 15%](assets/img/section/ScatterPlot150.png)](https://r-graph-gallery.com/scatterplot.html)
[![:scale 15%](assets/img/section/Heatmap150.png)](https://r-graph-gallery.com/heatmap.html)
[![:scale 15%](assets/img/section/Correlogram150.png)](https://r-graph-gallery.com/correlogram.html)
[![:scale 15%](assets/img/section/BubblePlot150.png)](https://r-graph-gallery.com/bubble-chart.html)
[![:scale 15%](assets/img/section/ScatterConnected150.png)](https://r-graph-gallery.com/connected-scatterplot.html)
[![:scale 15%](assets/img/section/2dDensity150.png)](https://r-graph-gallery.com/2d-density-chart.html)

.bottom[Scatter]
.bottom[Heatmap]
.bottom[Correlogram]
.bottom[Bubble]
.bottom[Connected scatter]
.bottom[Density 2D]

<br>

.black.font120[
- Visualization of the **relationship** between two variables
- Two continuous, or two discrete, or mixed
- Options to include a third one
]

---
class: correlation

# Correlation ![:scale 6%](assets/img/section/ScatterPlot150.png) Scatter
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r scatter, eval=FALSE}
gapminder::gapminder |>
  filter(year == 1997) |>
ggplot() +
  aes(gdpPercap, lifeExp) +
  scale_x_log10() +
  geom_point() #<<
```
]
.pull-right-mod[
```{r scatter, echo=FALSE, fig.asp=1.25}
```
]

---
class: correlation

# Correlation ![:scale 6%](assets/img/section/ScatterPlot150.png) Scatter
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r scatter-color, eval=FALSE}
gapminder::gapminder |>
  filter(year == 1997) |>
ggplot() +
  aes(gdpPercap, lifeExp) +
  scale_x_log10() +
  geom_point(aes(color=continent)) + #<<
  theme(legend.position=c(1, 0),
        legend.justification=c(1, 0))
```
]
.pull-right-mod[
```{r scatter-color, echo=FALSE, fig.asp=1.25}
```
]

---
class: correlation

# Correlation ![:scale 6%](assets/img/section/BubblePlot150.png) Bubble
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r scatter-bubble, eval=FALSE}
gapminder::gapminder |>
  filter(year == 1997) |>
ggplot() +
  aes(gdpPercap, lifeExp) +
  scale_x_log10() +
  geom_point(aes(color=continent,
                 size=pop)) + #<<
  theme(legend.position=c(1, 0),
        legend.justification=c(1, 0))
```
]
.pull-right-mod[
```{r scatter-bubble, echo=FALSE, fig.asp=1.25}
```
]

---
class: correlation

# Correlation ![:scale 6%](assets/img/section/BubblePlot150.png) Bubble
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r scatter-bubble-scale, eval=FALSE}
gapminder::gapminder |>
  filter(year == 1997) |>
ggplot() +
  aes(gdpPercap, lifeExp) +
  scale_x_log10() +
  geom_point(aes(color=continent,
                 size=pop),
             alpha=0.7) + #<<
  scale_size_area(max_size=20) + #<<
  theme(legend.position=c(1, 0),
        legend.justification=c(1, 0))
```
]
.pull-right-mod[
```{r scatter-bubble-scale, echo=FALSE, fig.asp=1.25}
```
]

---
class: correlation

# Correlation ![:scale 6%](assets/img/section/BubblePlot150.png) Bubble
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r scatter-smooth, eval=FALSE}
gapminder::gapminder |>
  filter(year == 1997) |>
ggplot() +
  aes(gdpPercap, lifeExp) +
  scale_x_log10() +
  geom_point(aes(color=continent,
                 size=pop),
             alpha=0.7) +
  scale_size_area(max_size=20) +
  geom_smooth() + #<<
  theme(legend.position=c(1, 0),
        legend.justification=c(1, 0))
```
]
.pull-right-mod[
```{r scatter-smooth, echo=FALSE, fig.asp=1.25}
```
]

---
class: correlation

# Correlation ![:scale 6%](assets/img/section/BubblePlot150.png) Bubble
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r scatter-smooth-lm, eval=FALSE}
gapminder::gapminder |>
  filter(year == 1997) |>
ggplot() +
  aes(gdpPercap, lifeExp) +
  scale_x_log10() +
  geom_point(aes(color=continent,
                 size=pop),
             alpha=0.7) +
  scale_size_area(max_size=20) +
  geom_smooth(method="lm") + #<<
  theme(legend.position=c(1, 0),
        legend.justification=c(1, 0))
```
]
.pull-right-mod[
```{r scatter-smooth-lm, echo=FALSE, fig.asp=1.25}
```
]

---
class: correlation

# Correlation ![:scale 6%](assets/img/section/ScatterConnected150.png) Connected Scatter
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r scatter-connected, eval=FALSE}
gapminder::gapminder |>
  filter(year == 1997) |>
ggplot() +
  aes(gdpPercap, lifeExp) +
  scale_x_log10() +
  geom_point(aes(color=continent)) +
  geom_line(aes(color=continent)) + #<<
  theme(legend.position=c(1, 0),
        legend.justification=c(1, 0))
```
]
.pull-right-mod[
```{r scatter-connected, echo=FALSE, fig.asp=1.25}
```
]

---
class: correlation

# Correlation ![:scale 6%](assets/img/section/ScatterConnected150.png) Connected Scatter
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r scatter-connected-path, eval=FALSE}
babynames::babynames |>
  filter(name %in% c(
    "Ashley", "Amanda")) |>
  filter(sex == "F") |>
  filter(year > 1970) |>
  select(year, name, n) |>
  spread(key = name, value=n, -1) |>
ggplot() +
  aes(Amanda, Ashley, color=year) + #<<
  geom_point() +
  geom_path() + #<<
  scale_color_viridis_c() +
  theme(legend.position=c(0, 1),
        legend.justification=c(0, 1))
```
]
.pull-right-mod[
```{r scatter-connected-path, echo=FALSE, fig.asp=1.25}
```
]

---
class: correlation

# Correlation ![:scale 6%](assets/img/section/ScatterConnected150.png) Connected Scatter
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r scatter-connected-path-label, eval=FALSE}
df <- babynames::babynames |>
  filter(name %in% c(
    "Ashley", "Amanda")) |>
  filter(sex == "F") |>
  filter(year > 1970) |>
  select(year, name, n) |>
  spread(key = name, value=n, -1)

text <- df |> #<<
  filter(year %in% c(
    1972, 1980, 1984, 1987, 2012))

ggplot(df) +
  aes(Amanda, Ashley, color=year) +
  geom_path(arrow=arrow( #<<
    angle=15, type="closed", #<<
    length=unit(0.1, "inches"))) + #<<
  scale_color_viridis_c() +
  geom_label(aes(label=year), text) + #<<
  theme(legend.position=c(0, 1),
        legend.justification=c(0, 1))
```
]
.pull-right-mod[
```{r scatter-connected-path-label, echo=FALSE, fig.asp=1.25}
```
]

---
class: correlation

# Correlation ![:scale 6%](assets/img/section/ScatterPlot150.png) Scatter
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r scatter-distribution, eval=FALSE}
ggplot(faithful) +
  aes(eruptions, waiting) +
  geom_point() #<<
```
]
.pull-right-mod[
```{r scatter-distribution, echo=FALSE, fig.asp=1.25}
```
]

---
class: correlation

# Correlation ![:scale 6%](assets/img/section/ScatterPlot150.png) Scatter
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r scatter-distribution-margin, eval=FALSE}
ggplot(faithful) +
  aes(eruptions, waiting) +
  geom_point() +
  ggside::geom_xsidehistogram() #<<
```
]
.pull-right-mod[
```{r scatter-distribution-margin, echo=FALSE, fig.asp=1.25}
```
]

---
class: correlation

# Correlation ![:scale 6%](assets/img/section/2dDensity150.png) Density 2D
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r density2d-histogram, eval=FALSE}
ggplot(faithful) +
  aes(eruptions, waiting) +
  geom_bin2d() + #<<
  scale_fill_viridis_c() +
  ggside::geom_xsidehistogram() +
  theme(legend.position=c(1, 0),
        legend.justification=c(1, 0))
```
]
.pull-right-mod[
```{r density2d-histogram, echo=FALSE, fig.asp=1.25}
```
]

---
class: correlation

# Correlation ![:scale 6%](assets/img/section/2dDensity150.png) Density 2D
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r density2d-hex, eval=FALSE}
ggplot(faithful) +
  aes(eruptions, waiting) +
  geom_hex() + #<<
  scale_fill_viridis_c() +
  ggside::geom_xsidehistogram() +
  theme(legend.position=c(1, 0),
        legend.justification=c(1, 0))
```
]
.pull-right-mod[
```{r density2d-hex, echo=FALSE, fig.asp=1.25}
```
]

---
class: correlation

# Correlation ![:scale 6%](assets/img/section/2dDensity150.png) Density 2D
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r density2d, eval=FALSE}
ggplot(faithful) +
  aes(eruptions, waiting) +
  geom_density2d_filled() + #<<
  ggside::geom_xsidehistogram() +
  theme(legend.position=c(1, 0),
        legend.justification=c(1, 0))
```
]
.pull-right-mod[
```{r density2d, echo=FALSE, fig.asp=1.25}
```
]

---
class: correlation

# Correlation ![:scale 6%](assets/img/section/2dDensity150.png) Density 2D
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r density2d-raster, eval=FALSE}
ggplot(faithfuld) +
  aes(eruptions, waiting, fill=density) + #<<
  geom_raster() + #<<
  scale_fill_viridis_c() +
  theme(legend.position=c(1, 0),
        legend.justification=c(1, 0))
```
]
.pull-right-mod[
```{r density2d-raster, echo=FALSE, fig.asp=1.25}
```
]

---
class: correlation

# Correlation ![:scale 6%](assets/img/section/2dDensity150.png) Density 2D
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r density2d-raster-interpolate, eval=FALSE}
ggplot(faithfuld) +
  aes(eruptions, waiting, fill=density) +
  geom_raster(interpolate=TRUE) + #<<
  scale_fill_viridis_c() +
  theme(legend.position=c(1, 0),
        legend.justification=c(1, 0))
```
]
.pull-right-mod[
```{r density2d-raster-interpolate, echo=FALSE, fig.asp=1.25}
```
]

---
class: correlation

# Correlation ![:scale 6%](assets/img/section/Heatmap150.png) Heatmap
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r heatmap, eval=FALSE}
mtcars |>
  tibble::rownames_to_column("model") |>
  gather("key", "value", -model) |>
ggplot() +
  aes(key, model, fill=value) +
  geom_tile() + #<<
  scale_fill_viridis_c(
    trans="pseudo_log") + #<<
  labs(x=NULL, y=NULL)
```
]
.pull-right-mod[
```{r heatmap, echo=FALSE, fig.asp=1.25}
```
]

---
class: correlation

# Correlation ![:scale 6%](assets/img/section/Correlogram150.png) Correlogram
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r correlation, eval=FALSE}
mtcars |>
  cor(mtcars) |>
  ggcorrplot::ggcorrplot() + #<<
  theme(legend.position="top")
```
]
.pull-right-mod[
```{r correlation, echo=FALSE, fig.asp=1.25}
```
]

---
class: correlation

# Correlation ![:scale 6%](assets/img/section/Correlogram150.png) Correlogram
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r correlation-order, eval=FALSE}
mtcars |>
  cor(mtcars) |>
  ggcorrplot::ggcorrplot(
    hc.order=TRUE,  #<<
    outline.color="white") + #<<
  theme(legend.position="top")
```
]
.pull-right-mod[
```{r correlation-order, echo=FALSE, fig.asp=1.25}
```
]

---
class: correlation

# Correlation ![:scale 6%](assets/img/section/Correlogram150.png) Correlogram
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r correlation-circle, eval=FALSE}
mtcars |>
  cor(mtcars) |>
  ggcorrplot::ggcorrplot(
    hc.order=TRUE,
    method="circle") + #<<
  theme(legend.position="top")
```
]
.pull-right-mod[
```{r correlation-circle, echo=FALSE, fig.asp=1.25}
```
]

---
class: correlation

# Correlation ![:scale 6%](assets/img/section/Correlogram150.png) Correlogram
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r correlogram, eval=FALSE}
GGally::ggpairs(iris)
```
]
.pull-right-mod[
```{r correlogram, echo=FALSE, fig.asp=1.25}
```
]

---
class: correlation

# Correlation ![:scale 6%](assets/img/section/Correlogram150.png) Correlogram
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r correlogram-color, eval=FALSE}
GGally::ggpairs(
  iris,
  aes(color=Species) #<<
)
```
]
.pull-right-mod[
```{r correlogram-color, echo=FALSE, fig.asp=1.25}
```
]

---
class: ranking

# Ranking
.footnote[[< Contents](#4)]

[![:scale 15%](assets/img/section/Bar150.png)](https://r-graph-gallery.com/barplot.html)
[![:scale 15%](assets/img/section/Spider150.png)](https://r-graph-gallery.com/spider-or-radar-chart.html)
[![:scale 15%](assets/img/section/Wordcloud150.png)](https://r-graph-gallery.com/wordcloud.html)
[![:scale 15%](assets/img/section/Parallel1150.png)](https://r-graph-gallery.com/parallel-plot.html)
[![:scale 15%](assets/img/section/Lollipop150.png)](https://r-graph-gallery.com/lollipop-plot.html)
[![:scale 15%](assets/img/section/CircularBarplot150.png)](https://r-graph-gallery.com/circular-barplot.html)

.bottom[Barplot]
.bottom[Spider/radar]
.bottom[Wordcloud]
.bottom[Parallel]
.bottom[Lollipop]
.bottom[Circular barplot]

<br>

.black.font120[
- Visualization of the **ranking of a categorical variable**
- Based on some other numerical variable
- **Sort your data!**
]

---
class: ranking

# Ranking ![:scale 6%](assets/img/section/Bar150.png) Barplot
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r barplot, eval=FALSE}
ggplot(mpg) +
  aes(class) +
  geom_bar() + #<<
  labs(x=NULL)
```
]
.pull-right-mod[
```{r barplot, echo=FALSE, fig.asp=1.25}
```
]

---
class: ranking

# Ranking ![:scale 6%](assets/img/section/Bar150.png) Barplot
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r barplot-col, eval=FALSE}
mpg |>
  count(drv, class, name="count") |>
ggplot() +
  aes(count, class) + #<<
  geom_col() + #<<
  labs(y=NULL)
```
]
.pull-right-mod[
```{r barplot-col, echo=FALSE, fig.asp=1.25}
```
]

---
class: ranking

# Ranking ![:scale 6%](assets/img/section/Bar150.png) Barplot
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r barplot-order, eval=FALSE}
mpg |>
  count(drv, class, name="count") |>
ggplot() +
  aes(count, reorder(class, count, sum)) + #<<
  geom_col() +
  labs(y=NULL)
```
]
.pull-right-mod[
```{r barplot-order, echo=FALSE, fig.asp=1.25}
```
]

---
class: ranking

# Ranking ![:scale 6%](assets/img/section/Bar150.png) Barplot
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r barplot-color, eval=FALSE}
mpg |>
  count(drv, class, name="count") |>
ggplot() +
  aes(count, reorder(class, count, sum)) +
  geom_col(aes(fill=drv)) + #<<
  labs(y=NULL) +
  theme(legend.position="top")
```
]
.pull-right-mod[
```{r barplot-color, echo=FALSE, fig.asp=1.25}
```
]

---
class: ranking

# Ranking ![:scale 6%](assets/img/section/CircularBarplot150.png) Circular Barplot
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r barplot-circular, eval=FALSE}
mpg |>
  count(drv, class, name="count") |>
ggplot() +
  aes(count, reorder(class, count, sum)) +
  geom_col(aes(fill=drv)) +
  coord_polar(theta="y") + #<<
  labs(y=NULL) +
  theme(legend.position="top")
```
]
.pull-right-mod[
```{r barplot-circular, echo=FALSE, fig.asp=1.25}
```
]

---
class: ranking

# Ranking ![:scale 6%](assets/img/section/Lollipop150.png) Lollipop
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r lollipop, eval=FALSE}
mpg |>
  count(drv, class, name="count") |>
ggplot() +
  aes(count, reorder(class, count, sum)) +
  geom_segment(aes(xend=0, yend=class)) + #<<
  geom_point(size=3) + #<<
  labs(y=NULL)
```
]
.pull-right-mod[
```{r lollipop, echo=FALSE, fig.asp=1.25}
```
]

---
class: ranking

# Ranking ![:scale 6%](assets/img/section/Lollipop150.png) Lollipop
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r lollipop-color, eval=FALSE}
mpg |>
  count(drv, class, name="count") |>
ggplot() +
  aes(count, reorder(class, count, sum)) +
  aes(color=drv) + #<<
  geom_segment(aes(xend=0, yend=class)) +
  geom_point(size=3) +
  labs(y=NULL) +
  theme(legend.position=c(1, 0),
        legend.justification=c(1, 0))
```
]
.pull-right-mod[
```{r lollipop-color, echo=FALSE, fig.asp=1.25}
```
]

---
class: ranking

# Ranking ![:scale 6%](assets/img/section/Lollipop150.png) Lollipop
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r lollipop-minmax, eval=FALSE}
mpg |>
  count(drv, class, name="count") |>
  group_by(class) |>
  summarise(xmin = min(count),
            count = max(count)) |>
ggplot() +
  aes(count, reorder(class, count, sum)) +
  geom_segment(aes(xend=xmin, yend=class)) + #<<
  geom_point(size=3) +
  geom_point(aes(xmin), size=3) + #<<
  labs(y=NULL) +
  expand_limits(x=0) #<<
```
]
.pull-right-mod[
```{r lollipop-minmax, echo=FALSE, fig.asp=1.25}
```
]

---
class: ranking

# Ranking ![:scale 6%](assets/img/section/Parallel1150.png) Parallel
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r parallel, eval=FALSE}
iris |>
  tibble::rowid_to_column("id") |> #<<
  gather("key", "value", -Species, -id) |>
ggplot() +
  aes(key, value, color=Species) +
  geom_point(alpha=0.5) +
  geom_line(aes(group=id), alpha=0.3) + #<<
  scale_color_viridis_d() +
  labs(x=NULL) +
  theme(legend.position="top")
```
]
.pull-right-mod[
```{r parallel, echo=FALSE, fig.asp=1.25}
```
]

---
class: ranking

# Ranking ![:scale 6%](assets/img/section/Parallel1150.png) Parallel
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r parallel-scale, eval=FALSE}
iris |>
  tibble::rowid_to_column("id") |>
  gather("key", "value", -Species, -id) |>
  group_by(key) |> #<<
  mutate(value = scale(value)) |> #<<
ggplot() +
  aes(key, value, color=Species) +
  geom_point(alpha=0.5) +
  geom_line(aes(group=id), alpha=0.3) +
  scale_color_viridis_d() +
  labs(x=NULL, y="Std. value") + #<<
  theme(legend.position="top")
```
]
.pull-right-mod[
```{r parallel-scale, echo=FALSE, fig.asp=1.25}
```
]

---
class: part

# Part of a Whole
.footnote[[< Contents](#4)]

[![:scale 15%](assets/img/section/GroupedRed150.png)](https://r-graph-gallery.com/stacked-barplot.html)
[![:scale 15%](assets/img/section/Tree150.png)](https://r-graph-gallery.com/treemap.html)
[![:scale 15%](assets/img/section/Doughnut150.png)](https://r-graph-gallery.com/doughnut-plot.html)
[![:scale 15%](assets/img/section/Pie150.png)](https://r-graph-gallery.com/pie-plot.html)
[![:scale 15%](assets/img/section/Dendrogram150.png)](https://r-graph-gallery.com/dendrogram.html)
[![:scale 15%](assets/img/section/CircularPacking150.png)](https://r-graph-gallery.com/circle-packing.html)

.bottom[Grouped and Stacked barplot]
.bottom[Treemap]
.bottom[Doughnut]
.bottom[Pie chart]
.bottom[Dendrogram]
.bottom[Circular packing]

<br>

.black.font120[
- Visualization of **proportions**
- Some charts are also able to convey **hierarchies**
- Some are rarely appropriate
]

---
class: part

# Part of a Whole ![:scale 6%](assets/img/section/GroupedRed150.png) Stacked barplot
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r sbarplot, eval=FALSE}
mpg |>
  count(drv, class, name="count") |>
ggplot() +
  aes(count, reorder(class, count, sum)) +
  geom_col(aes(fill=drv)) + #<<
  labs(y=NULL) +
  theme(legend.position="top")
```
]
.pull-right-mod[
```{r sbarplot, echo=FALSE, fig.asp=1.25}
```
]

---
class: part

# Part of a Whole ![:scale 6%](assets/img/section/GroupedRed150.png) Stacked barplot
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r sbarplot-proportion, eval=FALSE}
mpg |>
  count(drv, class, name="count") |>
  group_by(class) |> #<<
  mutate(prop = count / sum(count)) |> #<<
ggplot() +
  aes(prop, reorder(class, count, sum)) + #<<
  geom_col(aes(fill=drv)) +
  labs(y=NULL) +
  theme(legend.position="top")
```
]
.pull-right-mod[
```{r sbarplot-proportion, echo=FALSE, fig.asp=1.25}
```
]

---
class: part

# Part of a Whole ![:scale 6%](assets/img/section/GroupedRed150.png) Stacked barplot
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r sbarplot-percent, eval=FALSE}
mpg |>
  count(drv, class, name="count") |>
  group_by(class) |>
  mutate(prop = count / sum(count)) |>
ggplot() +
  aes(prop, reorder(class, count, sum)) +
  geom_col(aes(fill=drv)) +
  scale_x_continuous(
    label=scales::percent) + #<<
  labs(y=NULL) +
  theme(legend.position="top")
```
]
.pull-right-mod[
```{r sbarplot-percent, echo=FALSE, fig.asp=1.25}
```
]

---
class: part

# Part of a Whole ![:scale 6%](assets/img/section/Pie150.png) Pie chart
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r pie-pre, eval=FALSE}
data.frame(
  category=c("A", "B", "C"),
  prop=c(0.1, 0.6, 0.3)) |>
ggplot() +
  aes(1, prop) + #<<
  geom_col(aes(fill=category)) #<<
```
]
.pull-right-mod[
```{r pie-pre, echo=FALSE, fig.asp=1.25}
```
]

---
class: part

# Part of a Whole ![:scale 6%](assets/img/section/Pie150.png) Pie chart
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r pie, eval=FALSE}
data.frame(
  category=c("A", "B", "C"),
  prop=c(0.1, 0.6, 0.3)) |>
ggplot() +
  aes(1, prop) +
  geom_col(aes(fill=category)) +
  coord_polar(theta="y") + #<<
  theme_void(base_size=16) #<<
```
]
.pull-right-mod[
```{r pie, echo=FALSE, fig.asp=1.25}
```
]

---
class: part

# Part of a Whole ![:scale 6%](assets/img/section/Doughnut150.png) Doughnut
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r doughnut-pre, eval=FALSE}
data.frame(
  category=c("A", "B", "C"),
  prop=c(0.1, 0.6, 0.3)) |>
ggplot() +
  aes(1, prop) +
  geom_col(aes(fill=category)) +
  xlim(c(-0.5, 1.5)) #<<
```
]
.pull-right-mod[
```{r doughnut-pre, echo=FALSE, fig.asp=1.25}
```
]

---
class: part

# Part of a Whole ![:scale 6%](assets/img/section/Doughnut150.png) Doughnut
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r doughnut, eval=FALSE}
data.frame(
  category=c("A", "B", "C"),
  prop=c(0.1, 0.6, 0.3)) |>
ggplot() +
  aes(1, prop) +
  geom_col(aes(fill=category)) +
  xlim(c(-0.5, 1.5)) +
  coord_polar(theta="y") + #<<
  theme_void(base_size=16) #<<
```
]
.pull-right-mod[
```{r doughnut, echo=FALSE, fig.asp=1.25}
```
]

---
class: part

# Part of a Whole ![:scale 6%](assets/img/section/CircularPacking150.png) Circular packing
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r cpacking, eval=FALSE}
library(packcircles) #<<

df <- mpg |>
  count(class, name="count")
df <- cbind(df, circleProgressiveLayout( #<<
  df$count, sizetype="area"))

ggplot(df) +
  aes(x0=x, y0=y, r=radius) + #<<
  ggforce::geom_circle() #<<
```
]
.pull-right-mod[
```{r cpacking, echo=FALSE, fig.asp=1.25}
```
]

---
class: part

# Part of a Whole ![:scale 6%](assets/img/section/CircularPacking150.png) Circular packing
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r cpacking-fixed, eval=FALSE}
library(packcircles)

df <- mpg |>
  count(class, name="count")
df <- cbind(df, circleProgressiveLayout(
  df$count, sizetype="area"))

ggplot(df) +
  aes(x0=x, y0=y, r=radius) +
  ggforce::geom_circle(aes(
    fill=class), color=NA) + #<<
  coord_fixed() + #<<
  geom_text(aes(x, y, label=class)) +
  theme_void(base_size=16) +
  theme(legend.position="none")
```
]
.pull-right-mod[
```{r cpacking-fixed, echo=FALSE, fig.asp=1.25}
```
]

---
class: part

# Part of a Whole ![:scale 6%](assets/img/section/CircularPacking150.png) Circular packing
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r cpacking-overlap, eval=FALSE}
library(packcircles)

df <- data.frame(
  x = c(0, 1, 0, 1),
  y = c(0, 0, 1, 1),
  radius = c(0.7, 0.5, 0.6, 1.2))

ggplot(df) +
  aes(x0=x, y0=y, r=radius) +
  ggforce::geom_circle() + #<<
  geom_point(aes(x, y), color="red") +
  coord_fixed() +
  theme_void(base_size=16) +
  theme(legend.position="none")
```
]
.pull-right-mod[
```{r cpacking-overlap, echo=FALSE, fig.asp=1.25}
```
]

---
class: part

# Part of a Whole ![:scale 6%](assets/img/section/CircularPacking150.png) Circular packing
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r cpacking-repel, eval=FALSE}
library(packcircles)

df <- data.frame(
  x = c(0, 1, 0, 1),
  y = c(0, 0, 1, 1),
  radius = c(0.7, 0.5, 0.6, 1.2))

df.new <- circleRepelLayout( #<<
  df, sizetype="radius")$layout

ggplot(df.new) + #<<
  aes(x0=x, y0=y, r=radius) +
  ggforce::geom_circle() +
  geom_point(aes(x, y), color="red") +
  geom_point(aes(x, y), df) + #<<
  coord_fixed() +
  theme_void(base_size=16) +
  theme(legend.position="none")
```
]
.pull-right-mod[
```{r cpacking-repel, echo=FALSE, fig.asp=1.25}
```
]

---
class: part

# Part of a Whole ![:scale 6%](assets/img/section/CircularPacking150.png) Circular packing
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r cpacking-hierarchical, eval=FALSE}
edges <- ggraph::flare$edges
vertices <- ggraph::flare$vertices
graph <- igraph::graph_from_data_frame(
  edges, vertices=vertices)

ggraph::ggraph(graph,
               layout="circlepack", #<<
               weight=size) +
  ggraph::geom_node_circle() + #<<
  theme_void(base_size=16)
```
]
.pull-right-mod[
```{r cpacking-hierarchical, echo=FALSE, fig.asp=1.25}
```
]

---
class: part

# Part of a Whole ![:scale 6%](assets/img/section/CircularPacking150.png) Circular packing
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r cpacking-hierarchical-fill, eval=FALSE}
edges <- ggraph::flare$edges
vertices <- ggraph::flare$vertices
graph <- igraph::graph_from_data_frame(
  edges, vertices=vertices)

ggraph::ggraph(graph,
               layout="circlepack",
               weight=size) +
  ggraph::geom_node_circle(
    aes(fill=depth)) + #<<
  scale_fill_viridis_c() +
  coord_fixed() + #<<
  theme_void(base_size=16)
```
]
.pull-right-mod[
```{r cpacking-hierarchical-fill, echo=FALSE, fig.asp=1.25}
```
]

---
class: part

# Part of a Whole ![:scale 6%](assets/img/section/Tree150.png) Treemap
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r treemap, eval=FALSE}
edges <- ggraph::flare$edges
vertices <- ggraph::flare$vertices
graph <- igraph::graph_from_data_frame(
  edges, vertices=vertices)

ggraph::ggraph(graph,
               layout="treemap", #<<
               weight=size) +
  ggraph::geom_node_tile( #<<
    aes(fill=depth)) +
  scale_fill_viridis_c() +
  theme_void(base_size=16)
```
]
.pull-right-mod[
```{r treemap, echo=FALSE, fig.asp=1.25}
```
]

---
class: part

# Part of a Whole ![:scale 6%](assets/img/section/Dendrogram150.png) Dendrogram
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r tree, eval=FALSE}
edges <- ggraph::flare$edges
vertices <- ggraph::flare$vertices
graph <- igraph::graph_from_data_frame(
  edges, vertices=vertices)

ggraph::ggraph(graph,
               layout="tree") + #<<
  ggraph::geom_edge_diagonal() + #<<
  theme_void(base_size=16)
```
]
.pull-right-mod[
```{r tree, echo=FALSE, fig.asp=1.25}
```
]

---
class: part

# Part of a Whole ![:scale 6%](assets/img/section/Dendrogram150.png) Dendrogram
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r dendrogram, eval=FALSE}
edges <- ggraph::flare$edges
vertices <- ggraph::flare$vertices
graph <- igraph::graph_from_data_frame(
  edges, vertices=vertices)

ggraph::ggraph(graph,
               layout="dendrogram") + #<<
  ggraph::geom_edge_diagonal() +
  theme_void(base_size=16)
```
]
.pull-right-mod[
```{r dendrogram, echo=FALSE, fig.asp=1.25}
```
]

---
class: part

# Part of a Whole ![:scale 6%](assets/img/section/Dendrogram150.png) Dendrogram
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r dendrogram-elbow, eval=FALSE}
df <- hclust(dist(iris[, 1:4]))

ggraph::ggraph(df,
               layout="dendrogram",
               height=height) + #<<
  ggraph::geom_edge_elbow() + #<<
  theme_void(base_size=16)
```
]
.pull-right-mod[
```{r dendrogram-elbow, echo=FALSE, fig.asp=1.25}
```
]

---
class: part

# Part of a Whole ![:scale 6%](assets/img/section/Dendrogram150.png) Dendrogram
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r dendrogram-circular, eval=FALSE}
df <- hclust(dist(iris[, 1:4]))

ggraph::ggraph(df,
               layout="dendrogram",
               circular=TRUE) + #<<
  ggraph::geom_edge_elbow() +
  coord_fixed() + #<<
  theme_void(base_size=16)
```
]
.pull-right-mod[
```{r dendrogram-circular, echo=FALSE, fig.asp=1.25}
```
]

---
class: evolution

# Evolution
.footnote[[< Contents](#4)]

[![:scale 15%](assets/img/section/Line150.png)](https://r-graph-gallery.com/line-plot.html)
[![:scale 15%](assets/img/section/Area150.png)](https://r-graph-gallery.com/area-chart.html)
[![:scale 15%](assets/img/section/StackedArea150.png)](https://r-graph-gallery.com/stacked-area-graph.html)
[![:scale 15%](assets/img/section/Stream150.png)](https://r-graph-gallery.com/streamgraph.html)
[![:scale 15%](assets/img/section/Time150.gif)](https://r-graph-gallery.com/time-series.html)

.bottom[Line plot]
.bottom[Area]
.bottom[Stacked area]
.bottom[Stream chart]
.bottom[Time series]

<br>

.black.font120[
- Visualization of the **evolution** of series
- Individual data points are not important
- When `x` is time -> **time series**
]

---
class: evolution

# Evolution ![:scale 6%](assets/img/section/Line150.png) Line plot
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r line, eval=FALSE}
ggstream::blockbusters |>
  filter(genre == "Action") |>
ggplot() +
  aes(year, box_office) +
  geom_line() #<<
```
]
.pull-right-mod[
```{r line, echo=FALSE, fig.asp=1.25}
```
]

---
class: evolution

# Evolution ![:scale 6%](assets/img/section/Area150.png) Area
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r area, eval=FALSE}
ggstream::blockbusters |>
  filter(genre == "Action") |>
ggplot() +
  aes(year, box_office) +
  geom_area() #<<
```
]
.pull-right-mod[
```{r area, echo=FALSE, fig.asp=1.25}
```
]

---
class: evolution

# Evolution ![:scale 6%](assets/img/section/Time150.gif) Time series
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r line-time, eval=FALSE}
ggstream::blockbusters |>
  mutate(date = as.Date( #<<
    ISOdate(year, 1, 1))) |> #<<
  filter(genre == "Action") |>
ggplot() +
  aes(date, box_office) + #<<
  geom_line()
```
]
.pull-right-mod[
```{r line-time, echo=FALSE, fig.asp=1.25}
```
]

---
class: evolution

# Evolution ![:scale 6%](assets/img/section/Time150.gif) Time series
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r line-color, eval=FALSE}
ggstream::blockbusters |>
  mutate(date = as.Date(
    ISOdate(year, 1, 1))) |>
ggplot() +
  aes(date, box_office) +
  geom_line(aes(color=genre)) #<<
```
]
.pull-right-mod[
```{r line-color, echo=FALSE, fig.asp=1.25}
```
]

---
class: evolution

# Evolution ![:scale 6%](assets/img/section/Time150.gif) Time series
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r line-order, eval=FALSE}
ggstream::blockbusters |>
  mutate(date = as.Date(
    ISOdate(year, 1, 1))) |>
  mutate(genre = forcats::fct_reorder2( #<<
    genre, year, box_office)) |> #<<
ggplot() +
  aes(date, box_office) +
  geom_line(aes(color=genre))
```
]
.pull-right-mod[
```{r line-order, echo=FALSE, fig.asp=1.25}
```
]

---
class: evolution

# Evolution ![:scale 6%](assets/img/section/Time150.gif) Time series
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r line-annotation, eval=FALSE}
df <- ggstream::blockbusters |>
  mutate(date = as.Date(
    ISOdate(year, 1, 1)))

text <- df |>
  group_by(genre) |>
  slice(n()) #<<

ggplot(df) +
  aes(date, box_office,
      color=genre) + #<<
  geom_line() +
  geom_text(aes(label=genre), #<<
            text, hjust=-0.1) +
  expand_limits( #<<
    x=as.Date("2024-01-01")) +
  theme(legend.position="none")
```
]
.pull-right-mod[
```{r line-annotation, echo=FALSE, fig.asp=1.25}
```
]

---
class: evolution

# Evolution ![:scale 6%](assets/img/section/StackedArea150.png) Stacked area
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r area-fill, eval=FALSE}
ggstream::blockbusters |>
  mutate(date = as.Date(
    ISOdate(year, 1, 1))) |>
ggplot() +
  aes(date, box_office) +
  geom_area(aes(fill=genre)) #<<
```
]
.pull-right-mod[
```{r area-fill, echo=FALSE, fig.asp=1.25}
```
]

---
class: evolution

# Evolution ![:scale 6%](assets/img/section/Stream150.png) Streamchart
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r stream-ridge, eval=FALSE}
ggstream::blockbusters |>
  mutate(date = as.Date(
    ISOdate(year, 1, 1))) |>
ggplot() +
  aes(date, box_office) +
  ggstream::geom_stream( #<<
    aes(fill=genre),
    type="ridge") #<<
```
]
.pull-right-mod[
```{r stream-ridge, echo=FALSE, fig.asp=1.25}
```
]

---
class: evolution

# Evolution ![:scale 6%](assets/img/section/Stream150.png) Streamchart
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r stream-mirror, eval=FALSE}
ggstream::blockbusters |>
  mutate(date = as.Date(
    ISOdate(year, 1, 1))) |>
ggplot() +
  aes(date, box_office) +
  ggstream::geom_stream(
    aes(fill=genre),
    type="mirror") #<<
```
]
.pull-right-mod[
```{r stream-mirror, echo=FALSE, fig.asp=1.25}
```
]

---
class: evolution

# Evolution ![:scale 6%](assets/img/section/Stream150.png) Streamchart
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r stream-proportional, eval=FALSE}
ggstream::blockbusters |>
  mutate(date = as.Date(
    ISOdate(year, 1, 1))) |>
ggplot() +
  aes(date, box_office) +
  ggstream::geom_stream(
    aes(fill=genre),
    type="proportional") #<<
```
]
.pull-right-mod[
```{r stream-proportional, echo=FALSE, fig.asp=1.25}
```
]

---
class: map

# Map
.footnote[[< Contents](#4)]

[![:scale 15%](assets/img/section/Map150.png)](https://r-graph-gallery.com/map.html)
[![:scale 15%](assets/img/section/Choropleth150.png)](https://r-graph-gallery.com/choropleth-map.html)
[![:scale 15%](assets/img/section/MapHexbin150.png)](https://r-graph-gallery.com/hexbin-map.html)
[![:scale 15%](assets/img/section/Cartogram150.png)](https://r-graph-gallery.com/cartogram.html)
[![:scale 15%](assets/img/section/ConnectedMap150.png)](https://r-graph-gallery.com/connection-map.html)
[![:scale 15%](assets/img/section/BubbleMap150.png)](https://r-graph-gallery.com/bubble-map.html)

.bottom[Map]
.bottom[Choropleth]
.bottom[Hexbin map]
.bottom[Cartogram]
.bottom[Connection]
.bottom[Bubble map]

<br>

.black.font120[
- Visualizaton of **geospatial data**
- Usually, the map is just a reference
- Sometimes, it **encodes** the information
]

---
class: map

# Map ![:scale 6%](assets/img/section/Map150.png) Map
.footnote[[< Contents](#4) | Many resources and examples at [**r-spatial.org**](https://r-spatial.org/)]

.pull-left-mod[
```{r map, eval=FALSE}
world <- giscoR::gisco_get_countries()

ggplot(world) +
  geom_sf() #<<
```
]
.pull-right-mod[
```{r map, echo=FALSE, fig.asp=1.25}
```
]

---
class: map

# Map ![:scale 6%](assets/img/section/Map150.png) Map
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r map-usa, eval=FALSE}
usa <- sf::st_as_sf(maps::map( #<<
  "state", plot=FALSE, fill=TRUE))

ggplot(usa) +
  geom_sf()
```
]
.pull-right-mod[
```{r map-usa, echo=FALSE, fig.asp=1.25}
```
]

---
class: map

# Map ![:scale 6%](assets/img/section/Map150.png) Map
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r map-africa, eval=FALSE}
africa <- giscoR::gisco_get_countries(
    region="Africa") #<<

ggplot(africa) +
  geom_sf()
```
]
.pull-right-mod[
```{r map-africa, echo=FALSE, fig.asp=1.25}
```
]

---
class: map

# Map ![:scale 6%](assets/img/section/Map150.png) Map
.footnote[[< Contents](#4) | See [**Coordinate Reference Systems**](https://en.wikipedia.org/wiki/Spatial_reference_system)]

.pull-left-mod[
```{r map-africa-cut, eval=FALSE}
africa <- giscoR::gisco_get_countries(
    region="Africa")

ggplot(africa) +
  geom_sf() +
  coord_sf(xlim=c(-20, 50), #<<
           ylim=c(-40, 40)) #<<
```
]
.pull-right-mod[
```{r map-africa-cut, echo=FALSE, fig.asp=1.25}
```
]

---
class: map

# Map ![:scale 6%](assets/img/section/Choropleth150.png) Choropleth
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r choropleth, eval=FALSE}
africa <- giscoR::gisco_get_countries(
    region="Africa") |>
  left_join( #<<
    africamonitor::am_data( #<<
      series="SP_POP_TOTL", #<<
      from=2021, to=2021), #<<
    by=c("ISO3_CODE"="ISO3")) #<<

ggplot(africa) +
  geom_sf(aes(fill=SP_POP_TOTL)) + #<<
  coord_sf(xlim=c(-20, 50),
           ylim=c(-40, 40)) +
  scale_fill_viridis_c() +
  labs(fill="Population") +
  theme(legend.position=c(0, 0),
        legend.justification=c(0, 0))
```
]
.pull-right-mod[
```{r choropleth, echo=FALSE, fig.asp=1.25}
```
]

---
class: map

# Map ![:scale 6%](assets/img/section/Cartogram150.png) Cartogram
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r cartogram, eval=FALSE}
africa <- giscoR::gisco_get_countries(
    region="Africa") |>
  left_join(
    africamonitor::am_data(
      series="SP_POP_TOTL",
      from=2021, to=2021),
    by=c("ISO3_CODE"="ISO3")) |>
  sf::st_transform(3857) |>
  cartogram::cartogram_cont( #<<
    "SP_POP_TOTL", itermax=5) |> #<<
  sf::st_transform(4326)

ggplot(africa) +
  geom_sf(aes(fill=SP_POP_TOTL)) + #<<
  coord_sf(xlim=c(-20, 50),
           ylim=c(-40, 40)) +
  scale_fill_viridis_c() +
  labs(fill="Population") +
  theme(legend.position=c(0, 0),
        legend.justification=c(0, 0))
```
]
.pull-right-mod[
```{r cartogram, echo=FALSE, fig.asp=1.25}
```
]

---
class: map

# Map ![:scale 6%](assets/img/section/BubbleMap150.png) Bubble map
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r bubble, eval=FALSE}
africa <- giscoR::gisco_get_countries(
    region="Africa") |>
  left_join(
    africamonitor::am_data(
      series="SP_POP_TOTL",
      from=2021, to=2021),
    by=c("ISO3_CODE"="ISO3"))
centroids <- africa |> #<<
  sf::st_centroid() #<<

ggplot(centroids) + #<<
  geom_sf(data=africa) +
  geom_sf(aes(size=SP_POP_TOTL)) + #<<
  coord_sf(xlim=c(-20, 50),
           ylim=c(-40, 40)) +
  labs(size="Population") +
  theme(legend.position=c(0, 0),
        legend.justification=c(0, 0))
```
]
.pull-right-mod[
```{r bubble, echo=FALSE, fig.asp=1.25}
```
]

---
class: map

# Map ![:scale 6%](assets/img/section/ConnectedMap150.png) Connection
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r connection, eval=FALSE}
africa <- giscoR::gisco_get_countries(
    region="Africa") |>
  left_join(
    africamonitor::am_data(
      series="SP_POP_TOTL",
      from=2021, to=2021),
    by=c("ISO3_CODE"="ISO3"))
centroids <- africa |>
  sf::st_centroid()
lines <- centroids |> #<<
  sf::st_union() |> #<<
  sf::st_cast("LINESTRING") #<<

ggplot(lines) + #<<
  geom_sf(data=africa) +
  geom_sf(aes(size=SP_POP_TOTL),
          data=centroids) +
  geom_sf() + #<<
  coord_sf(xlim=c(-20, 50),
           ylim=c(-40, 40)) +
  labs(size="Population") +
  theme(legend.position=c(0, 0),
        legend.justification=c(0, 0))
```
]
.pull-right-mod[
```{r connection, echo=FALSE, fig.asp=1.25}
```
]

---
class: map

# Map ![:scale 6%](assets/img/section/MapHexbin150.png) Hexbin map
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r hexbin, eval=FALSE}
esp <- mapSpain::esp_get_country()
hexccaa <- mapSpain::esp_get_hex_ccaa() #<<

ggplot(hexccaa) + #<<
  geom_sf(data=esp) +
  geom_sf(aes(fill=codauto), #<<
          alpha=0.3,
          show.legend=FALSE) +
  geom_sf_text(
    aes(label=label),
    check_overlap=TRUE) +
  theme_void(base_size=16)
```
]
.pull-right-mod[
```{r hexbin, echo=FALSE, fig.asp=1.25}
```
]

---
class: map

# Map ![:scale 6%](assets/img/section/MapHexbin150.png) Hexbin map
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r hexbin-prov, eval=FALSE}
esp <- mapSpain::esp_get_country()
hexprov <- mapSpain::esp_get_hex_prov() #<<

ggplot(hexprov) + #<<
  geom_sf(data=esp) +
  geom_sf(aes(fill=codauto),
          alpha=0.3,
          show.legend=FALSE) +
  geom_sf_text(
    aes(label=label),
    check_overlap=TRUE) +
  theme_void(base_size=16)
```
]
.pull-right-mod[
```{r hexbin-prov, echo=FALSE, fig.asp=1.25}
```
]

---
class: map

# Map ![:scale 6%](assets/img/section/MapHexbin150.png) Hexbin map
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r hexbin-prov-grid, eval=FALSE}
esp <- mapSpain::esp_get_country()
gridprov <- mapSpain::esp_get_grid_prov() #<<

ggplot(gridprov) + #<<
  geom_sf(data=esp) +
  geom_sf(aes(fill=codauto),
          alpha=0.3,
          show.legend=FALSE) +
  geom_sf_text(
    aes(label=label),
    check_overlap=TRUE) +
  theme_void(base_size=16)
```
]
.pull-right-mod[
```{r hexbin-prov-grid, echo=FALSE, fig.asp=1.25}
```
]

---
class: flow

# Flow
.footnote[[< Contents](#4)]

[![:scale 15%](assets/img/section/Chord150.png)](https://r-graph-gallery.com/chord-diagram.html)
[![:scale 15%](assets/img/section/Network150.png)](https://r-graph-gallery.com/network.html)
[![:scale 15%](assets/img/section/Sankey150.png)](https://r-graph-gallery.com/sankey-diagram.html)
[![:scale 15%](assets/img/section/Arc150.png)](https://www.data-to-viz.com/graph/arc.html)
[![:scale 15%](assets/img/section/Bundle150.png)](https://r-graph-gallery.com/hierarchical-edge-bundling.html)

.bottom[Chord diagram]
.bottom[Network]
.bottom[Sankey]
.bottom[Arc diagram]
.bottom[Edge bundling]

<br>

.black.font120[
- Visualization of **interconnection** between entities
- Generally, two datasets are required: **nodes** and **edges**
- Data wrangling is a bit different
]

---
class: flow

# Flow ![:scale 6%](assets/img/section/Network150.png) Network
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r network, eval=FALSE}
library(ggraph)
library(tidygraph)

as_tbl_graph(highschool) |> #<<
  mutate(Popularity = centrality_degree(
    mode="in")) |>
ggraph(layout="kk") + #<<
  geom_node_point( #<<
    aes(size=Popularity)) + #<<
  theme(legend.position="top")
```
]
.pull-right-mod[
```{r network, echo=FALSE, fig.asp=1.25}
```
]

---
class: flow

# Flow ![:scale 6%](assets/img/section/Network150.png) Network
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r network-edges, eval=FALSE}
library(ggraph)
library(tidygraph)

as_tbl_graph(highschool) |>
  mutate(Popularity = centrality_degree(
    mode="in")) |>
ggraph(layout="kk") +
  geom_node_point(
    aes(size=Popularity)) +
  geom_edge_link( #<<
    arrow=arrow( #<<
      length=unit(0.1, "inches"), #<<
      type="closed")) + #<<
  theme(legend.position="top")
```
]
.pull-right-mod[
```{r network-edges, echo=FALSE, fig.asp=1.25}
```
]

---
class: flow

# Flow ![:scale 6%](assets/img/section/Network150.png) Network
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r network-edges-fan, eval=FALSE}
library(ggraph)
library(tidygraph)

as_tbl_graph(highschool) |>
  mutate(Popularity = centrality_degree(
    mode="in")) |>
ggraph(layout="kk") +
  geom_node_point(
    aes(size=Popularity)) +
  geom_edge_fan( #<<
    aes(alpha=after_stat(index)), #<<
    show.legend=FALSE) + #<<
  theme(legend.position="top")
```
]
.pull-right-mod[
```{r network-edges-fan, echo=FALSE, fig.asp=1.25}
```
]

---
class: flow

# Flow ![:scale 6%](assets/img/section/Network150.png) Network
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r network-edges-color, eval=FALSE}
library(ggraph)
library(tidygraph)

as_tbl_graph(highschool) |>
  mutate(Popularity = centrality_degree(
    mode="in")) |>
ggraph(layout="kk") +
  geom_node_point(
    aes(size=Popularity)) +
  geom_edge_fan( #<<
    aes(alpha=after_stat(index), #<<
        color=factor(year)), #<<
    show.legend=FALSE) + #<<
  theme(legend.position="top")
```
]
.pull-right-mod[
```{r network-edges-color, echo=FALSE, fig.asp=1.25}
```
]

---
class: flow

# Flow ![:scale 6%](assets/img/section/Network150.png) Network
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r network-facet, eval=FALSE}
library(ggraph)
library(tidygraph)

as_tbl_graph(highschool) |>
  mutate(Popularity = centrality_degree(
    mode="in")) |>
ggraph(layout="kk") +
  geom_node_point(
    aes(size=Popularity)) +
  geom_edge_fan(
    aes(alpha=after_stat(index)),
    show.legend=FALSE) +
  facet_edges(~year, ncol=1) + #<<
  theme(legend.position="top")
```
]
.pull-right-mod[
```{r network-facet, echo=FALSE, fig.asp=1.25}
```
]

---
class: flow

# Flow ![:scale 6%](assets/img/section/Network150.png) Network
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r network-theme, eval=FALSE}
library(ggraph)
library(tidygraph)

as_tbl_graph(highschool) |>
  mutate(Popularity = centrality_degree(
    mode="in")) |>
ggraph(layout="kk") +
  geom_node_point(
    aes(size=Popularity)) +
  geom_edge_fan(
    aes(alpha=after_stat(index)),
    show.legend=FALSE) +
  facet_edges(~year, ncol=1) +
  theme_graph(base_size=16, #<<
              foreground="#a53253", #<<
              fg_text_colour="white") + #<<
  theme(legend.position="top")
```
]
.pull-right-mod[
```{r network-theme, echo=FALSE, fig.asp=1.25}
```
]

---
class: flow

# Flow ![:scale 6%](assets/img/section/Arc150.png) Arc diagram
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r network-arc, eval=FALSE}
library(ggraph)
library(tidygraph)

as_tbl_graph(highschool) |>
  mutate(Popularity = centrality_degree(
    mode="in")) |>
ggraph(layout="linear") + #<<
  geom_node_point(
    aes(size=Popularity)) +
  geom_edge_arc( #<<
    aes(alpha=after_stat(index)),
    show.legend=FALSE) +
  facet_edges(~year, ncol=1) +
  theme_graph(base_size=16,
              foreground="#a53253",
              fg_text_colour="white") +
  theme(legend.position="top")
```
]
.pull-right-mod[
```{r network-arc, echo=FALSE, fig.asp=1.25}
```
]

---
class: flow

# Flow ![:scale 6%](assets/img/section/Arc150.png) Arc diagram
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r network-circular, eval=FALSE}
library(ggraph)
library(tidygraph)

as_tbl_graph(highschool) |>
  mutate(Popularity = centrality_degree(
    mode="in")) |>
ggraph(layout="linear", circular=TRUE) + #<<
  coord_fixed() + #<<
  geom_node_point(
    aes(size=Popularity)) +
  geom_edge_arc(
    aes(alpha=after_stat(index)),
    show.legend=FALSE) +
  facet_edges(~year, ncol=1) +
  theme_graph(base_size=16,
              foreground="#a53253",
              fg_text_colour="white") +
  theme(legend.position="top")
```
]
.pull-right-mod[
```{r network-circular, echo=FALSE, fig.asp=1.25}
```
]

---
class: flow

# Flow ![:scale 6%](assets/img/section/Bundle150.png) Edge bundling
.footnote[[< Contents](#4) | Data from [**ggraph manual**](https://ggraph.data-imaginist.com/reference/geom_conn_bundle.html)]

.pull-left-mod[
```{r, echo=FALSE}
flareGraph <- tbl_graph(
  flare$vertices, flare$edges) |>
  mutate(
    class = map_bfs_chr(node_is_root(), .f = function(node, dist, path, ...) {
      if (dist <= 1) {
        return(shortName[node])
      }
      path$result[[nrow(path)]]
    })
  )
importFrom <- match(flare$imports$from, flare$vertices$name)
importTo <- match(flare$imports$to, flare$vertices$name)
```
```{r network-bundle, eval=FALSE}
library(ggraph)
library(tidygraph)

# flareGraph <- ...
# importFrom <- ...
# importTo <- ...

ggraph(flareGraph, "dendrogram", #<<
       circular=TRUE) + #<<
  coord_fixed() + #<<
  geom_node_point() +
  theme_graph(base_size=16)
```
]
.pull-right-mod[
```{r network-bundle, echo=FALSE, fig.asp=1.25}
```
]

---
class: flow

# Flow ![:scale 6%](assets/img/section/Bundle150.png) Edge bundling
.footnote[[< Contents](#4) | Data from [**ggraph manual**](https://ggraph.data-imaginist.com/reference/geom_conn_bundle.html)]

.pull-left-mod[
```{r network-bundle-nodes, eval=FALSE}
library(ggraph)
library(tidygraph)

# flareGraph <- ...
# importFrom <- ...
# importTo <- ...

ggraph(flareGraph, "dendrogram",
       circular=TRUE) +
  coord_fixed() +
  geom_node_point(
    aes(filter=leaf, color=class)) + #<<
  theme_graph(base_size=16) +
  theme(legend.position="top")
```
]
.pull-right-mod[
```{r network-bundle-nodes, echo=FALSE, fig.asp=1.25}
```
]

---
class: flow

# Flow ![:scale 6%](assets/img/section/Bundle150.png) Edge bundling
.footnote[[< Contents](#4) | Data from [**ggraph manual**](https://ggraph.data-imaginist.com/reference/geom_conn_bundle.html)]

.pull-left-mod[
```{r network-bundle-edges, eval=FALSE}
library(ggraph)
library(tidygraph)

# flareGraph <- ...
# importFrom <- ...
# importTo <- ...

ggraph(flareGraph, "dendrogram",
       circular=TRUE) +
  coord_fixed() +
  geom_node_point(
    aes(filter=leaf, color=class)) +
  geom_conn_bundle( #<<
    aes(color=after_stat(index)), #<<
    data=get_con(importFrom, importTo), #<<
    edge_alpha=0.25) + #<<
  theme_graph(base_size=16) +
  theme(legend.position="top")
```
]
.pull-right-mod[
```{r network-bundle-edges, echo=FALSE, fig.asp=1.25}
```
]

---
class: flow

# Flow ![:scale 6%](assets/img/section/Bundle150.png) Edge bundling
.footnote[[< Contents](#4) | Data from [**ggraph manual**](https://ggraph.data-imaginist.com/reference/geom_conn_bundle.html)]

.pull-left-mod[
```{r network-bundle-guide, eval=FALSE}
library(ggraph)
library(tidygraph)

# flareGraph <- ...
# importFrom <- ...
# importTo <- ...

ggraph(flareGraph, "dendrogram",
       circular=TRUE) +
  coord_fixed() +
  geom_node_point(
    aes(filter=leaf, color=class)) +
  geom_conn_bundle(
    aes(color=after_stat(index)),
    data=get_con(importFrom, importTo),
    edge_alpha=0.25) +
  scale_edge_colour_distiller( #<<
    NULL, guide="edge_direction") + #<<
  theme_graph(base_size=16) +
  theme(legend.position="top")
```
]
.pull-right-mod[
```{r network-bundle-guide, echo=FALSE, fig.asp=1.25}
```
]

---
class: flow

# Flow ![:scale 6%](assets/img/section/Chord150.png) Chord diagram
.footnote[[< Contents](#4)]

.pull-left-mod[
- Out of the scope
- Requires `circlize`, `chorddiag`
- See the [**source**](https://www.data-to-viz.com/graph/chord.html)
]
.pull-right-mod[
```{r chord, echo=FALSE, fig.asp=1.25}
knitr::include_graphics("ch3_files/chorddiagram.png")
```
]

---
class: flow

# Flow ![:scale 6%](assets/img/section/Sankey150.png) Sankey / Alluvial
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r sankey, eval=FALSE}
# remotes::install_github(
#   "davidsjoberg/ggsankey")
df <- mtcars |>
  ggsankey::make_long(
    cyl, vs, am, gear, carb)

ggplot(df) +
  aes(x, next_x=next_x, #<<
      node=node, next_node=next_node, #<<
      fill=factor(node)) +
  ggsankey::geom_sankey() + #<<
  scale_fill_viridis_d() +
  labs(x=NULL) +
  theme(legend.position="top")
```
]
.pull-right-mod[
```{r sankey, echo=FALSE, fig.asp=1.25}
```
]

---
class: flow

# Flow ![:scale 6%](assets/img/section/Sankey150.png) Sankey / Alluvial
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r sankey-nodes, eval=FALSE}
# remotes::install_github(
#   "davidsjoberg/ggsankey")
df <- mtcars |>
  ggsankey::make_long(
    cyl, vs, am, gear, carb)

ggplot(df) +
  aes(x, next_x=next_x,
      node=node, next_node=next_node,
      fill=factor(node)) +
  ggsankey::geom_sankey(
    flow.alpha=0.6, #<<
    node.color="gray30") + #<<
  scale_fill_viridis_d() +
  labs(x=NULL) +
  theme(legend.position="top")
```
]
.pull-right-mod[
```{r sankey-nodes, echo=FALSE, fig.asp=1.25}
```
]

---
class: flow

# Flow ![:scale 6%](assets/img/section/Sankey150.png) Sankey / Alluvial
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r sankey-labels, eval=FALSE}
# remotes::install_github(
#   "davidsjoberg/ggsankey")
df <- mtcars |>
  ggsankey::make_long(
    cyl, vs, am, gear, carb)

ggplot(df) +
  aes(x, next_x=next_x,
      node=node, next_node=next_node,
      fill=factor(node),
      label=node) + #<<
  ggsankey::geom_sankey(
    flow.alpha=0.6,
    node.color="gray30") +
  ggsankey::geom_sankey_label( #<<
    size=3, color="white", #<<
    fill="gray40") + #<<
  scale_fill_viridis_d() +
  labs(x=NULL) +
  theme(legend.position="none")
```
]
.pull-right-mod[
```{r sankey-labels, echo=FALSE, fig.asp=1.25}
```
]

---
class: flow

# Flow ![:scale 6%](assets/img/section/Sankey150.png) Sankey / Alluvial
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r sankey-theme, eval=FALSE}
# remotes::install_github(
#   "davidsjoberg/ggsankey")
df <- mtcars |>
  ggsankey::make_long(
    cyl, vs, am, gear, carb)

ggplot(df) +
  aes(x, next_x=next_x,
      node=node, next_node=next_node,
      fill=factor(node),
      label=node) +
  ggsankey::geom_sankey(
    flow.alpha=0.6,
    node.color="gray30") +
  ggsankey::geom_sankey_label(
    size=3, color="white",
    fill="gray40") +
  scale_fill_viridis_d() +
  ggsankey::theme_sankey(base_size=16) + #<<
  labs(x=NULL) +
  theme(legend.position="none")
```
]
.pull-right-mod[
```{r sankey-theme, echo=FALSE, fig.asp=1.25}
```
]

---
class: flow

# Flow ![:scale 6%](assets/img/section/Map150.png)![:scale 6%](assets/img/section/Network150.png) Geospatial network
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r sfnetwork, eval=FALSE}
library(tidygraph)
library(sfnetworks) #<<

net <- as_sfnetwork(roxel, directed=F) |> #<<
  activate("nodes") |>
  mutate(bc = centrality_betweenness())

ggplot() +
  geom_sf(data=sf::st_as_sf(net, "edges"), #<<
          color="grey50") + #<<
  geom_sf(data=sf::st_as_sf(net, "nodes"), #<<
          aes(color=bc)) + #<<
  scale_color_viridis_c() +
  theme(legend.position=c(1, 0),
        legend.justification=c(1, 0))
```
]
.pull-right-mod[
```{r sfnetwork, echo=FALSE, fig.asp=1.25}
```
]

---
class: flow

# Flow ![:scale 6%](assets/img/section/Map150.png)![:scale 6%](assets/img/section/Network150.png) Geospatial network
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r sfnetwork-ggraph, eval=FALSE}
library(ggraph) #<<
library(tidygraph)
library(sfnetworks)

net <- as_sfnetwork(roxel, directed=F) |>
  activate("nodes") |>
  mutate(bc = centrality_betweenness())

ggraph(net) + #<<
  geom_edge_link(color="grey50") + #<<
  geom_node_point(aes(color=bc)) + #<<
  scale_color_viridis_c() +
  theme(legend.position=c(1, 0),
        legend.justification=c(1, 0))
```
]
.pull-right-mod[
```{r sfnetwork-ggraph, echo=FALSE, fig.asp=1.25}
```
]

---
class: flow

# Flow ![:scale 6%](assets/img/section/Map150.png)![:scale 6%](assets/img/section/Network150.png) Geospatial network
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r sfnetwork-ggraph-layout, eval=FALSE}
library(ggraph)
library(tidygraph)
library(sfnetworks)

net <- as_sfnetwork(roxel, directed=F) |>
  activate("nodes") |>
  mutate(bc = centrality_betweenness())

layout_sf <- function(graph) { #<<
  graph <- activate(graph, "nodes") #<<
  data.frame( #<<
    x=sf::st_coordinates(graph)[,"X"], #<<
    y=sf::st_coordinates(graph)[,"Y"]) #<<
} #<<

ggraph(net, layout=layout_sf) + #<<
  geom_edge_link(color="grey50") +
  geom_node_point(aes(color=bc)) +
  scale_color_viridis_c() +
  theme(legend.position=c(1, 0),
        legend.justification=c(1, 0))
```
]
.pull-right-mod[
```{r sfnetwork-ggraph-layout, echo=FALSE, fig.asp=1.25}
```
]

---
class: flow

# Flow ![:scale 6%](assets/img/section/Map150.png)![:scale 6%](assets/img/section/Network150.png) Geospatial network
.footnote[[< Contents](#4)]

.pull-left-mod[
```{r sfnetwork-ggraph-coord, eval=FALSE}
library(ggraph)
library(tidygraph)
library(sfnetworks)

net <- as_sfnetwork(roxel, directed=F) |>
  activate("nodes") |>
  mutate(bc = centrality_betweenness())

layout_sf <- function(graph) {
  graph <- activate(graph, "nodes")
  data.frame(
    x=sf::st_coordinates(graph)[,"X"],
    y=sf::st_coordinates(graph)[,"Y"])
}

ggraph(net, layout=layout_sf) +
  geom_edge_link(color="grey50") +
  geom_node_point(aes(color=bc)) +
  coord_sf(crs=sf::st_crs(net)) + #<<
  scale_color_viridis_c() +
  theme(legend.position=c(1, 0),
        legend.justification=c(1, 0))
```
]
.pull-right-mod[
```{r sfnetwork-ggraph-coord, echo=FALSE, fig.asp=1.25}
```
]

---
class: other

# Other Resources
.footnote[[< Contents](#4)]

[![:scale 15%](assets/img/section/anim150.gif)](https://r-graph-gallery.com/animation.html)
[![:scale 15%](assets/img/section/Interactive150.png)](https://r-graph-gallery.com/interactive-charts.html)
[![:scale 15%](assets/img/section/Bad150.png)](https://www.data-to-viz.com/caveats.html)
[![:scale 15%](assets/img/section/DataArt1150.png)](https://www.data-to-art.com/)

.bottom[Animation]
.bottom[Interactive]
.bottom[Caveats]
.bottom[Data Art]

<br>

.black.font120[
]
